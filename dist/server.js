var a221_0x3720=['remotePort','******result:\x20','startsWith','ST910','eventsController','reportEvent','then','alarm:\x20','close','splice','LPR','parse','infoplate','controllers','vehiclesCountController','report','img','dataValues','uuid','.png','base64','fullData:\x20','CLOSED:\x20','__esModule','defineProperty','./app','./infrastructure/sequelize-utils','./tasks/fileOptimizationTask','fs-extra','default','use','env','EXPRESS_SERVICE_ENABLED','FILE_OPTIMIZATION_SERVICE_ENABLED','true','SOCKET_SERVICE_ENABLED','listen','get','port','log','\x20\x20Press\x20CTRL-C\x20to\x20stop\x0a','start','net','createServer','TCP\x20Server\x20is\x20running\x20on\x20port\x20','vehiclesCount/','ensureDir','connection','remoteAddress'];(function(_0x516ced,_0x5ee441){var _0x3733b1=function(_0x10869f){while(--_0x10869f){_0x516ced['push'](_0x516ced['shift']());}};_0x3733b1(++_0x5ee441);}(a221_0x3720,0x16e));var a221_0x22c4=function(_0x263e28,_0x304453){_0x263e28=_0x263e28-0x0;var _0x5b7065=a221_0x3720[_0x263e28];return _0x5b7065;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x525841){return _0x525841&&_0x525841[a221_0x22c4('0x0')]?_0x525841:{'default':_0x525841};};Object[a221_0x22c4('0x1')](exports,a221_0x22c4('0x0'),{'value':!![]});const errorhandler_1=__importDefault(require('errorhandler'));const app_1=__importDefault(require(a221_0x22c4('0x2')));const sequelize_utils_1=__importDefault(require(a221_0x22c4('0x3')));const fileOptimizationTask_1=__importDefault(require(a221_0x22c4('0x4')));const fsExtra=require(a221_0x22c4('0x5'));app_1[a221_0x22c4('0x6')][a221_0x22c4('0x7')](errorhandler_1[a221_0x22c4('0x6')]());const expressServiceEnabled=process[a221_0x22c4('0x8')][a221_0x22c4('0x9')]=='true';const fileOptimizationEnabled=process[a221_0x22c4('0x8')][a221_0x22c4('0xa')]==a221_0x22c4('0xb');const socketServiceEnabled=process[a221_0x22c4('0x8')][a221_0x22c4('0xc')]==a221_0x22c4('0xb');if(expressServiceEnabled){const server=app_1[a221_0x22c4('0x6')][a221_0x22c4('0xd')](app_1[a221_0x22c4('0x6')][a221_0x22c4('0xe')](a221_0x22c4('0xf')),()=>{console['log']('\x20\x20App\x20is\x20running\x20at\x20http://localhost:%d\x20in\x20%s\x20mode',app_1[a221_0x22c4('0x6')][a221_0x22c4('0xe')](a221_0x22c4('0xf')),app_1[a221_0x22c4('0x6')][a221_0x22c4('0xe')](a221_0x22c4('0x8')));console[a221_0x22c4('0x10')](a221_0x22c4('0x11'));});}if(fileOptimizationEnabled){const fileOptimizationTask=new fileOptimizationTask_1['default']();fileOptimizationTask[a221_0x22c4('0x12')]();}if(socketServiceEnabled){const net=require(a221_0x22c4('0x13'));const port=0x46;const host='0.0.0.0';const fs=require('fs');const socketServer=net[a221_0x22c4('0x14')]();socketServer['listen'](port,host,()=>{console['log'](a221_0x22c4('0x15')+port+'.');});const imageFolder=process[a221_0x22c4('0x8')]['IMAGE_FILES_FOLDER']+a221_0x22c4('0x16');fsExtra[a221_0x22c4('0x17')](imageFolder,_0x1b9145=>{console[a221_0x22c4('0x10')](_0x1b9145);});const sockets=[];socketServer['on'](a221_0x22c4('0x18'),function(_0x2f0131){console[a221_0x22c4('0x10')]('CONNECTED:\x20'+_0x2f0131[a221_0x22c4('0x19')]+':'+_0x2f0131[a221_0x22c4('0x1a')]);let _0x415e83='';_0x2f0131['on']('data',function(_0x5bdfaf){const _0x2f0a0d=String(_0x5bdfaf);console[a221_0x22c4('0x10')](a221_0x22c4('0x1b'));console['log'](_0x2f0a0d);_0x415e83+=_0x2f0a0d;if(_0x2f0a0d[a221_0x22c4('0x1c')](a221_0x22c4('0x1d'))){console[a221_0x22c4('0x10')]('alarm');const _0x5bb23b={};sequelize_utils_1['default']['controllers'][a221_0x22c4('0x1e')][a221_0x22c4('0x1f')]({'body':{'data':''}},null,null)[a221_0x22c4('0x20')](_0x407042=>{console['log'](a221_0x22c4('0x21'));console[a221_0x22c4('0x10')](_0x407042);});}});_0x2f0131['on'](a221_0x22c4('0x22'),function(_0xaab5e7){const _0xea82f8=sockets['findIndex'](function(_0x3e7e28){return _0x3e7e28[a221_0x22c4('0x19')]===_0x2f0131[a221_0x22c4('0x19')]&&_0x3e7e28['remotePort']===_0x2f0131[a221_0x22c4('0x1a')];});if(_0xea82f8!==-0x1)sockets[a221_0x22c4('0x23')](_0xea82f8,0x1);if(_0x415e83[a221_0x22c4('0x1c')](a221_0x22c4('0x1d'))){}else{console[a221_0x22c4('0x10')](a221_0x22c4('0x24'));_0x415e83=_0x415e83['substr'](_0x415e83['indexOf']('{'));let _0x3a947b={};try{_0x3a947b=JSON[a221_0x22c4('0x25')](_0x415e83);}catch(_0x4fedbb){console[a221_0x22c4('0x10')](_0x4fedbb);}if(_0x3a947b[a221_0x22c4('0x26')]!=null&&_0x3a947b[a221_0x22c4('0x26')]!=''){sequelize_utils_1['default'][a221_0x22c4('0x27')][a221_0x22c4('0x28')][a221_0x22c4('0x29')]({'body':_0x3a947b},null,null)[a221_0x22c4('0x20')](_0xfefbab=>{console[a221_0x22c4('0x10')](_0xfefbab['dataValues']);if(_0x3a947b['infoplate'][a221_0x22c4('0x2a')]!=null&&_0x3a947b[a221_0x22c4('0x26')][a221_0x22c4('0x2a')]!='')fsExtra['writeFile'](imageFolder+_0xfefbab[a221_0x22c4('0x2b')][a221_0x22c4('0x2c')]+a221_0x22c4('0x2d'),_0x3a947b['infoplate']['img'],a221_0x22c4('0x2e'),function(_0x27d004){console[a221_0x22c4('0x10')](_0x27d004);});});}}console['log'](a221_0x22c4('0x2f')+_0x415e83);console[a221_0x22c4('0x10')](a221_0x22c4('0x30')+_0x2f0131[a221_0x22c4('0x19')]+'\x20'+_0x2f0131[a221_0x22c4('0x1a')]);});});}exports[a221_0x22c4('0x6')]=null;