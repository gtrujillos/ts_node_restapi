var a221_0x136d=['infoplate','vehiclesCountController','dataValues','img','writeFile','uuid','CLOSED:\x20','__esModule','defineProperty','fs-extra','use','default','EXPRESS_SERVICE_ENABLED','true','env','FILE_OPTIMIZATION_SERVICE_ENABLED','listen','get','port','log','\x20\x20App\x20is\x20running\x20at\x20http://localhost:%d\x20in\x20%s\x20mode','start','net','0.0.0.0','createServer','TCP\x20Server\x20is\x20running\x20on\x20port\x20','IMAGE_FILES_FOLDER','vehiclesCount/','connection','CONNECTED:\x20','remoteAddress','******result:\x20','startsWith','controllers','eventsController','reportEvent','then','alarm:\x20','findIndex','remotePort','splice','ST910','LPR','substr','parse'];(function(_0x95f0a5,_0x51cc68){var _0x11c26f=function(_0xe2b612){while(--_0xe2b612){_0x95f0a5['push'](_0x95f0a5['shift']());}};_0x11c26f(++_0x51cc68);}(a221_0x136d,0x142));var a221_0x530e=function(_0x17078f,_0x28b770){_0x17078f=_0x17078f-0x0;var _0xbca7a1=a221_0x136d[_0x17078f];return _0xbca7a1;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x255e7d){return _0x255e7d&&_0x255e7d[a221_0x530e('0x0')]?_0x255e7d:{'default':_0x255e7d};};Object[a221_0x530e('0x1')](exports,a221_0x530e('0x0'),{'value':!![]});const errorhandler_1=__importDefault(require('errorhandler'));const app_1=__importDefault(require('./app'));const sequelize_utils_1=__importDefault(require('./infrastructure/sequelize-utils'));const fileOptimizationTask_1=__importDefault(require('./tasks/fileOptimizationTask'));const fsExtra=require(a221_0x530e('0x2'));app_1['default'][a221_0x530e('0x3')](errorhandler_1[a221_0x530e('0x4')]());const expressServiceEnabled=process['env'][a221_0x530e('0x5')]==a221_0x530e('0x6');const fileOptimizationEnabled=process[a221_0x530e('0x7')][a221_0x530e('0x8')]==a221_0x530e('0x6');const socketServiceEnabled=process['env']['SOCKET_SERVICE_ENABLED']==a221_0x530e('0x6');if(expressServiceEnabled){const server=app_1[a221_0x530e('0x4')][a221_0x530e('0x9')](app_1[a221_0x530e('0x4')][a221_0x530e('0xa')](a221_0x530e('0xb')),()=>{console[a221_0x530e('0xc')](a221_0x530e('0xd'),app_1[a221_0x530e('0x4')][a221_0x530e('0xa')](a221_0x530e('0xb')),app_1[a221_0x530e('0x4')][a221_0x530e('0xa')](a221_0x530e('0x7')));console[a221_0x530e('0xc')]('\x20\x20Press\x20CTRL-C\x20to\x20stop\x0a');});}if(fileOptimizationEnabled){const fileOptimizationTask=new fileOptimizationTask_1[(a221_0x530e('0x4'))]();fileOptimizationTask[a221_0x530e('0xe')]();}if(socketServiceEnabled){const net=require(a221_0x530e('0xf'));const port=0x46;const host=a221_0x530e('0x10');const fs=require('fs');const socketServer=net[a221_0x530e('0x11')]();socketServer[a221_0x530e('0x9')](port,host,()=>{console[a221_0x530e('0xc')](a221_0x530e('0x12')+port+'.');});const imageFolder=process['env'][a221_0x530e('0x13')]+a221_0x530e('0x14');fsExtra['ensureDir'](imageFolder,_0x109900=>{console[a221_0x530e('0xc')](_0x109900);});const sockets=[];socketServer['on'](a221_0x530e('0x15'),function(_0x2e9752){console['log'](a221_0x530e('0x16')+_0x2e9752[a221_0x530e('0x17')]+':'+_0x2e9752['remotePort']);let _0x4e199a='';_0x2e9752['on']('data',function(_0x5ed54){const _0x25a628=String(_0x5ed54);console[a221_0x530e('0xc')](a221_0x530e('0x18'));console['log'](_0x25a628);_0x4e199a+=_0x25a628;if(_0x25a628[a221_0x530e('0x19')]('ST910')){console[a221_0x530e('0xc')]('alarm');const _0xfec626={};sequelize_utils_1[a221_0x530e('0x4')][a221_0x530e('0x1a')][a221_0x530e('0x1b')][a221_0x530e('0x1c')]({'body':{'data':''}},null,null)[a221_0x530e('0x1d')](_0x402820=>{console[a221_0x530e('0xc')](a221_0x530e('0x1e'));console[a221_0x530e('0xc')](_0x402820);});}});_0x2e9752['on']('close',function(_0x288f7e){const _0x2c1583=sockets[a221_0x530e('0x1f')](function(_0xd8ad3c){return _0xd8ad3c['remoteAddress']===_0x2e9752[a221_0x530e('0x17')]&&_0xd8ad3c['remotePort']===_0x2e9752[a221_0x530e('0x20')];});if(_0x2c1583!==-0x1)sockets[a221_0x530e('0x21')](_0x2c1583,0x1);if(_0x4e199a[a221_0x530e('0x19')](a221_0x530e('0x22'))){}else{console[a221_0x530e('0xc')](a221_0x530e('0x23'));_0x4e199a=_0x4e199a[a221_0x530e('0x24')](_0x4e199a['indexOf']('{'));let _0x216f20={};try{_0x216f20=JSON[a221_0x530e('0x25')](_0x4e199a);}catch(_0x125564){console[a221_0x530e('0xc')](_0x125564);}if(_0x216f20[a221_0x530e('0x26')]!=null&&_0x216f20[a221_0x530e('0x26')]!=''){sequelize_utils_1[a221_0x530e('0x4')][a221_0x530e('0x1a')][a221_0x530e('0x27')]['report']({'body':_0x216f20},null,null)[a221_0x530e('0x1d')](_0x5b0551=>{console['log'](_0x5b0551[a221_0x530e('0x28')]);if(_0x216f20[a221_0x530e('0x26')][a221_0x530e('0x29')]!=null&&_0x216f20[a221_0x530e('0x26')][a221_0x530e('0x29')]!='')fsExtra[a221_0x530e('0x2a')](imageFolder+_0x5b0551[a221_0x530e('0x28')][a221_0x530e('0x2b')]+'.png',_0x216f20[a221_0x530e('0x26')][a221_0x530e('0x29')],'base64',function(_0x4a25c9){console[a221_0x530e('0xc')](_0x4a25c9);});});}}console[a221_0x530e('0xc')]('fullData:\x20'+_0x4e199a);console[a221_0x530e('0xc')](a221_0x530e('0x2c')+_0x2e9752[a221_0x530e('0x17')]+'\x20'+_0x2e9752['remotePort']);});});}exports[a221_0x530e('0x4')]=null;