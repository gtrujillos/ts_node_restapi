var a157_0x5b49=['./app','./infrastructure/sequelize-utils','./tasks/fileOptimizationTask','use','default','EXPRESS_SERVICE_ENABLED','true','env','SOCKET_SERVICE_ENABLED','listen','get','port','log','\x20\x20App\x20is\x20running\x20at\x20http://localhost:%d\x20in\x20%s\x20mode','start','createServer','TCP\x20Server\x20is\x20running\x20on\x20port\x20','vehiclesCount/','ensureDir','CONNECTED:\x20','startsWith','ST910','alarm','alarmsController','then','alarm:\x20','close','findIndex','remoteAddress','remotePort','splice','substr','indexOf','parse','infoplate','vehiclesCountController','dataValues','img','writeFile','.png','base64','fullData:\x20','CLOSED:\x20','__importDefault','__esModule','defineProperty','errorhandler'];(function(_0x230bb2,_0x2fbd54){var _0x25586d=function(_0x62649a){while(--_0x62649a){_0x230bb2['push'](_0x230bb2['shift']());}};_0x25586d(++_0x2fbd54);}(a157_0x5b49,0xe7));var a157_0x121b=function(_0xd53ac,_0x4d5672){_0xd53ac=_0xd53ac-0x0;var _0x5d63f0=a157_0x5b49[_0xd53ac];return _0x5d63f0;};'use strict';var __importDefault=this&&this[a157_0x121b('0x0')]||function(_0x3e1300){return _0x3e1300&&_0x3e1300[a157_0x121b('0x1')]?_0x3e1300:{'default':_0x3e1300};};Object[a157_0x121b('0x2')](exports,a157_0x121b('0x1'),{'value':!![]});const errorhandler_1=__importDefault(require(a157_0x121b('0x3')));const app_1=__importDefault(require(a157_0x121b('0x4')));const sequelize_utils_1=__importDefault(require(a157_0x121b('0x5')));const fileOptimizationTask_1=__importDefault(require(a157_0x121b('0x6')));const fsExtra=require('fs-extra');app_1['default'][a157_0x121b('0x7')](errorhandler_1[a157_0x121b('0x8')]());const expressServiceEnabled=process['env'][a157_0x121b('0x9')]==a157_0x121b('0xa');const fileOptimizationEnabled=process[a157_0x121b('0xb')]['FILE_OPTIMIZATION_SERVICE_ENABLED']==a157_0x121b('0xa');const socketServiceEnabled=process[a157_0x121b('0xb')][a157_0x121b('0xc')]=='true';if(expressServiceEnabled){const server=app_1[a157_0x121b('0x8')][a157_0x121b('0xd')](app_1[a157_0x121b('0x8')][a157_0x121b('0xe')](a157_0x121b('0xf')),()=>{console[a157_0x121b('0x10')](a157_0x121b('0x11'),app_1['default'][a157_0x121b('0xe')](a157_0x121b('0xf')),app_1[a157_0x121b('0x8')][a157_0x121b('0xe')]('env'));console[a157_0x121b('0x10')]('\x20\x20Press\x20CTRL-C\x20to\x20stop\x0a');});}if(fileOptimizationEnabled){const fileOptimizationTask=new fileOptimizationTask_1[(a157_0x121b('0x8'))]();fileOptimizationTask[a157_0x121b('0x12')]();}if(socketServiceEnabled){const net=require('net');const port=0x46;const host='0.0.0.0';const fs=require('fs');const socketServer=net[a157_0x121b('0x13')]();socketServer['listen'](port,host,()=>{console['log'](a157_0x121b('0x14')+port+'.');});const imageFolder=process[a157_0x121b('0xb')]['IMAGE_FILES_FOLDER']+a157_0x121b('0x15');fsExtra[a157_0x121b('0x16')](imageFolder,_0x9429ab=>{console['log'](_0x9429ab);});const sockets=[];socketServer['on']('connection',function(_0x10e322){console[a157_0x121b('0x10')](a157_0x121b('0x17')+_0x10e322['remoteAddress']+':'+_0x10e322['remotePort']);let _0x27bb8a='';_0x10e322['on']('data',function(_0x36c9ca){const _0x1ff65d=String(_0x36c9ca);console[a157_0x121b('0x10')]('******result:\x20');console['log'](_0x1ff65d);_0x27bb8a+=_0x1ff65d;if(_0x1ff65d[a157_0x121b('0x18')](a157_0x121b('0x19'))){console[a157_0x121b('0x10')](a157_0x121b('0x1a'));const _0x2ea787={};sequelize_utils_1['default']['controllers'][a157_0x121b('0x1b')]['reportAlarm']({'body':{'data':''}},null,null)[a157_0x121b('0x1c')](_0x4c763e=>{console[a157_0x121b('0x10')](a157_0x121b('0x1d'));console[a157_0x121b('0x10')](_0x4c763e);});}});_0x10e322['on'](a157_0x121b('0x1e'),function(_0x29c001){const _0x151720=sockets[a157_0x121b('0x1f')](function(_0x228522){return _0x228522[a157_0x121b('0x20')]===_0x10e322[a157_0x121b('0x20')]&&_0x228522[a157_0x121b('0x21')]===_0x10e322[a157_0x121b('0x21')];});if(_0x151720!==-0x1)sockets[a157_0x121b('0x22')](_0x151720,0x1);if(_0x27bb8a[a157_0x121b('0x18')](a157_0x121b('0x19'))){}else{console[a157_0x121b('0x10')]('LPR');_0x27bb8a=_0x27bb8a[a157_0x121b('0x23')](_0x27bb8a[a157_0x121b('0x24')]('{'));let _0x4379f5={};try{_0x4379f5=JSON[a157_0x121b('0x25')](_0x27bb8a);}catch(_0xf7b978){console[a157_0x121b('0x10')](_0xf7b978);}if(_0x4379f5[a157_0x121b('0x26')]!=null&&_0x4379f5['infoplate']!=''){sequelize_utils_1[a157_0x121b('0x8')]['controllers'][a157_0x121b('0x27')]['report']({'body':_0x4379f5},null,null)[a157_0x121b('0x1c')](_0x3f1c2f=>{console[a157_0x121b('0x10')](_0x3f1c2f[a157_0x121b('0x28')]);if(_0x4379f5[a157_0x121b('0x26')]['img']!=null&&_0x4379f5[a157_0x121b('0x26')][a157_0x121b('0x29')]!='')fsExtra[a157_0x121b('0x2a')](imageFolder+_0x3f1c2f['dataValues']['uuid']+a157_0x121b('0x2b'),_0x4379f5[a157_0x121b('0x26')][a157_0x121b('0x29')],a157_0x121b('0x2c'),function(_0x2e82e9){console['log'](_0x2e82e9);});});}}console[a157_0x121b('0x10')](a157_0x121b('0x2d')+_0x27bb8a);console[a157_0x121b('0x10')](a157_0x121b('0x2e')+_0x10e322['remoteAddress']+'\x20'+_0x10e322[a157_0x121b('0x21')]);});});}exports[a157_0x121b('0x8')]=null;