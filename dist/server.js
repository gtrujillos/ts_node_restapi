var a110_0x1fae=['__esModule','errorhandler','./app','./infrastructure/sequelize-utils','default','EXPRESS_SERVICE_ENABLED','true','env','SOCKET_SERVICE_ENABLED','get','port','log','\x20\x20App\x20is\x20running\x20at\x20http://localhost:%d\x20in\x20%s\x20mode','\x20\x20Press\x20CTRL-C\x20to\x20stop\x0a','start','net','0.0.0.0','createServer','listen','TCP\x20Server\x20is\x20running\x20on\x20port\x20','IMAGE_FILES_FOLDER','vehiclesCount/','ensureDir','connection','CONNECTED:\x20','remoteAddress','remotePort','data','******result:\x20','ST910','controllers','alarmsController','reportAlarm','findIndex','LPR','substr','indexOf','parse','infoplate','report','then','dataValues','img','writeFile','uuid','.png','base64','defineProperty'];(function(_0x2699a9,_0x501e82){var _0x5b6c40=function(_0xa3de42){while(--_0xa3de42){_0x2699a9['push'](_0x2699a9['shift']());}};_0x5b6c40(++_0x501e82);}(a110_0x1fae,0x1af));var a110_0xf0ef=function(_0x4e1b58,_0x55b8d1){_0x4e1b58=_0x4e1b58-0x0;var _0x46da3c=a110_0x1fae[_0x4e1b58];return _0x46da3c;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x176792){return _0x176792&&_0x176792['__esModule']?_0x176792:{'default':_0x176792};};Object[a110_0xf0ef('0x0')](exports,a110_0xf0ef('0x1'),{'value':!![]});const errorhandler_1=__importDefault(require(a110_0xf0ef('0x2')));const app_1=__importDefault(require(a110_0xf0ef('0x3')));const sequelize_utils_1=__importDefault(require(a110_0xf0ef('0x4')));const fileOptimizationDemon_1=__importDefault(require('./tasks/fileOptimizationDemon'));const fsExtra=require('fs-extra');app_1[a110_0xf0ef('0x5')]['use'](errorhandler_1['default']());const expressServiceEnabled=process['env'][a110_0xf0ef('0x6')]==a110_0xf0ef('0x7');const fileOptimizationEnabled=process[a110_0xf0ef('0x8')]['FILE_OPTIMIZATION_SERVICE_ENABLED']=='true';const socketServiceEnabled=process['env'][a110_0xf0ef('0x9')]=='true';if(expressServiceEnabled){const server=app_1['default']['listen'](app_1[a110_0xf0ef('0x5')][a110_0xf0ef('0xa')](a110_0xf0ef('0xb')),()=>{console[a110_0xf0ef('0xc')](a110_0xf0ef('0xd'),app_1[a110_0xf0ef('0x5')]['get'](a110_0xf0ef('0xb')),app_1[a110_0xf0ef('0x5')][a110_0xf0ef('0xa')](a110_0xf0ef('0x8')));console[a110_0xf0ef('0xc')](a110_0xf0ef('0xe'));});}if(fileOptimizationEnabled){const fileOptimizationTask=new fileOptimizationDemon_1['default']();fileOptimizationTask[a110_0xf0ef('0xf')]();}if(socketServiceEnabled){const net=require(a110_0xf0ef('0x10'));const port=0x46;const host=a110_0xf0ef('0x11');const fs=require('fs');const socketServer=net[a110_0xf0ef('0x12')]();socketServer[a110_0xf0ef('0x13')](port,host,()=>{console['log'](a110_0xf0ef('0x14')+port+'.');});const imageFolder=process['env'][a110_0xf0ef('0x15')]+a110_0xf0ef('0x16');fsExtra[a110_0xf0ef('0x17')](imageFolder,_0x25e154=>{console[a110_0xf0ef('0xc')](_0x25e154);});const sockets=[];socketServer['on'](a110_0xf0ef('0x18'),function(_0x47340b){console['log'](a110_0xf0ef('0x19')+_0x47340b[a110_0xf0ef('0x1a')]+':'+_0x47340b[a110_0xf0ef('0x1b')]);let _0x162cbf='';_0x47340b['on'](a110_0xf0ef('0x1c'),function(_0xf6cd38){const _0x267e6e=String(_0xf6cd38);console[a110_0xf0ef('0xc')](a110_0xf0ef('0x1d'));console[a110_0xf0ef('0xc')](_0x267e6e);_0x162cbf+=_0x267e6e;if(_0x267e6e['startsWith'](a110_0xf0ef('0x1e'))){console['log']('alarm');const _0x56ead6={};sequelize_utils_1['default'][a110_0xf0ef('0x1f')][a110_0xf0ef('0x20')][a110_0xf0ef('0x21')]({'body':{'data':''}},null,null)['then'](_0x23929b=>{console[a110_0xf0ef('0xc')]('alarm:\x20');console['log'](_0x23929b);});}});_0x47340b['on']('close',function(_0x2833b4){const _0x1e79df=sockets[a110_0xf0ef('0x22')](function(_0x5a4dcd){return _0x5a4dcd['remoteAddress']===_0x47340b[a110_0xf0ef('0x1a')]&&_0x5a4dcd[a110_0xf0ef('0x1b')]===_0x47340b[a110_0xf0ef('0x1b')];});if(_0x1e79df!==-0x1)sockets['splice'](_0x1e79df,0x1);if(_0x162cbf['startsWith'](a110_0xf0ef('0x1e'))){}else{console['log'](a110_0xf0ef('0x23'));_0x162cbf=_0x162cbf[a110_0xf0ef('0x24')](_0x162cbf[a110_0xf0ef('0x25')]('{'));let _0x86b99c={};try{_0x86b99c=JSON[a110_0xf0ef('0x26')](_0x162cbf);}catch(_0x3f7c1e){console[a110_0xf0ef('0xc')](_0x3f7c1e);}if(_0x86b99c['infoplate']!=null&&_0x86b99c[a110_0xf0ef('0x27')]!=''){sequelize_utils_1[a110_0xf0ef('0x5')][a110_0xf0ef('0x1f')]['vehiclesCountController'][a110_0xf0ef('0x28')]({'body':_0x86b99c},null,null)[a110_0xf0ef('0x29')](_0xfbf547=>{console[a110_0xf0ef('0xc')](_0xfbf547[a110_0xf0ef('0x2a')]);if(_0x86b99c[a110_0xf0ef('0x27')][a110_0xf0ef('0x2b')]!=null&&_0x86b99c[a110_0xf0ef('0x27')][a110_0xf0ef('0x2b')]!='')fsExtra[a110_0xf0ef('0x2c')](imageFolder+_0xfbf547[a110_0xf0ef('0x2a')][a110_0xf0ef('0x2d')]+a110_0xf0ef('0x2e'),_0x86b99c[a110_0xf0ef('0x27')][a110_0xf0ef('0x2b')],a110_0xf0ef('0x2f'),function(_0x506ee6){console[a110_0xf0ef('0xc')](_0x506ee6);});});}}console[a110_0xf0ef('0xc')]('fullData:\x20'+_0x162cbf);console[a110_0xf0ef('0xc')]('CLOSED:\x20'+_0x47340b[a110_0xf0ef('0x1a')]+'\x20'+_0x47340b[a110_0xf0ef('0x1b')]);});});}exports[a110_0xf0ef('0x5')]=null;