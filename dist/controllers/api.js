var a98_0x1a4c=['sum','HOUR','MONTH','YEAR','user','tokens','find','facebook','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','api/facebook','Facebook\x20API','__importDefault','__esModule','fbgraph','ftp','sequelize','setSequelize','getApi','render','api/index','API\x20Examples','syncFtp','connecting','default','ready','log','connected','list','colombia','Downloading:\x20','name','endsWith','json','reportFiles','spread','push','error','ipd','downloadFtp','findOne','then','connected:','fileName','get','colombia/','media/','.txt','pipe','save','Downloaded:\x20','ftp.vivotek.com','processFtp','readFile','utf8','parse','Data','CountingInfo','Out','EndTime','models','create','status','getPassCounting','passes','findAll','countingDate','ASC','getPassCountingByDay','query','startDate','endDate','col','amount','total','gte','params','direction','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','countingDateShort'];(function(_0x239b55,_0x547083){var _0x4144cb=function(_0x4373ba){while(--_0x4373ba){_0x239b55['push'](_0x239b55['shift']());}};_0x4144cb(++_0x547083);}(a98_0x1a4c,0xfe));var a98_0x20b2=function(_0x2c7a68,_0x1f8ace){_0x2c7a68=_0x2c7a68-0x0;var _0x438f67=a98_0x1a4c[_0x2c7a68];return _0x438f67;};'use strict';var __importDefault=this&&this[a98_0x20b2('0x0')]||function(_0x10d9b8){return _0x10d9b8&&_0x10d9b8['__esModule']?_0x10d9b8:{'default':_0x10d9b8};};Object['defineProperty'](exports,a98_0x20b2('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a98_0x20b2('0x2')));const ftp_1=__importDefault(require(a98_0x20b2('0x3')));const fs_1=__importDefault(require('fs'));function setSequelize(_0x5af437){exports[a98_0x20b2('0x4')]=_0x5af437;}exports[a98_0x20b2('0x5')]=setSequelize;exports[a98_0x20b2('0x6')]=(_0x1b93cf,_0x100e46)=>{_0x100e46[a98_0x20b2('0x7')](a98_0x20b2('0x8'),{'title':a98_0x20b2('0x9')});};exports[a98_0x20b2('0xa')]=(_0x59de83,_0x14c0a7)=>{console['log'](a98_0x20b2('0xb'));const _0x44980d=[];const _0x448828=new ftp_1[(a98_0x20b2('0xc'))]();_0x448828['on'](a98_0x20b2('0xd'),function(){console[a98_0x20b2('0xe')](a98_0x20b2('0xf'));_0x448828[a98_0x20b2('0x10')](a98_0x20b2('0x11'),![],function(_0x44540f,_0x3f1ae4){if(_0x44540f){}else{for(const _0x655806 of _0x3f1ae4){console[a98_0x20b2('0xe')](a98_0x20b2('0x12')+_0x655806[a98_0x20b2('0x13')]);if(_0x655806[a98_0x20b2('0x13')][a98_0x20b2('0x14')](a98_0x20b2('0x15'))){exports[a98_0x20b2('0x4')]['models'][a98_0x20b2('0x16')]['findOrCreate']({'where':{'fileName':_0x655806[a98_0x20b2('0x13')]}})[a98_0x20b2('0x17')]((_0x57610f,_0x27b51b)=>{if(_0x27b51b){console[a98_0x20b2('0xe')](_0x655806[a98_0x20b2('0x13')]);_0x44980d[a98_0x20b2('0x18')](_0x57610f);}});}}}_0x14c0a7[a98_0x20b2('0x15')]({'data':_0x44980d});});});_0x448828['on'](a98_0x20b2('0x19'),function(_0x594506){_0x14c0a7['json']({'message':_0x594506});});_0x448828['connect']({'host':'ftp.vivotek.com','port':0x15,'user':a98_0x20b2('0x1a'),'password':a98_0x20b2('0x1a')});};exports[a98_0x20b2('0x1b')]=(_0x3169e9,_0x584236)=>{exports[a98_0x20b2('0x4')]['models']['reportFiles'][a98_0x20b2('0x1c')]({'where':{'status':null}})[a98_0x20b2('0x1d')](_0x28d23c=>{if(_0x28d23c){const _0x8e462e=new ftp_1[(a98_0x20b2('0xc'))]();_0x8e462e['on'](a98_0x20b2('0xd'),function(){console['log'](a98_0x20b2('0x1e')+_0x28d23c[a98_0x20b2('0x1f')]);_0x8e462e[a98_0x20b2('0x20')](a98_0x20b2('0x21')+_0x28d23c['fileName'],function(_0x4e93c5,_0x5735c6){_0x8e462e['end']();if(_0x4e93c5){}else{const _0x67cba=a98_0x20b2('0x22')+_0x28d23c[a98_0x20b2('0x1f')]+a98_0x20b2('0x23');_0x5735c6[a98_0x20b2('0x24')](fs_1[a98_0x20b2('0xc')]['createWriteStream'](_0x67cba));_0x28d23c['status']=0x1;_0x28d23c[a98_0x20b2('0x25')]();console[a98_0x20b2('0xe')](a98_0x20b2('0x26')+_0x28d23c[a98_0x20b2('0x1f')]);}});});_0x8e462e['on'](a98_0x20b2('0x19'),function(_0x43157c){_0x584236['json']({'message':_0x43157c});});_0x8e462e['connect']({'host':a98_0x20b2('0x27'),'port':0x15,'user':a98_0x20b2('0x1a'),'password':a98_0x20b2('0x1a')});_0x584236[a98_0x20b2('0x15')]({'data':_0x28d23c[a98_0x20b2('0x1f')]});}else{_0x584236['json']({'data':[]});}});};exports[a98_0x20b2('0x28')]=(_0x36e31a,_0x3106a4)=>{exports[a98_0x20b2('0x4')]['models'][a98_0x20b2('0x16')][a98_0x20b2('0x1c')]({'where':{'status':0x1}})[a98_0x20b2('0x1d')](_0x42a8e9=>{if(_0x42a8e9){const _0x1a479a='media/'+_0x42a8e9['fileName']+a98_0x20b2('0x23');fs_1[a98_0x20b2('0xc')][a98_0x20b2('0x29')](_0x1a479a,a98_0x20b2('0x2a'),function(_0x5a7621,_0x2cc44b){if(_0x5a7621){_0x42a8e9['status']=null;}else{try{const _0x35f991=JSON[a98_0x20b2('0x2b')](_0x2cc44b);for(const _0x579639 of _0x35f991[a98_0x20b2('0x2c')][0x0][a98_0x20b2('0x2d')]){const _0x563e3a=_0x579639['In'];const _0x580b26=_0x579639[a98_0x20b2('0x2e')];const _0x4092cd=Date[a98_0x20b2('0x2b')](_0x579639[a98_0x20b2('0x2f')]);if(_0x563e3a>0x0){exports[a98_0x20b2('0x4')][a98_0x20b2('0x30')]['passes'][a98_0x20b2('0x31')]({'reportFileId':_0x42a8e9['id'],'amount':_0x563e3a,'countingDate':_0x4092cd});}if(_0x580b26>0x0){exports[a98_0x20b2('0x4')][a98_0x20b2('0x30')]['passes'][a98_0x20b2('0x31')]({'reportFileId':_0x42a8e9['id'],'amount':_0x580b26*-0x1,'countingDate':_0x4092cd});}}_0x42a8e9[a98_0x20b2('0x32')]=0x2;}catch(_0x22fff6){_0x42a8e9[a98_0x20b2('0x32')]=null;}}_0x42a8e9[a98_0x20b2('0x25')]();});_0x3106a4[a98_0x20b2('0x15')]({'data':_0x42a8e9[a98_0x20b2('0x1f')]});}else{_0x3106a4['json']({'data':[]});}});};exports[a98_0x20b2('0x33')]=(_0x2bc5b5,_0x12eb71)=>{exports[a98_0x20b2('0x4')]['models'][a98_0x20b2('0x34')][a98_0x20b2('0x35')]({'where':{'amount':{[exports[a98_0x20b2('0x4')]['Op']['gt']]:0x0}},'order':[[a98_0x20b2('0x36'),a98_0x20b2('0x37')]]})['then'](_0x5bdf2c=>{_0x12eb71['json']({'data':_0x5bdf2c});});};exports[a98_0x20b2('0x38')]=(_0x2bd441,_0x4925c4)=>{const _0xad4605=_0x2bd441[a98_0x20b2('0x39')]['month'];const _0x1c7e98=_0x2bd441[a98_0x20b2('0x39')][a98_0x20b2('0x3a')];const _0x1c431e=_0x2bd441[a98_0x20b2('0x39')][a98_0x20b2('0x3b')];exports[a98_0x20b2('0x4')][a98_0x20b2('0x30')][a98_0x20b2('0x34')][a98_0x20b2('0x35')]({'attributes':[a98_0x20b2('0x36'),[exports[a98_0x20b2('0x4')]['fn']('sum',exports[a98_0x20b2('0x4')][a98_0x20b2('0x3c')](a98_0x20b2('0x3d'))),a98_0x20b2('0x3e')]],'where':{'countingDate':{[exports['sequelize']['Op'][a98_0x20b2('0x3f')]]:_0x1c7e98,[exports[a98_0x20b2('0x4')]['Op']['lt']]:_0x1c431e},'amount':_0x2bd441[a98_0x20b2('0x40')][a98_0x20b2('0x41')]=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports[a98_0x20b2('0x4')]['Op']['lt']]:0x0}},'group':[exports[a98_0x20b2('0x4')][a98_0x20b2('0x42')](a98_0x20b2('0x43'))],'order':[[a98_0x20b2('0x36'),a98_0x20b2('0x37')]]})[a98_0x20b2('0x1d')](_0x91ac4a=>{_0x4925c4['json']({'data':_0x91ac4a});});};exports[a98_0x20b2('0x44')]=(_0x428cce,_0x27b915)=>{const _0x5c1b8f=_0x428cce['query']['month'];const _0x5967b9=_0x428cce['query'][a98_0x20b2('0x3a')];const _0x270d55=_0x428cce[a98_0x20b2('0x39')][a98_0x20b2('0x3b')];exports[a98_0x20b2('0x4')][a98_0x20b2('0x30')][a98_0x20b2('0x34')][a98_0x20b2('0x35')]({'attributes':['countingDate',[exports[a98_0x20b2('0x4')]['fn']('DATE_FORMAT',exports['sequelize'][a98_0x20b2('0x3c')](a98_0x20b2('0x36')),'%Y-%m-%d\x20%H:00'),a98_0x20b2('0x45')],[exports['sequelize']['fn'](a98_0x20b2('0x46'),exports['sequelize'][a98_0x20b2('0x3c')](a98_0x20b2('0x3d'))),a98_0x20b2('0x3e')]],'where':{'countingDate':{[exports[a98_0x20b2('0x4')]['Op']['gte']]:_0x5967b9,[exports[a98_0x20b2('0x4')]['Op']['lt']]:_0x270d55},'amount':_0x428cce[a98_0x20b2('0x40')][a98_0x20b2('0x41')]=='in'?{[exports[a98_0x20b2('0x4')]['Op']['gt']]:0x0}:{[exports[a98_0x20b2('0x4')]['Op']['lt']]:0x0}},'group':[exports[a98_0x20b2('0x4')]['fn'](a98_0x20b2('0x47'),exports[a98_0x20b2('0x4')][a98_0x20b2('0x3c')](a98_0x20b2('0x36'))),exports[a98_0x20b2('0x4')]['fn']('DAY',exports[a98_0x20b2('0x4')][a98_0x20b2('0x3c')](a98_0x20b2('0x36'))),exports[a98_0x20b2('0x4')]['fn'](a98_0x20b2('0x48'),exports[a98_0x20b2('0x4')][a98_0x20b2('0x3c')](a98_0x20b2('0x36'))),exports[a98_0x20b2('0x4')]['fn'](a98_0x20b2('0x49'),exports[a98_0x20b2('0x4')][a98_0x20b2('0x3c')](a98_0x20b2('0x36')))],'order':[[a98_0x20b2('0x36'),a98_0x20b2('0x37')]]})['then'](_0x277a17=>{_0x27b915['json']({'data':_0x277a17});});};exports['getFacebook']=(_0x1d8c4f,_0x56565c,_0x2911aa)=>{const _0x9ffac8=_0x1d8c4f[a98_0x20b2('0x4a')][a98_0x20b2('0x4b')][a98_0x20b2('0x4c')](_0x9ffac8=>_0x9ffac8['kind']==='facebook');fbgraph_1[a98_0x20b2('0xc')]['setAccessToken'](_0x9ffac8['accessToken']);fbgraph_1[a98_0x20b2('0xc')][a98_0x20b2('0x20')](_0x1d8c4f[a98_0x20b2('0x4a')][a98_0x20b2('0x4d')]+a98_0x20b2('0x4e'),(_0x9559ca,_0x314669)=>{if(_0x9559ca){return _0x2911aa(_0x9559ca);}_0x56565c[a98_0x20b2('0x7')](a98_0x20b2('0x4f'),{'title':a98_0x20b2('0x50'),'profile':_0x314669});});};