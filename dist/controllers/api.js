var a92_0x46e8=['user','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','api/facebook','Facebook\x20API','__importDefault','__esModule','defineProperty','fbgraph','ftp','sequelize','getApi','render','api/index','API\x20Examples','syncFtp','log','connecting','default','ready','connected','colombia','name','json','models','reportFiles','findOrCreate','push','error','connect','ipd','downloadFtp','connected:','fileName','get','colombia/','media/','pipe','createWriteStream','status','save','Downloaded:\x20','ftp.vivotek.com','findOne','then','.txt','readFile','utf8','parse','Data','CountingInfo','EndTime','passes','create','getPassCounting','findAll','countingDate','query','month','startDate','sum','col','total','gte','params','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','ASC','getPassCountingByHour','endDate','DATE_FORMAT','%Y-%m-%d\x20%H:00','countingDateShort','amount','direction','HOUR','MONTH','YEAR','getFacebook','tokens','find','kind','facebook','setAccessToken'];(function(_0x317374,_0x553b4a){var _0x5245e7=function(_0x2b01a1){while(--_0x2b01a1){_0x317374['push'](_0x317374['shift']());}};_0x5245e7(++_0x553b4a);}(a92_0x46e8,0x1a3));var a92_0xf7c5=function(_0xf56814,_0x35f9d4){_0xf56814=_0xf56814-0x0;var _0x32e1ab=a92_0x46e8[_0xf56814];return _0x32e1ab;};'use strict';var __importDefault=this&&this[a92_0xf7c5('0x0')]||function(_0x123516){return _0x123516&&_0x123516[a92_0xf7c5('0x1')]?_0x123516:{'default':_0x123516};};Object[a92_0xf7c5('0x2')](exports,'__esModule',{'value':!![]});const fbgraph_1=__importDefault(require(a92_0xf7c5('0x3')));const ftp_1=__importDefault(require(a92_0xf7c5('0x4')));const fs_1=__importDefault(require('fs'));function setSequelize(_0x2d90b6){exports[a92_0xf7c5('0x5')]=_0x2d90b6;}exports['setSequelize']=setSequelize;exports[a92_0xf7c5('0x6')]=(_0x213f75,_0xbb25c7)=>{_0xbb25c7[a92_0xf7c5('0x7')](a92_0xf7c5('0x8'),{'title':a92_0xf7c5('0x9')});};exports[a92_0xf7c5('0xa')]=(_0x40ac4d,_0x343292)=>{console[a92_0xf7c5('0xb')](a92_0xf7c5('0xc'));const _0x30484a=[];const _0x24e8bb=new ftp_1[(a92_0xf7c5('0xd'))]();_0x24e8bb['on'](a92_0xf7c5('0xe'),function(){console[a92_0xf7c5('0xb')](a92_0xf7c5('0xf'));_0x24e8bb['list'](a92_0xf7c5('0x10'),![],function(_0x41c2e5,_0x19c163){if(_0x41c2e5){}else{for(const _0x27b3b3 of _0x19c163){console[a92_0xf7c5('0xb')]('Downloading:\x20'+_0x27b3b3['name']);if(_0x27b3b3[a92_0xf7c5('0x11')]['endsWith'](a92_0xf7c5('0x12'))){exports['sequelize'][a92_0xf7c5('0x13')][a92_0xf7c5('0x14')][a92_0xf7c5('0x15')]({'where':{'fileName':_0x27b3b3[a92_0xf7c5('0x11')]}})['spread']((_0x39cb34,_0x2aec9a)=>{if(_0x2aec9a){console[a92_0xf7c5('0xb')](_0x27b3b3[a92_0xf7c5('0x11')]);_0x30484a[a92_0xf7c5('0x16')](_0x39cb34);}});}}}_0x343292[a92_0xf7c5('0x12')]({'data':_0x30484a});});});_0x24e8bb['on'](a92_0xf7c5('0x17'),function(_0x13bbb0){_0x343292['json']({'message':_0x13bbb0});});_0x24e8bb[a92_0xf7c5('0x18')]({'host':'ftp.vivotek.com','port':0x15,'user':a92_0xf7c5('0x19'),'password':a92_0xf7c5('0x19')});};exports[a92_0xf7c5('0x1a')]=(_0x2d8694,_0x430016)=>{exports[a92_0xf7c5('0x5')][a92_0xf7c5('0x13')][a92_0xf7c5('0x14')]['findOne']({'where':{'status':null}})['then'](_0x1eae6e=>{if(_0x1eae6e){const _0x10494d=new ftp_1['default']();_0x10494d['on'](a92_0xf7c5('0xe'),function(){console['log'](a92_0xf7c5('0x1b')+_0x1eae6e[a92_0xf7c5('0x1c')]);_0x10494d[a92_0xf7c5('0x1d')](a92_0xf7c5('0x1e')+_0x1eae6e[a92_0xf7c5('0x1c')],function(_0x3648c9,_0x3a8549){_0x10494d['end']();if(_0x3648c9){}else{const _0x146327=a92_0xf7c5('0x1f')+_0x1eae6e[a92_0xf7c5('0x1c')]+'.txt';_0x3a8549[a92_0xf7c5('0x20')](fs_1[a92_0xf7c5('0xd')][a92_0xf7c5('0x21')](_0x146327));_0x1eae6e[a92_0xf7c5('0x22')]=0x1;_0x1eae6e[a92_0xf7c5('0x23')]();console['log'](a92_0xf7c5('0x24')+_0x1eae6e[a92_0xf7c5('0x1c')]);}});});_0x10494d['on'](a92_0xf7c5('0x17'),function(_0x415a4d){_0x430016[a92_0xf7c5('0x12')]({'message':_0x415a4d});});_0x10494d['connect']({'host':a92_0xf7c5('0x25'),'port':0x15,'user':a92_0xf7c5('0x19'),'password':a92_0xf7c5('0x19')});_0x430016['json']({'data':_0x1eae6e[a92_0xf7c5('0x1c')]});}else{_0x430016[a92_0xf7c5('0x12')]({'data':[]});}});};exports['processFtp']=(_0x1fed0a,_0x24f4ed)=>{exports[a92_0xf7c5('0x5')]['models'][a92_0xf7c5('0x14')][a92_0xf7c5('0x26')]({'where':{'status':0x1}})[a92_0xf7c5('0x27')](_0x589217=>{if(_0x589217){const _0x49e017='media/'+_0x589217['fileName']+a92_0xf7c5('0x28');fs_1['default'][a92_0xf7c5('0x29')](_0x49e017,a92_0xf7c5('0x2a'),function(_0x4b1b1c,_0x2a6afd){if(_0x4b1b1c){_0x589217['status']=null;}else{try{const _0x59e0ce=JSON[a92_0xf7c5('0x2b')](_0x2a6afd);for(const _0x3109b7 of _0x59e0ce[a92_0xf7c5('0x2c')][0x0][a92_0xf7c5('0x2d')]){const _0x516176=_0x3109b7['In'];const _0x3737ac=_0x3109b7['Out'];const _0x29ebef=Date['parse'](_0x3109b7[a92_0xf7c5('0x2e')]);if(_0x516176>0x0){exports[a92_0xf7c5('0x5')][a92_0xf7c5('0x13')][a92_0xf7c5('0x2f')][a92_0xf7c5('0x30')]({'reportFileId':_0x589217['id'],'amount':_0x516176,'countingDate':_0x29ebef});}if(_0x3737ac>0x0){exports[a92_0xf7c5('0x5')][a92_0xf7c5('0x13')]['passes'][a92_0xf7c5('0x30')]({'reportFileId':_0x589217['id'],'amount':_0x3737ac*-0x1,'countingDate':_0x29ebef});}}_0x589217[a92_0xf7c5('0x22')]=0x2;}catch(_0x41891e){_0x589217[a92_0xf7c5('0x22')]=null;}}_0x589217['save']();});_0x24f4ed[a92_0xf7c5('0x12')]({'data':_0x589217[a92_0xf7c5('0x1c')]});}else{_0x24f4ed[a92_0xf7c5('0x12')]({'data':[]});}});};exports[a92_0xf7c5('0x31')]=(_0x216281,_0x1dda8f)=>{exports[a92_0xf7c5('0x5')][a92_0xf7c5('0x13')][a92_0xf7c5('0x2f')][a92_0xf7c5('0x32')]({'where':{'amount':{[exports[a92_0xf7c5('0x5')]['Op']['gt']]:0x0}},'order':[[a92_0xf7c5('0x33'),'ASC']]})[a92_0xf7c5('0x27')](_0x59ceeb=>{_0x1dda8f[a92_0xf7c5('0x12')]({'data':_0x59ceeb});});};exports['getPassCountingByDay']=(_0x37e1c7,_0x3a17b4)=>{const _0x550326=_0x37e1c7[a92_0xf7c5('0x34')][a92_0xf7c5('0x35')];const _0x1de23b=_0x37e1c7[a92_0xf7c5('0x34')][a92_0xf7c5('0x36')];const _0x3fc4d5=_0x37e1c7['query']['endDate'];exports[a92_0xf7c5('0x5')][a92_0xf7c5('0x13')][a92_0xf7c5('0x2f')]['findAll']({'attributes':[a92_0xf7c5('0x33'),[exports[a92_0xf7c5('0x5')]['fn'](a92_0xf7c5('0x37'),exports[a92_0xf7c5('0x5')][a92_0xf7c5('0x38')]('amount')),a92_0xf7c5('0x39')]],'where':{'countingDate':{[exports[a92_0xf7c5('0x5')]['Op'][a92_0xf7c5('0x3a')]]:_0x1de23b,[exports[a92_0xf7c5('0x5')]['Op']['lt']]:_0x3fc4d5},'amount':_0x37e1c7[a92_0xf7c5('0x3b')]['direction']=='in'?{[exports[a92_0xf7c5('0x5')]['Op']['gt']]:0x0}:{[exports[a92_0xf7c5('0x5')]['Op']['lt']]:0x0}},'group':[exports[a92_0xf7c5('0x5')][a92_0xf7c5('0x3c')](a92_0xf7c5('0x3d'))],'order':[[a92_0xf7c5('0x33'),a92_0xf7c5('0x3e')]]})[a92_0xf7c5('0x27')](_0x5c9d04=>{_0x3a17b4[a92_0xf7c5('0x12')]({'data':_0x5c9d04});});};exports[a92_0xf7c5('0x3f')]=(_0x272fa4,_0x440fc6)=>{const _0x148ec0=_0x272fa4['query']['month'];const _0x3cccf3=_0x272fa4['query'][a92_0xf7c5('0x36')];const _0x3e8506=_0x272fa4['query'][a92_0xf7c5('0x40')];exports[a92_0xf7c5('0x5')]['models'][a92_0xf7c5('0x2f')]['findAll']({'attributes':['countingDate',[exports[a92_0xf7c5('0x5')]['fn'](a92_0xf7c5('0x41'),exports[a92_0xf7c5('0x5')][a92_0xf7c5('0x38')](a92_0xf7c5('0x33')),a92_0xf7c5('0x42')),a92_0xf7c5('0x43')],[exports['sequelize']['fn'](a92_0xf7c5('0x37'),exports[a92_0xf7c5('0x5')]['col'](a92_0xf7c5('0x44'))),a92_0xf7c5('0x39')]],'where':{'countingDate':{[exports[a92_0xf7c5('0x5')]['Op']['gte']]:_0x3cccf3,[exports[a92_0xf7c5('0x5')]['Op']['lt']]:_0x3e8506},'amount':_0x272fa4[a92_0xf7c5('0x3b')][a92_0xf7c5('0x45')]=='in'?{[exports[a92_0xf7c5('0x5')]['Op']['gt']]:0x0}:{[exports[a92_0xf7c5('0x5')]['Op']['lt']]:0x0}},'group':[exports['sequelize']['fn'](a92_0xf7c5('0x46'),exports[a92_0xf7c5('0x5')][a92_0xf7c5('0x38')](a92_0xf7c5('0x33'))),exports[a92_0xf7c5('0x5')]['fn']('DAY',exports['sequelize'][a92_0xf7c5('0x38')](a92_0xf7c5('0x33'))),exports[a92_0xf7c5('0x5')]['fn'](a92_0xf7c5('0x47'),exports['sequelize']['col'](a92_0xf7c5('0x33'))),exports['sequelize']['fn'](a92_0xf7c5('0x48'),exports[a92_0xf7c5('0x5')][a92_0xf7c5('0x38')]('countingDate'))],'order':[[a92_0xf7c5('0x33'),'ASC']]})[a92_0xf7c5('0x27')](_0x4201ae=>{_0x440fc6['json']({'data':_0x4201ae});});};exports[a92_0xf7c5('0x49')]=(_0x24e61a,_0x1586b0,_0xebe28c)=>{const _0x14510f=_0x24e61a['user'][a92_0xf7c5('0x4a')][a92_0xf7c5('0x4b')](_0x14510f=>_0x14510f[a92_0xf7c5('0x4c')]===a92_0xf7c5('0x4d'));fbgraph_1[a92_0xf7c5('0xd')][a92_0xf7c5('0x4e')](_0x14510f['accessToken']);fbgraph_1[a92_0xf7c5('0xd')]['get'](_0x24e61a[a92_0xf7c5('0x4f')]['facebook']+a92_0xf7c5('0x50'),(_0x5e7932,_0x39ae62)=>{if(_0x5e7932){return _0xebe28c(_0x5e7932);}_0x1586b0[a92_0xf7c5('0x7')](a92_0xf7c5('0x51'),{'title':a92_0xf7c5('0x52'),'profile':_0x39ae62});});};