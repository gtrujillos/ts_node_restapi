var a88_0x3da3=['syncFtp','connecting','default','ready','log','connected','colombia','name','endsWith','json','sequelize','models','spread','push','connect','ipd','findOne','connected:','colombia/','end','.txt','pipe','status','save','Downloaded:\x20','fileName','error','processFtp','reportFiles','then','media/','readFile','utf8','parse','Data','CountingInfo','passes','create','getPassCounting','findAll','countingDate','getPassCountingByDay','query','month','startDate','endDate','sum','col','amount','total','gte','params','direction','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','ASC','DATE_FORMAT','%Y-%m-%d\x20%H:00','countingDateShort','HOUR','DAY','MONTH','YEAR','getFacebook','tokens','find','kind','facebook','setAccessToken','accessToken','get','user','api/facebook','Facebook\x20API','__importDefault','defineProperty','__esModule','fbgraph','ftp','render','api/index','API\x20Examples'];(function(_0x415d52,_0x4d99c5){var _0x29c259=function(_0x584b9f){while(--_0x584b9f){_0x415d52['push'](_0x415d52['shift']());}};_0x29c259(++_0x4d99c5);}(a88_0x3da3,0x192));var a88_0x1df8=function(_0x3cc0af,_0x44df42){_0x3cc0af=_0x3cc0af-0x0;var _0x59c926=a88_0x3da3[_0x3cc0af];return _0x59c926;};'use strict';var __importDefault=this&&this[a88_0x1df8('0x0')]||function(_0x5c3f02){return _0x5c3f02&&_0x5c3f02['__esModule']?_0x5c3f02:{'default':_0x5c3f02};};Object[a88_0x1df8('0x1')](exports,a88_0x1df8('0x2'),{'value':!![]});const fbgraph_1=__importDefault(require(a88_0x1df8('0x3')));const ftp_1=__importDefault(require(a88_0x1df8('0x4')));const fs_1=__importDefault(require('fs'));function setSequelize(_0x387043){exports['sequelize']=_0x387043;}exports['setSequelize']=setSequelize;exports['getApi']=(_0x23700f,_0x3ddb97)=>{_0x3ddb97[a88_0x1df8('0x5')](a88_0x1df8('0x6'),{'title':a88_0x1df8('0x7')});};exports[a88_0x1df8('0x8')]=(_0x40c999,_0x52cb00)=>{console['log'](a88_0x1df8('0x9'));const _0x10c144=[];const _0x2084ea=new ftp_1[(a88_0x1df8('0xa'))]();_0x2084ea['on'](a88_0x1df8('0xb'),function(){console[a88_0x1df8('0xc')](a88_0x1df8('0xd'));_0x2084ea['list'](a88_0x1df8('0xe'),![],function(_0x3818d4,_0x43c2bf){if(_0x3818d4){}else{for(const _0x5c8414 of _0x43c2bf){console['log']('Downloading:\x20'+_0x5c8414[a88_0x1df8('0xf')]);if(_0x5c8414['name'][a88_0x1df8('0x10')](a88_0x1df8('0x11'))){exports[a88_0x1df8('0x12')][a88_0x1df8('0x13')]['reportFiles']['findOrCreate']({'where':{'fileName':_0x5c8414['name']}})[a88_0x1df8('0x14')]((_0x69f26b,_0x29712d)=>{if(_0x29712d){console[a88_0x1df8('0xc')](_0x5c8414['name']);_0x10c144[a88_0x1df8('0x15')](_0x69f26b);}});}}}_0x52cb00[a88_0x1df8('0x11')]({'data':_0x10c144});});});_0x2084ea['on']('error',function(_0x35d193){_0x52cb00[a88_0x1df8('0x11')]({'message':_0x35d193});});_0x2084ea[a88_0x1df8('0x16')]({'host':'ftp.vivotek.com','port':0x15,'user':a88_0x1df8('0x17'),'password':a88_0x1df8('0x17')});};exports['downloadFtp']=(_0x241569,_0xb34938)=>{exports[a88_0x1df8('0x12')][a88_0x1df8('0x13')]['reportFiles'][a88_0x1df8('0x18')]({'where':{'status':null}})['then'](_0x455e66=>{if(_0x455e66){const _0x11fddd=new ftp_1['default']();_0x11fddd['on'](a88_0x1df8('0xb'),function(){console[a88_0x1df8('0xc')](a88_0x1df8('0x19')+_0x455e66['fileName']);_0x11fddd['get'](a88_0x1df8('0x1a')+_0x455e66['fileName'],function(_0x54e634,_0x427e24){_0x11fddd[a88_0x1df8('0x1b')]();if(_0x54e634){}else{const _0x4b8e54='media/'+_0x455e66['fileName']+a88_0x1df8('0x1c');_0x427e24[a88_0x1df8('0x1d')](fs_1[a88_0x1df8('0xa')]['createWriteStream'](_0x4b8e54));_0x455e66[a88_0x1df8('0x1e')]=0x1;_0x455e66[a88_0x1df8('0x1f')]();console[a88_0x1df8('0xc')](a88_0x1df8('0x20')+_0x455e66[a88_0x1df8('0x21')]);}});});_0x11fddd['on'](a88_0x1df8('0x22'),function(_0x15f7a9){_0xb34938[a88_0x1df8('0x11')]({'message':_0x15f7a9});});_0x11fddd[a88_0x1df8('0x16')]({'host':'ftp.vivotek.com','port':0x15,'user':a88_0x1df8('0x17'),'password':'ipd'});_0xb34938[a88_0x1df8('0x11')]({'data':_0x455e66[a88_0x1df8('0x21')]});}else{_0xb34938['json']({'data':[]});}});};exports[a88_0x1df8('0x23')]=(_0x373585,_0x3b5652)=>{exports[a88_0x1df8('0x12')][a88_0x1df8('0x13')][a88_0x1df8('0x24')][a88_0x1df8('0x18')]({'where':{'status':0x1}})[a88_0x1df8('0x25')](_0x3888e3=>{if(_0x3888e3){const _0x48f41b=a88_0x1df8('0x26')+_0x3888e3[a88_0x1df8('0x21')]+a88_0x1df8('0x1c');fs_1[a88_0x1df8('0xa')][a88_0x1df8('0x27')](_0x48f41b,a88_0x1df8('0x28'),function(_0x473013,_0x393dac){if(_0x473013){_0x3888e3[a88_0x1df8('0x1e')]=null;}else{try{const _0x2e1816=JSON[a88_0x1df8('0x29')](_0x393dac);for(const _0x1d8aa1 of _0x2e1816[a88_0x1df8('0x2a')][0x0][a88_0x1df8('0x2b')]){const _0x1416f7=_0x1d8aa1['In'];const _0x4e8126=_0x1d8aa1['Out'];const _0x5b6343=Date[a88_0x1df8('0x29')](_0x1d8aa1['EndTime']);if(_0x1416f7>0x0){exports[a88_0x1df8('0x12')][a88_0x1df8('0x13')][a88_0x1df8('0x2c')][a88_0x1df8('0x2d')]({'reportFileId':_0x3888e3['id'],'amount':_0x1416f7,'countingDate':_0x5b6343});}if(_0x4e8126>0x0){exports[a88_0x1df8('0x12')][a88_0x1df8('0x13')][a88_0x1df8('0x2c')][a88_0x1df8('0x2d')]({'reportFileId':_0x3888e3['id'],'amount':_0x4e8126*-0x1,'countingDate':_0x5b6343});}}_0x3888e3['status']=0x2;}catch(_0x5bf2d9){_0x3888e3[a88_0x1df8('0x1e')]=null;}}_0x3888e3[a88_0x1df8('0x1f')]();});_0x3b5652[a88_0x1df8('0x11')]({'data':_0x3888e3['fileName']});}else{_0x3b5652[a88_0x1df8('0x11')]({'data':[]});}});};exports[a88_0x1df8('0x2e')]=(_0x42f2a4,_0x5365b6)=>{exports[a88_0x1df8('0x12')][a88_0x1df8('0x13')][a88_0x1df8('0x2c')][a88_0x1df8('0x2f')]({'where':{'amount':{[exports[a88_0x1df8('0x12')]['Op']['gt']]:0x0}},'order':[[a88_0x1df8('0x30'),'ASC']]})[a88_0x1df8('0x25')](_0x2938b4=>{_0x5365b6[a88_0x1df8('0x11')]({'data':_0x2938b4});});};exports[a88_0x1df8('0x31')]=(_0x5dcd47,_0x5dc55e)=>{const _0x22fc96=_0x5dcd47[a88_0x1df8('0x32')][a88_0x1df8('0x33')];const _0x22cbb5=_0x5dcd47[a88_0x1df8('0x32')][a88_0x1df8('0x34')];const _0x1732d4=_0x5dcd47[a88_0x1df8('0x32')][a88_0x1df8('0x35')];exports[a88_0x1df8('0x12')]['models'][a88_0x1df8('0x2c')]['findAll']({'attributes':[a88_0x1df8('0x30'),[exports['sequelize']['fn'](a88_0x1df8('0x36'),exports[a88_0x1df8('0x12')][a88_0x1df8('0x37')](a88_0x1df8('0x38'))),a88_0x1df8('0x39')]],'where':{'countingDate':{[exports[a88_0x1df8('0x12')]['Op'][a88_0x1df8('0x3a')]]:_0x22cbb5,[exports['sequelize']['Op']['lt']]:_0x1732d4},'amount':_0x5dcd47[a88_0x1df8('0x3b')][a88_0x1df8('0x3c')]=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports[a88_0x1df8('0x12')]['Op']['lt']]:0x0}},'group':[exports[a88_0x1df8('0x12')][a88_0x1df8('0x3d')](a88_0x1df8('0x3e'))],'order':[[a88_0x1df8('0x30'),a88_0x1df8('0x3f')]]})[a88_0x1df8('0x25')](_0x40c54e=>{_0x5dc55e[a88_0x1df8('0x11')]({'data':_0x40c54e});});};exports['getPassCountingByHour']=(_0x57c756,_0x38f15a)=>{const _0x1e12a6=_0x57c756[a88_0x1df8('0x32')][a88_0x1df8('0x33')];const _0x1c0bb6=_0x57c756[a88_0x1df8('0x32')]['startDate'];const _0x67c3be=_0x57c756[a88_0x1df8('0x32')][a88_0x1df8('0x35')];exports['sequelize'][a88_0x1df8('0x13')]['passes'][a88_0x1df8('0x2f')]({'attributes':['countingDate',[exports[a88_0x1df8('0x12')]['fn'](a88_0x1df8('0x40'),exports[a88_0x1df8('0x12')][a88_0x1df8('0x37')]('countingDate'),a88_0x1df8('0x41')),a88_0x1df8('0x42')],[exports[a88_0x1df8('0x12')]['fn'](a88_0x1df8('0x36'),exports[a88_0x1df8('0x12')][a88_0x1df8('0x37')](a88_0x1df8('0x38'))),a88_0x1df8('0x39')]],'where':{'countingDate':{[exports['sequelize']['Op'][a88_0x1df8('0x3a')]]:_0x1c0bb6,[exports[a88_0x1df8('0x12')]['Op']['lt']]:_0x67c3be},'amount':_0x57c756['params']['direction']=='in'?{[exports[a88_0x1df8('0x12')]['Op']['gt']]:0x0}:{[exports[a88_0x1df8('0x12')]['Op']['lt']]:0x0}},'group':[exports[a88_0x1df8('0x12')]['fn'](a88_0x1df8('0x43'),exports[a88_0x1df8('0x12')][a88_0x1df8('0x37')](a88_0x1df8('0x30'))),exports[a88_0x1df8('0x12')]['fn'](a88_0x1df8('0x44'),exports[a88_0x1df8('0x12')][a88_0x1df8('0x37')](a88_0x1df8('0x30'))),exports[a88_0x1df8('0x12')]['fn'](a88_0x1df8('0x45'),exports[a88_0x1df8('0x12')]['col']('countingDate')),exports[a88_0x1df8('0x12')]['fn'](a88_0x1df8('0x46'),exports['sequelize']['col']('countingDate'))],'order':[[a88_0x1df8('0x30'),'ASC']]})['then'](_0x241aaf=>{_0x38f15a['json']({'data':_0x241aaf});});};exports[a88_0x1df8('0x47')]=(_0x3f9dc9,_0x105802,_0x37763f)=>{const _0x3fae5b=_0x3f9dc9['user'][a88_0x1df8('0x48')][a88_0x1df8('0x49')](_0x3fae5b=>_0x3fae5b[a88_0x1df8('0x4a')]===a88_0x1df8('0x4b'));fbgraph_1[a88_0x1df8('0xa')][a88_0x1df8('0x4c')](_0x3fae5b[a88_0x1df8('0x4d')]);fbgraph_1['default'][a88_0x1df8('0x4e')](_0x3f9dc9[a88_0x1df8('0x4f')][a88_0x1df8('0x4b')]+'?fields=id,name,email,first_name,last_name,gender,link,locale,timezone',(_0x108803,_0x498387)=>{if(_0x108803){return _0x37763f(_0x108803);}_0x105802[a88_0x1df8('0x5')](a88_0x1df8('0x50'),{'title':a88_0x1df8('0x51'),'profile':_0x498387});});};