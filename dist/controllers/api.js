var a139_0xdd2d=['user','tokens','find','facebook','accessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','api/facebook','Facebook\x20API','__esModule','defineProperty','fbgraph','ftp','sequelize','getApi','render','api/index','API\x20Examples','syncFtp','log','connecting','default','ready','list','colombia','Downloading:\x20','name','json','models','reportFiles','spread','push','ipd','findOne','then','connected:','get','fileName','media/','pipe','save','Downloaded:\x20','error','connect','processFtp','.txt','readFile','utf8','status','parse','Data','CountingInfo','EndTime','passes','create','getPassCounting','findAll','countingDate','ASC','getPassCountingByDay','query','month','startDate','endDate','sum','col','total','params','direction','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','DATE_FORMAT','%Y-%m-%d\x20%H:00','countingDateShort','amount','gte','HOUR','DAY','MONTH','getFacebook'];(function(_0x29b457,_0xdbc6c0){var _0x3b9b50=function(_0x1c766d){while(--_0x1c766d){_0x29b457['push'](_0x29b457['shift']());}};_0x3b9b50(++_0xdbc6c0);}(a139_0xdd2d,0x1e8));var a139_0x4b9e=function(_0x5735a1,_0x31c7e1){_0x5735a1=_0x5735a1-0x0;var _0x1cf64b=a139_0xdd2d[_0x5735a1];return _0x1cf64b;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x2f8a79){return _0x2f8a79&&_0x2f8a79[a139_0x4b9e('0x0')]?_0x2f8a79:{'default':_0x2f8a79};};Object[a139_0x4b9e('0x1')](exports,a139_0x4b9e('0x0'),{'value':!![]});const fbgraph_1=__importDefault(require(a139_0x4b9e('0x2')));const ftp_1=__importDefault(require(a139_0x4b9e('0x3')));const fs_1=__importDefault(require('fs'));function setSequelize(_0x597377){exports[a139_0x4b9e('0x4')]=_0x597377;}exports['setSequelize']=setSequelize;exports[a139_0x4b9e('0x5')]=(_0x2dede8,_0x128b9e)=>{_0x128b9e[a139_0x4b9e('0x6')](a139_0x4b9e('0x7'),{'title':a139_0x4b9e('0x8')});};exports[a139_0x4b9e('0x9')]=(_0xf4d8c3,_0x468107)=>{console[a139_0x4b9e('0xa')](a139_0x4b9e('0xb'));const _0x1c2a8e=[];const _0x4ba4e2=new ftp_1[(a139_0x4b9e('0xc'))]();_0x4ba4e2['on'](a139_0x4b9e('0xd'),function(){console[a139_0x4b9e('0xa')]('connected');_0x4ba4e2[a139_0x4b9e('0xe')](a139_0x4b9e('0xf'),![],function(_0x32f084,_0x4987e6){if(_0x32f084){}else{for(const _0x28ef57 of _0x4987e6){console['log'](a139_0x4b9e('0x10')+_0x28ef57[a139_0x4b9e('0x11')]);if(_0x28ef57[a139_0x4b9e('0x11')]['endsWith'](a139_0x4b9e('0x12'))){exports[a139_0x4b9e('0x4')][a139_0x4b9e('0x13')][a139_0x4b9e('0x14')]['findOrCreate']({'where':{'fileName':_0x28ef57[a139_0x4b9e('0x11')]}})[a139_0x4b9e('0x15')]((_0x58d29b,_0x2f39f2)=>{if(_0x2f39f2){console[a139_0x4b9e('0xa')](_0x28ef57[a139_0x4b9e('0x11')]);_0x1c2a8e[a139_0x4b9e('0x16')](_0x58d29b);}});}}}_0x468107[a139_0x4b9e('0x12')]({'data':_0x1c2a8e});});});_0x4ba4e2['on']('error',function(_0x1fb18d){_0x468107['json']({'message':_0x1fb18d});});_0x4ba4e2['connect']({'host':'ftp.vivotek.com','port':0x15,'user':a139_0x4b9e('0x17'),'password':a139_0x4b9e('0x17')});};exports['downloadFtp']=(_0x5aaf06,_0x4c9145)=>{exports[a139_0x4b9e('0x4')][a139_0x4b9e('0x13')][a139_0x4b9e('0x14')][a139_0x4b9e('0x18')]({'where':{'status':null}})[a139_0x4b9e('0x19')](_0x407d25=>{if(_0x407d25){const _0xfba8c2=new ftp_1['default']();_0xfba8c2['on'](a139_0x4b9e('0xd'),function(){console['log'](a139_0x4b9e('0x1a')+_0x407d25['fileName']);_0xfba8c2[a139_0x4b9e('0x1b')]('colombia/'+_0x407d25[a139_0x4b9e('0x1c')],function(_0x5f005f,_0x11cd8c){_0xfba8c2['end']();if(_0x5f005f){}else{const _0xefff82=a139_0x4b9e('0x1d')+_0x407d25['fileName']+'.txt';_0x11cd8c[a139_0x4b9e('0x1e')](fs_1['default']['createWriteStream'](_0xefff82));_0x407d25['status']=0x1;_0x407d25[a139_0x4b9e('0x1f')]();console['log'](a139_0x4b9e('0x20')+_0x407d25[a139_0x4b9e('0x1c')]);}});});_0xfba8c2['on'](a139_0x4b9e('0x21'),function(_0x2d80a7){_0x4c9145[a139_0x4b9e('0x12')]({'message':_0x2d80a7});});_0xfba8c2[a139_0x4b9e('0x22')]({'host':'ftp.vivotek.com','port':0x15,'user':a139_0x4b9e('0x17'),'password':a139_0x4b9e('0x17')});_0x4c9145[a139_0x4b9e('0x12')]({'data':_0x407d25[a139_0x4b9e('0x1c')]});}else{_0x4c9145['json']({'data':[]});}});};exports[a139_0x4b9e('0x23')]=(_0xc3e0de,_0x177ce4)=>{exports[a139_0x4b9e('0x4')][a139_0x4b9e('0x13')][a139_0x4b9e('0x14')]['findOne']({'where':{'status':0x1}})[a139_0x4b9e('0x19')](_0x263adb=>{if(_0x263adb){const _0x2ae4d7=a139_0x4b9e('0x1d')+_0x263adb[a139_0x4b9e('0x1c')]+a139_0x4b9e('0x24');fs_1['default'][a139_0x4b9e('0x25')](_0x2ae4d7,a139_0x4b9e('0x26'),function(_0x47a5f6,_0xb97be4){if(_0x47a5f6){_0x263adb[a139_0x4b9e('0x27')]=null;}else{try{const _0x428836=JSON[a139_0x4b9e('0x28')](_0xb97be4);for(const _0x592d08 of _0x428836[a139_0x4b9e('0x29')][0x0][a139_0x4b9e('0x2a')]){const _0x22e551=_0x592d08['In'];const _0x390e57=_0x592d08['Out'];const _0x240065=Date[a139_0x4b9e('0x28')](_0x592d08[a139_0x4b9e('0x2b')]);if(_0x22e551>0x0){exports['sequelize'][a139_0x4b9e('0x13')][a139_0x4b9e('0x2c')][a139_0x4b9e('0x2d')]({'reportFileId':_0x263adb['id'],'amount':_0x22e551,'countingDate':_0x240065});}if(_0x390e57>0x0){exports[a139_0x4b9e('0x4')][a139_0x4b9e('0x13')][a139_0x4b9e('0x2c')]['create']({'reportFileId':_0x263adb['id'],'amount':_0x390e57*-0x1,'countingDate':_0x240065});}}_0x263adb[a139_0x4b9e('0x27')]=0x2;}catch(_0x578e7c){_0x263adb[a139_0x4b9e('0x27')]=null;}}_0x263adb['save']();});_0x177ce4[a139_0x4b9e('0x12')]({'data':_0x263adb['fileName']});}else{_0x177ce4[a139_0x4b9e('0x12')]({'data':[]});}});};exports[a139_0x4b9e('0x2e')]=(_0x5d526c,_0x44b6ba)=>{exports[a139_0x4b9e('0x4')]['models'][a139_0x4b9e('0x2c')][a139_0x4b9e('0x2f')]({'where':{'amount':{[exports[a139_0x4b9e('0x4')]['Op']['gt']]:0x0}},'order':[[a139_0x4b9e('0x30'),a139_0x4b9e('0x31')]]})[a139_0x4b9e('0x19')](_0x1ade88=>{_0x44b6ba[a139_0x4b9e('0x12')]({'data':_0x1ade88});});};exports[a139_0x4b9e('0x32')]=(_0x3e2fbf,_0x35ed2d)=>{const _0x35a42a=_0x3e2fbf[a139_0x4b9e('0x33')][a139_0x4b9e('0x34')];const _0x3c44df=_0x3e2fbf[a139_0x4b9e('0x33')][a139_0x4b9e('0x35')];const _0x1cec37=_0x3e2fbf[a139_0x4b9e('0x33')][a139_0x4b9e('0x36')];exports['sequelize'][a139_0x4b9e('0x13')][a139_0x4b9e('0x2c')][a139_0x4b9e('0x2f')]({'attributes':[a139_0x4b9e('0x30'),[exports['sequelize']['fn'](a139_0x4b9e('0x37'),exports[a139_0x4b9e('0x4')][a139_0x4b9e('0x38')]('amount')),a139_0x4b9e('0x39')]],'where':{'countingDate':{[exports[a139_0x4b9e('0x4')]['Op']['gte']]:_0x3c44df,[exports[a139_0x4b9e('0x4')]['Op']['lt']]:_0x1cec37},'amount':_0x3e2fbf[a139_0x4b9e('0x3a')][a139_0x4b9e('0x3b')]=='in'?{[exports[a139_0x4b9e('0x4')]['Op']['gt']]:0x0}:{[exports[a139_0x4b9e('0x4')]['Op']['lt']]:0x0}},'group':[exports[a139_0x4b9e('0x4')][a139_0x4b9e('0x3c')](a139_0x4b9e('0x3d'))],'order':[[a139_0x4b9e('0x30'),'ASC']]})[a139_0x4b9e('0x19')](_0x33ef18=>{_0x35ed2d[a139_0x4b9e('0x12')]({'data':_0x33ef18});});};exports[a139_0x4b9e('0x3e')]=(_0xa53ad,_0x4f5b25)=>{const _0xe4c219=_0xa53ad[a139_0x4b9e('0x33')][a139_0x4b9e('0x34')];const _0x282162=_0xa53ad[a139_0x4b9e('0x33')][a139_0x4b9e('0x35')];const _0x128bb0=_0xa53ad[a139_0x4b9e('0x33')][a139_0x4b9e('0x36')];exports['sequelize'][a139_0x4b9e('0x13')][a139_0x4b9e('0x2c')][a139_0x4b9e('0x2f')]({'attributes':['countingDate',[exports[a139_0x4b9e('0x4')]['fn'](a139_0x4b9e('0x3f'),exports[a139_0x4b9e('0x4')]['col'](a139_0x4b9e('0x30')),a139_0x4b9e('0x40')),a139_0x4b9e('0x41')],[exports['sequelize']['fn']('sum',exports[a139_0x4b9e('0x4')][a139_0x4b9e('0x38')](a139_0x4b9e('0x42'))),a139_0x4b9e('0x39')]],'where':{'countingDate':{[exports['sequelize']['Op'][a139_0x4b9e('0x43')]]:_0x282162,[exports[a139_0x4b9e('0x4')]['Op']['lt']]:_0x128bb0},'amount':_0xa53ad[a139_0x4b9e('0x3a')]['direction']=='in'?{[exports[a139_0x4b9e('0x4')]['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports['sequelize']['fn'](a139_0x4b9e('0x44'),exports[a139_0x4b9e('0x4')][a139_0x4b9e('0x38')](a139_0x4b9e('0x30'))),exports[a139_0x4b9e('0x4')]['fn'](a139_0x4b9e('0x45'),exports['sequelize'][a139_0x4b9e('0x38')]('countingDate')),exports[a139_0x4b9e('0x4')]['fn'](a139_0x4b9e('0x46'),exports['sequelize'][a139_0x4b9e('0x38')](a139_0x4b9e('0x30'))),exports[a139_0x4b9e('0x4')]['fn']('YEAR',exports['sequelize'][a139_0x4b9e('0x38')](a139_0x4b9e('0x30')))],'order':[[a139_0x4b9e('0x30'),a139_0x4b9e('0x31')]]})['then'](_0x412b31=>{_0x4f5b25[a139_0x4b9e('0x12')]({'data':_0x412b31});});};exports[a139_0x4b9e('0x47')]=(_0x8eb5ca,_0x3725b1,_0xe5a940)=>{const _0x9d397e=_0x8eb5ca[a139_0x4b9e('0x48')][a139_0x4b9e('0x49')][a139_0x4b9e('0x4a')](_0x9d397e=>_0x9d397e['kind']===a139_0x4b9e('0x4b'));fbgraph_1['default']['setAccessToken'](_0x9d397e[a139_0x4b9e('0x4c')]);fbgraph_1[a139_0x4b9e('0xc')][a139_0x4b9e('0x1b')](_0x8eb5ca[a139_0x4b9e('0x48')]['facebook']+a139_0x4b9e('0x4d'),(_0xc81071,_0x4acc84)=>{if(_0xc81071){return _0xe5a940(_0xc81071);}_0x3725b1['render'](a139_0x4b9e('0x4e'),{'title':a139_0x4b9e('0x4f'),'profile':_0x4acc84});});};