var a108_0x5c9c=['startDate','endDate','col','amount','gte','params','direction','literal','ASC','%Y-%m-%d\x20%H:00','countingDateShort','sum','total','HOUR','DAY','MONTH','YEAR','getFacebook','user','tokens','setAccessToken','accessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','api/facebook','Facebook\x20API','__esModule','defineProperty','fbgraph','ftp','setSequelize','getApi','render','API\x20Examples','syncFtp','log','connecting','default','ready','connected','list','colombia','Downloading:\x20','name','endsWith','json','sequelize','models','reportFiles','findOrCreate','spread','push','error','connect','ftp.vivotek.com','ipd','downloadFtp','findOne','then','connected:','get','colombia/','fileName','end','media/','.txt','createWriteStream','save','Downloaded:\x20','readFile','utf8','status','CountingInfo','Out','parse','EndTime','passes','create','findAll','countingDate','getPassCountingByDay','query','month'];(function(_0x240d45,_0x5501d1){var _0x45de2f=function(_0x37f5eb){while(--_0x37f5eb){_0x240d45['push'](_0x240d45['shift']());}};_0x45de2f(++_0x5501d1);}(a108_0x5c9c,0x1b3));var a108_0x2f8b=function(_0x372c17,_0xda35c5){_0x372c17=_0x372c17-0x0;var _0x3913bc=a108_0x5c9c[_0x372c17];return _0x3913bc;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x4bcfff){return _0x4bcfff&&_0x4bcfff[a108_0x2f8b('0x0')]?_0x4bcfff:{'default':_0x4bcfff};};Object[a108_0x2f8b('0x1')](exports,a108_0x2f8b('0x0'),{'value':!![]});const fbgraph_1=__importDefault(require(a108_0x2f8b('0x2')));const ftp_1=__importDefault(require(a108_0x2f8b('0x3')));const fs_1=__importDefault(require('fs'));function setSequelize(_0x5be335){exports['sequelize']=_0x5be335;}exports[a108_0x2f8b('0x4')]=setSequelize;exports[a108_0x2f8b('0x5')]=(_0x10233f,_0x136c57)=>{_0x136c57[a108_0x2f8b('0x6')]('api/index',{'title':a108_0x2f8b('0x7')});};exports[a108_0x2f8b('0x8')]=(_0x2e86d2,_0x21f6c1)=>{console[a108_0x2f8b('0x9')](a108_0x2f8b('0xa'));const _0x5d92dc=[];const _0x261dff=new ftp_1[(a108_0x2f8b('0xb'))]();_0x261dff['on'](a108_0x2f8b('0xc'),function(){console[a108_0x2f8b('0x9')](a108_0x2f8b('0xd'));_0x261dff[a108_0x2f8b('0xe')](a108_0x2f8b('0xf'),![],function(_0x13634d,_0xca5125){if(_0x13634d){}else{for(const _0x23409f of _0xca5125){console[a108_0x2f8b('0x9')](a108_0x2f8b('0x10')+_0x23409f['name']);if(_0x23409f[a108_0x2f8b('0x11')][a108_0x2f8b('0x12')](a108_0x2f8b('0x13'))){exports[a108_0x2f8b('0x14')][a108_0x2f8b('0x15')][a108_0x2f8b('0x16')][a108_0x2f8b('0x17')]({'where':{'fileName':_0x23409f[a108_0x2f8b('0x11')]}})[a108_0x2f8b('0x18')]((_0x36209b,_0x146e85)=>{if(_0x146e85){console[a108_0x2f8b('0x9')](_0x23409f[a108_0x2f8b('0x11')]);_0x5d92dc[a108_0x2f8b('0x19')](_0x36209b);}});}}}_0x21f6c1[a108_0x2f8b('0x13')]({'data':_0x5d92dc});});});_0x261dff['on'](a108_0x2f8b('0x1a'),function(_0x31a1d5){_0x21f6c1[a108_0x2f8b('0x13')]({'message':_0x31a1d5});});_0x261dff[a108_0x2f8b('0x1b')]({'host':a108_0x2f8b('0x1c'),'port':0x15,'user':a108_0x2f8b('0x1d'),'password':'ipd'});};exports[a108_0x2f8b('0x1e')]=(_0xfd7346,_0x34b730)=>{exports['sequelize']['models']['reportFiles'][a108_0x2f8b('0x1f')]({'where':{'status':null}})[a108_0x2f8b('0x20')](_0x11ffe9=>{if(_0x11ffe9){const _0x38c98a=new ftp_1[(a108_0x2f8b('0xb'))]();_0x38c98a['on'](a108_0x2f8b('0xc'),function(){console[a108_0x2f8b('0x9')](a108_0x2f8b('0x21')+_0x11ffe9['fileName']);_0x38c98a[a108_0x2f8b('0x22')](a108_0x2f8b('0x23')+_0x11ffe9[a108_0x2f8b('0x24')],function(_0x4c1775,_0x4ad37e){_0x38c98a[a108_0x2f8b('0x25')]();if(_0x4c1775){}else{const _0xc9aa91=a108_0x2f8b('0x26')+_0x11ffe9[a108_0x2f8b('0x24')]+a108_0x2f8b('0x27');_0x4ad37e['pipe'](fs_1[a108_0x2f8b('0xb')][a108_0x2f8b('0x28')](_0xc9aa91));_0x11ffe9['status']=0x1;_0x11ffe9[a108_0x2f8b('0x29')]();console[a108_0x2f8b('0x9')](a108_0x2f8b('0x2a')+_0x11ffe9[a108_0x2f8b('0x24')]);}});});_0x38c98a['on'](a108_0x2f8b('0x1a'),function(_0xfa7b64){_0x34b730[a108_0x2f8b('0x13')]({'message':_0xfa7b64});});_0x38c98a['connect']({'host':a108_0x2f8b('0x1c'),'port':0x15,'user':a108_0x2f8b('0x1d'),'password':'ipd'});_0x34b730[a108_0x2f8b('0x13')]({'data':_0x11ffe9['fileName']});}else{_0x34b730[a108_0x2f8b('0x13')]({'data':[]});}});};exports['processFtp']=(_0x432402,_0x2592e4)=>{exports[a108_0x2f8b('0x14')][a108_0x2f8b('0x15')][a108_0x2f8b('0x16')][a108_0x2f8b('0x1f')]({'where':{'status':0x1}})[a108_0x2f8b('0x20')](_0x1ef0d6=>{if(_0x1ef0d6){const _0x470322=a108_0x2f8b('0x26')+_0x1ef0d6[a108_0x2f8b('0x24')]+a108_0x2f8b('0x27');fs_1[a108_0x2f8b('0xb')][a108_0x2f8b('0x2b')](_0x470322,a108_0x2f8b('0x2c'),function(_0x34d1a8,_0x30bf81){if(_0x34d1a8){_0x1ef0d6[a108_0x2f8b('0x2d')]=null;}else{try{const _0x17de61=JSON['parse'](_0x30bf81);for(const _0x2c0adf of _0x17de61['Data'][0x0][a108_0x2f8b('0x2e')]){const _0x117ad2=_0x2c0adf['In'];const _0x542277=_0x2c0adf[a108_0x2f8b('0x2f')];const _0x224457=Date[a108_0x2f8b('0x30')](_0x2c0adf[a108_0x2f8b('0x31')]);if(_0x117ad2>0x0){exports['sequelize'][a108_0x2f8b('0x15')][a108_0x2f8b('0x32')][a108_0x2f8b('0x33')]({'reportFileId':_0x1ef0d6['id'],'amount':_0x117ad2,'countingDate':_0x224457});}if(_0x542277>0x0){exports[a108_0x2f8b('0x14')][a108_0x2f8b('0x15')][a108_0x2f8b('0x32')]['create']({'reportFileId':_0x1ef0d6['id'],'amount':_0x542277*-0x1,'countingDate':_0x224457});}}_0x1ef0d6[a108_0x2f8b('0x2d')]=0x2;}catch(_0xb88c21){_0x1ef0d6['status']=null;}}_0x1ef0d6[a108_0x2f8b('0x29')]();});_0x2592e4[a108_0x2f8b('0x13')]({'data':_0x1ef0d6[a108_0x2f8b('0x24')]});}else{_0x2592e4[a108_0x2f8b('0x13')]({'data':[]});}});};exports['getPassCounting']=(_0x5f210f,_0x371b28)=>{exports[a108_0x2f8b('0x14')][a108_0x2f8b('0x15')][a108_0x2f8b('0x32')][a108_0x2f8b('0x34')]({'where':{'amount':{[exports[a108_0x2f8b('0x14')]['Op']['gt']]:0x0}},'order':[[a108_0x2f8b('0x35'),'ASC']]})[a108_0x2f8b('0x20')](_0x3157b0=>{_0x371b28[a108_0x2f8b('0x13')]({'data':_0x3157b0});});};exports[a108_0x2f8b('0x36')]=(_0x4083b1,_0x46b5d4)=>{const _0x396f69=_0x4083b1[a108_0x2f8b('0x37')][a108_0x2f8b('0x38')];const _0x5b7042=_0x4083b1[a108_0x2f8b('0x37')][a108_0x2f8b('0x39')];const _0x5caf52=_0x4083b1['query'][a108_0x2f8b('0x3a')];exports[a108_0x2f8b('0x14')][a108_0x2f8b('0x15')][a108_0x2f8b('0x32')][a108_0x2f8b('0x34')]({'attributes':[a108_0x2f8b('0x35'),[exports[a108_0x2f8b('0x14')]['fn']('sum',exports[a108_0x2f8b('0x14')][a108_0x2f8b('0x3b')](a108_0x2f8b('0x3c'))),'total']],'where':{'countingDate':{[exports[a108_0x2f8b('0x14')]['Op'][a108_0x2f8b('0x3d')]]:_0x5b7042,[exports[a108_0x2f8b('0x14')]['Op']['lt']]:_0x5caf52},'amount':_0x4083b1[a108_0x2f8b('0x3e')][a108_0x2f8b('0x3f')]=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports[a108_0x2f8b('0x14')][a108_0x2f8b('0x40')]('YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))')],'order':[[a108_0x2f8b('0x35'),a108_0x2f8b('0x41')]]})['then'](_0x485e3d=>{_0x46b5d4['json']({'data':_0x485e3d});});};exports['getPassCountingByHour']=(_0x1e9a8a,_0xf542e7)=>{const _0x193cab=_0x1e9a8a['query'][a108_0x2f8b('0x38')];const _0x1d19d5=_0x1e9a8a[a108_0x2f8b('0x37')][a108_0x2f8b('0x39')];const _0x1861f2=_0x1e9a8a[a108_0x2f8b('0x37')][a108_0x2f8b('0x3a')];exports[a108_0x2f8b('0x14')][a108_0x2f8b('0x15')]['passes']['findAll']({'attributes':[a108_0x2f8b('0x35'),[exports['sequelize']['fn']('DATE_FORMAT',exports[a108_0x2f8b('0x14')][a108_0x2f8b('0x3b')](a108_0x2f8b('0x35')),a108_0x2f8b('0x42')),a108_0x2f8b('0x43')],[exports['sequelize']['fn'](a108_0x2f8b('0x44'),exports[a108_0x2f8b('0x14')][a108_0x2f8b('0x3b')](a108_0x2f8b('0x3c'))),a108_0x2f8b('0x45')]],'where':{'countingDate':{[exports[a108_0x2f8b('0x14')]['Op'][a108_0x2f8b('0x3d')]]:_0x1d19d5,[exports[a108_0x2f8b('0x14')]['Op']['lt']]:_0x1861f2},'amount':_0x1e9a8a[a108_0x2f8b('0x3e')][a108_0x2f8b('0x3f')]=='in'?{[exports[a108_0x2f8b('0x14')]['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports[a108_0x2f8b('0x14')]['fn'](a108_0x2f8b('0x46'),exports[a108_0x2f8b('0x14')][a108_0x2f8b('0x3b')](a108_0x2f8b('0x35'))),exports['sequelize']['fn'](a108_0x2f8b('0x47'),exports[a108_0x2f8b('0x14')][a108_0x2f8b('0x3b')](a108_0x2f8b('0x35'))),exports[a108_0x2f8b('0x14')]['fn'](a108_0x2f8b('0x48'),exports[a108_0x2f8b('0x14')][a108_0x2f8b('0x3b')](a108_0x2f8b('0x35'))),exports[a108_0x2f8b('0x14')]['fn'](a108_0x2f8b('0x49'),exports['sequelize'][a108_0x2f8b('0x3b')](a108_0x2f8b('0x35')))],'order':[[a108_0x2f8b('0x35'),'ASC']]})['then'](_0x13a0c8=>{_0xf542e7[a108_0x2f8b('0x13')]({'data':_0x13a0c8});});};exports[a108_0x2f8b('0x4a')]=(_0x351fa8,_0xec9b8a,_0x1b7614)=>{const _0x3cefd2=_0x351fa8[a108_0x2f8b('0x4b')][a108_0x2f8b('0x4c')]['find'](_0x3cefd2=>_0x3cefd2['kind']==='facebook');fbgraph_1['default'][a108_0x2f8b('0x4d')](_0x3cefd2[a108_0x2f8b('0x4e')]);fbgraph_1['default']['get'](_0x351fa8[a108_0x2f8b('0x4b')]['facebook']+a108_0x2f8b('0x4f'),(_0x7b3e31,_0x44a135)=>{if(_0x7b3e31){return _0x1b7614(_0x7b3e31);}_0xec9b8a['render'](a108_0x2f8b('0x50'),{'title':a108_0x2f8b('0x51'),'profile':_0x44a135});});};