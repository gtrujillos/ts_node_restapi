var a198_0x5950=['name','endsWith','findOrCreate','spread','error','json','downloadFtp','models','then','default','connected:','fileName','get','end','media/','.txt','createWriteStream','status','save','Downloaded:\x20','connect','ftp.vivotek.com','ipd','processFtp','utf8','Out','parse','EndTime','passes','create','getPassCounting','findAll','ASC','query','month','startDate','endDate','sum','col','total','gte','params','literal','getPassCountingByHour','countingDate','%Y-%m-%d\x20%H:00','countingDateShort','direction','DAY','YEAR','getFacebook','user','tokens','find','kind','facebook','setAccessToken','accessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','api/facebook','Facebook\x20API','__importDefault','__esModule','fbgraph','sequelize','setSequelize','getApi','render','api/index','API\x20Examples','syncFtp','connecting','ready','log','connected','colombia','Downloading:\x20'];(function(_0x183fea,_0x15cd07){var _0x531840=function(_0x508229){while(--_0x508229){_0x183fea['push'](_0x183fea['shift']());}};_0x531840(++_0x15cd07);}(a198_0x5950,0x124));var a198_0x1e40=function(_0x2fbeca,_0x302170){_0x2fbeca=_0x2fbeca-0x0;var _0x1ae02f=a198_0x5950[_0x2fbeca];return _0x1ae02f;};'use strict';var __importDefault=this&&this[a198_0x1e40('0x0')]||function(_0xbd30bc){return _0xbd30bc&&_0xbd30bc[a198_0x1e40('0x1')]?_0xbd30bc:{'default':_0xbd30bc};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const fbgraph_1=__importDefault(require(a198_0x1e40('0x2')));const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));function setSequelize(_0x374710){exports[a198_0x1e40('0x3')]=_0x374710;}exports[a198_0x1e40('0x4')]=setSequelize;exports[a198_0x1e40('0x5')]=(_0x4f34cf,_0x1dd5c7)=>{_0x1dd5c7[a198_0x1e40('0x6')](a198_0x1e40('0x7'),{'title':a198_0x1e40('0x8')});};exports[a198_0x1e40('0x9')]=(_0x4193f3,_0x4ac856)=>{console['log'](a198_0x1e40('0xa'));const _0x209c8d=[];const _0x448cb3=new ftp_1['default']();_0x448cb3['on'](a198_0x1e40('0xb'),function(){console[a198_0x1e40('0xc')](a198_0x1e40('0xd'));_0x448cb3['list'](a198_0x1e40('0xe'),![],function(_0x2afc75,_0x6e986f){if(_0x2afc75){}else{for(const _0x476cf3 of _0x6e986f){console[a198_0x1e40('0xc')](a198_0x1e40('0xf')+_0x476cf3[a198_0x1e40('0x10')]);if(_0x476cf3[a198_0x1e40('0x10')][a198_0x1e40('0x11')]('json')){exports['sequelize']['models']['reportFiles'][a198_0x1e40('0x12')]({'where':{'fileName':_0x476cf3[a198_0x1e40('0x10')]}})[a198_0x1e40('0x13')]((_0x2a934f,_0x382181)=>{if(_0x382181){console[a198_0x1e40('0xc')](_0x476cf3[a198_0x1e40('0x10')]);_0x209c8d['push'](_0x2a934f);}});}}}_0x4ac856['json']({'data':_0x209c8d});});});_0x448cb3['on'](a198_0x1e40('0x14'),function(_0x16bc3d){_0x4ac856[a198_0x1e40('0x15')]({'message':_0x16bc3d});});_0x448cb3['connect']({'host':'ftp.vivotek.com','port':0x15,'user':'ipd','password':'ipd'});};exports[a198_0x1e40('0x16')]=(_0x4c13ca,_0x53129b)=>{exports['sequelize'][a198_0x1e40('0x17')]['reportFiles']['findOne']({'where':{'status':null}})[a198_0x1e40('0x18')](_0x430ab5=>{if(_0x430ab5){const _0x272f11=new ftp_1[(a198_0x1e40('0x19'))]();_0x272f11['on'](a198_0x1e40('0xb'),function(){console['log'](a198_0x1e40('0x1a')+_0x430ab5[a198_0x1e40('0x1b')]);_0x272f11[a198_0x1e40('0x1c')]('colombia/'+_0x430ab5[a198_0x1e40('0x1b')],function(_0x2e1fd5,_0x6b89e9){_0x272f11[a198_0x1e40('0x1d')]();if(_0x2e1fd5){}else{const _0x42d5eb=a198_0x1e40('0x1e')+_0x430ab5[a198_0x1e40('0x1b')]+a198_0x1e40('0x1f');_0x6b89e9['pipe'](fs_1['default'][a198_0x1e40('0x20')](_0x42d5eb));_0x430ab5[a198_0x1e40('0x21')]=0x1;_0x430ab5[a198_0x1e40('0x22')]();console[a198_0x1e40('0xc')](a198_0x1e40('0x23')+_0x430ab5[a198_0x1e40('0x1b')]);}});});_0x272f11['on'](a198_0x1e40('0x14'),function(_0xa398eb){_0x53129b['json']({'message':_0xa398eb});});_0x272f11[a198_0x1e40('0x24')]({'host':a198_0x1e40('0x25'),'port':0x15,'user':'ipd','password':a198_0x1e40('0x26')});_0x53129b['json']({'data':_0x430ab5[a198_0x1e40('0x1b')]});}else{_0x53129b['json']({'data':[]});}});};exports[a198_0x1e40('0x27')]=(_0x2f9b34,_0x1e7bbf)=>{exports[a198_0x1e40('0x3')][a198_0x1e40('0x17')]['reportFiles']['findOne']({'where':{'status':0x1}})[a198_0x1e40('0x18')](_0x1af20a=>{if(_0x1af20a){const _0x4427d8='media/'+_0x1af20a['fileName']+a198_0x1e40('0x1f');fs_1[a198_0x1e40('0x19')]['readFile'](_0x4427d8,a198_0x1e40('0x28'),function(_0x267521,_0x3cbfd7){if(_0x267521){_0x1af20a[a198_0x1e40('0x21')]=null;}else{try{const _0x1834df=JSON['parse'](_0x3cbfd7);for(const _0x577c33 of _0x1834df['Data'][0x0]['CountingInfo']){const _0x38d7ad=_0x577c33['In'];const _0x1567d2=_0x577c33[a198_0x1e40('0x29')];const _0x3a6067=Date[a198_0x1e40('0x2a')](_0x577c33[a198_0x1e40('0x2b')]);if(_0x38d7ad>0x0){exports[a198_0x1e40('0x3')][a198_0x1e40('0x17')][a198_0x1e40('0x2c')][a198_0x1e40('0x2d')]({'reportFileId':_0x1af20a['id'],'amount':_0x38d7ad,'countingDate':_0x3a6067});}if(_0x1567d2>0x0){exports[a198_0x1e40('0x3')][a198_0x1e40('0x17')]['passes'][a198_0x1e40('0x2d')]({'reportFileId':_0x1af20a['id'],'amount':_0x1567d2*-0x1,'countingDate':_0x3a6067});}}_0x1af20a['status']=0x2;}catch(_0x1cc2c1){_0x1af20a[a198_0x1e40('0x21')]=null;}}_0x1af20a[a198_0x1e40('0x22')]();});_0x1e7bbf[a198_0x1e40('0x15')]({'data':_0x1af20a[a198_0x1e40('0x1b')]});}else{_0x1e7bbf['json']({'data':[]});}});};exports[a198_0x1e40('0x2e')]=(_0x24c7be,_0x35bb80)=>{exports[a198_0x1e40('0x3')][a198_0x1e40('0x17')][a198_0x1e40('0x2c')][a198_0x1e40('0x2f')]({'where':{'amount':{[exports[a198_0x1e40('0x3')]['Op']['gt']]:0x0}},'order':[['countingDate',a198_0x1e40('0x30')]]})[a198_0x1e40('0x18')](_0x275c5a=>{_0x35bb80[a198_0x1e40('0x15')]({'data':_0x275c5a});});};exports['getPassCountingByDay']=(_0x49039b,_0x1e6d8d)=>{const _0x35cbb2=_0x49039b[a198_0x1e40('0x31')][a198_0x1e40('0x32')];const _0x385d66=_0x49039b[a198_0x1e40('0x31')][a198_0x1e40('0x33')];const _0x3e8ac9=_0x49039b[a198_0x1e40('0x31')][a198_0x1e40('0x34')];exports[a198_0x1e40('0x3')][a198_0x1e40('0x17')][a198_0x1e40('0x2c')]['findAll']({'attributes':['countingDate',[exports[a198_0x1e40('0x3')]['fn'](a198_0x1e40('0x35'),exports[a198_0x1e40('0x3')][a198_0x1e40('0x36')]('amount')),a198_0x1e40('0x37')]],'where':{'countingDate':{[exports[a198_0x1e40('0x3')]['Op'][a198_0x1e40('0x38')]]:_0x385d66,[exports[a198_0x1e40('0x3')]['Op']['lt']]:_0x3e8ac9},'amount':_0x49039b[a198_0x1e40('0x39')]['direction']=='in'?{[exports[a198_0x1e40('0x3')]['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports['sequelize'][a198_0x1e40('0x3a')]('YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))')],'order':[['countingDate',a198_0x1e40('0x30')]]})[a198_0x1e40('0x18')](_0x3b777b=>{_0x1e6d8d[a198_0x1e40('0x15')]({'data':_0x3b777b});});};exports[a198_0x1e40('0x3b')]=(_0x35617f,_0x52fcdc)=>{const _0x35b1ec=_0x35617f[a198_0x1e40('0x31')]['month'];const _0x32b16f=_0x35617f['query']['startDate'];const _0x437367=_0x35617f['query'][a198_0x1e40('0x34')];exports[a198_0x1e40('0x3')]['models']['passes'][a198_0x1e40('0x2f')]({'attributes':[a198_0x1e40('0x3c'),[exports[a198_0x1e40('0x3')]['fn']('DATE_FORMAT',exports[a198_0x1e40('0x3')][a198_0x1e40('0x36')](a198_0x1e40('0x3c')),a198_0x1e40('0x3d')),a198_0x1e40('0x3e')],[exports[a198_0x1e40('0x3')]['fn'](a198_0x1e40('0x35'),exports[a198_0x1e40('0x3')][a198_0x1e40('0x36')]('amount')),a198_0x1e40('0x37')]],'where':{'countingDate':{[exports[a198_0x1e40('0x3')]['Op']['gte']]:_0x32b16f,[exports['sequelize']['Op']['lt']]:_0x437367},'amount':_0x35617f[a198_0x1e40('0x39')][a198_0x1e40('0x3f')]=='in'?{[exports[a198_0x1e40('0x3')]['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports[a198_0x1e40('0x3')]['fn']('HOUR',exports[a198_0x1e40('0x3')]['col'](a198_0x1e40('0x3c'))),exports['sequelize']['fn'](a198_0x1e40('0x40'),exports[a198_0x1e40('0x3')][a198_0x1e40('0x36')](a198_0x1e40('0x3c'))),exports[a198_0x1e40('0x3')]['fn']('MONTH',exports[a198_0x1e40('0x3')][a198_0x1e40('0x36')]('countingDate')),exports[a198_0x1e40('0x3')]['fn'](a198_0x1e40('0x41'),exports[a198_0x1e40('0x3')][a198_0x1e40('0x36')](a198_0x1e40('0x3c')))],'order':[[a198_0x1e40('0x3c'),a198_0x1e40('0x30')]]})[a198_0x1e40('0x18')](_0x3a3a95=>{_0x52fcdc['json']({'data':_0x3a3a95});});};exports[a198_0x1e40('0x42')]=(_0x50865c,_0x5e3c5d,_0x44c94b)=>{const _0x1daf3e=_0x50865c[a198_0x1e40('0x43')][a198_0x1e40('0x44')][a198_0x1e40('0x45')](_0x1daf3e=>_0x1daf3e[a198_0x1e40('0x46')]===a198_0x1e40('0x47'));fbgraph_1[a198_0x1e40('0x19')][a198_0x1e40('0x48')](_0x1daf3e[a198_0x1e40('0x49')]);fbgraph_1['default'][a198_0x1e40('0x1c')](_0x50865c[a198_0x1e40('0x43')]['facebook']+a198_0x1e40('0x4a'),(_0x3bde04,_0x3fc7e1)=>{if(_0x3bde04){return _0x44c94b(_0x3bde04);}_0x5e3c5d[a198_0x1e40('0x6')](a198_0x1e40('0x4b'),{'title':a198_0x1e40('0x4c'),'profile':_0x3fc7e1});});};