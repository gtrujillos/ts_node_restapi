var a85_0xa07f=['ready','connected','list','colombia','endsWith','json','models','findOrCreate','name','spread','connect','ftp.vivotek.com','ipd','downloadFtp','findOne','then','connected:','get','colombia/','fileName','media/','.txt','createWriteStream','status','save','Downloaded:\x20','readFile','utf8','parse','Data','CountingInfo','Out','passes','create','getPassCounting','findAll','countingDate','getPassCountingByDay','startDate','query','endDate','sum','col','amount','total','gte','params','direction','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','month','DATE_FORMAT','%Y-%m-%d\x20%H:00','countingDateShort','DAY','MONTH','YEAR','ASC','getFacebook','user','facebook','setAccessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','Facebook\x20API','__importDefault','__esModule','fbgraph','ftp','sequelize','getApi','render','api/index','API\x20Examples','log','default'];(function(_0x41d3f4,_0x1b0ecc){var _0x1629f1=function(_0x84561b){while(--_0x84561b){_0x41d3f4['push'](_0x41d3f4['shift']());}};_0x1629f1(++_0x1b0ecc);}(a85_0xa07f,0xd9));var a85_0x287c=function(_0x1d2076,_0x2a7e5a){_0x1d2076=_0x1d2076-0x0;var _0x6ffefc=a85_0xa07f[_0x1d2076];return _0x6ffefc;};'use strict';var __importDefault=this&&this[a85_0x287c('0x0')]||function(_0x1f1867){return _0x1f1867&&_0x1f1867[a85_0x287c('0x1')]?_0x1f1867:{'default':_0x1f1867};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const fbgraph_1=__importDefault(require(a85_0x287c('0x2')));const ftp_1=__importDefault(require(a85_0x287c('0x3')));const fs_1=__importDefault(require('fs'));function setSequelize(_0x289e18){exports[a85_0x287c('0x4')]=_0x289e18;}exports['setSequelize']=setSequelize;exports[a85_0x287c('0x5')]=(_0x2bc652,_0x49626e)=>{_0x49626e[a85_0x287c('0x6')](a85_0x287c('0x7'),{'title':a85_0x287c('0x8')});};exports['syncFtp']=(_0x3a8207,_0x13940f)=>{console[a85_0x287c('0x9')]('connecting');const _0x4b6911=[];const _0x263df=new ftp_1[(a85_0x287c('0xa'))]();_0x263df['on'](a85_0x287c('0xb'),function(){console[a85_0x287c('0x9')](a85_0x287c('0xc'));_0x263df[a85_0x287c('0xd')](a85_0x287c('0xe'),![],function(_0x48ab5b,_0x375bbc){if(_0x48ab5b){}else{for(const _0x50c758 of _0x375bbc){console[a85_0x287c('0x9')]('Downloading:\x20'+_0x50c758['name']);if(_0x50c758['name'][a85_0x287c('0xf')](a85_0x287c('0x10'))){exports['sequelize'][a85_0x287c('0x11')]['reportFiles'][a85_0x287c('0x12')]({'where':{'fileName':_0x50c758[a85_0x287c('0x13')]}})[a85_0x287c('0x14')]((_0x56db90,_0x37dafd)=>{if(_0x37dafd){console[a85_0x287c('0x9')](_0x50c758[a85_0x287c('0x13')]);_0x4b6911['push'](_0x56db90);}});}}}_0x13940f['json']({'data':_0x4b6911});});});_0x263df['on']('error',function(_0x4f2ab3){_0x13940f[a85_0x287c('0x10')]({'message':_0x4f2ab3});});_0x263df[a85_0x287c('0x15')]({'host':a85_0x287c('0x16'),'port':0x15,'user':'ipd','password':a85_0x287c('0x17')});};exports[a85_0x287c('0x18')]=(_0x1d6f9d,_0x40c5bc)=>{exports[a85_0x287c('0x4')][a85_0x287c('0x11')]['reportFiles'][a85_0x287c('0x19')]({'where':{'status':null}})[a85_0x287c('0x1a')](_0x388a45=>{if(_0x388a45){const _0x20be74=new ftp_1[(a85_0x287c('0xa'))]();_0x20be74['on'](a85_0x287c('0xb'),function(){console[a85_0x287c('0x9')](a85_0x287c('0x1b')+_0x388a45['fileName']);_0x20be74[a85_0x287c('0x1c')](a85_0x287c('0x1d')+_0x388a45[a85_0x287c('0x1e')],function(_0x43495e,_0x5099cc){_0x20be74['end']();if(_0x43495e){}else{const _0x3da283=a85_0x287c('0x1f')+_0x388a45[a85_0x287c('0x1e')]+a85_0x287c('0x20');_0x5099cc['pipe'](fs_1['default'][a85_0x287c('0x21')](_0x3da283));_0x388a45[a85_0x287c('0x22')]=0x1;_0x388a45[a85_0x287c('0x23')]();console[a85_0x287c('0x9')](a85_0x287c('0x24')+_0x388a45[a85_0x287c('0x1e')]);}});});_0x20be74['on']('error',function(_0x678224){_0x40c5bc[a85_0x287c('0x10')]({'message':_0x678224});});_0x20be74[a85_0x287c('0x15')]({'host':a85_0x287c('0x16'),'port':0x15,'user':a85_0x287c('0x17'),'password':a85_0x287c('0x17')});_0x40c5bc['json']({'data':_0x388a45[a85_0x287c('0x1e')]});}else{_0x40c5bc['json']({'data':[]});}});};exports['processFtp']=(_0x50a9b8,_0x4d4348)=>{exports['sequelize']['models']['reportFiles']['findOne']({'where':{'status':0x1}})['then'](_0x18b72c=>{if(_0x18b72c){const _0xd98e96=a85_0x287c('0x1f')+_0x18b72c['fileName']+a85_0x287c('0x20');fs_1[a85_0x287c('0xa')][a85_0x287c('0x25')](_0xd98e96,a85_0x287c('0x26'),function(_0x147640,_0x29917c){if(_0x147640){_0x18b72c['status']=null;}else{try{const _0x5dc753=JSON[a85_0x287c('0x27')](_0x29917c);for(const _0x94b49d of _0x5dc753[a85_0x287c('0x28')][0x0][a85_0x287c('0x29')]){const _0x34ff3a=_0x94b49d['In'];const _0x322bae=_0x94b49d[a85_0x287c('0x2a')];const _0x2861e0=Date['parse'](_0x94b49d['EndTime']);if(_0x34ff3a>0x0){exports[a85_0x287c('0x4')][a85_0x287c('0x11')][a85_0x287c('0x2b')][a85_0x287c('0x2c')]({'reportFileId':_0x18b72c['id'],'amount':_0x34ff3a,'countingDate':_0x2861e0});}if(_0x322bae>0x0){exports['sequelize']['models'][a85_0x287c('0x2b')][a85_0x287c('0x2c')]({'reportFileId':_0x18b72c['id'],'amount':_0x322bae*-0x1,'countingDate':_0x2861e0});}}_0x18b72c[a85_0x287c('0x22')]=0x2;}catch(_0x46878e){_0x18b72c[a85_0x287c('0x22')]=null;}}_0x18b72c[a85_0x287c('0x23')]();});_0x4d4348['json']({'data':_0x18b72c[a85_0x287c('0x1e')]});}else{_0x4d4348[a85_0x287c('0x10')]({'data':[]});}});};exports[a85_0x287c('0x2d')]=(_0x38e9f4,_0x51a61c)=>{exports[a85_0x287c('0x4')][a85_0x287c('0x11')][a85_0x287c('0x2b')][a85_0x287c('0x2e')]({'where':{'amount':{[exports[a85_0x287c('0x4')]['Op']['gt']]:0x0}},'order':[[a85_0x287c('0x2f'),'ASC']]})[a85_0x287c('0x1a')](_0x1a3ebd=>{_0x51a61c[a85_0x287c('0x10')]({'data':_0x1a3ebd});});};exports[a85_0x287c('0x30')]=(_0x162360,_0x496421)=>{const _0x569118=_0x162360['query']['month'];const _0x1cde1a=_0x162360['query'][a85_0x287c('0x31')];const _0x425080=_0x162360[a85_0x287c('0x32')][a85_0x287c('0x33')];exports[a85_0x287c('0x4')][a85_0x287c('0x11')][a85_0x287c('0x2b')][a85_0x287c('0x2e')]({'attributes':['countingDate',[exports[a85_0x287c('0x4')]['fn'](a85_0x287c('0x34'),exports['sequelize'][a85_0x287c('0x35')](a85_0x287c('0x36'))),a85_0x287c('0x37')]],'where':{'countingDate':{[exports[a85_0x287c('0x4')]['Op'][a85_0x287c('0x38')]]:_0x1cde1a,[exports['sequelize']['Op']['lt']]:_0x425080},'amount':_0x162360[a85_0x287c('0x39')][a85_0x287c('0x3a')]=='in'?{[exports[a85_0x287c('0x4')]['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports['sequelize'][a85_0x287c('0x3b')](a85_0x287c('0x3c'))],'order':[[a85_0x287c('0x2f'),'ASC']]})['then'](_0x56091c=>{_0x496421[a85_0x287c('0x10')]({'data':_0x56091c});});};exports[a85_0x287c('0x3d')]=(_0x3e5674,_0x2e31dc)=>{const _0xad6bcc=_0x3e5674[a85_0x287c('0x32')][a85_0x287c('0x3e')];const _0x5b250c=_0x3e5674[a85_0x287c('0x32')][a85_0x287c('0x31')];const _0x2e6d37=_0x3e5674['query'][a85_0x287c('0x33')];exports[a85_0x287c('0x4')][a85_0x287c('0x11')][a85_0x287c('0x2b')][a85_0x287c('0x2e')]({'attributes':[a85_0x287c('0x2f'),[exports['sequelize']['fn'](a85_0x287c('0x3f'),exports[a85_0x287c('0x4')][a85_0x287c('0x35')](a85_0x287c('0x2f')),a85_0x287c('0x40')),a85_0x287c('0x41')],[exports[a85_0x287c('0x4')]['fn'](a85_0x287c('0x34'),exports[a85_0x287c('0x4')]['col']('amount')),a85_0x287c('0x37')]],'where':{'countingDate':{[exports[a85_0x287c('0x4')]['Op']['gte']]:_0x5b250c,[exports['sequelize']['Op']['lt']]:_0x2e6d37},'amount':_0x3e5674[a85_0x287c('0x39')][a85_0x287c('0x3a')]=='in'?{[exports[a85_0x287c('0x4')]['Op']['gt']]:0x0}:{[exports[a85_0x287c('0x4')]['Op']['lt']]:0x0}},'group':[exports[a85_0x287c('0x4')]['fn']('HOUR',exports[a85_0x287c('0x4')]['col'](a85_0x287c('0x2f'))),exports[a85_0x287c('0x4')]['fn'](a85_0x287c('0x42'),exports['sequelize']['col'](a85_0x287c('0x2f'))),exports[a85_0x287c('0x4')]['fn'](a85_0x287c('0x43'),exports[a85_0x287c('0x4')]['col']('countingDate')),exports['sequelize']['fn'](a85_0x287c('0x44'),exports[a85_0x287c('0x4')][a85_0x287c('0x35')]('countingDate'))],'order':[[a85_0x287c('0x2f'),a85_0x287c('0x45')]]})[a85_0x287c('0x1a')](_0x4bd9e6=>{_0x2e31dc['json']({'data':_0x4bd9e6});});};exports[a85_0x287c('0x46')]=(_0x151758,_0x4ffc13,_0x5be359)=>{const _0x42c5e2=_0x151758[a85_0x287c('0x47')]['tokens']['find'](_0x42c5e2=>_0x42c5e2['kind']===a85_0x287c('0x48'));fbgraph_1['default'][a85_0x287c('0x49')](_0x42c5e2['accessToken']);fbgraph_1[a85_0x287c('0xa')][a85_0x287c('0x1c')](_0x151758['user'][a85_0x287c('0x48')]+a85_0x287c('0x4a'),(_0x33e9dd,_0x41d2ad)=>{if(_0x33e9dd){return _0x5be359(_0x33e9dd);}_0x4ffc13['render']('api/facebook',{'title':a85_0x287c('0x4b'),'profile':_0x41d2ad});});};