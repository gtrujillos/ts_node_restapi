var a88_0x388d=['ipd','downloadFtp','models','then','connected:','fileName','get','media/','.txt','pipe','createWriteStream','status','save','Downloaded:\x20','findOne','readFile','utf8','parse','Data','CountingInfo','Out','EndTime','passes','create','getPassCounting','findAll','countingDate','ASC','query','month','startDate','sum','col','amount','total','gte','params','direction','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','endDate','%Y-%m-%d\x20%H:00','countingDateShort','DAY','MONTH','YEAR','user','find','kind','facebook','setAccessToken','accessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','Facebook\x20API','__importDefault','__esModule','defineProperty','fbgraph','sequelize','getApi','render','api/index','API\x20Examples','log','default','ready','list','colombia','Downloading:\x20','name','endsWith','reportFiles','findOrCreate','spread','json','error','connect','ftp.vivotek.com'];(function(_0x426d8b,_0x2116eb){var _0x59e24f=function(_0x37067b){while(--_0x37067b){_0x426d8b['push'](_0x426d8b['shift']());}};_0x59e24f(++_0x2116eb);}(a88_0x388d,0x173));var a88_0x2173=function(_0x38e62e,_0x24c59e){_0x38e62e=_0x38e62e-0x0;var _0x1a8658=a88_0x388d[_0x38e62e];return _0x1a8658;};'use strict';var __importDefault=this&&this[a88_0x2173('0x0')]||function(_0x22f302){return _0x22f302&&_0x22f302[a88_0x2173('0x1')]?_0x22f302:{'default':_0x22f302};};Object[a88_0x2173('0x2')](exports,a88_0x2173('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a88_0x2173('0x3')));const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));function setSequelize(_0x521b02){exports[a88_0x2173('0x4')]=_0x521b02;}exports['setSequelize']=setSequelize;exports[a88_0x2173('0x5')]=(_0x5790f1,_0x1a4145)=>{_0x1a4145[a88_0x2173('0x6')](a88_0x2173('0x7'),{'title':a88_0x2173('0x8')});};exports['syncFtp']=(_0x170de8,_0x16425d)=>{console[a88_0x2173('0x9')]('connecting');const _0x305025=[];const _0x2ec23a=new ftp_1[(a88_0x2173('0xa'))]();_0x2ec23a['on'](a88_0x2173('0xb'),function(){console['log']('connected');_0x2ec23a[a88_0x2173('0xc')](a88_0x2173('0xd'),![],function(_0x505f0a,_0x5b6fe5){if(_0x505f0a){}else{for(const _0x125eb5 of _0x5b6fe5){console[a88_0x2173('0x9')](a88_0x2173('0xe')+_0x125eb5[a88_0x2173('0xf')]);if(_0x125eb5[a88_0x2173('0xf')][a88_0x2173('0x10')]('json')){exports[a88_0x2173('0x4')]['models'][a88_0x2173('0x11')][a88_0x2173('0x12')]({'where':{'fileName':_0x125eb5['name']}})[a88_0x2173('0x13')]((_0x2be1d0,_0x4ad96a)=>{if(_0x4ad96a){console[a88_0x2173('0x9')](_0x125eb5[a88_0x2173('0xf')]);_0x305025['push'](_0x2be1d0);}});}}}_0x16425d[a88_0x2173('0x14')]({'data':_0x305025});});});_0x2ec23a['on'](a88_0x2173('0x15'),function(_0x95ccd6){_0x16425d['json']({'message':_0x95ccd6});});_0x2ec23a[a88_0x2173('0x16')]({'host':a88_0x2173('0x17'),'port':0x15,'user':a88_0x2173('0x18'),'password':a88_0x2173('0x18')});};exports[a88_0x2173('0x19')]=(_0x454d17,_0x45bee8)=>{exports['sequelize'][a88_0x2173('0x1a')]['reportFiles']['findOne']({'where':{'status':null}})[a88_0x2173('0x1b')](_0x1a432d=>{if(_0x1a432d){const _0x133cee=new ftp_1[(a88_0x2173('0xa'))]();_0x133cee['on']('ready',function(){console[a88_0x2173('0x9')](a88_0x2173('0x1c')+_0x1a432d[a88_0x2173('0x1d')]);_0x133cee[a88_0x2173('0x1e')]('colombia/'+_0x1a432d[a88_0x2173('0x1d')],function(_0x326a95,_0x10c8e1){_0x133cee['end']();if(_0x326a95){}else{const _0x2fd236=a88_0x2173('0x1f')+_0x1a432d['fileName']+a88_0x2173('0x20');_0x10c8e1[a88_0x2173('0x21')](fs_1['default'][a88_0x2173('0x22')](_0x2fd236));_0x1a432d[a88_0x2173('0x23')]=0x1;_0x1a432d[a88_0x2173('0x24')]();console[a88_0x2173('0x9')](a88_0x2173('0x25')+_0x1a432d[a88_0x2173('0x1d')]);}});});_0x133cee['on']('error',function(_0x5d8561){_0x45bee8[a88_0x2173('0x14')]({'message':_0x5d8561});});_0x133cee['connect']({'host':a88_0x2173('0x17'),'port':0x15,'user':a88_0x2173('0x18'),'password':a88_0x2173('0x18')});_0x45bee8['json']({'data':_0x1a432d[a88_0x2173('0x1d')]});}else{_0x45bee8[a88_0x2173('0x14')]({'data':[]});}});};exports['processFtp']=(_0x584428,_0x1f2d7b)=>{exports[a88_0x2173('0x4')][a88_0x2173('0x1a')][a88_0x2173('0x11')][a88_0x2173('0x26')]({'where':{'status':0x1}})[a88_0x2173('0x1b')](_0x58f494=>{if(_0x58f494){const _0x5c01a5='media/'+_0x58f494[a88_0x2173('0x1d')]+a88_0x2173('0x20');fs_1[a88_0x2173('0xa')][a88_0x2173('0x27')](_0x5c01a5,a88_0x2173('0x28'),function(_0x1e8930,_0x26bf69){if(_0x1e8930){_0x58f494[a88_0x2173('0x23')]=null;}else{try{const _0x29c6e1=JSON[a88_0x2173('0x29')](_0x26bf69);for(const _0x2f9169 of _0x29c6e1[a88_0x2173('0x2a')][0x0][a88_0x2173('0x2b')]){const _0x15ba6d=_0x2f9169['In'];const _0x4ebddf=_0x2f9169[a88_0x2173('0x2c')];const _0x570ce8=Date[a88_0x2173('0x29')](_0x2f9169[a88_0x2173('0x2d')]);if(_0x15ba6d>0x0){exports[a88_0x2173('0x4')][a88_0x2173('0x1a')][a88_0x2173('0x2e')][a88_0x2173('0x2f')]({'reportFileId':_0x58f494['id'],'amount':_0x15ba6d,'countingDate':_0x570ce8});}if(_0x4ebddf>0x0){exports[a88_0x2173('0x4')]['models'][a88_0x2173('0x2e')][a88_0x2173('0x2f')]({'reportFileId':_0x58f494['id'],'amount':_0x4ebddf*-0x1,'countingDate':_0x570ce8});}}_0x58f494[a88_0x2173('0x23')]=0x2;}catch(_0x3772f5){_0x58f494['status']=null;}}_0x58f494[a88_0x2173('0x24')]();});_0x1f2d7b[a88_0x2173('0x14')]({'data':_0x58f494['fileName']});}else{_0x1f2d7b[a88_0x2173('0x14')]({'data':[]});}});};exports[a88_0x2173('0x30')]=(_0x174ed8,_0x5cc0ea)=>{exports[a88_0x2173('0x4')]['models']['passes'][a88_0x2173('0x31')]({'where':{'amount':{[exports[a88_0x2173('0x4')]['Op']['gt']]:0x0}},'order':[[a88_0x2173('0x32'),a88_0x2173('0x33')]]})[a88_0x2173('0x1b')](_0x849021=>{_0x5cc0ea[a88_0x2173('0x14')]({'data':_0x849021});});};exports['getPassCountingByDay']=(_0x5333d0,_0x3500d6)=>{const _0x3c8994=_0x5333d0[a88_0x2173('0x34')][a88_0x2173('0x35')];const _0x1dcf33=_0x5333d0[a88_0x2173('0x34')][a88_0x2173('0x36')];const _0x38c081=_0x5333d0[a88_0x2173('0x34')]['endDate'];exports[a88_0x2173('0x4')][a88_0x2173('0x1a')][a88_0x2173('0x2e')][a88_0x2173('0x31')]({'attributes':['countingDate',[exports[a88_0x2173('0x4')]['fn'](a88_0x2173('0x37'),exports[a88_0x2173('0x4')][a88_0x2173('0x38')](a88_0x2173('0x39'))),a88_0x2173('0x3a')]],'where':{'countingDate':{[exports['sequelize']['Op'][a88_0x2173('0x3b')]]:_0x1dcf33,[exports[a88_0x2173('0x4')]['Op']['lt']]:_0x38c081},'amount':_0x5333d0[a88_0x2173('0x3c')][a88_0x2173('0x3d')]=='in'?{[exports[a88_0x2173('0x4')]['Op']['gt']]:0x0}:{[exports[a88_0x2173('0x4')]['Op']['lt']]:0x0}},'group':[exports['sequelize'][a88_0x2173('0x3e')](a88_0x2173('0x3f'))],'order':[[a88_0x2173('0x32'),a88_0x2173('0x33')]]})['then'](_0x306c45=>{_0x3500d6['json']({'data':_0x306c45});});};exports[a88_0x2173('0x40')]=(_0x234afe,_0x93c65c)=>{const _0x3d89f4=_0x234afe[a88_0x2173('0x34')]['month'];const _0x462ad8=_0x234afe[a88_0x2173('0x34')][a88_0x2173('0x36')];const _0x16e11d=_0x234afe['query'][a88_0x2173('0x41')];exports[a88_0x2173('0x4')][a88_0x2173('0x1a')]['passes'][a88_0x2173('0x31')]({'attributes':[a88_0x2173('0x32'),[exports[a88_0x2173('0x4')]['fn']('DATE_FORMAT',exports[a88_0x2173('0x4')]['col'](a88_0x2173('0x32')),a88_0x2173('0x42')),a88_0x2173('0x43')],[exports[a88_0x2173('0x4')]['fn'](a88_0x2173('0x37'),exports[a88_0x2173('0x4')]['col'](a88_0x2173('0x39'))),a88_0x2173('0x3a')]],'where':{'countingDate':{[exports[a88_0x2173('0x4')]['Op']['gte']]:_0x462ad8,[exports[a88_0x2173('0x4')]['Op']['lt']]:_0x16e11d},'amount':_0x234afe[a88_0x2173('0x3c')][a88_0x2173('0x3d')]=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports[a88_0x2173('0x4')]['Op']['lt']]:0x0}},'group':[exports[a88_0x2173('0x4')]['fn']('HOUR',exports[a88_0x2173('0x4')]['col']('countingDate')),exports['sequelize']['fn'](a88_0x2173('0x44'),exports['sequelize']['col']('countingDate')),exports['sequelize']['fn'](a88_0x2173('0x45'),exports[a88_0x2173('0x4')][a88_0x2173('0x38')]('countingDate')),exports['sequelize']['fn'](a88_0x2173('0x46'),exports[a88_0x2173('0x4')]['col'](a88_0x2173('0x32')))],'order':[['countingDate','ASC']]})['then'](_0x3ade33=>{_0x93c65c[a88_0x2173('0x14')]({'data':_0x3ade33});});};exports['getFacebook']=(_0x5883df,_0x6651f1,_0x1850ee)=>{const _0x4fe823=_0x5883df[a88_0x2173('0x47')]['tokens'][a88_0x2173('0x48')](_0x4fe823=>_0x4fe823[a88_0x2173('0x49')]===a88_0x2173('0x4a'));fbgraph_1[a88_0x2173('0xa')][a88_0x2173('0x4b')](_0x4fe823[a88_0x2173('0x4c')]);fbgraph_1[a88_0x2173('0xa')][a88_0x2173('0x1e')](_0x5883df[a88_0x2173('0x47')][a88_0x2173('0x4a')]+a88_0x2173('0x4d'),(_0x2186db,_0x20ea6b)=>{if(_0x2186db){return _0x1850ee(_0x2186db);}_0x6651f1[a88_0x2173('0x6')]('api/facebook',{'title':a88_0x2173('0x4e'),'profile':_0x20ea6b});});};