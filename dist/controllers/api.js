var a88_0x1c74=['findAll','sum','col','gte','params','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','month','DATE_FORMAT','%Y-%m-%d\x20%H:00','countingDateShort','amount','total','direction','DAY','MONTH','YEAR','getFacebook','user','facebook','setAccessToken','accessToken','render','Facebook\x20API','__importDefault','ftp','sequelize','setSequelize','API\x20Examples','syncFtp','log','connecting','default','ready','connected','list','colombia','Downloading:\x20','name','endsWith','json','models','reportFiles','findOrCreate','spread','push','ipd','findOne','then','fileName','get','colombia/','end','.txt','pipe','createWriteStream','status','save','Downloaded:\x20','connect','ftp.vivotek.com','processFtp','media/','readFile','utf8','parse','CountingInfo','Out','EndTime','passes','create','getPassCounting','countingDate','ASC','getPassCountingByDay','query','startDate','endDate'];(function(_0x113fc9,_0x41479f){var _0x477920=function(_0x40f04d){while(--_0x40f04d){_0x113fc9['push'](_0x113fc9['shift']());}};_0x477920(++_0x41479f);}(a88_0x1c74,0x106));var a88_0x3cc4=function(_0x3d62ca,_0x4082ca){_0x3d62ca=_0x3d62ca-0x0;var _0x40b18e=a88_0x1c74[_0x3d62ca];return _0x40b18e;};'use strict';var __importDefault=this&&this[a88_0x3cc4('0x0')]||function(_0x221c05){return _0x221c05&&_0x221c05['__esModule']?_0x221c05:{'default':_0x221c05};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const fbgraph_1=__importDefault(require('fbgraph'));const ftp_1=__importDefault(require(a88_0x3cc4('0x1')));const fs_1=__importDefault(require('fs'));function setSequelize(_0x513826){exports[a88_0x3cc4('0x2')]=_0x513826;}exports[a88_0x3cc4('0x3')]=setSequelize;exports['getApi']=(_0xa29c50,_0x257f4e)=>{_0x257f4e['render']('api/index',{'title':a88_0x3cc4('0x4')});};exports[a88_0x3cc4('0x5')]=(_0x2262ee,_0x1c3319)=>{console[a88_0x3cc4('0x6')](a88_0x3cc4('0x7'));const _0x291227=[];const _0x5d33d3=new ftp_1[(a88_0x3cc4('0x8'))]();_0x5d33d3['on'](a88_0x3cc4('0x9'),function(){console['log'](a88_0x3cc4('0xa'));_0x5d33d3[a88_0x3cc4('0xb')](a88_0x3cc4('0xc'),![],function(_0x2599e5,_0x4d4ab4){if(_0x2599e5){}else{for(const _0x50cfd9 of _0x4d4ab4){console[a88_0x3cc4('0x6')](a88_0x3cc4('0xd')+_0x50cfd9['name']);if(_0x50cfd9[a88_0x3cc4('0xe')][a88_0x3cc4('0xf')](a88_0x3cc4('0x10'))){exports[a88_0x3cc4('0x2')][a88_0x3cc4('0x11')][a88_0x3cc4('0x12')][a88_0x3cc4('0x13')]({'where':{'fileName':_0x50cfd9[a88_0x3cc4('0xe')]}})[a88_0x3cc4('0x14')]((_0x2fd6a0,_0x36cbfe)=>{if(_0x36cbfe){console[a88_0x3cc4('0x6')](_0x50cfd9[a88_0x3cc4('0xe')]);_0x291227[a88_0x3cc4('0x15')](_0x2fd6a0);}});}}}_0x1c3319[a88_0x3cc4('0x10')]({'data':_0x291227});});});_0x5d33d3['on']('error',function(_0x363873){_0x1c3319['json']({'message':_0x363873});});_0x5d33d3['connect']({'host':'ftp.vivotek.com','port':0x15,'user':'ipd','password':a88_0x3cc4('0x16')});};exports['downloadFtp']=(_0x202c2b,_0x1c6854)=>{exports[a88_0x3cc4('0x2')][a88_0x3cc4('0x11')][a88_0x3cc4('0x12')][a88_0x3cc4('0x17')]({'where':{'status':null}})[a88_0x3cc4('0x18')](_0x2bfda4=>{if(_0x2bfda4){const _0x8f5398=new ftp_1[(a88_0x3cc4('0x8'))]();_0x8f5398['on'](a88_0x3cc4('0x9'),function(){console[a88_0x3cc4('0x6')]('connected:'+_0x2bfda4[a88_0x3cc4('0x19')]);_0x8f5398[a88_0x3cc4('0x1a')](a88_0x3cc4('0x1b')+_0x2bfda4['fileName'],function(_0x337e90,_0x5971c3){_0x8f5398[a88_0x3cc4('0x1c')]();if(_0x337e90){}else{const _0x51b27e='media/'+_0x2bfda4[a88_0x3cc4('0x19')]+a88_0x3cc4('0x1d');_0x5971c3[a88_0x3cc4('0x1e')](fs_1[a88_0x3cc4('0x8')][a88_0x3cc4('0x1f')](_0x51b27e));_0x2bfda4[a88_0x3cc4('0x20')]=0x1;_0x2bfda4[a88_0x3cc4('0x21')]();console[a88_0x3cc4('0x6')](a88_0x3cc4('0x22')+_0x2bfda4[a88_0x3cc4('0x19')]);}});});_0x8f5398['on']('error',function(_0x4edeac){_0x1c6854[a88_0x3cc4('0x10')]({'message':_0x4edeac});});_0x8f5398[a88_0x3cc4('0x23')]({'host':a88_0x3cc4('0x24'),'port':0x15,'user':'ipd','password':'ipd'});_0x1c6854[a88_0x3cc4('0x10')]({'data':_0x2bfda4[a88_0x3cc4('0x19')]});}else{_0x1c6854[a88_0x3cc4('0x10')]({'data':[]});}});};exports[a88_0x3cc4('0x25')]=(_0x5b34bd,_0x58cbe5)=>{exports[a88_0x3cc4('0x2')]['models']['reportFiles'][a88_0x3cc4('0x17')]({'where':{'status':0x1}})[a88_0x3cc4('0x18')](_0x52b640=>{if(_0x52b640){const _0x45cf70=a88_0x3cc4('0x26')+_0x52b640[a88_0x3cc4('0x19')]+a88_0x3cc4('0x1d');fs_1[a88_0x3cc4('0x8')][a88_0x3cc4('0x27')](_0x45cf70,a88_0x3cc4('0x28'),function(_0x57bfdc,_0x790e65){if(_0x57bfdc){_0x52b640[a88_0x3cc4('0x20')]=null;}else{try{const _0x5b07ef=JSON[a88_0x3cc4('0x29')](_0x790e65);for(const _0x37837f of _0x5b07ef['Data'][0x0][a88_0x3cc4('0x2a')]){const _0x1ce776=_0x37837f['In'];const _0x1cf2d6=_0x37837f[a88_0x3cc4('0x2b')];const _0x487532=Date[a88_0x3cc4('0x29')](_0x37837f[a88_0x3cc4('0x2c')]);if(_0x1ce776>0x0){exports[a88_0x3cc4('0x2')][a88_0x3cc4('0x11')][a88_0x3cc4('0x2d')][a88_0x3cc4('0x2e')]({'reportFileId':_0x52b640['id'],'amount':_0x1ce776,'countingDate':_0x487532});}if(_0x1cf2d6>0x0){exports[a88_0x3cc4('0x2')]['models'][a88_0x3cc4('0x2d')][a88_0x3cc4('0x2e')]({'reportFileId':_0x52b640['id'],'amount':_0x1cf2d6*-0x1,'countingDate':_0x487532});}}_0x52b640[a88_0x3cc4('0x20')]=0x2;}catch(_0x5cac05){_0x52b640['status']=null;}}_0x52b640[a88_0x3cc4('0x21')]();});_0x58cbe5[a88_0x3cc4('0x10')]({'data':_0x52b640[a88_0x3cc4('0x19')]});}else{_0x58cbe5[a88_0x3cc4('0x10')]({'data':[]});}});};exports[a88_0x3cc4('0x2f')]=(_0x124ca7,_0x28bedf)=>{exports[a88_0x3cc4('0x2')][a88_0x3cc4('0x11')][a88_0x3cc4('0x2d')]['findAll']({'where':{'amount':{[exports[a88_0x3cc4('0x2')]['Op']['gt']]:0x0}},'order':[[a88_0x3cc4('0x30'),a88_0x3cc4('0x31')]]})['then'](_0x2a6044=>{_0x28bedf[a88_0x3cc4('0x10')]({'data':_0x2a6044});});};exports[a88_0x3cc4('0x32')]=(_0x2d3c38,_0x3cbb1e)=>{const _0x21a0cf=_0x2d3c38[a88_0x3cc4('0x33')]['month'];const _0x4e7284=_0x2d3c38[a88_0x3cc4('0x33')][a88_0x3cc4('0x34')];const _0x39689c=_0x2d3c38[a88_0x3cc4('0x33')][a88_0x3cc4('0x35')];exports['sequelize'][a88_0x3cc4('0x11')]['passes'][a88_0x3cc4('0x36')]({'attributes':[a88_0x3cc4('0x30'),[exports[a88_0x3cc4('0x2')]['fn'](a88_0x3cc4('0x37'),exports[a88_0x3cc4('0x2')][a88_0x3cc4('0x38')]('amount')),'total']],'where':{'countingDate':{[exports[a88_0x3cc4('0x2')]['Op'][a88_0x3cc4('0x39')]]:_0x4e7284,[exports[a88_0x3cc4('0x2')]['Op']['lt']]:_0x39689c},'amount':_0x2d3c38[a88_0x3cc4('0x3a')]['direction']=='in'?{[exports[a88_0x3cc4('0x2')]['Op']['gt']]:0x0}:{[exports[a88_0x3cc4('0x2')]['Op']['lt']]:0x0}},'group':[exports[a88_0x3cc4('0x2')][a88_0x3cc4('0x3b')](a88_0x3cc4('0x3c'))],'order':[[a88_0x3cc4('0x30'),'ASC']]})[a88_0x3cc4('0x18')](_0x37f0b4=>{_0x3cbb1e['json']({'data':_0x37f0b4});});};exports[a88_0x3cc4('0x3d')]=(_0x812193,_0x334c2a)=>{const _0x3e6f8b=_0x812193[a88_0x3cc4('0x33')][a88_0x3cc4('0x3e')];const _0x17668d=_0x812193[a88_0x3cc4('0x33')][a88_0x3cc4('0x34')];const _0x2e72ba=_0x812193[a88_0x3cc4('0x33')]['endDate'];exports[a88_0x3cc4('0x2')][a88_0x3cc4('0x11')][a88_0x3cc4('0x2d')][a88_0x3cc4('0x36')]({'attributes':[a88_0x3cc4('0x30'),[exports[a88_0x3cc4('0x2')]['fn'](a88_0x3cc4('0x3f'),exports[a88_0x3cc4('0x2')][a88_0x3cc4('0x38')](a88_0x3cc4('0x30')),a88_0x3cc4('0x40')),a88_0x3cc4('0x41')],[exports[a88_0x3cc4('0x2')]['fn']('sum',exports[a88_0x3cc4('0x2')]['col'](a88_0x3cc4('0x42'))),a88_0x3cc4('0x43')]],'where':{'countingDate':{[exports['sequelize']['Op'][a88_0x3cc4('0x39')]]:_0x17668d,[exports['sequelize']['Op']['lt']]:_0x2e72ba},'amount':_0x812193['params'][a88_0x3cc4('0x44')]=='in'?{[exports[a88_0x3cc4('0x2')]['Op']['gt']]:0x0}:{[exports[a88_0x3cc4('0x2')]['Op']['lt']]:0x0}},'group':[exports[a88_0x3cc4('0x2')]['fn']('HOUR',exports[a88_0x3cc4('0x2')][a88_0x3cc4('0x38')](a88_0x3cc4('0x30'))),exports[a88_0x3cc4('0x2')]['fn'](a88_0x3cc4('0x45'),exports[a88_0x3cc4('0x2')]['col'](a88_0x3cc4('0x30'))),exports[a88_0x3cc4('0x2')]['fn'](a88_0x3cc4('0x46'),exports[a88_0x3cc4('0x2')][a88_0x3cc4('0x38')](a88_0x3cc4('0x30'))),exports[a88_0x3cc4('0x2')]['fn'](a88_0x3cc4('0x47'),exports['sequelize'][a88_0x3cc4('0x38')](a88_0x3cc4('0x30')))],'order':[['countingDate',a88_0x3cc4('0x31')]]})[a88_0x3cc4('0x18')](_0x1c3f57=>{_0x334c2a[a88_0x3cc4('0x10')]({'data':_0x1c3f57});});};exports[a88_0x3cc4('0x48')]=(_0x4045ad,_0x5a8180,_0x3d9c8d)=>{const _0xe8a251=_0x4045ad[a88_0x3cc4('0x49')]['tokens']['find'](_0xe8a251=>_0xe8a251['kind']===a88_0x3cc4('0x4a'));fbgraph_1[a88_0x3cc4('0x8')][a88_0x3cc4('0x4b')](_0xe8a251[a88_0x3cc4('0x4c')]);fbgraph_1[a88_0x3cc4('0x8')][a88_0x3cc4('0x1a')](_0x4045ad['user']['facebook']+'?fields=id,name,email,first_name,last_name,gender,link,locale,timezone',(_0x5b4136,_0x15085b)=>{if(_0x5b4136){return _0x3d9c8d(_0x5b4136);}_0x5a8180[a88_0x3cc4('0x4d')]('api/facebook',{'title':a88_0x3cc4('0x4e'),'profile':_0x15085b});});};