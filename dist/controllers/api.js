var a180_0x4b59=['api/index','syncFtp','log','connecting','default','ready','connected','list','colombia','Downloading:\x20','name','endsWith','reportFiles','spread','push','json','error','ftp.vivotek.com','ipd','models','then','connected:','fileName','get','colombia/','end','media/','createWriteStream','status','save','Downloaded:\x20','connect','findOne','readFile','parse','Data','CountingInfo','EndTime','passes','create','findAll','countingDate','getPassCountingByDay','month','startDate','query','endDate','col','amount','total','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','ASC','getPassCountingByHour','%Y-%m-%d\x20%H:00','gte','params','direction','HOUR','DAY','MONTH','YEAR','getFacebook','user','find','facebook','accessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','__importDefault','__esModule','defineProperty','fbgraph','ftp','sequelize','setSequelize','getApi','render'];(function(_0x386158,_0x5be3f6){var _0x2cdf99=function(_0x99b0a9){while(--_0x99b0a9){_0x386158['push'](_0x386158['shift']());}};_0x2cdf99(++_0x5be3f6);}(a180_0x4b59,0xde));var a180_0x42d1=function(_0x2cefdc,_0x1ea2e0){_0x2cefdc=_0x2cefdc-0x0;var _0x53dd58=a180_0x4b59[_0x2cefdc];return _0x53dd58;};'use strict';var __importDefault=this&&this[a180_0x42d1('0x0')]||function(_0x84cd0e){return _0x84cd0e&&_0x84cd0e[a180_0x42d1('0x1')]?_0x84cd0e:{'default':_0x84cd0e};};Object[a180_0x42d1('0x2')](exports,'__esModule',{'value':!![]});const fbgraph_1=__importDefault(require(a180_0x42d1('0x3')));const ftp_1=__importDefault(require(a180_0x42d1('0x4')));const fs_1=__importDefault(require('fs'));function setSequelize(_0xf073b0){exports[a180_0x42d1('0x5')]=_0xf073b0;}exports[a180_0x42d1('0x6')]=setSequelize;exports[a180_0x42d1('0x7')]=(_0x1e56c8,_0x318e08)=>{_0x318e08[a180_0x42d1('0x8')](a180_0x42d1('0x9'),{'title':'API\x20Examples'});};exports[a180_0x42d1('0xa')]=(_0x2e968c,_0x30f9fe)=>{console[a180_0x42d1('0xb')](a180_0x42d1('0xc'));const _0x45e0db=[];const _0x4db3c7=new ftp_1[(a180_0x42d1('0xd'))]();_0x4db3c7['on'](a180_0x42d1('0xe'),function(){console[a180_0x42d1('0xb')](a180_0x42d1('0xf'));_0x4db3c7[a180_0x42d1('0x10')](a180_0x42d1('0x11'),![],function(_0x2349be,_0x1911d0){if(_0x2349be){}else{for(const _0x3292ef of _0x1911d0){console[a180_0x42d1('0xb')](a180_0x42d1('0x12')+_0x3292ef[a180_0x42d1('0x13')]);if(_0x3292ef[a180_0x42d1('0x13')][a180_0x42d1('0x14')]('json')){exports[a180_0x42d1('0x5')]['models'][a180_0x42d1('0x15')]['findOrCreate']({'where':{'fileName':_0x3292ef[a180_0x42d1('0x13')]}})[a180_0x42d1('0x16')]((_0x41df20,_0x4e74ca)=>{if(_0x4e74ca){console[a180_0x42d1('0xb')](_0x3292ef[a180_0x42d1('0x13')]);_0x45e0db[a180_0x42d1('0x17')](_0x41df20);}});}}}_0x30f9fe[a180_0x42d1('0x18')]({'data':_0x45e0db});});});_0x4db3c7['on'](a180_0x42d1('0x19'),function(_0x4d2b36){_0x30f9fe[a180_0x42d1('0x18')]({'message':_0x4d2b36});});_0x4db3c7['connect']({'host':a180_0x42d1('0x1a'),'port':0x15,'user':a180_0x42d1('0x1b'),'password':a180_0x42d1('0x1b')});};exports['downloadFtp']=(_0x335710,_0x3df706)=>{exports[a180_0x42d1('0x5')][a180_0x42d1('0x1c')][a180_0x42d1('0x15')]['findOne']({'where':{'status':null}})[a180_0x42d1('0x1d')](_0x728b46=>{if(_0x728b46){const _0x56d8b2=new ftp_1['default']();_0x56d8b2['on'](a180_0x42d1('0xe'),function(){console['log'](a180_0x42d1('0x1e')+_0x728b46[a180_0x42d1('0x1f')]);_0x56d8b2[a180_0x42d1('0x20')](a180_0x42d1('0x21')+_0x728b46[a180_0x42d1('0x1f')],function(_0x18fb5d,_0xba9a8c){_0x56d8b2[a180_0x42d1('0x22')]();if(_0x18fb5d){}else{const _0x55d5a3=a180_0x42d1('0x23')+_0x728b46[a180_0x42d1('0x1f')]+'.txt';_0xba9a8c['pipe'](fs_1[a180_0x42d1('0xd')][a180_0x42d1('0x24')](_0x55d5a3));_0x728b46[a180_0x42d1('0x25')]=0x1;_0x728b46[a180_0x42d1('0x26')]();console['log'](a180_0x42d1('0x27')+_0x728b46[a180_0x42d1('0x1f')]);}});});_0x56d8b2['on'](a180_0x42d1('0x19'),function(_0x533283){_0x3df706[a180_0x42d1('0x18')]({'message':_0x533283});});_0x56d8b2[a180_0x42d1('0x28')]({'host':a180_0x42d1('0x1a'),'port':0x15,'user':a180_0x42d1('0x1b'),'password':a180_0x42d1('0x1b')});_0x3df706[a180_0x42d1('0x18')]({'data':_0x728b46[a180_0x42d1('0x1f')]});}else{_0x3df706[a180_0x42d1('0x18')]({'data':[]});}});};exports['processFtp']=(_0xb0d155,_0x522bbf)=>{exports[a180_0x42d1('0x5')][a180_0x42d1('0x1c')][a180_0x42d1('0x15')][a180_0x42d1('0x29')]({'where':{'status':0x1}})[a180_0x42d1('0x1d')](_0x5954fc=>{if(_0x5954fc){const _0x4b0548=a180_0x42d1('0x23')+_0x5954fc['fileName']+'.txt';fs_1[a180_0x42d1('0xd')][a180_0x42d1('0x2a')](_0x4b0548,'utf8',function(_0x1e9c39,_0x420c08){if(_0x1e9c39){_0x5954fc[a180_0x42d1('0x25')]=null;}else{try{const _0xf5fbdb=JSON[a180_0x42d1('0x2b')](_0x420c08);for(const _0x2bea3e of _0xf5fbdb[a180_0x42d1('0x2c')][0x0][a180_0x42d1('0x2d')]){const _0x3d28d5=_0x2bea3e['In'];const _0x20b78a=_0x2bea3e['Out'];const _0x277514=Date[a180_0x42d1('0x2b')](_0x2bea3e[a180_0x42d1('0x2e')]);if(_0x3d28d5>0x0){exports[a180_0x42d1('0x5')][a180_0x42d1('0x1c')][a180_0x42d1('0x2f')][a180_0x42d1('0x30')]({'reportFileId':_0x5954fc['id'],'amount':_0x3d28d5,'countingDate':_0x277514});}if(_0x20b78a>0x0){exports[a180_0x42d1('0x5')]['models'][a180_0x42d1('0x2f')][a180_0x42d1('0x30')]({'reportFileId':_0x5954fc['id'],'amount':_0x20b78a*-0x1,'countingDate':_0x277514});}}_0x5954fc[a180_0x42d1('0x25')]=0x2;}catch(_0x27c5fd){_0x5954fc['status']=null;}}_0x5954fc[a180_0x42d1('0x26')]();});_0x522bbf['json']({'data':_0x5954fc[a180_0x42d1('0x1f')]});}else{_0x522bbf[a180_0x42d1('0x18')]({'data':[]});}});};exports['getPassCounting']=(_0x2f1788,_0x2eb6be)=>{exports[a180_0x42d1('0x5')]['models'][a180_0x42d1('0x2f')][a180_0x42d1('0x31')]({'where':{'amount':{[exports[a180_0x42d1('0x5')]['Op']['gt']]:0x0}},'order':[[a180_0x42d1('0x32'),'ASC']]})[a180_0x42d1('0x1d')](_0x219468=>{_0x2eb6be[a180_0x42d1('0x18')]({'data':_0x219468});});};exports[a180_0x42d1('0x33')]=(_0x47b2f3,_0x14f9e3)=>{const _0x337ab6=_0x47b2f3['query'][a180_0x42d1('0x34')];const _0x4d21bf=_0x47b2f3['query'][a180_0x42d1('0x35')];const _0x3f98d0=_0x47b2f3[a180_0x42d1('0x36')][a180_0x42d1('0x37')];exports[a180_0x42d1('0x5')][a180_0x42d1('0x1c')][a180_0x42d1('0x2f')]['findAll']({'attributes':[a180_0x42d1('0x32'),[exports[a180_0x42d1('0x5')]['fn']('sum',exports[a180_0x42d1('0x5')][a180_0x42d1('0x38')](a180_0x42d1('0x39'))),a180_0x42d1('0x3a')]],'where':{'countingDate':{[exports['sequelize']['Op']['gte']]:_0x4d21bf,[exports['sequelize']['Op']['lt']]:_0x3f98d0},'amount':_0x47b2f3['params']['direction']=='in'?{[exports[a180_0x42d1('0x5')]['Op']['gt']]:0x0}:{[exports[a180_0x42d1('0x5')]['Op']['lt']]:0x0}},'group':[exports[a180_0x42d1('0x5')][a180_0x42d1('0x3b')](a180_0x42d1('0x3c'))],'order':[[a180_0x42d1('0x32'),a180_0x42d1('0x3d')]]})[a180_0x42d1('0x1d')](_0x3498db=>{_0x14f9e3['json']({'data':_0x3498db});});};exports[a180_0x42d1('0x3e')]=(_0x2b13dc,_0x2eba31)=>{const _0x54ed0e=_0x2b13dc[a180_0x42d1('0x36')][a180_0x42d1('0x34')];const _0x9e2abe=_0x2b13dc['query']['startDate'];const _0x1b944f=_0x2b13dc[a180_0x42d1('0x36')][a180_0x42d1('0x37')];exports[a180_0x42d1('0x5')][a180_0x42d1('0x1c')][a180_0x42d1('0x2f')][a180_0x42d1('0x31')]({'attributes':['countingDate',[exports['sequelize']['fn']('DATE_FORMAT',exports['sequelize']['col']('countingDate'),a180_0x42d1('0x3f')),'countingDateShort'],[exports[a180_0x42d1('0x5')]['fn']('sum',exports[a180_0x42d1('0x5')][a180_0x42d1('0x38')](a180_0x42d1('0x39'))),a180_0x42d1('0x3a')]],'where':{'countingDate':{[exports['sequelize']['Op'][a180_0x42d1('0x40')]]:_0x9e2abe,[exports[a180_0x42d1('0x5')]['Op']['lt']]:_0x1b944f},'amount':_0x2b13dc[a180_0x42d1('0x41')][a180_0x42d1('0x42')]=='in'?{[exports[a180_0x42d1('0x5')]['Op']['gt']]:0x0}:{[exports[a180_0x42d1('0x5')]['Op']['lt']]:0x0}},'group':[exports['sequelize']['fn'](a180_0x42d1('0x43'),exports['sequelize'][a180_0x42d1('0x38')](a180_0x42d1('0x32'))),exports[a180_0x42d1('0x5')]['fn'](a180_0x42d1('0x44'),exports[a180_0x42d1('0x5')][a180_0x42d1('0x38')](a180_0x42d1('0x32'))),exports['sequelize']['fn'](a180_0x42d1('0x45'),exports[a180_0x42d1('0x5')][a180_0x42d1('0x38')](a180_0x42d1('0x32'))),exports[a180_0x42d1('0x5')]['fn'](a180_0x42d1('0x46'),exports['sequelize'][a180_0x42d1('0x38')]('countingDate'))],'order':[[a180_0x42d1('0x32'),a180_0x42d1('0x3d')]]})['then'](_0xe1b0ce=>{_0x2eba31[a180_0x42d1('0x18')]({'data':_0xe1b0ce});});};exports[a180_0x42d1('0x47')]=(_0x21bb13,_0x2c959b,_0x17a736)=>{const _0xd309e8=_0x21bb13[a180_0x42d1('0x48')]['tokens'][a180_0x42d1('0x49')](_0xd309e8=>_0xd309e8['kind']===a180_0x42d1('0x4a'));fbgraph_1[a180_0x42d1('0xd')]['setAccessToken'](_0xd309e8[a180_0x42d1('0x4b')]);fbgraph_1[a180_0x42d1('0xd')][a180_0x42d1('0x20')](_0x21bb13['user']['facebook']+a180_0x42d1('0x4c'),(_0x21b5a1,_0x27bbf8)=>{if(_0x21b5a1){return _0x17a736(_0x21b5a1);}_0x2c959b[a180_0x42d1('0x8')]('api/facebook',{'title':'Facebook\x20API','profile':_0x27bbf8});});};