var a198_0x49aa=['connect','processFtp','utf8','parse','CountingInfo','Out','EndTime','passes','create','findAll','countingDate','ASC','query','month','sum','amount','total','gte','direction','literal','getPassCountingByHour','endDate','DATE_FORMAT','%Y-%m-%d\x20%H:00','col','params','DAY','MONTH','YEAR','getFacebook','tokens','kind','facebook','accessToken','render','__importDefault','__esModule','defineProperty','fbgraph','setSequelize','getApi','API\x20Examples','syncFtp','log','default','ready','connected','list','colombia','Downloading:\x20','name','endsWith','json','models','reportFiles','findOrCreate','spread','push','error','ftp.vivotek.com','ipd','downloadFtp','sequelize','findOne','then','connected:','fileName','get','end','.txt','pipe','status','save','Downloaded:\x20'];(function(_0x184ebf,_0x440da2){var _0x465aaf=function(_0x517c67){while(--_0x517c67){_0x184ebf['push'](_0x184ebf['shift']());}};_0x465aaf(++_0x440da2);}(a198_0x49aa,0xb7));var a198_0x4290=function(_0xf42b48,_0x263ebf){_0xf42b48=_0xf42b48-0x0;var _0x93910e=a198_0x49aa[_0xf42b48];return _0x93910e;};'use strict';var __importDefault=this&&this[a198_0x4290('0x0')]||function(_0x563217){return _0x563217&&_0x563217[a198_0x4290('0x1')]?_0x563217:{'default':_0x563217};};Object[a198_0x4290('0x2')](exports,'__esModule',{'value':!![]});const fbgraph_1=__importDefault(require(a198_0x4290('0x3')));const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));function setSequelize(_0x2ed721){exports['sequelize']=_0x2ed721;}exports[a198_0x4290('0x4')]=setSequelize;exports[a198_0x4290('0x5')]=(_0x3ee9c1,_0x273b3d)=>{_0x273b3d['render']('api/index',{'title':a198_0x4290('0x6')});};exports[a198_0x4290('0x7')]=(_0x3be528,_0x28a7b8)=>{console[a198_0x4290('0x8')]('connecting');const _0x5d2654=[];const _0x46d931=new ftp_1[(a198_0x4290('0x9'))]();_0x46d931['on'](a198_0x4290('0xa'),function(){console['log'](a198_0x4290('0xb'));_0x46d931[a198_0x4290('0xc')](a198_0x4290('0xd'),![],function(_0x43e40b,_0x1c93d4){if(_0x43e40b){}else{for(const _0x3b6324 of _0x1c93d4){console[a198_0x4290('0x8')](a198_0x4290('0xe')+_0x3b6324[a198_0x4290('0xf')]);if(_0x3b6324[a198_0x4290('0xf')][a198_0x4290('0x10')](a198_0x4290('0x11'))){exports['sequelize'][a198_0x4290('0x12')][a198_0x4290('0x13')][a198_0x4290('0x14')]({'where':{'fileName':_0x3b6324[a198_0x4290('0xf')]}})[a198_0x4290('0x15')]((_0x4e632d,_0x27dfa0)=>{if(_0x27dfa0){console[a198_0x4290('0x8')](_0x3b6324[a198_0x4290('0xf')]);_0x5d2654[a198_0x4290('0x16')](_0x4e632d);}});}}}_0x28a7b8[a198_0x4290('0x11')]({'data':_0x5d2654});});});_0x46d931['on'](a198_0x4290('0x17'),function(_0x18de4c){_0x28a7b8[a198_0x4290('0x11')]({'message':_0x18de4c});});_0x46d931['connect']({'host':a198_0x4290('0x18'),'port':0x15,'user':a198_0x4290('0x19'),'password':a198_0x4290('0x19')});};exports[a198_0x4290('0x1a')]=(_0x50e9c1,_0x5228db)=>{exports[a198_0x4290('0x1b')][a198_0x4290('0x12')][a198_0x4290('0x13')][a198_0x4290('0x1c')]({'where':{'status':null}})[a198_0x4290('0x1d')](_0x14c5f6=>{if(_0x14c5f6){const _0x40d61c=new ftp_1[(a198_0x4290('0x9'))]();_0x40d61c['on'](a198_0x4290('0xa'),function(){console[a198_0x4290('0x8')](a198_0x4290('0x1e')+_0x14c5f6[a198_0x4290('0x1f')]);_0x40d61c[a198_0x4290('0x20')]('colombia/'+_0x14c5f6[a198_0x4290('0x1f')],function(_0x5f246c,_0x4fd9c7){_0x40d61c[a198_0x4290('0x21')]();if(_0x5f246c){}else{const _0x5000cb='media/'+_0x14c5f6[a198_0x4290('0x1f')]+a198_0x4290('0x22');_0x4fd9c7[a198_0x4290('0x23')](fs_1[a198_0x4290('0x9')]['createWriteStream'](_0x5000cb));_0x14c5f6[a198_0x4290('0x24')]=0x1;_0x14c5f6[a198_0x4290('0x25')]();console['log'](a198_0x4290('0x26')+_0x14c5f6[a198_0x4290('0x1f')]);}});});_0x40d61c['on'](a198_0x4290('0x17'),function(_0x1546cb){_0x5228db[a198_0x4290('0x11')]({'message':_0x1546cb});});_0x40d61c[a198_0x4290('0x27')]({'host':a198_0x4290('0x18'),'port':0x15,'user':a198_0x4290('0x19'),'password':a198_0x4290('0x19')});_0x5228db[a198_0x4290('0x11')]({'data':_0x14c5f6[a198_0x4290('0x1f')]});}else{_0x5228db[a198_0x4290('0x11')]({'data':[]});}});};exports[a198_0x4290('0x28')]=(_0x3875ae,_0x7f9fe3)=>{exports[a198_0x4290('0x1b')]['models'][a198_0x4290('0x13')][a198_0x4290('0x1c')]({'where':{'status':0x1}})[a198_0x4290('0x1d')](_0x492829=>{if(_0x492829){const _0x399000='media/'+_0x492829[a198_0x4290('0x1f')]+a198_0x4290('0x22');fs_1[a198_0x4290('0x9')]['readFile'](_0x399000,a198_0x4290('0x29'),function(_0x2a5f06,_0x230acf){if(_0x2a5f06){_0x492829['status']=null;}else{try{const _0x17359f=JSON[a198_0x4290('0x2a')](_0x230acf);for(const _0xaea75e of _0x17359f['Data'][0x0][a198_0x4290('0x2b')]){const _0x149a28=_0xaea75e['In'];const _0x2eae93=_0xaea75e[a198_0x4290('0x2c')];const _0x343ea0=Date['parse'](_0xaea75e[a198_0x4290('0x2d')]);if(_0x149a28>0x0){exports['sequelize'][a198_0x4290('0x12')][a198_0x4290('0x2e')]['create']({'reportFileId':_0x492829['id'],'amount':_0x149a28,'countingDate':_0x343ea0});}if(_0x2eae93>0x0){exports[a198_0x4290('0x1b')]['models']['passes'][a198_0x4290('0x2f')]({'reportFileId':_0x492829['id'],'amount':_0x2eae93*-0x1,'countingDate':_0x343ea0});}}_0x492829[a198_0x4290('0x24')]=0x2;}catch(_0x37751a){_0x492829[a198_0x4290('0x24')]=null;}}_0x492829[a198_0x4290('0x25')]();});_0x7f9fe3[a198_0x4290('0x11')]({'data':_0x492829[a198_0x4290('0x1f')]});}else{_0x7f9fe3[a198_0x4290('0x11')]({'data':[]});}});};exports['getPassCounting']=(_0x32fd77,_0x25c44b)=>{exports[a198_0x4290('0x1b')]['models']['passes'][a198_0x4290('0x30')]({'where':{'amount':{[exports[a198_0x4290('0x1b')]['Op']['gt']]:0x0}},'order':[[a198_0x4290('0x31'),a198_0x4290('0x32')]]})['then'](_0xc43f20=>{_0x25c44b[a198_0x4290('0x11')]({'data':_0xc43f20});});};exports['getPassCountingByDay']=(_0x2b0d0c,_0x2c53c2)=>{const _0x1e21a5=_0x2b0d0c[a198_0x4290('0x33')][a198_0x4290('0x34')];const _0x3994da=_0x2b0d0c[a198_0x4290('0x33')]['startDate'];const _0x1096fc=_0x2b0d0c[a198_0x4290('0x33')]['endDate'];exports[a198_0x4290('0x1b')][a198_0x4290('0x12')]['passes'][a198_0x4290('0x30')]({'attributes':['countingDate',[exports[a198_0x4290('0x1b')]['fn'](a198_0x4290('0x35'),exports[a198_0x4290('0x1b')]['col'](a198_0x4290('0x36'))),a198_0x4290('0x37')]],'where':{'countingDate':{[exports[a198_0x4290('0x1b')]['Op'][a198_0x4290('0x38')]]:_0x3994da,[exports['sequelize']['Op']['lt']]:_0x1096fc},'amount':_0x2b0d0c['params'][a198_0x4290('0x39')]=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports[a198_0x4290('0x1b')]['Op']['lt']]:0x0}},'group':[exports['sequelize'][a198_0x4290('0x3a')]('YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))')],'order':[['countingDate',a198_0x4290('0x32')]]})[a198_0x4290('0x1d')](_0x1b34f0=>{_0x2c53c2[a198_0x4290('0x11')]({'data':_0x1b34f0});});};exports[a198_0x4290('0x3b')]=(_0x300cf6,_0x94d005)=>{const _0x260201=_0x300cf6[a198_0x4290('0x33')][a198_0x4290('0x34')];const _0x36ffaf=_0x300cf6['query']['startDate'];const _0x15cfa2=_0x300cf6[a198_0x4290('0x33')][a198_0x4290('0x3c')];exports['sequelize'][a198_0x4290('0x12')][a198_0x4290('0x2e')][a198_0x4290('0x30')]({'attributes':[a198_0x4290('0x31'),[exports[a198_0x4290('0x1b')]['fn'](a198_0x4290('0x3d'),exports[a198_0x4290('0x1b')]['col'](a198_0x4290('0x31')),a198_0x4290('0x3e')),'countingDateShort'],[exports['sequelize']['fn'](a198_0x4290('0x35'),exports[a198_0x4290('0x1b')][a198_0x4290('0x3f')](a198_0x4290('0x36'))),'total']],'where':{'countingDate':{[exports['sequelize']['Op'][a198_0x4290('0x38')]]:_0x36ffaf,[exports[a198_0x4290('0x1b')]['Op']['lt']]:_0x15cfa2},'amount':_0x300cf6[a198_0x4290('0x40')]['direction']=='in'?{[exports[a198_0x4290('0x1b')]['Op']['gt']]:0x0}:{[exports[a198_0x4290('0x1b')]['Op']['lt']]:0x0}},'group':[exports[a198_0x4290('0x1b')]['fn']('HOUR',exports[a198_0x4290('0x1b')][a198_0x4290('0x3f')](a198_0x4290('0x31'))),exports[a198_0x4290('0x1b')]['fn'](a198_0x4290('0x41'),exports[a198_0x4290('0x1b')][a198_0x4290('0x3f')](a198_0x4290('0x31'))),exports[a198_0x4290('0x1b')]['fn'](a198_0x4290('0x42'),exports[a198_0x4290('0x1b')][a198_0x4290('0x3f')](a198_0x4290('0x31'))),exports[a198_0x4290('0x1b')]['fn'](a198_0x4290('0x43'),exports['sequelize'][a198_0x4290('0x3f')](a198_0x4290('0x31')))],'order':[['countingDate',a198_0x4290('0x32')]]})['then'](_0x500e8d=>{_0x94d005[a198_0x4290('0x11')]({'data':_0x500e8d});});};exports[a198_0x4290('0x44')]=(_0x43eda8,_0x1d1309,_0x253c40)=>{const _0x58e679=_0x43eda8['user'][a198_0x4290('0x45')]['find'](_0x58e679=>_0x58e679[a198_0x4290('0x46')]===a198_0x4290('0x47'));fbgraph_1[a198_0x4290('0x9')]['setAccessToken'](_0x58e679[a198_0x4290('0x48')]);fbgraph_1[a198_0x4290('0x9')][a198_0x4290('0x20')](_0x43eda8['user']['facebook']+'?fields=id,name,email,first_name,last_name,gender,link,locale,timezone',(_0x526847,_0x15d466)=>{if(_0x526847){return _0x253c40(_0x526847);}_0x1d1309[a198_0x4290('0x49')]('api/facebook',{'title':'Facebook\x20API','profile':_0x15d466});});};