var a92_0x18e5=['findAll','countingDate','ASC','getPassCountingByDay','query','month','endDate','sum','amount','gte','params','direction','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','startDate','DATE_FORMAT','%Y-%m-%d\x20%H:00','countingDateShort','total','HOUR','col','DAY','MONTH','YEAR','getFacebook','user','tokens','find','facebook','accessToken','api/facebook','Facebook\x20API','__esModule','defineProperty','fbgraph','sequelize','setSequelize','render','api/index','syncFtp','log','connecting','default','ready','connected','list','colombia','Downloading:\x20','name','endsWith','models','reportFiles','findOrCreate','spread','error','json','connect','ftp.vivotek.com','ipd','downloadFtp','then','connected:','get','colombia/','fileName','end','media/','pipe','status','save','Downloaded:\x20','processFtp','findOne','utf8','parse','Data','Out','EndTime','create','passes','getPassCounting'];(function(_0x4c8e04,_0x1de736){var _0x21ce84=function(_0x2b4726){while(--_0x2b4726){_0x4c8e04['push'](_0x4c8e04['shift']());}};_0x21ce84(++_0x1de736);}(a92_0x18e5,0x164));var a92_0x231f=function(_0x583092,_0x5e99e1){_0x583092=_0x583092-0x0;var _0x19ca1b=a92_0x18e5[_0x583092];return _0x19ca1b;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x3f6206){return _0x3f6206&&_0x3f6206[a92_0x231f('0x0')]?_0x3f6206:{'default':_0x3f6206};};Object[a92_0x231f('0x1')](exports,a92_0x231f('0x0'),{'value':!![]});const fbgraph_1=__importDefault(require(a92_0x231f('0x2')));const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));function setSequelize(_0x8b4077){exports[a92_0x231f('0x3')]=_0x8b4077;}exports[a92_0x231f('0x4')]=setSequelize;exports['getApi']=(_0x25c53c,_0x128e6d)=>{_0x128e6d[a92_0x231f('0x5')](a92_0x231f('0x6'),{'title':'API\x20Examples'});};exports[a92_0x231f('0x7')]=(_0x232a92,_0x4fe71b)=>{console[a92_0x231f('0x8')](a92_0x231f('0x9'));const _0x12b447=[];const _0x535cd0=new ftp_1[(a92_0x231f('0xa'))]();_0x535cd0['on'](a92_0x231f('0xb'),function(){console['log'](a92_0x231f('0xc'));_0x535cd0[a92_0x231f('0xd')](a92_0x231f('0xe'),![],function(_0xe317f7,_0x2f9842){if(_0xe317f7){}else{for(const _0x484f96 of _0x2f9842){console[a92_0x231f('0x8')](a92_0x231f('0xf')+_0x484f96[a92_0x231f('0x10')]);if(_0x484f96['name'][a92_0x231f('0x11')]('json')){exports[a92_0x231f('0x3')][a92_0x231f('0x12')][a92_0x231f('0x13')][a92_0x231f('0x14')]({'where':{'fileName':_0x484f96[a92_0x231f('0x10')]}})[a92_0x231f('0x15')]((_0x466c8f,_0x4ebe07)=>{if(_0x4ebe07){console[a92_0x231f('0x8')](_0x484f96[a92_0x231f('0x10')]);_0x12b447['push'](_0x466c8f);}});}}}_0x4fe71b['json']({'data':_0x12b447});});});_0x535cd0['on'](a92_0x231f('0x16'),function(_0x3da82e){_0x4fe71b[a92_0x231f('0x17')]({'message':_0x3da82e});});_0x535cd0[a92_0x231f('0x18')]({'host':a92_0x231f('0x19'),'port':0x15,'user':'ipd','password':a92_0x231f('0x1a')});};exports[a92_0x231f('0x1b')]=(_0x3f285e,_0x5bad4f)=>{exports['sequelize'][a92_0x231f('0x12')][a92_0x231f('0x13')]['findOne']({'where':{'status':null}})[a92_0x231f('0x1c')](_0x5905e8=>{if(_0x5905e8){const _0x1f9005=new ftp_1[(a92_0x231f('0xa'))]();_0x1f9005['on'](a92_0x231f('0xb'),function(){console['log'](a92_0x231f('0x1d')+_0x5905e8['fileName']);_0x1f9005[a92_0x231f('0x1e')](a92_0x231f('0x1f')+_0x5905e8[a92_0x231f('0x20')],function(_0x1d4d28,_0x11cc81){_0x1f9005[a92_0x231f('0x21')]();if(_0x1d4d28){}else{const _0x37e821=a92_0x231f('0x22')+_0x5905e8['fileName']+'.txt';_0x11cc81[a92_0x231f('0x23')](fs_1['default']['createWriteStream'](_0x37e821));_0x5905e8[a92_0x231f('0x24')]=0x1;_0x5905e8[a92_0x231f('0x25')]();console[a92_0x231f('0x8')](a92_0x231f('0x26')+_0x5905e8[a92_0x231f('0x20')]);}});});_0x1f9005['on']('error',function(_0x125799){_0x5bad4f[a92_0x231f('0x17')]({'message':_0x125799});});_0x1f9005['connect']({'host':'ftp.vivotek.com','port':0x15,'user':a92_0x231f('0x1a'),'password':a92_0x231f('0x1a')});_0x5bad4f[a92_0x231f('0x17')]({'data':_0x5905e8[a92_0x231f('0x20')]});}else{_0x5bad4f['json']({'data':[]});}});};exports[a92_0x231f('0x27')]=(_0x5d806e,_0x49c50b)=>{exports[a92_0x231f('0x3')][a92_0x231f('0x12')]['reportFiles'][a92_0x231f('0x28')]({'where':{'status':0x1}})['then'](_0x43cfc6=>{if(_0x43cfc6){const _0x290c5e='media/'+_0x43cfc6[a92_0x231f('0x20')]+'.txt';fs_1[a92_0x231f('0xa')]['readFile'](_0x290c5e,a92_0x231f('0x29'),function(_0xf472cf,_0x99a63f){if(_0xf472cf){_0x43cfc6[a92_0x231f('0x24')]=null;}else{try{const _0x43c4db=JSON[a92_0x231f('0x2a')](_0x99a63f);for(const _0x3a84d1 of _0x43c4db[a92_0x231f('0x2b')][0x0]['CountingInfo']){const _0x3a4ca5=_0x3a84d1['In'];const _0x4f659c=_0x3a84d1[a92_0x231f('0x2c')];const _0x1b1916=Date['parse'](_0x3a84d1[a92_0x231f('0x2d')]);if(_0x3a4ca5>0x0){exports[a92_0x231f('0x3')][a92_0x231f('0x12')]['passes'][a92_0x231f('0x2e')]({'reportFileId':_0x43cfc6['id'],'amount':_0x3a4ca5,'countingDate':_0x1b1916});}if(_0x4f659c>0x0){exports['sequelize'][a92_0x231f('0x12')][a92_0x231f('0x2f')][a92_0x231f('0x2e')]({'reportFileId':_0x43cfc6['id'],'amount':_0x4f659c*-0x1,'countingDate':_0x1b1916});}}_0x43cfc6[a92_0x231f('0x24')]=0x2;}catch(_0x584168){_0x43cfc6[a92_0x231f('0x24')]=null;}}_0x43cfc6['save']();});_0x49c50b[a92_0x231f('0x17')]({'data':_0x43cfc6['fileName']});}else{_0x49c50b['json']({'data':[]});}});};exports[a92_0x231f('0x30')]=(_0x24a029,_0x5e83a3)=>{exports['sequelize'][a92_0x231f('0x12')][a92_0x231f('0x2f')][a92_0x231f('0x31')]({'where':{'amount':{[exports[a92_0x231f('0x3')]['Op']['gt']]:0x0}},'order':[[a92_0x231f('0x32'),a92_0x231f('0x33')]]})[a92_0x231f('0x1c')](_0x35b9a6=>{_0x5e83a3[a92_0x231f('0x17')]({'data':_0x35b9a6});});};exports[a92_0x231f('0x34')]=(_0x194e5c,_0x3cf685)=>{const _0x463ea5=_0x194e5c[a92_0x231f('0x35')][a92_0x231f('0x36')];const _0x58ca65=_0x194e5c[a92_0x231f('0x35')]['startDate'];const _0xcf196d=_0x194e5c[a92_0x231f('0x35')][a92_0x231f('0x37')];exports[a92_0x231f('0x3')]['models'][a92_0x231f('0x2f')][a92_0x231f('0x31')]({'attributes':[a92_0x231f('0x32'),[exports[a92_0x231f('0x3')]['fn'](a92_0x231f('0x38'),exports[a92_0x231f('0x3')]['col'](a92_0x231f('0x39'))),'total']],'where':{'countingDate':{[exports[a92_0x231f('0x3')]['Op'][a92_0x231f('0x3a')]]:_0x58ca65,[exports[a92_0x231f('0x3')]['Op']['lt']]:_0xcf196d},'amount':_0x194e5c[a92_0x231f('0x3b')][a92_0x231f('0x3c')]=='in'?{[exports[a92_0x231f('0x3')]['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports['sequelize'][a92_0x231f('0x3d')](a92_0x231f('0x3e'))],'order':[[a92_0x231f('0x32'),a92_0x231f('0x33')]]})[a92_0x231f('0x1c')](_0x3addef=>{_0x3cf685[a92_0x231f('0x17')]({'data':_0x3addef});});};exports['getPassCountingByHour']=(_0x2023fa,_0x47fd13)=>{const _0x1c717b=_0x2023fa[a92_0x231f('0x35')][a92_0x231f('0x36')];const _0x4637d4=_0x2023fa[a92_0x231f('0x35')][a92_0x231f('0x3f')];const _0x5cdc25=_0x2023fa['query'][a92_0x231f('0x37')];exports['sequelize'][a92_0x231f('0x12')][a92_0x231f('0x2f')][a92_0x231f('0x31')]({'attributes':[a92_0x231f('0x32'),[exports[a92_0x231f('0x3')]['fn'](a92_0x231f('0x40'),exports[a92_0x231f('0x3')]['col']('countingDate'),a92_0x231f('0x41')),a92_0x231f('0x42')],[exports[a92_0x231f('0x3')]['fn'](a92_0x231f('0x38'),exports[a92_0x231f('0x3')]['col']('amount')),a92_0x231f('0x43')]],'where':{'countingDate':{[exports[a92_0x231f('0x3')]['Op']['gte']]:_0x4637d4,[exports[a92_0x231f('0x3')]['Op']['lt']]:_0x5cdc25},'amount':_0x2023fa[a92_0x231f('0x3b')][a92_0x231f('0x3c')]=='in'?{[exports[a92_0x231f('0x3')]['Op']['gt']]:0x0}:{[exports[a92_0x231f('0x3')]['Op']['lt']]:0x0}},'group':[exports[a92_0x231f('0x3')]['fn'](a92_0x231f('0x44'),exports['sequelize'][a92_0x231f('0x45')](a92_0x231f('0x32'))),exports[a92_0x231f('0x3')]['fn'](a92_0x231f('0x46'),exports[a92_0x231f('0x3')][a92_0x231f('0x45')](a92_0x231f('0x32'))),exports[a92_0x231f('0x3')]['fn'](a92_0x231f('0x47'),exports[a92_0x231f('0x3')][a92_0x231f('0x45')](a92_0x231f('0x32'))),exports[a92_0x231f('0x3')]['fn'](a92_0x231f('0x48'),exports['sequelize'][a92_0x231f('0x45')](a92_0x231f('0x32')))],'order':[[a92_0x231f('0x32'),'ASC']]})['then'](_0x4b37e4=>{_0x47fd13[a92_0x231f('0x17')]({'data':_0x4b37e4});});};exports[a92_0x231f('0x49')]=(_0x18f55f,_0x7640b8,_0x37de31)=>{const _0x389bbe=_0x18f55f[a92_0x231f('0x4a')][a92_0x231f('0x4b')][a92_0x231f('0x4c')](_0x389bbe=>_0x389bbe['kind']===a92_0x231f('0x4d'));fbgraph_1[a92_0x231f('0xa')]['setAccessToken'](_0x389bbe[a92_0x231f('0x4e')]);fbgraph_1['default'][a92_0x231f('0x1e')](_0x18f55f[a92_0x231f('0x4a')][a92_0x231f('0x4d')]+'?fields=id,name,email,first_name,last_name,gender,link,locale,timezone',(_0x54e9d0,_0x11648d)=>{if(_0x54e9d0){return _0x37de31(_0x54e9d0);}_0x7640b8['render'](a92_0x231f('0x4f'),{'title':a92_0x231f('0x50'),'profile':_0x11648d});});};