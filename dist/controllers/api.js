var a92_0x304f=['ftp','sequelize','getApi','render','api/index','API\x20Examples','syncFtp','default','ready','log','connected','list','Downloading:\x20','name','endsWith','json','models','findOrCreate','push','error','connect','ftp.vivotek.com','ipd','downloadFtp','then','connected:','get','fileName','end','media/','pipe','Downloaded:\x20','processFtp','findOne','.txt','readFile','utf8','status','parse','Data','CountingInfo','passes','save','findAll','countingDate','ASC','getPassCountingByDay','query','month','endDate','sum','amount','gte','params','direction','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','startDate','DATE_FORMAT','col','total','DAY','MONTH','YEAR','user','find','kind','facebook','accessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','Facebook\x20API','__esModule','defineProperty','fbgraph'];(function(_0x137469,_0x56ed2d){var _0xf8d799=function(_0x1ff7c0){while(--_0x1ff7c0){_0x137469['push'](_0x137469['shift']());}};_0xf8d799(++_0x56ed2d);}(a92_0x304f,0x129));var a92_0x5952=function(_0x29eed8,_0x4bb4aa){_0x29eed8=_0x29eed8-0x0;var _0x47e29c=a92_0x304f[_0x29eed8];return _0x47e29c;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x3005be){return _0x3005be&&_0x3005be[a92_0x5952('0x0')]?_0x3005be:{'default':_0x3005be};};Object[a92_0x5952('0x1')](exports,a92_0x5952('0x0'),{'value':!![]});const fbgraph_1=__importDefault(require(a92_0x5952('0x2')));const ftp_1=__importDefault(require(a92_0x5952('0x3')));const fs_1=__importDefault(require('fs'));function setSequelize(_0x14b95e){exports[a92_0x5952('0x4')]=_0x14b95e;}exports['setSequelize']=setSequelize;exports[a92_0x5952('0x5')]=(_0x163ae1,_0x2aaf9f)=>{_0x2aaf9f[a92_0x5952('0x6')](a92_0x5952('0x7'),{'title':a92_0x5952('0x8')});};exports[a92_0x5952('0x9')]=(_0x2202b1,_0x5c60db)=>{console['log']('connecting');const _0x253c95=[];const _0x506173=new ftp_1[(a92_0x5952('0xa'))]();_0x506173['on'](a92_0x5952('0xb'),function(){console[a92_0x5952('0xc')](a92_0x5952('0xd'));_0x506173[a92_0x5952('0xe')]('colombia',![],function(_0x3a12f8,_0x21d2c7){if(_0x3a12f8){}else{for(const _0x5cdf75 of _0x21d2c7){console[a92_0x5952('0xc')](a92_0x5952('0xf')+_0x5cdf75[a92_0x5952('0x10')]);if(_0x5cdf75['name'][a92_0x5952('0x11')](a92_0x5952('0x12'))){exports[a92_0x5952('0x4')][a92_0x5952('0x13')]['reportFiles'][a92_0x5952('0x14')]({'where':{'fileName':_0x5cdf75[a92_0x5952('0x10')]}})['spread']((_0x30d79d,_0x50da36)=>{if(_0x50da36){console[a92_0x5952('0xc')](_0x5cdf75[a92_0x5952('0x10')]);_0x253c95[a92_0x5952('0x15')](_0x30d79d);}});}}}_0x5c60db[a92_0x5952('0x12')]({'data':_0x253c95});});});_0x506173['on'](a92_0x5952('0x16'),function(_0xea52d8){_0x5c60db[a92_0x5952('0x12')]({'message':_0xea52d8});});_0x506173[a92_0x5952('0x17')]({'host':a92_0x5952('0x18'),'port':0x15,'user':a92_0x5952('0x19'),'password':a92_0x5952('0x19')});};exports[a92_0x5952('0x1a')]=(_0x3d8b0c,_0x513637)=>{exports['sequelize'][a92_0x5952('0x13')]['reportFiles']['findOne']({'where':{'status':null}})[a92_0x5952('0x1b')](_0xbdbede=>{if(_0xbdbede){const _0x2c3387=new ftp_1[(a92_0x5952('0xa'))]();_0x2c3387['on'](a92_0x5952('0xb'),function(){console[a92_0x5952('0xc')](a92_0x5952('0x1c')+_0xbdbede['fileName']);_0x2c3387[a92_0x5952('0x1d')]('colombia/'+_0xbdbede[a92_0x5952('0x1e')],function(_0x279b6b,_0x5e9af8){_0x2c3387[a92_0x5952('0x1f')]();if(_0x279b6b){}else{const _0x2323b8=a92_0x5952('0x20')+_0xbdbede[a92_0x5952('0x1e')]+'.txt';_0x5e9af8[a92_0x5952('0x21')](fs_1[a92_0x5952('0xa')]['createWriteStream'](_0x2323b8));_0xbdbede['status']=0x1;_0xbdbede['save']();console[a92_0x5952('0xc')](a92_0x5952('0x22')+_0xbdbede[a92_0x5952('0x1e')]);}});});_0x2c3387['on'](a92_0x5952('0x16'),function(_0x381dad){_0x513637['json']({'message':_0x381dad});});_0x2c3387[a92_0x5952('0x17')]({'host':a92_0x5952('0x18'),'port':0x15,'user':a92_0x5952('0x19'),'password':a92_0x5952('0x19')});_0x513637['json']({'data':_0xbdbede[a92_0x5952('0x1e')]});}else{_0x513637[a92_0x5952('0x12')]({'data':[]});}});};exports[a92_0x5952('0x23')]=(_0x49b4af,_0x53dc6c)=>{exports[a92_0x5952('0x4')][a92_0x5952('0x13')]['reportFiles'][a92_0x5952('0x24')]({'where':{'status':0x1}})[a92_0x5952('0x1b')](_0xb53a17=>{if(_0xb53a17){const _0x5294ee=a92_0x5952('0x20')+_0xb53a17[a92_0x5952('0x1e')]+a92_0x5952('0x25');fs_1[a92_0x5952('0xa')][a92_0x5952('0x26')](_0x5294ee,a92_0x5952('0x27'),function(_0x5818fe,_0x58c4a3){if(_0x5818fe){_0xb53a17[a92_0x5952('0x28')]=null;}else{try{const _0x50c248=JSON[a92_0x5952('0x29')](_0x58c4a3);for(const _0x1ac299 of _0x50c248[a92_0x5952('0x2a')][0x0][a92_0x5952('0x2b')]){const _0x4dc842=_0x1ac299['In'];const _0x1ad174=_0x1ac299['Out'];const _0x18bc4e=Date[a92_0x5952('0x29')](_0x1ac299['EndTime']);if(_0x4dc842>0x0){exports[a92_0x5952('0x4')][a92_0x5952('0x13')][a92_0x5952('0x2c')]['create']({'reportFileId':_0xb53a17['id'],'amount':_0x4dc842,'countingDate':_0x18bc4e});}if(_0x1ad174>0x0){exports['sequelize'][a92_0x5952('0x13')][a92_0x5952('0x2c')]['create']({'reportFileId':_0xb53a17['id'],'amount':_0x1ad174*-0x1,'countingDate':_0x18bc4e});}}_0xb53a17['status']=0x2;}catch(_0x1faace){_0xb53a17[a92_0x5952('0x28')]=null;}}_0xb53a17[a92_0x5952('0x2d')]();});_0x53dc6c[a92_0x5952('0x12')]({'data':_0xb53a17['fileName']});}else{_0x53dc6c['json']({'data':[]});}});};exports['getPassCounting']=(_0xfa037e,_0x213f79)=>{exports['sequelize'][a92_0x5952('0x13')]['passes'][a92_0x5952('0x2e')]({'where':{'amount':{[exports[a92_0x5952('0x4')]['Op']['gt']]:0x0}},'order':[[a92_0x5952('0x2f'),a92_0x5952('0x30')]]})['then'](_0x5de652=>{_0x213f79[a92_0x5952('0x12')]({'data':_0x5de652});});};exports[a92_0x5952('0x31')]=(_0x487743,_0x38e594)=>{const _0x368748=_0x487743[a92_0x5952('0x32')][a92_0x5952('0x33')];const _0x2554ea=_0x487743[a92_0x5952('0x32')]['startDate'];const _0x3f3f3c=_0x487743[a92_0x5952('0x32')][a92_0x5952('0x34')];exports['sequelize'][a92_0x5952('0x13')][a92_0x5952('0x2c')]['findAll']({'attributes':['countingDate',[exports[a92_0x5952('0x4')]['fn'](a92_0x5952('0x35'),exports['sequelize']['col'](a92_0x5952('0x36'))),'total']],'where':{'countingDate':{[exports[a92_0x5952('0x4')]['Op'][a92_0x5952('0x37')]]:_0x2554ea,[exports[a92_0x5952('0x4')]['Op']['lt']]:_0x3f3f3c},'amount':_0x487743[a92_0x5952('0x38')][a92_0x5952('0x39')]=='in'?{[exports[a92_0x5952('0x4')]['Op']['gt']]:0x0}:{[exports[a92_0x5952('0x4')]['Op']['lt']]:0x0}},'group':[exports[a92_0x5952('0x4')][a92_0x5952('0x3a')](a92_0x5952('0x3b'))],'order':[[a92_0x5952('0x2f'),'ASC']]})[a92_0x5952('0x1b')](_0x5286dd=>{_0x38e594[a92_0x5952('0x12')]({'data':_0x5286dd});});};exports[a92_0x5952('0x3c')]=(_0x3d4654,_0x13e9e9)=>{const _0x3364d2=_0x3d4654['query'][a92_0x5952('0x33')];const _0x11ebe6=_0x3d4654[a92_0x5952('0x32')][a92_0x5952('0x3d')];const _0x107844=_0x3d4654['query'][a92_0x5952('0x34')];exports[a92_0x5952('0x4')][a92_0x5952('0x13')][a92_0x5952('0x2c')][a92_0x5952('0x2e')]({'attributes':['countingDate',[exports[a92_0x5952('0x4')]['fn'](a92_0x5952('0x3e'),exports[a92_0x5952('0x4')]['col'](a92_0x5952('0x2f')),'%Y-%m-%d\x20%H:00'),'countingDateShort'],[exports['sequelize']['fn']('sum',exports[a92_0x5952('0x4')][a92_0x5952('0x3f')](a92_0x5952('0x36'))),a92_0x5952('0x40')]],'where':{'countingDate':{[exports[a92_0x5952('0x4')]['Op'][a92_0x5952('0x37')]]:_0x11ebe6,[exports[a92_0x5952('0x4')]['Op']['lt']]:_0x107844},'amount':_0x3d4654[a92_0x5952('0x38')]['direction']=='in'?{[exports[a92_0x5952('0x4')]['Op']['gt']]:0x0}:{[exports[a92_0x5952('0x4')]['Op']['lt']]:0x0}},'group':[exports[a92_0x5952('0x4')]['fn']('HOUR',exports['sequelize'][a92_0x5952('0x3f')](a92_0x5952('0x2f'))),exports[a92_0x5952('0x4')]['fn'](a92_0x5952('0x41'),exports['sequelize'][a92_0x5952('0x3f')](a92_0x5952('0x2f'))),exports[a92_0x5952('0x4')]['fn'](a92_0x5952('0x42'),exports[a92_0x5952('0x4')][a92_0x5952('0x3f')]('countingDate')),exports[a92_0x5952('0x4')]['fn'](a92_0x5952('0x43'),exports[a92_0x5952('0x4')]['col']('countingDate'))],'order':[[a92_0x5952('0x2f'),a92_0x5952('0x30')]]})[a92_0x5952('0x1b')](_0x22f0ff=>{_0x13e9e9[a92_0x5952('0x12')]({'data':_0x22f0ff});});};exports['getFacebook']=(_0x3bf743,_0x47288f,_0x5f546b)=>{const _0x369e27=_0x3bf743[a92_0x5952('0x44')]['tokens'][a92_0x5952('0x45')](_0x369e27=>_0x369e27[a92_0x5952('0x46')]===a92_0x5952('0x47'));fbgraph_1[a92_0x5952('0xa')]['setAccessToken'](_0x369e27[a92_0x5952('0x48')]);fbgraph_1[a92_0x5952('0xa')][a92_0x5952('0x1d')](_0x3bf743['user'][a92_0x5952('0x47')]+a92_0x5952('0x49'),(_0x11d936,_0x44d76c)=>{if(_0x11d936){return _0x5f546b(_0x11d936);}_0x47288f[a92_0x5952('0x6')]('api/facebook',{'title':a92_0x5952('0x4a'),'profile':_0x44d76c});});};