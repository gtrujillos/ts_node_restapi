var a198_0xf01c=['ipd','reportFiles','findOne','connected:','fileName','get','end','media/','.txt','pipe','createWriteStream','status','then','utf8','parse','Data','CountingInfo','Out','EndTime','create','passes','save','getPassCounting','findAll','countingDate','ASC','getPassCountingByDay','query','month','startDate','endDate','col','total','gte','params','getPassCountingByHour','DATE_FORMAT','%Y-%m-%d\x20%H:00','countingDateShort','sum','amount','direction','HOUR','MONTH','YEAR','getFacebook','user','tokens','find','kind','facebook','accessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','Facebook\x20API','__importDefault','__esModule','defineProperty','sequelize','setSequelize','render','API\x20Examples','log','connecting','default','ready','connected','list','colombia','name','models','findOrCreate','spread','json','error','connect','ftp.vivotek.com'];(function(_0x1fdffc,_0x225c09){var _0x4201b9=function(_0x750a83){while(--_0x750a83){_0x1fdffc['push'](_0x1fdffc['shift']());}};_0x4201b9(++_0x225c09);}(a198_0xf01c,0x1b2));var a198_0xfb4d=function(_0x53f88c,_0x2da283){_0x53f88c=_0x53f88c-0x0;var _0x1d555f=a198_0xf01c[_0x53f88c];return _0x1d555f;};'use strict';var __importDefault=this&&this[a198_0xfb4d('0x0')]||function(_0x44504d){return _0x44504d&&_0x44504d[a198_0xfb4d('0x1')]?_0x44504d:{'default':_0x44504d};};Object[a198_0xfb4d('0x2')](exports,a198_0xfb4d('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require('fbgraph'));const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));function setSequelize(_0xe654f3){exports[a198_0xfb4d('0x3')]=_0xe654f3;}exports[a198_0xfb4d('0x4')]=setSequelize;exports['getApi']=(_0x30ee93,_0x9579ea)=>{_0x9579ea[a198_0xfb4d('0x5')]('api/index',{'title':a198_0xfb4d('0x6')});};exports['syncFtp']=(_0x225019,_0xc4d6d)=>{console[a198_0xfb4d('0x7')](a198_0xfb4d('0x8'));const _0x561cf8=[];const _0x35f16a=new ftp_1[(a198_0xfb4d('0x9'))]();_0x35f16a['on'](a198_0xfb4d('0xa'),function(){console[a198_0xfb4d('0x7')](a198_0xfb4d('0xb'));_0x35f16a[a198_0xfb4d('0xc')](a198_0xfb4d('0xd'),![],function(_0x354209,_0x40fae8){if(_0x354209){}else{for(const _0x243de6 of _0x40fae8){console[a198_0xfb4d('0x7')]('Downloading:\x20'+_0x243de6[a198_0xfb4d('0xe')]);if(_0x243de6[a198_0xfb4d('0xe')]['endsWith']('json')){exports[a198_0xfb4d('0x3')][a198_0xfb4d('0xf')]['reportFiles'][a198_0xfb4d('0x10')]({'where':{'fileName':_0x243de6[a198_0xfb4d('0xe')]}})[a198_0xfb4d('0x11')]((_0x43446d,_0x902453)=>{if(_0x902453){console[a198_0xfb4d('0x7')](_0x243de6[a198_0xfb4d('0xe')]);_0x561cf8['push'](_0x43446d);}});}}}_0xc4d6d[a198_0xfb4d('0x12')]({'data':_0x561cf8});});});_0x35f16a['on'](a198_0xfb4d('0x13'),function(_0x3f49ec){_0xc4d6d[a198_0xfb4d('0x12')]({'message':_0x3f49ec});});_0x35f16a[a198_0xfb4d('0x14')]({'host':a198_0xfb4d('0x15'),'port':0x15,'user':a198_0xfb4d('0x16'),'password':a198_0xfb4d('0x16')});};exports['downloadFtp']=(_0x59211a,_0x232d90)=>{exports[a198_0xfb4d('0x3')][a198_0xfb4d('0xf')][a198_0xfb4d('0x17')][a198_0xfb4d('0x18')]({'where':{'status':null}})['then'](_0x50901c=>{if(_0x50901c){const _0x3cdfc2=new ftp_1[(a198_0xfb4d('0x9'))]();_0x3cdfc2['on'](a198_0xfb4d('0xa'),function(){console[a198_0xfb4d('0x7')](a198_0xfb4d('0x19')+_0x50901c[a198_0xfb4d('0x1a')]);_0x3cdfc2[a198_0xfb4d('0x1b')]('colombia/'+_0x50901c[a198_0xfb4d('0x1a')],function(_0x4637a0,_0x150ec9){_0x3cdfc2[a198_0xfb4d('0x1c')]();if(_0x4637a0){}else{const _0x32628c=a198_0xfb4d('0x1d')+_0x50901c[a198_0xfb4d('0x1a')]+a198_0xfb4d('0x1e');_0x150ec9[a198_0xfb4d('0x1f')](fs_1[a198_0xfb4d('0x9')][a198_0xfb4d('0x20')](_0x32628c));_0x50901c[a198_0xfb4d('0x21')]=0x1;_0x50901c['save']();console['log']('Downloaded:\x20'+_0x50901c[a198_0xfb4d('0x1a')]);}});});_0x3cdfc2['on'](a198_0xfb4d('0x13'),function(_0x318f6c){_0x232d90['json']({'message':_0x318f6c});});_0x3cdfc2['connect']({'host':'ftp.vivotek.com','port':0x15,'user':a198_0xfb4d('0x16'),'password':a198_0xfb4d('0x16')});_0x232d90['json']({'data':_0x50901c[a198_0xfb4d('0x1a')]});}else{_0x232d90[a198_0xfb4d('0x12')]({'data':[]});}});};exports['processFtp']=(_0x2faea5,_0x49bb0a)=>{exports['sequelize'][a198_0xfb4d('0xf')]['reportFiles'][a198_0xfb4d('0x18')]({'where':{'status':0x1}})[a198_0xfb4d('0x22')](_0x51d99c=>{if(_0x51d99c){const _0x24f779=a198_0xfb4d('0x1d')+_0x51d99c[a198_0xfb4d('0x1a')]+a198_0xfb4d('0x1e');fs_1[a198_0xfb4d('0x9')]['readFile'](_0x24f779,a198_0xfb4d('0x23'),function(_0x4443f1,_0x181b35){if(_0x4443f1){_0x51d99c[a198_0xfb4d('0x21')]=null;}else{try{const _0x4523d1=JSON[a198_0xfb4d('0x24')](_0x181b35);for(const _0x502b05 of _0x4523d1[a198_0xfb4d('0x25')][0x0][a198_0xfb4d('0x26')]){const _0x400e4c=_0x502b05['In'];const _0x3c39d0=_0x502b05[a198_0xfb4d('0x27')];const _0x46d984=Date[a198_0xfb4d('0x24')](_0x502b05[a198_0xfb4d('0x28')]);if(_0x400e4c>0x0){exports[a198_0xfb4d('0x3')][a198_0xfb4d('0xf')]['passes'][a198_0xfb4d('0x29')]({'reportFileId':_0x51d99c['id'],'amount':_0x400e4c,'countingDate':_0x46d984});}if(_0x3c39d0>0x0){exports[a198_0xfb4d('0x3')][a198_0xfb4d('0xf')][a198_0xfb4d('0x2a')]['create']({'reportFileId':_0x51d99c['id'],'amount':_0x3c39d0*-0x1,'countingDate':_0x46d984});}}_0x51d99c[a198_0xfb4d('0x21')]=0x2;}catch(_0x429cdb){_0x51d99c[a198_0xfb4d('0x21')]=null;}}_0x51d99c[a198_0xfb4d('0x2b')]();});_0x49bb0a[a198_0xfb4d('0x12')]({'data':_0x51d99c['fileName']});}else{_0x49bb0a[a198_0xfb4d('0x12')]({'data':[]});}});};exports[a198_0xfb4d('0x2c')]=(_0x313dcb,_0x5c7a1e)=>{exports[a198_0xfb4d('0x3')][a198_0xfb4d('0xf')][a198_0xfb4d('0x2a')][a198_0xfb4d('0x2d')]({'where':{'amount':{[exports[a198_0xfb4d('0x3')]['Op']['gt']]:0x0}},'order':[[a198_0xfb4d('0x2e'),a198_0xfb4d('0x2f')]]})[a198_0xfb4d('0x22')](_0x58f380=>{_0x5c7a1e[a198_0xfb4d('0x12')]({'data':_0x58f380});});};exports[a198_0xfb4d('0x30')]=(_0x5c4af5,_0x2b3670)=>{const _0x260497=_0x5c4af5[a198_0xfb4d('0x31')][a198_0xfb4d('0x32')];const _0x24cf59=_0x5c4af5[a198_0xfb4d('0x31')][a198_0xfb4d('0x33')];const _0x5bb4d5=_0x5c4af5[a198_0xfb4d('0x31')][a198_0xfb4d('0x34')];exports[a198_0xfb4d('0x3')]['models'][a198_0xfb4d('0x2a')]['findAll']({'attributes':[a198_0xfb4d('0x2e'),[exports[a198_0xfb4d('0x3')]['fn']('sum',exports[a198_0xfb4d('0x3')][a198_0xfb4d('0x35')]('amount')),a198_0xfb4d('0x36')]],'where':{'countingDate':{[exports['sequelize']['Op'][a198_0xfb4d('0x37')]]:_0x24cf59,[exports['sequelize']['Op']['lt']]:_0x5bb4d5},'amount':_0x5c4af5[a198_0xfb4d('0x38')]['direction']=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports[a198_0xfb4d('0x3')]['Op']['lt']]:0x0}},'group':[exports[a198_0xfb4d('0x3')]['literal']('YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))')],'order':[[a198_0xfb4d('0x2e'),'ASC']]})[a198_0xfb4d('0x22')](_0x5ce98e=>{_0x2b3670[a198_0xfb4d('0x12')]({'data':_0x5ce98e});});};exports[a198_0xfb4d('0x39')]=(_0x2b2f58,_0x143293)=>{const _0x22b1df=_0x2b2f58[a198_0xfb4d('0x31')][a198_0xfb4d('0x32')];const _0x45e9e2=_0x2b2f58[a198_0xfb4d('0x31')][a198_0xfb4d('0x33')];const _0x17edc4=_0x2b2f58[a198_0xfb4d('0x31')][a198_0xfb4d('0x34')];exports[a198_0xfb4d('0x3')][a198_0xfb4d('0xf')][a198_0xfb4d('0x2a')][a198_0xfb4d('0x2d')]({'attributes':[a198_0xfb4d('0x2e'),[exports[a198_0xfb4d('0x3')]['fn'](a198_0xfb4d('0x3a'),exports[a198_0xfb4d('0x3')]['col']('countingDate'),a198_0xfb4d('0x3b')),a198_0xfb4d('0x3c')],[exports[a198_0xfb4d('0x3')]['fn'](a198_0xfb4d('0x3d'),exports[a198_0xfb4d('0x3')]['col'](a198_0xfb4d('0x3e'))),'total']],'where':{'countingDate':{[exports[a198_0xfb4d('0x3')]['Op'][a198_0xfb4d('0x37')]]:_0x45e9e2,[exports[a198_0xfb4d('0x3')]['Op']['lt']]:_0x17edc4},'amount':_0x2b2f58['params'][a198_0xfb4d('0x3f')]=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports[a198_0xfb4d('0x3')]['Op']['lt']]:0x0}},'group':[exports[a198_0xfb4d('0x3')]['fn'](a198_0xfb4d('0x40'),exports[a198_0xfb4d('0x3')]['col'](a198_0xfb4d('0x2e'))),exports[a198_0xfb4d('0x3')]['fn']('DAY',exports['sequelize']['col'](a198_0xfb4d('0x2e'))),exports[a198_0xfb4d('0x3')]['fn'](a198_0xfb4d('0x41'),exports[a198_0xfb4d('0x3')][a198_0xfb4d('0x35')]('countingDate')),exports[a198_0xfb4d('0x3')]['fn'](a198_0xfb4d('0x42'),exports[a198_0xfb4d('0x3')][a198_0xfb4d('0x35')](a198_0xfb4d('0x2e')))],'order':[[a198_0xfb4d('0x2e'),'ASC']]})[a198_0xfb4d('0x22')](_0x4421bf=>{_0x143293[a198_0xfb4d('0x12')]({'data':_0x4421bf});});};exports[a198_0xfb4d('0x43')]=(_0x4704d8,_0x9e8233,_0x20bace)=>{const _0x117cbb=_0x4704d8[a198_0xfb4d('0x44')][a198_0xfb4d('0x45')][a198_0xfb4d('0x46')](_0x117cbb=>_0x117cbb[a198_0xfb4d('0x47')]===a198_0xfb4d('0x48'));fbgraph_1[a198_0xfb4d('0x9')]['setAccessToken'](_0x117cbb[a198_0xfb4d('0x49')]);fbgraph_1[a198_0xfb4d('0x9')][a198_0xfb4d('0x1b')](_0x4704d8[a198_0xfb4d('0x44')][a198_0xfb4d('0x48')]+a198_0xfb4d('0x4a'),(_0x172324,_0x1ac071)=>{if(_0x172324){return _0x20bace(_0x172324);}_0x9e8233[a198_0xfb4d('0x5')]('api/facebook',{'title':a198_0xfb4d('0x4b'),'profile':_0x1ac071});});};