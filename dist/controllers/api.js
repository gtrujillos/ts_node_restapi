var a288_0x42f5=['defineProperty','__esModule','fbgraph','ftp','setSequelize','getApi','render','api/index','API\x20Examples','syncFtp','connecting','default','ready','log','connected','colombia','Downloading:\x20','endsWith','json','sequelize','models','reportFiles','findOrCreate','name','spread','push','error','ftp.vivotek.com','ipd','downloadFtp','connected:','fileName','get','colombia/','end','.txt','pipe','status','save','Downloaded:\x20','connect','processFtp','findOne','then','media/','readFile','utf8','parse','CountingInfo','EndTime','passes','create','getPassCounting','findAll','month','query','countingDate','sum','col','amount','total','params','direction','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','startDate','DATE_FORMAT','%Y-%m-%d\x20%H:00','gte','HOUR','DAY','kind','facebook','accessToken','user','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','Facebook\x20API'];(function(_0x2d8f05,_0x4b81bb){var _0x4d74cb=function(_0x32719f){while(--_0x32719f){_0x2d8f05['push'](_0x2d8f05['shift']());}};_0x4d74cb(++_0x4b81bb);}(a288_0x42f5,0x134));var a288_0x618d=function(_0x3643bc,_0x4554ba){_0x3643bc=_0x3643bc-0x0;var _0xc91666=a288_0x42f5[_0x3643bc];return _0xc91666;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x40b7f3){return _0x40b7f3&&_0x40b7f3['__esModule']?_0x40b7f3:{'default':_0x40b7f3};};Object[a288_0x618d('0x0')](exports,a288_0x618d('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a288_0x618d('0x2')));const ftp_1=__importDefault(require(a288_0x618d('0x3')));const fs_1=__importDefault(require('fs'));function setSequelize(_0x3074d0){exports['sequelize']=_0x3074d0;}exports[a288_0x618d('0x4')]=setSequelize;exports[a288_0x618d('0x5')]=(_0x23294b,_0x205ec0)=>{_0x205ec0[a288_0x618d('0x6')](a288_0x618d('0x7'),{'title':a288_0x618d('0x8')});};exports[a288_0x618d('0x9')]=(_0xbf059b,_0x409dd5)=>{console['log'](a288_0x618d('0xa'));const _0x3e35a1=[];const _0x198dcc=new ftp_1[(a288_0x618d('0xb'))]();_0x198dcc['on'](a288_0x618d('0xc'),function(){console[a288_0x618d('0xd')](a288_0x618d('0xe'));_0x198dcc['list'](a288_0x618d('0xf'),![],function(_0x56e425,_0x266ed2){if(_0x56e425){}else{for(const _0x38c731 of _0x266ed2){console[a288_0x618d('0xd')](a288_0x618d('0x10')+_0x38c731['name']);if(_0x38c731['name'][a288_0x618d('0x11')](a288_0x618d('0x12'))){exports[a288_0x618d('0x13')][a288_0x618d('0x14')][a288_0x618d('0x15')][a288_0x618d('0x16')]({'where':{'fileName':_0x38c731[a288_0x618d('0x17')]}})[a288_0x618d('0x18')]((_0x1c737d,_0x322dda)=>{if(_0x322dda){console[a288_0x618d('0xd')](_0x38c731[a288_0x618d('0x17')]);_0x3e35a1[a288_0x618d('0x19')](_0x1c737d);}});}}}_0x409dd5[a288_0x618d('0x12')]({'data':_0x3e35a1});});});_0x198dcc['on'](a288_0x618d('0x1a'),function(_0x4fb033){_0x409dd5[a288_0x618d('0x12')]({'message':_0x4fb033});});_0x198dcc['connect']({'host':a288_0x618d('0x1b'),'port':0x15,'user':a288_0x618d('0x1c'),'password':'ipd'});};exports[a288_0x618d('0x1d')]=(_0x4c028a,_0x3c0b3f)=>{exports[a288_0x618d('0x13')][a288_0x618d('0x14')][a288_0x618d('0x15')]['findOne']({'where':{'status':null}})['then'](_0x4756f0=>{if(_0x4756f0){const _0x6d8948=new ftp_1[(a288_0x618d('0xb'))]();_0x6d8948['on'](a288_0x618d('0xc'),function(){console[a288_0x618d('0xd')](a288_0x618d('0x1e')+_0x4756f0[a288_0x618d('0x1f')]);_0x6d8948[a288_0x618d('0x20')](a288_0x618d('0x21')+_0x4756f0[a288_0x618d('0x1f')],function(_0x9d7819,_0x2116aa){_0x6d8948[a288_0x618d('0x22')]();if(_0x9d7819){}else{const _0x2deb04='media/'+_0x4756f0[a288_0x618d('0x1f')]+a288_0x618d('0x23');_0x2116aa[a288_0x618d('0x24')](fs_1[a288_0x618d('0xb')]['createWriteStream'](_0x2deb04));_0x4756f0[a288_0x618d('0x25')]=0x1;_0x4756f0[a288_0x618d('0x26')]();console['log'](a288_0x618d('0x27')+_0x4756f0['fileName']);}});});_0x6d8948['on'](a288_0x618d('0x1a'),function(_0x94aced){_0x3c0b3f[a288_0x618d('0x12')]({'message':_0x94aced});});_0x6d8948[a288_0x618d('0x28')]({'host':'ftp.vivotek.com','port':0x15,'user':a288_0x618d('0x1c'),'password':a288_0x618d('0x1c')});_0x3c0b3f['json']({'data':_0x4756f0['fileName']});}else{_0x3c0b3f[a288_0x618d('0x12')]({'data':[]});}});};exports[a288_0x618d('0x29')]=(_0x9cf807,_0x2ca527)=>{exports['sequelize']['models'][a288_0x618d('0x15')][a288_0x618d('0x2a')]({'where':{'status':0x1}})[a288_0x618d('0x2b')](_0x2a9afe=>{if(_0x2a9afe){const _0x536323=a288_0x618d('0x2c')+_0x2a9afe['fileName']+a288_0x618d('0x23');fs_1[a288_0x618d('0xb')][a288_0x618d('0x2d')](_0x536323,a288_0x618d('0x2e'),function(_0x3f4bd2,_0x2fd1a6){if(_0x3f4bd2){_0x2a9afe['status']=null;}else{try{const _0x1fbcb6=JSON[a288_0x618d('0x2f')](_0x2fd1a6);for(const _0x5d247c of _0x1fbcb6['Data'][0x0][a288_0x618d('0x30')]){const _0x3380d4=_0x5d247c['In'];const _0x5de7f2=_0x5d247c['Out'];const _0x158628=Date[a288_0x618d('0x2f')](_0x5d247c[a288_0x618d('0x31')]);if(_0x3380d4>0x0){exports[a288_0x618d('0x13')][a288_0x618d('0x14')][a288_0x618d('0x32')]['create']({'reportFileId':_0x2a9afe['id'],'amount':_0x3380d4,'countingDate':_0x158628});}if(_0x5de7f2>0x0){exports[a288_0x618d('0x13')][a288_0x618d('0x14')]['passes'][a288_0x618d('0x33')]({'reportFileId':_0x2a9afe['id'],'amount':_0x5de7f2*-0x1,'countingDate':_0x158628});}}_0x2a9afe[a288_0x618d('0x25')]=0x2;}catch(_0x1ab2ba){_0x2a9afe[a288_0x618d('0x25')]=null;}}_0x2a9afe['save']();});_0x2ca527[a288_0x618d('0x12')]({'data':_0x2a9afe[a288_0x618d('0x1f')]});}else{_0x2ca527[a288_0x618d('0x12')]({'data':[]});}});};exports[a288_0x618d('0x34')]=(_0x500b73,_0x4fa6e9)=>{exports[a288_0x618d('0x13')][a288_0x618d('0x14')][a288_0x618d('0x32')][a288_0x618d('0x35')]({'where':{'amount':{[exports[a288_0x618d('0x13')]['Op']['gt']]:0x0}},'order':[['countingDate','ASC']]})[a288_0x618d('0x2b')](_0x1af83a=>{_0x4fa6e9[a288_0x618d('0x12')]({'data':_0x1af83a});});};exports['getPassCountingByDay']=(_0x296d4e,_0x176579)=>{const _0x2e50f4=_0x296d4e['query'][a288_0x618d('0x36')];const _0x3f7f6c=_0x296d4e[a288_0x618d('0x37')]['startDate'];const _0x51bdef=_0x296d4e[a288_0x618d('0x37')]['endDate'];exports['sequelize'][a288_0x618d('0x14')][a288_0x618d('0x32')]['findAll']({'attributes':[a288_0x618d('0x38'),[exports[a288_0x618d('0x13')]['fn'](a288_0x618d('0x39'),exports[a288_0x618d('0x13')][a288_0x618d('0x3a')](a288_0x618d('0x3b'))),a288_0x618d('0x3c')]],'where':{'countingDate':{[exports[a288_0x618d('0x13')]['Op']['gte']]:_0x3f7f6c,[exports[a288_0x618d('0x13')]['Op']['lt']]:_0x51bdef},'amount':_0x296d4e[a288_0x618d('0x3d')][a288_0x618d('0x3e')]=='in'?{[exports[a288_0x618d('0x13')]['Op']['gt']]:0x0}:{[exports[a288_0x618d('0x13')]['Op']['lt']]:0x0}},'group':[exports[a288_0x618d('0x13')][a288_0x618d('0x3f')](a288_0x618d('0x40'))],'order':[[a288_0x618d('0x38'),'ASC']]})[a288_0x618d('0x2b')](_0x402ba5=>{_0x176579[a288_0x618d('0x12')]({'data':_0x402ba5});});};exports['getPassCountingByHour']=(_0x2e6258,_0x4a2cdd)=>{const _0xe84703=_0x2e6258[a288_0x618d('0x37')][a288_0x618d('0x36')];const _0xaff7ac=_0x2e6258[a288_0x618d('0x37')][a288_0x618d('0x41')];const _0x4bc44c=_0x2e6258[a288_0x618d('0x37')]['endDate'];exports[a288_0x618d('0x13')][a288_0x618d('0x14')]['passes'][a288_0x618d('0x35')]({'attributes':[a288_0x618d('0x38'),[exports[a288_0x618d('0x13')]['fn'](a288_0x618d('0x42'),exports[a288_0x618d('0x13')]['col']('countingDate'),a288_0x618d('0x43')),'countingDateShort'],[exports[a288_0x618d('0x13')]['fn']('sum',exports[a288_0x618d('0x13')][a288_0x618d('0x3a')](a288_0x618d('0x3b'))),a288_0x618d('0x3c')]],'where':{'countingDate':{[exports['sequelize']['Op'][a288_0x618d('0x44')]]:_0xaff7ac,[exports[a288_0x618d('0x13')]['Op']['lt']]:_0x4bc44c},'amount':_0x2e6258[a288_0x618d('0x3d')]['direction']=='in'?{[exports[a288_0x618d('0x13')]['Op']['gt']]:0x0}:{[exports[a288_0x618d('0x13')]['Op']['lt']]:0x0}},'group':[exports[a288_0x618d('0x13')]['fn'](a288_0x618d('0x45'),exports['sequelize'][a288_0x618d('0x3a')](a288_0x618d('0x38'))),exports[a288_0x618d('0x13')]['fn'](a288_0x618d('0x46'),exports[a288_0x618d('0x13')][a288_0x618d('0x3a')](a288_0x618d('0x38'))),exports[a288_0x618d('0x13')]['fn']('MONTH',exports[a288_0x618d('0x13')][a288_0x618d('0x3a')]('countingDate')),exports['sequelize']['fn']('YEAR',exports[a288_0x618d('0x13')][a288_0x618d('0x3a')](a288_0x618d('0x38')))],'order':[[a288_0x618d('0x38'),'ASC']]})[a288_0x618d('0x2b')](_0x67a4c0=>{_0x4a2cdd['json']({'data':_0x67a4c0});});};exports['getFacebook']=(_0x4c8057,_0x100b2e,_0x3286ef)=>{const _0x47e935=_0x4c8057['user']['tokens']['find'](_0x47e935=>_0x47e935[a288_0x618d('0x47')]===a288_0x618d('0x48'));fbgraph_1[a288_0x618d('0xb')]['setAccessToken'](_0x47e935[a288_0x618d('0x49')]);fbgraph_1['default'][a288_0x618d('0x20')](_0x4c8057[a288_0x618d('0x4a')][a288_0x618d('0x48')]+a288_0x618d('0x4b'),(_0x5baee1,_0x4d8d5f)=>{if(_0x5baee1){return _0x3286ef(_0x5baee1);}_0x100b2e['render']('api/facebook',{'title':a288_0x618d('0x4c'),'profile':_0x4d8d5f});});};