var a92_0x2d9f=['accessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','api/facebook','Facebook\x20API','__importDefault','__esModule','fbgraph','ftp','getApi','render','api/index','API\x20Examples','syncFtp','connecting','default','ready','log','connected','list','colombia','name','endsWith','sequelize','models','reportFiles','spread','json','error','ipd','downloadFtp','then','connected:','fileName','get','colombia/','end','media/','.txt','pipe','status','save','Downloaded:\x20','connect','ftp.vivotek.com','processFtp','findOne','utf8','parse','Data','CountingInfo','Out','passes','create','getPassCounting','findAll','getPassCountingByDay','query','startDate','sum','amount','total','gte','params','direction','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','countingDate','ASC','getPassCountingByHour','month','endDate','col','countingDateShort','HOUR','MONTH','user','facebook'];(function(_0x299e67,_0x221ea1){var _0x2a2c45=function(_0x46c3f3){while(--_0x46c3f3){_0x299e67['push'](_0x299e67['shift']());}};_0x2a2c45(++_0x221ea1);}(a92_0x2d9f,0x185));var a92_0x9631=function(_0x59e069,_0x3d3e5a){_0x59e069=_0x59e069-0x0;var _0x1b914f=a92_0x2d9f[_0x59e069];return _0x1b914f;};'use strict';var __importDefault=this&&this[a92_0x9631('0x0')]||function(_0x7294d4){return _0x7294d4&&_0x7294d4[a92_0x9631('0x1')]?_0x7294d4:{'default':_0x7294d4};};Object['defineProperty'](exports,a92_0x9631('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a92_0x9631('0x2')));const ftp_1=__importDefault(require(a92_0x9631('0x3')));const fs_1=__importDefault(require('fs'));function setSequelize(_0x3cc468){exports['sequelize']=_0x3cc468;}exports['setSequelize']=setSequelize;exports[a92_0x9631('0x4')]=(_0x10602e,_0x55bcdd)=>{_0x55bcdd[a92_0x9631('0x5')](a92_0x9631('0x6'),{'title':a92_0x9631('0x7')});};exports[a92_0x9631('0x8')]=(_0x42b857,_0x55262f)=>{console['log'](a92_0x9631('0x9'));const _0x1cf4c6=[];const _0x2767ab=new ftp_1[(a92_0x9631('0xa'))]();_0x2767ab['on'](a92_0x9631('0xb'),function(){console[a92_0x9631('0xc')](a92_0x9631('0xd'));_0x2767ab[a92_0x9631('0xe')](a92_0x9631('0xf'),![],function(_0x48ac2b,_0x242913){if(_0x48ac2b){}else{for(const _0x37b669 of _0x242913){console[a92_0x9631('0xc')]('Downloading:\x20'+_0x37b669[a92_0x9631('0x10')]);if(_0x37b669[a92_0x9631('0x10')][a92_0x9631('0x11')]('json')){exports[a92_0x9631('0x12')][a92_0x9631('0x13')][a92_0x9631('0x14')]['findOrCreate']({'where':{'fileName':_0x37b669[a92_0x9631('0x10')]}})[a92_0x9631('0x15')]((_0x3af660,_0x73862c)=>{if(_0x73862c){console[a92_0x9631('0xc')](_0x37b669[a92_0x9631('0x10')]);_0x1cf4c6['push'](_0x3af660);}});}}}_0x55262f[a92_0x9631('0x16')]({'data':_0x1cf4c6});});});_0x2767ab['on'](a92_0x9631('0x17'),function(_0x315588){_0x55262f[a92_0x9631('0x16')]({'message':_0x315588});});_0x2767ab['connect']({'host':'ftp.vivotek.com','port':0x15,'user':a92_0x9631('0x18'),'password':'ipd'});};exports[a92_0x9631('0x19')]=(_0x5b4ea1,_0xf561c6)=>{exports['sequelize'][a92_0x9631('0x13')][a92_0x9631('0x14')]['findOne']({'where':{'status':null}})[a92_0x9631('0x1a')](_0x2d4b2b=>{if(_0x2d4b2b){const _0x1ec63b=new ftp_1['default']();_0x1ec63b['on'](a92_0x9631('0xb'),function(){console['log'](a92_0x9631('0x1b')+_0x2d4b2b[a92_0x9631('0x1c')]);_0x1ec63b[a92_0x9631('0x1d')](a92_0x9631('0x1e')+_0x2d4b2b[a92_0x9631('0x1c')],function(_0x204e0c,_0x3248c8){_0x1ec63b[a92_0x9631('0x1f')]();if(_0x204e0c){}else{const _0x24aaa6=a92_0x9631('0x20')+_0x2d4b2b[a92_0x9631('0x1c')]+a92_0x9631('0x21');_0x3248c8[a92_0x9631('0x22')](fs_1['default']['createWriteStream'](_0x24aaa6));_0x2d4b2b[a92_0x9631('0x23')]=0x1;_0x2d4b2b[a92_0x9631('0x24')]();console[a92_0x9631('0xc')](a92_0x9631('0x25')+_0x2d4b2b[a92_0x9631('0x1c')]);}});});_0x1ec63b['on'](a92_0x9631('0x17'),function(_0xf938bf){_0xf561c6['json']({'message':_0xf938bf});});_0x1ec63b[a92_0x9631('0x26')]({'host':a92_0x9631('0x27'),'port':0x15,'user':a92_0x9631('0x18'),'password':a92_0x9631('0x18')});_0xf561c6[a92_0x9631('0x16')]({'data':_0x2d4b2b[a92_0x9631('0x1c')]});}else{_0xf561c6[a92_0x9631('0x16')]({'data':[]});}});};exports[a92_0x9631('0x28')]=(_0x4f8d54,_0x3fa3ea)=>{exports[a92_0x9631('0x12')][a92_0x9631('0x13')][a92_0x9631('0x14')][a92_0x9631('0x29')]({'where':{'status':0x1}})[a92_0x9631('0x1a')](_0x2128ab=>{if(_0x2128ab){const _0x4b6b56=a92_0x9631('0x20')+_0x2128ab[a92_0x9631('0x1c')]+a92_0x9631('0x21');fs_1['default']['readFile'](_0x4b6b56,a92_0x9631('0x2a'),function(_0xeae2c,_0xc0183f){if(_0xeae2c){_0x2128ab[a92_0x9631('0x23')]=null;}else{try{const _0x2d29b4=JSON[a92_0x9631('0x2b')](_0xc0183f);for(const _0x5a1a65 of _0x2d29b4[a92_0x9631('0x2c')][0x0][a92_0x9631('0x2d')]){const _0x1d22a1=_0x5a1a65['In'];const _0x2a188f=_0x5a1a65[a92_0x9631('0x2e')];const _0x5667c5=Date[a92_0x9631('0x2b')](_0x5a1a65['EndTime']);if(_0x1d22a1>0x0){exports[a92_0x9631('0x12')][a92_0x9631('0x13')][a92_0x9631('0x2f')]['create']({'reportFileId':_0x2128ab['id'],'amount':_0x1d22a1,'countingDate':_0x5667c5});}if(_0x2a188f>0x0){exports['sequelize'][a92_0x9631('0x13')][a92_0x9631('0x2f')][a92_0x9631('0x30')]({'reportFileId':_0x2128ab['id'],'amount':_0x2a188f*-0x1,'countingDate':_0x5667c5});}}_0x2128ab[a92_0x9631('0x23')]=0x2;}catch(_0x2ae22d){_0x2128ab[a92_0x9631('0x23')]=null;}}_0x2128ab[a92_0x9631('0x24')]();});_0x3fa3ea[a92_0x9631('0x16')]({'data':_0x2128ab[a92_0x9631('0x1c')]});}else{_0x3fa3ea[a92_0x9631('0x16')]({'data':[]});}});};exports[a92_0x9631('0x31')]=(_0x152562,_0x515cc7)=>{exports[a92_0x9631('0x12')][a92_0x9631('0x13')][a92_0x9631('0x2f')][a92_0x9631('0x32')]({'where':{'amount':{[exports[a92_0x9631('0x12')]['Op']['gt']]:0x0}},'order':[['countingDate','ASC']]})['then'](_0x5bb308=>{_0x515cc7[a92_0x9631('0x16')]({'data':_0x5bb308});});};exports[a92_0x9631('0x33')]=(_0x669136,_0x1809e5)=>{const _0x16c01f=_0x669136[a92_0x9631('0x34')]['month'];const _0xa512b9=_0x669136[a92_0x9631('0x34')][a92_0x9631('0x35')];const _0x4698ef=_0x669136[a92_0x9631('0x34')]['endDate'];exports[a92_0x9631('0x12')]['models']['passes'][a92_0x9631('0x32')]({'attributes':['countingDate',[exports[a92_0x9631('0x12')]['fn'](a92_0x9631('0x36'),exports['sequelize']['col'](a92_0x9631('0x37'))),a92_0x9631('0x38')]],'where':{'countingDate':{[exports[a92_0x9631('0x12')]['Op'][a92_0x9631('0x39')]]:_0xa512b9,[exports['sequelize']['Op']['lt']]:_0x4698ef},'amount':_0x669136[a92_0x9631('0x3a')][a92_0x9631('0x3b')]=='in'?{[exports[a92_0x9631('0x12')]['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports['sequelize'][a92_0x9631('0x3c')](a92_0x9631('0x3d'))],'order':[[a92_0x9631('0x3e'),a92_0x9631('0x3f')]]})['then'](_0x3ab384=>{_0x1809e5[a92_0x9631('0x16')]({'data':_0x3ab384});});};exports[a92_0x9631('0x40')]=(_0x1c1063,_0x165f68)=>{const _0x9268cb=_0x1c1063[a92_0x9631('0x34')][a92_0x9631('0x41')];const _0x55a144=_0x1c1063[a92_0x9631('0x34')][a92_0x9631('0x35')];const _0x293795=_0x1c1063[a92_0x9631('0x34')][a92_0x9631('0x42')];exports[a92_0x9631('0x12')]['models'][a92_0x9631('0x2f')]['findAll']({'attributes':[a92_0x9631('0x3e'),[exports[a92_0x9631('0x12')]['fn']('DATE_FORMAT',exports[a92_0x9631('0x12')][a92_0x9631('0x43')](a92_0x9631('0x3e')),'%Y-%m-%d\x20%H:00'),a92_0x9631('0x44')],[exports[a92_0x9631('0x12')]['fn']('sum',exports[a92_0x9631('0x12')]['col']('amount')),a92_0x9631('0x38')]],'where':{'countingDate':{[exports[a92_0x9631('0x12')]['Op']['gte']]:_0x55a144,[exports['sequelize']['Op']['lt']]:_0x293795},'amount':_0x1c1063[a92_0x9631('0x3a')]['direction']=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports[a92_0x9631('0x12')]['Op']['lt']]:0x0}},'group':[exports['sequelize']['fn'](a92_0x9631('0x45'),exports['sequelize'][a92_0x9631('0x43')](a92_0x9631('0x3e'))),exports[a92_0x9631('0x12')]['fn']('DAY',exports['sequelize'][a92_0x9631('0x43')](a92_0x9631('0x3e'))),exports[a92_0x9631('0x12')]['fn'](a92_0x9631('0x46'),exports['sequelize'][a92_0x9631('0x43')]('countingDate')),exports['sequelize']['fn']('YEAR',exports[a92_0x9631('0x12')][a92_0x9631('0x43')](a92_0x9631('0x3e')))],'order':[['countingDate','ASC']]})[a92_0x9631('0x1a')](_0x4029c5=>{_0x165f68[a92_0x9631('0x16')]({'data':_0x4029c5});});};exports['getFacebook']=(_0x356cd0,_0x20a115,_0x314daa)=>{const _0x215743=_0x356cd0[a92_0x9631('0x47')]['tokens']['find'](_0x215743=>_0x215743['kind']===a92_0x9631('0x48'));fbgraph_1['default']['setAccessToken'](_0x215743[a92_0x9631('0x49')]);fbgraph_1[a92_0x9631('0xa')]['get'](_0x356cd0[a92_0x9631('0x47')][a92_0x9631('0x48')]+a92_0x9631('0x4a'),(_0x277786,_0x1279dc)=>{if(_0x277786){return _0x314daa(_0x277786);}_0x20a115[a92_0x9631('0x5')](a92_0x9631('0x4b'),{'title':a92_0x9631('0x4c'),'profile':_0x1279dc});});};