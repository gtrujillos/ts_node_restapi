var a198_0x1f1a=['countingDateShort','HOUR','MONTH','YEAR','getFacebook','user','tokens','kind','setAccessToken','accessToken','facebook','api/facebook','Facebook\x20API','__importDefault','defineProperty','__esModule','fbgraph','ftp','setSequelize','getApi','API\x20Examples','syncFtp','log','connecting','default','ready','colombia','Downloading:\x20','name','endsWith','json','sequelize','models','reportFiles','spread','push','error','connect','ftp.vivotek.com','connected:','get','fileName','end','.txt','pipe','createWriteStream','save','Downloaded:\x20','ipd','processFtp','findOne','readFile','status','parse','Data','CountingInfo','EndTime','passes','create','getPassCounting','findAll','then','getPassCountingByDay','query','month','startDate','endDate','countingDate','sum','col','amount','total','gte','params','direction','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','ASC','getPassCountingByHour','DATE_FORMAT','%Y-%m-%d\x20%H:00'];(function(_0x4c73db,_0x46d9b1){var _0x356e04=function(_0x3e0206){while(--_0x3e0206){_0x4c73db['push'](_0x4c73db['shift']());}};_0x356e04(++_0x46d9b1);}(a198_0x1f1a,0x100));var a198_0x2083=function(_0x1c70a8,_0x749229){_0x1c70a8=_0x1c70a8-0x0;var _0x3c411a=a198_0x1f1a[_0x1c70a8];return _0x3c411a;};'use strict';var __importDefault=this&&this[a198_0x2083('0x0')]||function(_0x450075){return _0x450075&&_0x450075['__esModule']?_0x450075:{'default':_0x450075};};Object[a198_0x2083('0x1')](exports,a198_0x2083('0x2'),{'value':!![]});const fbgraph_1=__importDefault(require(a198_0x2083('0x3')));const ftp_1=__importDefault(require(a198_0x2083('0x4')));const fs_1=__importDefault(require('fs'));function setSequelize(_0x24c0c2){exports['sequelize']=_0x24c0c2;}exports[a198_0x2083('0x5')]=setSequelize;exports[a198_0x2083('0x6')]=(_0x4c0db2,_0x4a54f4)=>{_0x4a54f4['render']('api/index',{'title':a198_0x2083('0x7')});};exports[a198_0x2083('0x8')]=(_0x40f2f1,_0x8d0a1a)=>{console[a198_0x2083('0x9')](a198_0x2083('0xa'));const _0x45fa38=[];const _0x2161c8=new ftp_1[(a198_0x2083('0xb'))]();_0x2161c8['on'](a198_0x2083('0xc'),function(){console[a198_0x2083('0x9')]('connected');_0x2161c8['list'](a198_0x2083('0xd'),![],function(_0x1af495,_0x1415e3){if(_0x1af495){}else{for(const _0x1e9610 of _0x1415e3){console['log'](a198_0x2083('0xe')+_0x1e9610[a198_0x2083('0xf')]);if(_0x1e9610[a198_0x2083('0xf')][a198_0x2083('0x10')](a198_0x2083('0x11'))){exports[a198_0x2083('0x12')][a198_0x2083('0x13')][a198_0x2083('0x14')]['findOrCreate']({'where':{'fileName':_0x1e9610[a198_0x2083('0xf')]}})[a198_0x2083('0x15')]((_0x2104ff,_0x23c1bd)=>{if(_0x23c1bd){console[a198_0x2083('0x9')](_0x1e9610[a198_0x2083('0xf')]);_0x45fa38[a198_0x2083('0x16')](_0x2104ff);}});}}}_0x8d0a1a['json']({'data':_0x45fa38});});});_0x2161c8['on'](a198_0x2083('0x17'),function(_0x18236b){_0x8d0a1a['json']({'message':_0x18236b});});_0x2161c8[a198_0x2083('0x18')]({'host':a198_0x2083('0x19'),'port':0x15,'user':'ipd','password':'ipd'});};exports['downloadFtp']=(_0x3bce38,_0x51ba35)=>{exports[a198_0x2083('0x12')][a198_0x2083('0x13')]['reportFiles']['findOne']({'where':{'status':null}})['then'](_0x4bcef1=>{if(_0x4bcef1){const _0x106c54=new ftp_1['default']();_0x106c54['on']('ready',function(){console[a198_0x2083('0x9')](a198_0x2083('0x1a')+_0x4bcef1['fileName']);_0x106c54[a198_0x2083('0x1b')]('colombia/'+_0x4bcef1[a198_0x2083('0x1c')],function(_0x4eb081,_0x3b3f37){_0x106c54[a198_0x2083('0x1d')]();if(_0x4eb081){}else{const _0x58e125='media/'+_0x4bcef1[a198_0x2083('0x1c')]+a198_0x2083('0x1e');_0x3b3f37[a198_0x2083('0x1f')](fs_1[a198_0x2083('0xb')][a198_0x2083('0x20')](_0x58e125));_0x4bcef1['status']=0x1;_0x4bcef1[a198_0x2083('0x21')]();console[a198_0x2083('0x9')](a198_0x2083('0x22')+_0x4bcef1['fileName']);}});});_0x106c54['on'](a198_0x2083('0x17'),function(_0x234eb3){_0x51ba35[a198_0x2083('0x11')]({'message':_0x234eb3});});_0x106c54['connect']({'host':a198_0x2083('0x19'),'port':0x15,'user':a198_0x2083('0x23'),'password':'ipd'});_0x51ba35['json']({'data':_0x4bcef1[a198_0x2083('0x1c')]});}else{_0x51ba35[a198_0x2083('0x11')]({'data':[]});}});};exports[a198_0x2083('0x24')]=(_0x20d155,_0x509a45)=>{exports[a198_0x2083('0x12')][a198_0x2083('0x13')]['reportFiles'][a198_0x2083('0x25')]({'where':{'status':0x1}})['then'](_0x30fcaa=>{if(_0x30fcaa){const _0x1f87b4='media/'+_0x30fcaa['fileName']+a198_0x2083('0x1e');fs_1[a198_0x2083('0xb')][a198_0x2083('0x26')](_0x1f87b4,'utf8',function(_0x41435d,_0xb82164){if(_0x41435d){_0x30fcaa[a198_0x2083('0x27')]=null;}else{try{const _0x3332ff=JSON[a198_0x2083('0x28')](_0xb82164);for(const _0x33b399 of _0x3332ff[a198_0x2083('0x29')][0x0][a198_0x2083('0x2a')]){const _0x5e15cd=_0x33b399['In'];const _0x198811=_0x33b399['Out'];const _0x274e0d=Date['parse'](_0x33b399[a198_0x2083('0x2b')]);if(_0x5e15cd>0x0){exports[a198_0x2083('0x12')][a198_0x2083('0x13')][a198_0x2083('0x2c')][a198_0x2083('0x2d')]({'reportFileId':_0x30fcaa['id'],'amount':_0x5e15cd,'countingDate':_0x274e0d});}if(_0x198811>0x0){exports[a198_0x2083('0x12')][a198_0x2083('0x13')]['passes'][a198_0x2083('0x2d')]({'reportFileId':_0x30fcaa['id'],'amount':_0x198811*-0x1,'countingDate':_0x274e0d});}}_0x30fcaa['status']=0x2;}catch(_0x4a29d1){_0x30fcaa[a198_0x2083('0x27')]=null;}}_0x30fcaa['save']();});_0x509a45['json']({'data':_0x30fcaa[a198_0x2083('0x1c')]});}else{_0x509a45[a198_0x2083('0x11')]({'data':[]});}});};exports[a198_0x2083('0x2e')]=(_0x4d76f6,_0x8afe39)=>{exports[a198_0x2083('0x12')]['models'][a198_0x2083('0x2c')][a198_0x2083('0x2f')]({'where':{'amount':{[exports[a198_0x2083('0x12')]['Op']['gt']]:0x0}},'order':[['countingDate','ASC']]})[a198_0x2083('0x30')](_0x166f43=>{_0x8afe39[a198_0x2083('0x11')]({'data':_0x166f43});});};exports[a198_0x2083('0x31')]=(_0x234aee,_0x19a974)=>{const _0x2d8812=_0x234aee[a198_0x2083('0x32')][a198_0x2083('0x33')];const _0x3e8f31=_0x234aee[a198_0x2083('0x32')][a198_0x2083('0x34')];const _0x5de42f=_0x234aee[a198_0x2083('0x32')][a198_0x2083('0x35')];exports[a198_0x2083('0x12')][a198_0x2083('0x13')][a198_0x2083('0x2c')][a198_0x2083('0x2f')]({'attributes':[a198_0x2083('0x36'),[exports[a198_0x2083('0x12')]['fn'](a198_0x2083('0x37'),exports[a198_0x2083('0x12')][a198_0x2083('0x38')](a198_0x2083('0x39'))),a198_0x2083('0x3a')]],'where':{'countingDate':{[exports[a198_0x2083('0x12')]['Op'][a198_0x2083('0x3b')]]:_0x3e8f31,[exports['sequelize']['Op']['lt']]:_0x5de42f},'amount':_0x234aee[a198_0x2083('0x3c')][a198_0x2083('0x3d')]=='in'?{[exports[a198_0x2083('0x12')]['Op']['gt']]:0x0}:{[exports[a198_0x2083('0x12')]['Op']['lt']]:0x0}},'group':[exports['sequelize'][a198_0x2083('0x3e')](a198_0x2083('0x3f'))],'order':[[a198_0x2083('0x36'),a198_0x2083('0x40')]]})[a198_0x2083('0x30')](_0xbd5669=>{_0x19a974['json']({'data':_0xbd5669});});};exports[a198_0x2083('0x41')]=(_0x59ae2a,_0x59d40e)=>{const _0x178cf3=_0x59ae2a[a198_0x2083('0x32')]['month'];const _0x2cdcd6=_0x59ae2a[a198_0x2083('0x32')][a198_0x2083('0x34')];const _0x3dcbcd=_0x59ae2a[a198_0x2083('0x32')][a198_0x2083('0x35')];exports[a198_0x2083('0x12')][a198_0x2083('0x13')]['passes']['findAll']({'attributes':[a198_0x2083('0x36'),[exports['sequelize']['fn'](a198_0x2083('0x42'),exports[a198_0x2083('0x12')][a198_0x2083('0x38')](a198_0x2083('0x36')),a198_0x2083('0x43')),a198_0x2083('0x44')],[exports[a198_0x2083('0x12')]['fn']('sum',exports[a198_0x2083('0x12')][a198_0x2083('0x38')](a198_0x2083('0x39'))),a198_0x2083('0x3a')]],'where':{'countingDate':{[exports[a198_0x2083('0x12')]['Op'][a198_0x2083('0x3b')]]:_0x2cdcd6,[exports[a198_0x2083('0x12')]['Op']['lt']]:_0x3dcbcd},'amount':_0x59ae2a['params'][a198_0x2083('0x3d')]=='in'?{[exports[a198_0x2083('0x12')]['Op']['gt']]:0x0}:{[exports[a198_0x2083('0x12')]['Op']['lt']]:0x0}},'group':[exports['sequelize']['fn'](a198_0x2083('0x45'),exports[a198_0x2083('0x12')][a198_0x2083('0x38')](a198_0x2083('0x36'))),exports['sequelize']['fn']('DAY',exports[a198_0x2083('0x12')]['col'](a198_0x2083('0x36'))),exports[a198_0x2083('0x12')]['fn'](a198_0x2083('0x46'),exports[a198_0x2083('0x12')]['col'](a198_0x2083('0x36'))),exports[a198_0x2083('0x12')]['fn'](a198_0x2083('0x47'),exports['sequelize'][a198_0x2083('0x38')](a198_0x2083('0x36')))],'order':[['countingDate',a198_0x2083('0x40')]]})[a198_0x2083('0x30')](_0x11243a=>{_0x59d40e[a198_0x2083('0x11')]({'data':_0x11243a});});};exports[a198_0x2083('0x48')]=(_0x50c1fc,_0x1204a3,_0x28ea34)=>{const _0xb0c8cc=_0x50c1fc[a198_0x2083('0x49')][a198_0x2083('0x4a')]['find'](_0xb0c8cc=>_0xb0c8cc[a198_0x2083('0x4b')]==='facebook');fbgraph_1[a198_0x2083('0xb')][a198_0x2083('0x4c')](_0xb0c8cc[a198_0x2083('0x4d')]);fbgraph_1['default'][a198_0x2083('0x1b')](_0x50c1fc[a198_0x2083('0x49')][a198_0x2083('0x4e')]+'?fields=id,name,email,first_name,last_name,gender,link,locale,timezone',(_0x1d9708,_0x23329c)=>{if(_0x1d9708){return _0x28ea34(_0x1d9708);}_0x1204a3['render'](a198_0x2083('0x4f'),{'title':a198_0x2083('0x50'),'profile':_0x23329c});});};