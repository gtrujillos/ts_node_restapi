var a98_0x5bd3=['get','end','media/','.txt','pipe','createWriteStream','save','processFtp','readFile','status','Out','parse','passes','create','getPassCounting','findAll','countingDate','getPassCountingByDay','query','endDate','sum','col','total','direction','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','ASC','getPassCountingByHour','month','DATE_FORMAT','%Y-%m-%d\x20%H:00','countingDateShort','amount','gte','params','HOUR','DAY','MONTH','YEAR','getFacebook','user','tokens','find','kind','facebook','setAccessToken','accessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','api/facebook','Facebook\x20API','__importDefault','defineProperty','ftp','getApi','render','API\x20Examples','syncFtp','log','connecting','default','ready','connected','list','Downloading:\x20','name','endsWith','json','sequelize','models','reportFiles','findOrCreate','spread','push','error','ftp.vivotek.com','ipd','findOne','then','connected:','fileName'];(function(_0x3e1082,_0x803c97){var _0x445f51=function(_0x3ee013){while(--_0x3ee013){_0x3e1082['push'](_0x3e1082['shift']());}};_0x445f51(++_0x803c97);}(a98_0x5bd3,0xcf));var a98_0x2d9a=function(_0x3b1bea,_0x456586){_0x3b1bea=_0x3b1bea-0x0;var _0x265093=a98_0x5bd3[_0x3b1bea];return _0x265093;};'use strict';var __importDefault=this&&this[a98_0x2d9a('0x0')]||function(_0x157420){return _0x157420&&_0x157420['__esModule']?_0x157420:{'default':_0x157420};};Object[a98_0x2d9a('0x1')](exports,'__esModule',{'value':!![]});const fbgraph_1=__importDefault(require('fbgraph'));const ftp_1=__importDefault(require(a98_0x2d9a('0x2')));const fs_1=__importDefault(require('fs'));function setSequelize(_0x3ad70f){exports['sequelize']=_0x3ad70f;}exports['setSequelize']=setSequelize;exports[a98_0x2d9a('0x3')]=(_0x490690,_0x2364d1)=>{_0x2364d1[a98_0x2d9a('0x4')]('api/index',{'title':a98_0x2d9a('0x5')});};exports[a98_0x2d9a('0x6')]=(_0x4ffad7,_0x8105ca)=>{console[a98_0x2d9a('0x7')](a98_0x2d9a('0x8'));const _0x2222eb=[];const _0x4d6501=new ftp_1[(a98_0x2d9a('0x9'))]();_0x4d6501['on'](a98_0x2d9a('0xa'),function(){console[a98_0x2d9a('0x7')](a98_0x2d9a('0xb'));_0x4d6501[a98_0x2d9a('0xc')]('colombia',![],function(_0x161376,_0xca6a82){if(_0x161376){}else{for(const _0xf189f8 of _0xca6a82){console[a98_0x2d9a('0x7')](a98_0x2d9a('0xd')+_0xf189f8[a98_0x2d9a('0xe')]);if(_0xf189f8[a98_0x2d9a('0xe')][a98_0x2d9a('0xf')](a98_0x2d9a('0x10'))){exports[a98_0x2d9a('0x11')][a98_0x2d9a('0x12')][a98_0x2d9a('0x13')][a98_0x2d9a('0x14')]({'where':{'fileName':_0xf189f8[a98_0x2d9a('0xe')]}})[a98_0x2d9a('0x15')]((_0x5db797,_0x5894c2)=>{if(_0x5894c2){console[a98_0x2d9a('0x7')](_0xf189f8[a98_0x2d9a('0xe')]);_0x2222eb[a98_0x2d9a('0x16')](_0x5db797);}});}}}_0x8105ca['json']({'data':_0x2222eb});});});_0x4d6501['on'](a98_0x2d9a('0x17'),function(_0x297c66){_0x8105ca[a98_0x2d9a('0x10')]({'message':_0x297c66});});_0x4d6501['connect']({'host':a98_0x2d9a('0x18'),'port':0x15,'user':a98_0x2d9a('0x19'),'password':a98_0x2d9a('0x19')});};exports['downloadFtp']=(_0x409fcd,_0x2f677d)=>{exports[a98_0x2d9a('0x11')][a98_0x2d9a('0x12')][a98_0x2d9a('0x13')][a98_0x2d9a('0x1a')]({'where':{'status':null}})[a98_0x2d9a('0x1b')](_0x302419=>{if(_0x302419){const _0x37de68=new ftp_1[(a98_0x2d9a('0x9'))]();_0x37de68['on'](a98_0x2d9a('0xa'),function(){console[a98_0x2d9a('0x7')](a98_0x2d9a('0x1c')+_0x302419[a98_0x2d9a('0x1d')]);_0x37de68[a98_0x2d9a('0x1e')]('colombia/'+_0x302419[a98_0x2d9a('0x1d')],function(_0x39b2d8,_0x51b0e3){_0x37de68[a98_0x2d9a('0x1f')]();if(_0x39b2d8){}else{const _0x56ee72=a98_0x2d9a('0x20')+_0x302419[a98_0x2d9a('0x1d')]+a98_0x2d9a('0x21');_0x51b0e3[a98_0x2d9a('0x22')](fs_1[a98_0x2d9a('0x9')][a98_0x2d9a('0x23')](_0x56ee72));_0x302419['status']=0x1;_0x302419[a98_0x2d9a('0x24')]();console[a98_0x2d9a('0x7')]('Downloaded:\x20'+_0x302419['fileName']);}});});_0x37de68['on'](a98_0x2d9a('0x17'),function(_0x41b2e2){_0x2f677d[a98_0x2d9a('0x10')]({'message':_0x41b2e2});});_0x37de68['connect']({'host':a98_0x2d9a('0x18'),'port':0x15,'user':a98_0x2d9a('0x19'),'password':a98_0x2d9a('0x19')});_0x2f677d[a98_0x2d9a('0x10')]({'data':_0x302419['fileName']});}else{_0x2f677d['json']({'data':[]});}});};exports[a98_0x2d9a('0x25')]=(_0x50d850,_0x2853f9)=>{exports[a98_0x2d9a('0x11')][a98_0x2d9a('0x12')][a98_0x2d9a('0x13')][a98_0x2d9a('0x1a')]({'where':{'status':0x1}})[a98_0x2d9a('0x1b')](_0x2a1dd6=>{if(_0x2a1dd6){const _0x30534f=a98_0x2d9a('0x20')+_0x2a1dd6[a98_0x2d9a('0x1d')]+a98_0x2d9a('0x21');fs_1[a98_0x2d9a('0x9')][a98_0x2d9a('0x26')](_0x30534f,'utf8',function(_0x147f29,_0x6e5f84){if(_0x147f29){_0x2a1dd6[a98_0x2d9a('0x27')]=null;}else{try{const _0x3c104b=JSON['parse'](_0x6e5f84);for(const _0x357984 of _0x3c104b['Data'][0x0]['CountingInfo']){const _0x3cd50b=_0x357984['In'];const _0xdf3547=_0x357984[a98_0x2d9a('0x28')];const _0x3611fc=Date[a98_0x2d9a('0x29')](_0x357984['EndTime']);if(_0x3cd50b>0x0){exports['sequelize']['models'][a98_0x2d9a('0x2a')][a98_0x2d9a('0x2b')]({'reportFileId':_0x2a1dd6['id'],'amount':_0x3cd50b,'countingDate':_0x3611fc});}if(_0xdf3547>0x0){exports[a98_0x2d9a('0x11')][a98_0x2d9a('0x12')][a98_0x2d9a('0x2a')]['create']({'reportFileId':_0x2a1dd6['id'],'amount':_0xdf3547*-0x1,'countingDate':_0x3611fc});}}_0x2a1dd6[a98_0x2d9a('0x27')]=0x2;}catch(_0x33f885){_0x2a1dd6[a98_0x2d9a('0x27')]=null;}}_0x2a1dd6[a98_0x2d9a('0x24')]();});_0x2853f9[a98_0x2d9a('0x10')]({'data':_0x2a1dd6['fileName']});}else{_0x2853f9['json']({'data':[]});}});};exports[a98_0x2d9a('0x2c')]=(_0x1f4240,_0x213084)=>{exports['sequelize'][a98_0x2d9a('0x12')][a98_0x2d9a('0x2a')][a98_0x2d9a('0x2d')]({'where':{'amount':{[exports[a98_0x2d9a('0x11')]['Op']['gt']]:0x0}},'order':[[a98_0x2d9a('0x2e'),'ASC']]})[a98_0x2d9a('0x1b')](_0x27df95=>{_0x213084[a98_0x2d9a('0x10')]({'data':_0x27df95});});};exports[a98_0x2d9a('0x2f')]=(_0x162ca0,_0x408dbf)=>{const _0x70bf72=_0x162ca0[a98_0x2d9a('0x30')]['month'];const _0x42c219=_0x162ca0[a98_0x2d9a('0x30')]['startDate'];const _0x3f391e=_0x162ca0[a98_0x2d9a('0x30')][a98_0x2d9a('0x31')];exports[a98_0x2d9a('0x11')][a98_0x2d9a('0x12')][a98_0x2d9a('0x2a')]['findAll']({'attributes':['countingDate',[exports[a98_0x2d9a('0x11')]['fn'](a98_0x2d9a('0x32'),exports['sequelize'][a98_0x2d9a('0x33')]('amount')),a98_0x2d9a('0x34')]],'where':{'countingDate':{[exports[a98_0x2d9a('0x11')]['Op']['gte']]:_0x42c219,[exports[a98_0x2d9a('0x11')]['Op']['lt']]:_0x3f391e},'amount':_0x162ca0['params'][a98_0x2d9a('0x35')]=='in'?{[exports[a98_0x2d9a('0x11')]['Op']['gt']]:0x0}:{[exports[a98_0x2d9a('0x11')]['Op']['lt']]:0x0}},'group':[exports['sequelize']['literal'](a98_0x2d9a('0x36'))],'order':[['countingDate',a98_0x2d9a('0x37')]]})['then'](_0x54f799=>{_0x408dbf['json']({'data':_0x54f799});});};exports[a98_0x2d9a('0x38')]=(_0x297833,_0x392333)=>{const _0x2ee791=_0x297833['query'][a98_0x2d9a('0x39')];const _0x2d750b=_0x297833['query']['startDate'];const _0x2ecef9=_0x297833['query']['endDate'];exports[a98_0x2d9a('0x11')][a98_0x2d9a('0x12')][a98_0x2d9a('0x2a')][a98_0x2d9a('0x2d')]({'attributes':[a98_0x2d9a('0x2e'),[exports[a98_0x2d9a('0x11')]['fn'](a98_0x2d9a('0x3a'),exports['sequelize'][a98_0x2d9a('0x33')](a98_0x2d9a('0x2e')),a98_0x2d9a('0x3b')),a98_0x2d9a('0x3c')],[exports[a98_0x2d9a('0x11')]['fn'](a98_0x2d9a('0x32'),exports[a98_0x2d9a('0x11')][a98_0x2d9a('0x33')](a98_0x2d9a('0x3d'))),a98_0x2d9a('0x34')]],'where':{'countingDate':{[exports['sequelize']['Op'][a98_0x2d9a('0x3e')]]:_0x2d750b,[exports['sequelize']['Op']['lt']]:_0x2ecef9},'amount':_0x297833[a98_0x2d9a('0x3f')][a98_0x2d9a('0x35')]=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports['sequelize']['fn'](a98_0x2d9a('0x40'),exports['sequelize'][a98_0x2d9a('0x33')]('countingDate')),exports[a98_0x2d9a('0x11')]['fn'](a98_0x2d9a('0x41'),exports[a98_0x2d9a('0x11')][a98_0x2d9a('0x33')](a98_0x2d9a('0x2e'))),exports[a98_0x2d9a('0x11')]['fn'](a98_0x2d9a('0x42'),exports[a98_0x2d9a('0x11')][a98_0x2d9a('0x33')](a98_0x2d9a('0x2e'))),exports[a98_0x2d9a('0x11')]['fn'](a98_0x2d9a('0x43'),exports[a98_0x2d9a('0x11')][a98_0x2d9a('0x33')](a98_0x2d9a('0x2e')))],'order':[['countingDate','ASC']]})['then'](_0x371511=>{_0x392333[a98_0x2d9a('0x10')]({'data':_0x371511});});};exports[a98_0x2d9a('0x44')]=(_0x5e5186,_0x51a129,_0x715739)=>{const _0x40a787=_0x5e5186[a98_0x2d9a('0x45')][a98_0x2d9a('0x46')][a98_0x2d9a('0x47')](_0x40a787=>_0x40a787[a98_0x2d9a('0x48')]===a98_0x2d9a('0x49'));fbgraph_1['default'][a98_0x2d9a('0x4a')](_0x40a787[a98_0x2d9a('0x4b')]);fbgraph_1[a98_0x2d9a('0x9')]['get'](_0x5e5186[a98_0x2d9a('0x45')]['facebook']+a98_0x2d9a('0x4c'),(_0x1c22ba,_0x3191ac)=>{if(_0x1c22ba){return _0x715739(_0x1c22ba);}_0x51a129[a98_0x2d9a('0x4')](a98_0x2d9a('0x4d'),{'title':a98_0x2d9a('0x4e'),'profile':_0x3191ac});});};