var a85_0x5b03=['reportFiles','spread','push','connect','ipd','downloadFtp','models','findOne','connected:','fileName','colombia/','end','media/','createWriteStream','status','save','Downloaded:\x20','error','processFtp','then','.txt','readFile','utf8','parse','CountingInfo','Out','passes','create','getPassCounting','findAll','countingDate','ASC','getPassCountingByDay','query','month','endDate','sum','col','total','gte','params','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','DATE_FORMAT','%Y-%m-%d\x20%H:00','countingDateShort','amount','direction','HOUR','DAY','MONTH','getFacebook','find','kind','facebook','setAccessToken','accessToken','user','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','api/facebook','Facebook\x20API','__importDefault','__esModule','defineProperty','ftp','setSequelize','render','API\x20Examples','syncFtp','log','connecting','default','connected','list','colombia','name','endsWith','json','sequelize'];(function(_0x1de7c8,_0x3d059b){var _0x5b6b44=function(_0x494fe9){while(--_0x494fe9){_0x1de7c8['push'](_0x1de7c8['shift']());}};_0x5b6b44(++_0x3d059b);}(a85_0x5b03,0x17e));var a85_0x9170=function(_0x3c4159,_0x224e76){_0x3c4159=_0x3c4159-0x0;var _0x39e262=a85_0x5b03[_0x3c4159];return _0x39e262;};'use strict';var __importDefault=this&&this[a85_0x9170('0x0')]||function(_0x1e8bef){return _0x1e8bef&&_0x1e8bef[a85_0x9170('0x1')]?_0x1e8bef:{'default':_0x1e8bef};};Object[a85_0x9170('0x2')](exports,'__esModule',{'value':!![]});const fbgraph_1=__importDefault(require('fbgraph'));const ftp_1=__importDefault(require(a85_0x9170('0x3')));const fs_1=__importDefault(require('fs'));function setSequelize(_0x7b517c){exports['sequelize']=_0x7b517c;}exports[a85_0x9170('0x4')]=setSequelize;exports['getApi']=(_0x3ba697,_0x1b477c)=>{_0x1b477c[a85_0x9170('0x5')]('api/index',{'title':a85_0x9170('0x6')});};exports[a85_0x9170('0x7')]=(_0x3e2fcf,_0x255697)=>{console[a85_0x9170('0x8')](a85_0x9170('0x9'));const _0x371e64=[];const _0xf3eb88=new ftp_1[(a85_0x9170('0xa'))]();_0xf3eb88['on']('ready',function(){console[a85_0x9170('0x8')](a85_0x9170('0xb'));_0xf3eb88[a85_0x9170('0xc')](a85_0x9170('0xd'),![],function(_0x1e64a3,_0x172690){if(_0x1e64a3){}else{for(const _0x412175 of _0x172690){console[a85_0x9170('0x8')]('Downloading:\x20'+_0x412175['name']);if(_0x412175[a85_0x9170('0xe')][a85_0x9170('0xf')](a85_0x9170('0x10'))){exports[a85_0x9170('0x11')]['models'][a85_0x9170('0x12')]['findOrCreate']({'where':{'fileName':_0x412175[a85_0x9170('0xe')]}})[a85_0x9170('0x13')]((_0x52ab32,_0x3ade2c)=>{if(_0x3ade2c){console[a85_0x9170('0x8')](_0x412175[a85_0x9170('0xe')]);_0x371e64[a85_0x9170('0x14')](_0x52ab32);}});}}}_0x255697[a85_0x9170('0x10')]({'data':_0x371e64});});});_0xf3eb88['on']('error',function(_0x539ab5){_0x255697[a85_0x9170('0x10')]({'message':_0x539ab5});});_0xf3eb88[a85_0x9170('0x15')]({'host':'ftp.vivotek.com','port':0x15,'user':'ipd','password':a85_0x9170('0x16')});};exports[a85_0x9170('0x17')]=(_0x2fefa9,_0x5efcbf)=>{exports[a85_0x9170('0x11')][a85_0x9170('0x18')]['reportFiles'][a85_0x9170('0x19')]({'where':{'status':null}})['then'](_0x25e86e=>{if(_0x25e86e){const _0x348117=new ftp_1[(a85_0x9170('0xa'))]();_0x348117['on']('ready',function(){console['log'](a85_0x9170('0x1a')+_0x25e86e[a85_0x9170('0x1b')]);_0x348117['get'](a85_0x9170('0x1c')+_0x25e86e[a85_0x9170('0x1b')],function(_0x315752,_0x6b28dd){_0x348117[a85_0x9170('0x1d')]();if(_0x315752){}else{const _0x5ac5ef=a85_0x9170('0x1e')+_0x25e86e[a85_0x9170('0x1b')]+'.txt';_0x6b28dd['pipe'](fs_1[a85_0x9170('0xa')][a85_0x9170('0x1f')](_0x5ac5ef));_0x25e86e[a85_0x9170('0x20')]=0x1;_0x25e86e[a85_0x9170('0x21')]();console[a85_0x9170('0x8')](a85_0x9170('0x22')+_0x25e86e[a85_0x9170('0x1b')]);}});});_0x348117['on'](a85_0x9170('0x23'),function(_0x55e38b){_0x5efcbf[a85_0x9170('0x10')]({'message':_0x55e38b});});_0x348117[a85_0x9170('0x15')]({'host':'ftp.vivotek.com','port':0x15,'user':a85_0x9170('0x16'),'password':a85_0x9170('0x16')});_0x5efcbf[a85_0x9170('0x10')]({'data':_0x25e86e[a85_0x9170('0x1b')]});}else{_0x5efcbf[a85_0x9170('0x10')]({'data':[]});}});};exports[a85_0x9170('0x24')]=(_0x2031f6,_0x270039)=>{exports[a85_0x9170('0x11')][a85_0x9170('0x18')]['reportFiles'][a85_0x9170('0x19')]({'where':{'status':0x1}})[a85_0x9170('0x25')](_0x23d1c6=>{if(_0x23d1c6){const _0x427ab4=a85_0x9170('0x1e')+_0x23d1c6['fileName']+a85_0x9170('0x26');fs_1[a85_0x9170('0xa')][a85_0x9170('0x27')](_0x427ab4,a85_0x9170('0x28'),function(_0x324c6a,_0x4c830a){if(_0x324c6a){_0x23d1c6[a85_0x9170('0x20')]=null;}else{try{const _0x5a7649=JSON[a85_0x9170('0x29')](_0x4c830a);for(const _0x3ddbdb of _0x5a7649['Data'][0x0][a85_0x9170('0x2a')]){const _0x10b8ff=_0x3ddbdb['In'];const _0x9dc957=_0x3ddbdb[a85_0x9170('0x2b')];const _0xcdc626=Date[a85_0x9170('0x29')](_0x3ddbdb['EndTime']);if(_0x10b8ff>0x0){exports['sequelize'][a85_0x9170('0x18')][a85_0x9170('0x2c')][a85_0x9170('0x2d')]({'reportFileId':_0x23d1c6['id'],'amount':_0x10b8ff,'countingDate':_0xcdc626});}if(_0x9dc957>0x0){exports['sequelize'][a85_0x9170('0x18')][a85_0x9170('0x2c')][a85_0x9170('0x2d')]({'reportFileId':_0x23d1c6['id'],'amount':_0x9dc957*-0x1,'countingDate':_0xcdc626});}}_0x23d1c6['status']=0x2;}catch(_0x2705d8){_0x23d1c6['status']=null;}}_0x23d1c6[a85_0x9170('0x21')]();});_0x270039[a85_0x9170('0x10')]({'data':_0x23d1c6['fileName']});}else{_0x270039[a85_0x9170('0x10')]({'data':[]});}});};exports[a85_0x9170('0x2e')]=(_0x13f4fc,_0x45b4c2)=>{exports[a85_0x9170('0x11')][a85_0x9170('0x18')][a85_0x9170('0x2c')][a85_0x9170('0x2f')]({'where':{'amount':{[exports[a85_0x9170('0x11')]['Op']['gt']]:0x0}},'order':[[a85_0x9170('0x30'),a85_0x9170('0x31')]]})[a85_0x9170('0x25')](_0x5ae0fe=>{_0x45b4c2[a85_0x9170('0x10')]({'data':_0x5ae0fe});});};exports[a85_0x9170('0x32')]=(_0x303a2d,_0x2085f4)=>{const _0x1601df=_0x303a2d[a85_0x9170('0x33')][a85_0x9170('0x34')];const _0x459547=_0x303a2d[a85_0x9170('0x33')]['startDate'];const _0x5b5984=_0x303a2d[a85_0x9170('0x33')][a85_0x9170('0x35')];exports[a85_0x9170('0x11')][a85_0x9170('0x18')][a85_0x9170('0x2c')][a85_0x9170('0x2f')]({'attributes':[a85_0x9170('0x30'),[exports[a85_0x9170('0x11')]['fn'](a85_0x9170('0x36'),exports[a85_0x9170('0x11')][a85_0x9170('0x37')]('amount')),a85_0x9170('0x38')]],'where':{'countingDate':{[exports[a85_0x9170('0x11')]['Op'][a85_0x9170('0x39')]]:_0x459547,[exports[a85_0x9170('0x11')]['Op']['lt']]:_0x5b5984},'amount':_0x303a2d[a85_0x9170('0x3a')]['direction']=='in'?{[exports[a85_0x9170('0x11')]['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports[a85_0x9170('0x11')][a85_0x9170('0x3b')](a85_0x9170('0x3c'))],'order':[[a85_0x9170('0x30'),a85_0x9170('0x31')]]})['then'](_0x3e5229=>{_0x2085f4[a85_0x9170('0x10')]({'data':_0x3e5229});});};exports[a85_0x9170('0x3d')]=(_0x516d64,_0x156966)=>{const _0x426167=_0x516d64['query'][a85_0x9170('0x34')];const _0x48eb42=_0x516d64['query']['startDate'];const _0x13c852=_0x516d64[a85_0x9170('0x33')][a85_0x9170('0x35')];exports['sequelize']['models'][a85_0x9170('0x2c')]['findAll']({'attributes':[a85_0x9170('0x30'),[exports['sequelize']['fn'](a85_0x9170('0x3e'),exports[a85_0x9170('0x11')]['col'](a85_0x9170('0x30')),a85_0x9170('0x3f')),a85_0x9170('0x40')],[exports[a85_0x9170('0x11')]['fn'](a85_0x9170('0x36'),exports['sequelize'][a85_0x9170('0x37')](a85_0x9170('0x41'))),a85_0x9170('0x38')]],'where':{'countingDate':{[exports[a85_0x9170('0x11')]['Op'][a85_0x9170('0x39')]]:_0x48eb42,[exports[a85_0x9170('0x11')]['Op']['lt']]:_0x13c852},'amount':_0x516d64[a85_0x9170('0x3a')][a85_0x9170('0x42')]=='in'?{[exports[a85_0x9170('0x11')]['Op']['gt']]:0x0}:{[exports[a85_0x9170('0x11')]['Op']['lt']]:0x0}},'group':[exports['sequelize']['fn'](a85_0x9170('0x43'),exports[a85_0x9170('0x11')][a85_0x9170('0x37')](a85_0x9170('0x30'))),exports[a85_0x9170('0x11')]['fn'](a85_0x9170('0x44'),exports[a85_0x9170('0x11')]['col'](a85_0x9170('0x30'))),exports[a85_0x9170('0x11')]['fn'](a85_0x9170('0x45'),exports[a85_0x9170('0x11')][a85_0x9170('0x37')](a85_0x9170('0x30'))),exports[a85_0x9170('0x11')]['fn']('YEAR',exports[a85_0x9170('0x11')][a85_0x9170('0x37')]('countingDate'))],'order':[[a85_0x9170('0x30'),a85_0x9170('0x31')]]})[a85_0x9170('0x25')](_0x4807ca=>{_0x156966[a85_0x9170('0x10')]({'data':_0x4807ca});});};exports[a85_0x9170('0x46')]=(_0x3b194d,_0x3a9105,_0x1a0105)=>{const _0x72f8ec=_0x3b194d['user']['tokens'][a85_0x9170('0x47')](_0x72f8ec=>_0x72f8ec[a85_0x9170('0x48')]===a85_0x9170('0x49'));fbgraph_1[a85_0x9170('0xa')][a85_0x9170('0x4a')](_0x72f8ec[a85_0x9170('0x4b')]);fbgraph_1['default']['get'](_0x3b194d[a85_0x9170('0x4c')]['facebook']+a85_0x9170('0x4d'),(_0x3a0b15,_0x168337)=>{if(_0x3a0b15){return _0x1a0105(_0x3a0b15);}_0x3a9105[a85_0x9170('0x5')](a85_0x9170('0x4e'),{'title':a85_0x9170('0x4f'),'profile':_0x168337});});};