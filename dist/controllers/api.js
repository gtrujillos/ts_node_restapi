var a98_0x2420=['__esModule','defineProperty','fbgraph','sequelize','getApi','render','api/index','API\x20Examples','syncFtp','log','connecting','default','ready','connected','colombia','Downloading:\x20','name','json','models','reportFiles','findOrCreate','spread','error','connect','ftp.vivotek.com','ipd','downloadFtp','findOne','then','fileName','get','colombia/','end','media/','pipe','status','save','Downloaded:\x20','processFtp','readFile','utf8','parse','Data','CountingInfo','Out','EndTime','passes','create','getPassCounting','findAll','countingDate','ASC','query','month','startDate','endDate','sum','amount','total','gte','params','literal','getPassCountingByHour','DATE_FORMAT','col','%Y-%m-%d\x20%H:00','countingDateShort','direction','HOUR','YEAR','user','kind','setAccessToken','accessToken','facebook','api/facebook','Facebook\x20API','__importDefault'];(function(_0x2377ca,_0x2f19d5){var _0x19abe2=function(_0x124990){while(--_0x124990){_0x2377ca['push'](_0x2377ca['shift']());}};_0x19abe2(++_0x2f19d5);}(a98_0x2420,0x1d3));var a98_0x16f3=function(_0x59a04e,_0x12eaa4){_0x59a04e=_0x59a04e-0x0;var _0x2c7095=a98_0x2420[_0x59a04e];return _0x2c7095;};'use strict';var __importDefault=this&&this[a98_0x16f3('0x0')]||function(_0xdfebd){return _0xdfebd&&_0xdfebd[a98_0x16f3('0x1')]?_0xdfebd:{'default':_0xdfebd};};Object[a98_0x16f3('0x2')](exports,a98_0x16f3('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a98_0x16f3('0x3')));const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));function setSequelize(_0x50a35b){exports[a98_0x16f3('0x4')]=_0x50a35b;}exports['setSequelize']=setSequelize;exports[a98_0x16f3('0x5')]=(_0x296f2a,_0x50377e)=>{_0x50377e[a98_0x16f3('0x6')](a98_0x16f3('0x7'),{'title':a98_0x16f3('0x8')});};exports[a98_0x16f3('0x9')]=(_0x4c9859,_0x68856c)=>{console[a98_0x16f3('0xa')](a98_0x16f3('0xb'));const _0x35c496=[];const _0x441e3b=new ftp_1[(a98_0x16f3('0xc'))]();_0x441e3b['on'](a98_0x16f3('0xd'),function(){console[a98_0x16f3('0xa')](a98_0x16f3('0xe'));_0x441e3b['list'](a98_0x16f3('0xf'),![],function(_0x41cba8,_0x5f9896){if(_0x41cba8){}else{for(const _0x490c1f of _0x5f9896){console[a98_0x16f3('0xa')](a98_0x16f3('0x10')+_0x490c1f[a98_0x16f3('0x11')]);if(_0x490c1f['name']['endsWith'](a98_0x16f3('0x12'))){exports[a98_0x16f3('0x4')][a98_0x16f3('0x13')][a98_0x16f3('0x14')][a98_0x16f3('0x15')]({'where':{'fileName':_0x490c1f[a98_0x16f3('0x11')]}})[a98_0x16f3('0x16')]((_0x398787,_0x2c0e4b)=>{if(_0x2c0e4b){console[a98_0x16f3('0xa')](_0x490c1f['name']);_0x35c496['push'](_0x398787);}});}}}_0x68856c[a98_0x16f3('0x12')]({'data':_0x35c496});});});_0x441e3b['on'](a98_0x16f3('0x17'),function(_0x111a31){_0x68856c[a98_0x16f3('0x12')]({'message':_0x111a31});});_0x441e3b[a98_0x16f3('0x18')]({'host':a98_0x16f3('0x19'),'port':0x15,'user':a98_0x16f3('0x1a'),'password':a98_0x16f3('0x1a')});};exports[a98_0x16f3('0x1b')]=(_0x5e5707,_0x720d84)=>{exports[a98_0x16f3('0x4')]['models'][a98_0x16f3('0x14')][a98_0x16f3('0x1c')]({'where':{'status':null}})[a98_0x16f3('0x1d')](_0x4cc720=>{if(_0x4cc720){const _0xa07dd1=new ftp_1[(a98_0x16f3('0xc'))]();_0xa07dd1['on']('ready',function(){console[a98_0x16f3('0xa')]('connected:'+_0x4cc720[a98_0x16f3('0x1e')]);_0xa07dd1[a98_0x16f3('0x1f')](a98_0x16f3('0x20')+_0x4cc720[a98_0x16f3('0x1e')],function(_0x39463c,_0x278981){_0xa07dd1[a98_0x16f3('0x21')]();if(_0x39463c){}else{const _0x367421=a98_0x16f3('0x22')+_0x4cc720[a98_0x16f3('0x1e')]+'.txt';_0x278981[a98_0x16f3('0x23')](fs_1[a98_0x16f3('0xc')]['createWriteStream'](_0x367421));_0x4cc720[a98_0x16f3('0x24')]=0x1;_0x4cc720[a98_0x16f3('0x25')]();console[a98_0x16f3('0xa')](a98_0x16f3('0x26')+_0x4cc720[a98_0x16f3('0x1e')]);}});});_0xa07dd1['on'](a98_0x16f3('0x17'),function(_0x360dbb){_0x720d84[a98_0x16f3('0x12')]({'message':_0x360dbb});});_0xa07dd1[a98_0x16f3('0x18')]({'host':a98_0x16f3('0x19'),'port':0x15,'user':a98_0x16f3('0x1a'),'password':a98_0x16f3('0x1a')});_0x720d84[a98_0x16f3('0x12')]({'data':_0x4cc720[a98_0x16f3('0x1e')]});}else{_0x720d84[a98_0x16f3('0x12')]({'data':[]});}});};exports[a98_0x16f3('0x27')]=(_0x55807e,_0x5caa46)=>{exports[a98_0x16f3('0x4')]['models']['reportFiles'][a98_0x16f3('0x1c')]({'where':{'status':0x1}})[a98_0x16f3('0x1d')](_0x323f0d=>{if(_0x323f0d){const _0x5e16be=a98_0x16f3('0x22')+_0x323f0d[a98_0x16f3('0x1e')]+'.txt';fs_1['default'][a98_0x16f3('0x28')](_0x5e16be,a98_0x16f3('0x29'),function(_0xfe61ea,_0x43db53){if(_0xfe61ea){_0x323f0d[a98_0x16f3('0x24')]=null;}else{try{const _0x2dcdc0=JSON[a98_0x16f3('0x2a')](_0x43db53);for(const _0x27122 of _0x2dcdc0[a98_0x16f3('0x2b')][0x0][a98_0x16f3('0x2c')]){const _0x472feb=_0x27122['In'];const _0x4152c6=_0x27122[a98_0x16f3('0x2d')];const _0x37deec=Date[a98_0x16f3('0x2a')](_0x27122[a98_0x16f3('0x2e')]);if(_0x472feb>0x0){exports[a98_0x16f3('0x4')][a98_0x16f3('0x13')][a98_0x16f3('0x2f')]['create']({'reportFileId':_0x323f0d['id'],'amount':_0x472feb,'countingDate':_0x37deec});}if(_0x4152c6>0x0){exports[a98_0x16f3('0x4')][a98_0x16f3('0x13')][a98_0x16f3('0x2f')][a98_0x16f3('0x30')]({'reportFileId':_0x323f0d['id'],'amount':_0x4152c6*-0x1,'countingDate':_0x37deec});}}_0x323f0d[a98_0x16f3('0x24')]=0x2;}catch(_0x343823){_0x323f0d['status']=null;}}_0x323f0d['save']();});_0x5caa46[a98_0x16f3('0x12')]({'data':_0x323f0d[a98_0x16f3('0x1e')]});}else{_0x5caa46[a98_0x16f3('0x12')]({'data':[]});}});};exports[a98_0x16f3('0x31')]=(_0x479aa0,_0x13a444)=>{exports['sequelize'][a98_0x16f3('0x13')][a98_0x16f3('0x2f')][a98_0x16f3('0x32')]({'where':{'amount':{[exports['sequelize']['Op']['gt']]:0x0}},'order':[[a98_0x16f3('0x33'),a98_0x16f3('0x34')]]})['then'](_0x18466a=>{_0x13a444[a98_0x16f3('0x12')]({'data':_0x18466a});});};exports['getPassCountingByDay']=(_0x49dfc6,_0x225c15)=>{const _0x1d22ce=_0x49dfc6[a98_0x16f3('0x35')][a98_0x16f3('0x36')];const _0x3ab8a3=_0x49dfc6[a98_0x16f3('0x35')][a98_0x16f3('0x37')];const _0x17d9b8=_0x49dfc6['query'][a98_0x16f3('0x38')];exports[a98_0x16f3('0x4')]['models'][a98_0x16f3('0x2f')][a98_0x16f3('0x32')]({'attributes':[a98_0x16f3('0x33'),[exports['sequelize']['fn'](a98_0x16f3('0x39'),exports['sequelize']['col'](a98_0x16f3('0x3a'))),a98_0x16f3('0x3b')]],'where':{'countingDate':{[exports[a98_0x16f3('0x4')]['Op'][a98_0x16f3('0x3c')]]:_0x3ab8a3,[exports[a98_0x16f3('0x4')]['Op']['lt']]:_0x17d9b8},'amount':_0x49dfc6[a98_0x16f3('0x3d')]['direction']=='in'?{[exports[a98_0x16f3('0x4')]['Op']['gt']]:0x0}:{[exports[a98_0x16f3('0x4')]['Op']['lt']]:0x0}},'group':[exports[a98_0x16f3('0x4')][a98_0x16f3('0x3e')]('YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))')],'order':[['countingDate',a98_0x16f3('0x34')]]})[a98_0x16f3('0x1d')](_0x12eef4=>{_0x225c15[a98_0x16f3('0x12')]({'data':_0x12eef4});});};exports[a98_0x16f3('0x3f')]=(_0x1de94d,_0x4c65b7)=>{const _0x47c37e=_0x1de94d['query'][a98_0x16f3('0x36')];const _0x483634=_0x1de94d['query'][a98_0x16f3('0x37')];const _0x565970=_0x1de94d['query'][a98_0x16f3('0x38')];exports[a98_0x16f3('0x4')][a98_0x16f3('0x13')][a98_0x16f3('0x2f')][a98_0x16f3('0x32')]({'attributes':[a98_0x16f3('0x33'),[exports[a98_0x16f3('0x4')]['fn'](a98_0x16f3('0x40'),exports[a98_0x16f3('0x4')][a98_0x16f3('0x41')](a98_0x16f3('0x33')),a98_0x16f3('0x42')),a98_0x16f3('0x43')],[exports[a98_0x16f3('0x4')]['fn'](a98_0x16f3('0x39'),exports[a98_0x16f3('0x4')][a98_0x16f3('0x41')](a98_0x16f3('0x3a'))),'total']],'where':{'countingDate':{[exports[a98_0x16f3('0x4')]['Op'][a98_0x16f3('0x3c')]]:_0x483634,[exports[a98_0x16f3('0x4')]['Op']['lt']]:_0x565970},'amount':_0x1de94d[a98_0x16f3('0x3d')][a98_0x16f3('0x44')]=='in'?{[exports[a98_0x16f3('0x4')]['Op']['gt']]:0x0}:{[exports[a98_0x16f3('0x4')]['Op']['lt']]:0x0}},'group':[exports[a98_0x16f3('0x4')]['fn'](a98_0x16f3('0x45'),exports[a98_0x16f3('0x4')]['col'](a98_0x16f3('0x33'))),exports['sequelize']['fn']('DAY',exports[a98_0x16f3('0x4')][a98_0x16f3('0x41')](a98_0x16f3('0x33'))),exports[a98_0x16f3('0x4')]['fn']('MONTH',exports[a98_0x16f3('0x4')]['col'](a98_0x16f3('0x33'))),exports[a98_0x16f3('0x4')]['fn'](a98_0x16f3('0x46'),exports[a98_0x16f3('0x4')][a98_0x16f3('0x41')](a98_0x16f3('0x33')))],'order':[[a98_0x16f3('0x33'),a98_0x16f3('0x34')]]})['then'](_0xcf0fd5=>{_0x4c65b7[a98_0x16f3('0x12')]({'data':_0xcf0fd5});});};exports['getFacebook']=(_0x5e631a,_0x35b63c,_0x2e8194)=>{const _0x31f9f1=_0x5e631a[a98_0x16f3('0x47')]['tokens']['find'](_0x31f9f1=>_0x31f9f1[a98_0x16f3('0x48')]==='facebook');fbgraph_1[a98_0x16f3('0xc')][a98_0x16f3('0x49')](_0x31f9f1[a98_0x16f3('0x4a')]);fbgraph_1[a98_0x16f3('0xc')][a98_0x16f3('0x1f')](_0x5e631a['user'][a98_0x16f3('0x4b')]+'?fields=id,name,email,first_name,last_name,gender,link,locale,timezone',(_0x498a95,_0x259782)=>{if(_0x498a95){return _0x2e8194(_0x498a95);}_0x35b63c[a98_0x16f3('0x6')](a98_0x16f3('0x4c'),{'title':a98_0x16f3('0x4d'),'profile':_0x259782});});};