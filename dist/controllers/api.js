var a198_0xb4f5=['col','amount','gte','params','direction','literal','total','HOUR','DAY','MONTH','YEAR','getFacebook','user','tokens','kind','facebook','setAccessToken','get','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','render','__importDefault','__esModule','defineProperty','fbgraph','ftp','sequelize','setSequelize','getApi','api/index','API\x20Examples','syncFtp','log','default','ready','connected','Downloading:\x20','name','endsWith','models','findOrCreate','spread','push','json','error','ftp.vivotek.com','ipd','reportFiles','then','connected:','fileName','colombia/','end','.txt','pipe','save','Downloaded:\x20','connect','findOne','media/','readFile','parse','Data','CountingInfo','Out','passes','create','status','getPassCounting','findAll','countingDate','ASC','getPassCountingByDay','query','month','startDate','endDate','sum'];(function(_0xc71e9a,_0xa6513b){var _0x50e288=function(_0xc45f7f){while(--_0xc45f7f){_0xc71e9a['push'](_0xc71e9a['shift']());}};_0x50e288(++_0xa6513b);}(a198_0xb4f5,0xae));var a198_0x4f21=function(_0x857c9b,_0xfc9438){_0x857c9b=_0x857c9b-0x0;var _0x47c500=a198_0xb4f5[_0x857c9b];return _0x47c500;};'use strict';var __importDefault=this&&this[a198_0x4f21('0x0')]||function(_0x437bc0){return _0x437bc0&&_0x437bc0[a198_0x4f21('0x1')]?_0x437bc0:{'default':_0x437bc0};};Object[a198_0x4f21('0x2')](exports,a198_0x4f21('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a198_0x4f21('0x3')));const ftp_1=__importDefault(require(a198_0x4f21('0x4')));const fs_1=__importDefault(require('fs'));function setSequelize(_0x57a8e9){exports[a198_0x4f21('0x5')]=_0x57a8e9;}exports[a198_0x4f21('0x6')]=setSequelize;exports[a198_0x4f21('0x7')]=(_0x837d10,_0x4d0fd0)=>{_0x4d0fd0['render'](a198_0x4f21('0x8'),{'title':a198_0x4f21('0x9')});};exports[a198_0x4f21('0xa')]=(_0x250b18,_0x56f483)=>{console[a198_0x4f21('0xb')]('connecting');const _0x3d68b5=[];const _0x3c9102=new ftp_1[(a198_0x4f21('0xc'))]();_0x3c9102['on'](a198_0x4f21('0xd'),function(){console['log'](a198_0x4f21('0xe'));_0x3c9102['list']('colombia',![],function(_0x133c05,_0x45805d){if(_0x133c05){}else{for(const _0x51ac7d of _0x45805d){console['log'](a198_0x4f21('0xf')+_0x51ac7d[a198_0x4f21('0x10')]);if(_0x51ac7d['name'][a198_0x4f21('0x11')]('json')){exports['sequelize'][a198_0x4f21('0x12')]['reportFiles'][a198_0x4f21('0x13')]({'where':{'fileName':_0x51ac7d['name']}})[a198_0x4f21('0x14')]((_0x5d21b3,_0x475e02)=>{if(_0x475e02){console[a198_0x4f21('0xb')](_0x51ac7d['name']);_0x3d68b5[a198_0x4f21('0x15')](_0x5d21b3);}});}}}_0x56f483[a198_0x4f21('0x16')]({'data':_0x3d68b5});});});_0x3c9102['on'](a198_0x4f21('0x17'),function(_0x2ea675){_0x56f483[a198_0x4f21('0x16')]({'message':_0x2ea675});});_0x3c9102['connect']({'host':a198_0x4f21('0x18'),'port':0x15,'user':a198_0x4f21('0x19'),'password':a198_0x4f21('0x19')});};exports['downloadFtp']=(_0x44ec6a,_0x277ba1)=>{exports[a198_0x4f21('0x5')][a198_0x4f21('0x12')][a198_0x4f21('0x1a')]['findOne']({'where':{'status':null}})[a198_0x4f21('0x1b')](_0x10a9b7=>{if(_0x10a9b7){const _0x13d516=new ftp_1[(a198_0x4f21('0xc'))]();_0x13d516['on'](a198_0x4f21('0xd'),function(){console['log'](a198_0x4f21('0x1c')+_0x10a9b7[a198_0x4f21('0x1d')]);_0x13d516['get'](a198_0x4f21('0x1e')+_0x10a9b7[a198_0x4f21('0x1d')],function(_0x1f5492,_0x41f170){_0x13d516[a198_0x4f21('0x1f')]();if(_0x1f5492){}else{const _0x5bcd9e='media/'+_0x10a9b7[a198_0x4f21('0x1d')]+a198_0x4f21('0x20');_0x41f170[a198_0x4f21('0x21')](fs_1[a198_0x4f21('0xc')]['createWriteStream'](_0x5bcd9e));_0x10a9b7['status']=0x1;_0x10a9b7[a198_0x4f21('0x22')]();console[a198_0x4f21('0xb')](a198_0x4f21('0x23')+_0x10a9b7[a198_0x4f21('0x1d')]);}});});_0x13d516['on']('error',function(_0x3e949b){_0x277ba1['json']({'message':_0x3e949b});});_0x13d516[a198_0x4f21('0x24')]({'host':a198_0x4f21('0x18'),'port':0x15,'user':'ipd','password':a198_0x4f21('0x19')});_0x277ba1['json']({'data':_0x10a9b7[a198_0x4f21('0x1d')]});}else{_0x277ba1[a198_0x4f21('0x16')]({'data':[]});}});};exports['processFtp']=(_0x5bf217,_0x1d01ef)=>{exports['sequelize'][a198_0x4f21('0x12')][a198_0x4f21('0x1a')][a198_0x4f21('0x25')]({'where':{'status':0x1}})[a198_0x4f21('0x1b')](_0x5165e3=>{if(_0x5165e3){const _0x8a6e0=a198_0x4f21('0x26')+_0x5165e3['fileName']+a198_0x4f21('0x20');fs_1[a198_0x4f21('0xc')][a198_0x4f21('0x27')](_0x8a6e0,'utf8',function(_0x39ac33,_0x7c3bfd){if(_0x39ac33){_0x5165e3['status']=null;}else{try{const _0x4a206d=JSON[a198_0x4f21('0x28')](_0x7c3bfd);for(const _0x1497dc of _0x4a206d[a198_0x4f21('0x29')][0x0][a198_0x4f21('0x2a')]){const _0x3de0c4=_0x1497dc['In'];const _0x5b4765=_0x1497dc[a198_0x4f21('0x2b')];const _0x232b44=Date[a198_0x4f21('0x28')](_0x1497dc['EndTime']);if(_0x3de0c4>0x0){exports[a198_0x4f21('0x5')][a198_0x4f21('0x12')]['passes']['create']({'reportFileId':_0x5165e3['id'],'amount':_0x3de0c4,'countingDate':_0x232b44});}if(_0x5b4765>0x0){exports[a198_0x4f21('0x5')][a198_0x4f21('0x12')][a198_0x4f21('0x2c')][a198_0x4f21('0x2d')]({'reportFileId':_0x5165e3['id'],'amount':_0x5b4765*-0x1,'countingDate':_0x232b44});}}_0x5165e3[a198_0x4f21('0x2e')]=0x2;}catch(_0x51c26f){_0x5165e3['status']=null;}}_0x5165e3[a198_0x4f21('0x22')]();});_0x1d01ef['json']({'data':_0x5165e3['fileName']});}else{_0x1d01ef[a198_0x4f21('0x16')]({'data':[]});}});};exports[a198_0x4f21('0x2f')]=(_0x11962a,_0x53635b)=>{exports[a198_0x4f21('0x5')][a198_0x4f21('0x12')][a198_0x4f21('0x2c')][a198_0x4f21('0x30')]({'where':{'amount':{[exports[a198_0x4f21('0x5')]['Op']['gt']]:0x0}},'order':[[a198_0x4f21('0x31'),a198_0x4f21('0x32')]]})['then'](_0x56d212=>{_0x53635b[a198_0x4f21('0x16')]({'data':_0x56d212});});};exports[a198_0x4f21('0x33')]=(_0x4a3d0b,_0x22d220)=>{const _0x448e5f=_0x4a3d0b[a198_0x4f21('0x34')][a198_0x4f21('0x35')];const _0x55f984=_0x4a3d0b[a198_0x4f21('0x34')][a198_0x4f21('0x36')];const _0x3f0f42=_0x4a3d0b[a198_0x4f21('0x34')][a198_0x4f21('0x37')];exports['sequelize'][a198_0x4f21('0x12')]['passes'][a198_0x4f21('0x30')]({'attributes':['countingDate',[exports[a198_0x4f21('0x5')]['fn'](a198_0x4f21('0x38'),exports[a198_0x4f21('0x5')][a198_0x4f21('0x39')](a198_0x4f21('0x3a'))),'total']],'where':{'countingDate':{[exports[a198_0x4f21('0x5')]['Op'][a198_0x4f21('0x3b')]]:_0x55f984,[exports['sequelize']['Op']['lt']]:_0x3f0f42},'amount':_0x4a3d0b[a198_0x4f21('0x3c')][a198_0x4f21('0x3d')]=='in'?{[exports[a198_0x4f21('0x5')]['Op']['gt']]:0x0}:{[exports[a198_0x4f21('0x5')]['Op']['lt']]:0x0}},'group':[exports[a198_0x4f21('0x5')][a198_0x4f21('0x3e')]('YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))')],'order':[['countingDate','ASC']]})['then'](_0x2bfc10=>{_0x22d220[a198_0x4f21('0x16')]({'data':_0x2bfc10});});};exports['getPassCountingByHour']=(_0x3ec330,_0x3e6d12)=>{const _0x5633f4=_0x3ec330[a198_0x4f21('0x34')]['month'];const _0x119419=_0x3ec330['query'][a198_0x4f21('0x36')];const _0x47263c=_0x3ec330['query'][a198_0x4f21('0x37')];exports[a198_0x4f21('0x5')][a198_0x4f21('0x12')][a198_0x4f21('0x2c')][a198_0x4f21('0x30')]({'attributes':[a198_0x4f21('0x31'),[exports['sequelize']['fn']('DATE_FORMAT',exports['sequelize']['col'](a198_0x4f21('0x31')),'%Y-%m-%d\x20%H:00'),'countingDateShort'],[exports[a198_0x4f21('0x5')]['fn'](a198_0x4f21('0x38'),exports['sequelize'][a198_0x4f21('0x39')](a198_0x4f21('0x3a'))),a198_0x4f21('0x3f')]],'where':{'countingDate':{[exports[a198_0x4f21('0x5')]['Op'][a198_0x4f21('0x3b')]]:_0x119419,[exports[a198_0x4f21('0x5')]['Op']['lt']]:_0x47263c},'amount':_0x3ec330[a198_0x4f21('0x3c')][a198_0x4f21('0x3d')]=='in'?{[exports[a198_0x4f21('0x5')]['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports[a198_0x4f21('0x5')]['fn'](a198_0x4f21('0x40'),exports[a198_0x4f21('0x5')][a198_0x4f21('0x39')](a198_0x4f21('0x31'))),exports[a198_0x4f21('0x5')]['fn'](a198_0x4f21('0x41'),exports[a198_0x4f21('0x5')]['col'](a198_0x4f21('0x31'))),exports['sequelize']['fn'](a198_0x4f21('0x42'),exports['sequelize'][a198_0x4f21('0x39')](a198_0x4f21('0x31'))),exports[a198_0x4f21('0x5')]['fn'](a198_0x4f21('0x43'),exports[a198_0x4f21('0x5')][a198_0x4f21('0x39')](a198_0x4f21('0x31')))],'order':[[a198_0x4f21('0x31'),a198_0x4f21('0x32')]]})[a198_0x4f21('0x1b')](_0x53db5e=>{_0x3e6d12['json']({'data':_0x53db5e});});};exports[a198_0x4f21('0x44')]=(_0x2d6c94,_0x4632ce,_0x37283c)=>{const _0x7bc6c7=_0x2d6c94[a198_0x4f21('0x45')][a198_0x4f21('0x46')]['find'](_0x7bc6c7=>_0x7bc6c7[a198_0x4f21('0x47')]===a198_0x4f21('0x48'));fbgraph_1[a198_0x4f21('0xc')][a198_0x4f21('0x49')](_0x7bc6c7['accessToken']);fbgraph_1[a198_0x4f21('0xc')][a198_0x4f21('0x4a')](_0x2d6c94[a198_0x4f21('0x45')]['facebook']+a198_0x4f21('0x4b'),(_0x130762,_0x392ac6)=>{if(_0x130762){return _0x37283c(_0x130762);}_0x4632ce[a198_0x4f21('0x4c')]('api/facebook',{'title':'Facebook\x20API','profile':_0x392ac6});});};