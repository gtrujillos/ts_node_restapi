var a92_0x163c=['total','gte','params','literal','%Y-%m-%d\x20%H:00','countingDateShort','direction','HOUR','DAY','MONTH','YEAR','getFacebook','tokens','find','kind','facebook','setAccessToken','accessToken','user','api/facebook','__esModule','fbgraph','ftp','setSequelize','getApi','render','api/index','API\x20Examples','log','connecting','default','ready','connected','colombia','name','endsWith','models','reportFiles','findOrCreate','spread','json','error','ftp.vivotek.com','ipd','downloadFtp','sequelize','findOne','connected:','fileName','colombia/','media/','.txt','pipe','createWriteStream','status','save','Downloaded:\x20','connect','processFtp','then','readFile','utf8','Data','CountingInfo','Out','parse','create','passes','findAll','ASC','getPassCountingByDay','query','endDate','countingDate','sum','col'];(function(_0xb67384,_0x27295a){var _0x156d7c=function(_0x52a1f8){while(--_0x52a1f8){_0xb67384['push'](_0xb67384['shift']());}};_0x156d7c(++_0x27295a);}(a92_0x163c,0xf8));var a92_0x34ec=function(_0x47d16f,_0x2bd596){_0x47d16f=_0x47d16f-0x0;var _0x21724c=a92_0x163c[_0x47d16f];return _0x21724c;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x3b5a9d){return _0x3b5a9d&&_0x3b5a9d[a92_0x34ec('0x0')]?_0x3b5a9d:{'default':_0x3b5a9d};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const fbgraph_1=__importDefault(require(a92_0x34ec('0x1')));const ftp_1=__importDefault(require(a92_0x34ec('0x2')));const fs_1=__importDefault(require('fs'));function setSequelize(_0x1a720b){exports['sequelize']=_0x1a720b;}exports[a92_0x34ec('0x3')]=setSequelize;exports[a92_0x34ec('0x4')]=(_0x18024d,_0x3563e9)=>{_0x3563e9[a92_0x34ec('0x5')](a92_0x34ec('0x6'),{'title':a92_0x34ec('0x7')});};exports['syncFtp']=(_0x369d7e,_0x1aba25)=>{console[a92_0x34ec('0x8')](a92_0x34ec('0x9'));const _0x460fc0=[];const _0x48f920=new ftp_1[(a92_0x34ec('0xa'))]();_0x48f920['on'](a92_0x34ec('0xb'),function(){console[a92_0x34ec('0x8')](a92_0x34ec('0xc'));_0x48f920['list'](a92_0x34ec('0xd'),![],function(_0xc11beb,_0x505bfd){if(_0xc11beb){}else{for(const _0x2affc3 of _0x505bfd){console[a92_0x34ec('0x8')]('Downloading:\x20'+_0x2affc3[a92_0x34ec('0xe')]);if(_0x2affc3[a92_0x34ec('0xe')][a92_0x34ec('0xf')]('json')){exports['sequelize'][a92_0x34ec('0x10')][a92_0x34ec('0x11')][a92_0x34ec('0x12')]({'where':{'fileName':_0x2affc3[a92_0x34ec('0xe')]}})[a92_0x34ec('0x13')]((_0xe229a7,_0x2ab7b1)=>{if(_0x2ab7b1){console['log'](_0x2affc3[a92_0x34ec('0xe')]);_0x460fc0['push'](_0xe229a7);}});}}}_0x1aba25[a92_0x34ec('0x14')]({'data':_0x460fc0});});});_0x48f920['on'](a92_0x34ec('0x15'),function(_0x3df8a2){_0x1aba25[a92_0x34ec('0x14')]({'message':_0x3df8a2});});_0x48f920['connect']({'host':a92_0x34ec('0x16'),'port':0x15,'user':'ipd','password':a92_0x34ec('0x17')});};exports[a92_0x34ec('0x18')]=(_0x11dc90,_0x256fe2)=>{exports[a92_0x34ec('0x19')][a92_0x34ec('0x10')][a92_0x34ec('0x11')][a92_0x34ec('0x1a')]({'where':{'status':null}})['then'](_0x5ed28b=>{if(_0x5ed28b){const _0x36c77d=new ftp_1[(a92_0x34ec('0xa'))]();_0x36c77d['on']('ready',function(){console[a92_0x34ec('0x8')](a92_0x34ec('0x1b')+_0x5ed28b[a92_0x34ec('0x1c')]);_0x36c77d['get'](a92_0x34ec('0x1d')+_0x5ed28b[a92_0x34ec('0x1c')],function(_0x15a397,_0x5de28a){_0x36c77d['end']();if(_0x15a397){}else{const _0x13af80=a92_0x34ec('0x1e')+_0x5ed28b[a92_0x34ec('0x1c')]+a92_0x34ec('0x1f');_0x5de28a[a92_0x34ec('0x20')](fs_1[a92_0x34ec('0xa')][a92_0x34ec('0x21')](_0x13af80));_0x5ed28b[a92_0x34ec('0x22')]=0x1;_0x5ed28b[a92_0x34ec('0x23')]();console[a92_0x34ec('0x8')](a92_0x34ec('0x24')+_0x5ed28b['fileName']);}});});_0x36c77d['on']('error',function(_0x2e4090){_0x256fe2[a92_0x34ec('0x14')]({'message':_0x2e4090});});_0x36c77d[a92_0x34ec('0x25')]({'host':a92_0x34ec('0x16'),'port':0x15,'user':a92_0x34ec('0x17'),'password':a92_0x34ec('0x17')});_0x256fe2['json']({'data':_0x5ed28b[a92_0x34ec('0x1c')]});}else{_0x256fe2['json']({'data':[]});}});};exports[a92_0x34ec('0x26')]=(_0x535f77,_0x4a2036)=>{exports[a92_0x34ec('0x19')][a92_0x34ec('0x10')][a92_0x34ec('0x11')][a92_0x34ec('0x1a')]({'where':{'status':0x1}})[a92_0x34ec('0x27')](_0x3c597a=>{if(_0x3c597a){const _0x486ad2=a92_0x34ec('0x1e')+_0x3c597a['fileName']+'.txt';fs_1['default'][a92_0x34ec('0x28')](_0x486ad2,a92_0x34ec('0x29'),function(_0x1be567,_0x467352){if(_0x1be567){_0x3c597a[a92_0x34ec('0x22')]=null;}else{try{const _0x1ea769=JSON['parse'](_0x467352);for(const _0x12f805 of _0x1ea769[a92_0x34ec('0x2a')][0x0][a92_0x34ec('0x2b')]){const _0x701c0d=_0x12f805['In'];const _0x91f54a=_0x12f805[a92_0x34ec('0x2c')];const _0x49c5a9=Date[a92_0x34ec('0x2d')](_0x12f805['EndTime']);if(_0x701c0d>0x0){exports[a92_0x34ec('0x19')][a92_0x34ec('0x10')]['passes'][a92_0x34ec('0x2e')]({'reportFileId':_0x3c597a['id'],'amount':_0x701c0d,'countingDate':_0x49c5a9});}if(_0x91f54a>0x0){exports['sequelize']['models'][a92_0x34ec('0x2f')]['create']({'reportFileId':_0x3c597a['id'],'amount':_0x91f54a*-0x1,'countingDate':_0x49c5a9});}}_0x3c597a[a92_0x34ec('0x22')]=0x2;}catch(_0x19c9c4){_0x3c597a[a92_0x34ec('0x22')]=null;}}_0x3c597a['save']();});_0x4a2036['json']({'data':_0x3c597a[a92_0x34ec('0x1c')]});}else{_0x4a2036['json']({'data':[]});}});};exports['getPassCounting']=(_0x29466a,_0x11631b)=>{exports['sequelize'][a92_0x34ec('0x10')][a92_0x34ec('0x2f')][a92_0x34ec('0x30')]({'where':{'amount':{[exports[a92_0x34ec('0x19')]['Op']['gt']]:0x0}},'order':[['countingDate',a92_0x34ec('0x31')]]})['then'](_0x464481=>{_0x11631b[a92_0x34ec('0x14')]({'data':_0x464481});});};exports[a92_0x34ec('0x32')]=(_0x4fda7d,_0x1badc1)=>{const _0x2e4712=_0x4fda7d['query']['month'];const _0x44faa9=_0x4fda7d['query']['startDate'];const _0x50919e=_0x4fda7d[a92_0x34ec('0x33')][a92_0x34ec('0x34')];exports[a92_0x34ec('0x19')][a92_0x34ec('0x10')][a92_0x34ec('0x2f')]['findAll']({'attributes':[a92_0x34ec('0x35'),[exports['sequelize']['fn'](a92_0x34ec('0x36'),exports[a92_0x34ec('0x19')][a92_0x34ec('0x37')]('amount')),a92_0x34ec('0x38')]],'where':{'countingDate':{[exports['sequelize']['Op'][a92_0x34ec('0x39')]]:_0x44faa9,[exports[a92_0x34ec('0x19')]['Op']['lt']]:_0x50919e},'amount':_0x4fda7d[a92_0x34ec('0x3a')]['direction']=='in'?{[exports[a92_0x34ec('0x19')]['Op']['gt']]:0x0}:{[exports[a92_0x34ec('0x19')]['Op']['lt']]:0x0}},'group':[exports[a92_0x34ec('0x19')][a92_0x34ec('0x3b')]('YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))')],'order':[[a92_0x34ec('0x35'),'ASC']]})['then'](_0x1e86a1=>{_0x1badc1[a92_0x34ec('0x14')]({'data':_0x1e86a1});});};exports['getPassCountingByHour']=(_0x1a4403,_0x4055ce)=>{const _0x1f6d67=_0x1a4403[a92_0x34ec('0x33')]['month'];const _0x3ba684=_0x1a4403['query']['startDate'];const _0x45fae9=_0x1a4403[a92_0x34ec('0x33')][a92_0x34ec('0x34')];exports[a92_0x34ec('0x19')][a92_0x34ec('0x10')][a92_0x34ec('0x2f')][a92_0x34ec('0x30')]({'attributes':[a92_0x34ec('0x35'),[exports[a92_0x34ec('0x19')]['fn']('DATE_FORMAT',exports[a92_0x34ec('0x19')]['col']('countingDate'),a92_0x34ec('0x3c')),a92_0x34ec('0x3d')],[exports[a92_0x34ec('0x19')]['fn']('sum',exports[a92_0x34ec('0x19')][a92_0x34ec('0x37')]('amount')),a92_0x34ec('0x38')]],'where':{'countingDate':{[exports[a92_0x34ec('0x19')]['Op']['gte']]:_0x3ba684,[exports[a92_0x34ec('0x19')]['Op']['lt']]:_0x45fae9},'amount':_0x1a4403[a92_0x34ec('0x3a')][a92_0x34ec('0x3e')]=='in'?{[exports[a92_0x34ec('0x19')]['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports['sequelize']['fn'](a92_0x34ec('0x3f'),exports[a92_0x34ec('0x19')][a92_0x34ec('0x37')](a92_0x34ec('0x35'))),exports['sequelize']['fn'](a92_0x34ec('0x40'),exports[a92_0x34ec('0x19')][a92_0x34ec('0x37')](a92_0x34ec('0x35'))),exports[a92_0x34ec('0x19')]['fn'](a92_0x34ec('0x41'),exports[a92_0x34ec('0x19')][a92_0x34ec('0x37')](a92_0x34ec('0x35'))),exports[a92_0x34ec('0x19')]['fn'](a92_0x34ec('0x42'),exports[a92_0x34ec('0x19')][a92_0x34ec('0x37')](a92_0x34ec('0x35')))],'order':[['countingDate','ASC']]})[a92_0x34ec('0x27')](_0xf3631f=>{_0x4055ce[a92_0x34ec('0x14')]({'data':_0xf3631f});});};exports[a92_0x34ec('0x43')]=(_0xe93512,_0x327373,_0x538791)=>{const _0x142d83=_0xe93512['user'][a92_0x34ec('0x44')][a92_0x34ec('0x45')](_0x142d83=>_0x142d83[a92_0x34ec('0x46')]===a92_0x34ec('0x47'));fbgraph_1[a92_0x34ec('0xa')][a92_0x34ec('0x48')](_0x142d83[a92_0x34ec('0x49')]);fbgraph_1[a92_0x34ec('0xa')]['get'](_0xe93512[a92_0x34ec('0x4a')]['facebook']+'?fields=id,name,email,first_name,last_name,gender,link,locale,timezone',(_0x17b0f8,_0x17f4e9)=>{if(_0x17b0f8){return _0x538791(_0x17b0f8);}_0x327373['render'](a92_0x34ec('0x4b'),{'title':'Facebook\x20API','profile':_0x17f4e9});});};