var a91_0x2fef=['models','reportFiles','spread','push','json','error','connect','ipd','downloadFtp','then','ready','connected:','fileName','get','colombia/','end','.txt','pipe','createWriteStream','status','save','Downloaded:\x20','ftp.vivotek.com','processFtp','media/','readFile','utf8','parse','Data','CountingInfo','Out','EndTime','passes','create','findAll','countingDate','ASC','getPassCountingByDay','startDate','endDate','sum','col','amount','gte','direction','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','query','countingDateShort','params','HOUR','DAY','MONTH','getFacebook','user','find','kind','facebook','setAccessToken','accessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','api/facebook','Facebook\x20API','__importDefault','__esModule','defineProperty','fbgraph','ftp','sequelize','setSequelize','getApi','render','api/index','log','connecting','default','connected','list','Downloading:\x20','endsWith'];(function(_0x48c81e,_0x47c4d5){var _0xa63aba=function(_0x1c495a){while(--_0x1c495a){_0x48c81e['push'](_0x48c81e['shift']());}};_0xa63aba(++_0x47c4d5);}(a91_0x2fef,0x8f));var a91_0x2129=function(_0x306bcb,_0x214fb0){_0x306bcb=_0x306bcb-0x0;var _0x296821=a91_0x2fef[_0x306bcb];return _0x296821;};'use strict';var __importDefault=this&&this[a91_0x2129('0x0')]||function(_0x5a96f9){return _0x5a96f9&&_0x5a96f9[a91_0x2129('0x1')]?_0x5a96f9:{'default':_0x5a96f9};};Object[a91_0x2129('0x2')](exports,a91_0x2129('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a91_0x2129('0x3')));const ftp_1=__importDefault(require(a91_0x2129('0x4')));const fs_1=__importDefault(require('fs'));function setSequelize(_0x4d0054){exports[a91_0x2129('0x5')]=_0x4d0054;}exports[a91_0x2129('0x6')]=setSequelize;exports[a91_0x2129('0x7')]=(_0x14948d,_0x3f09d4)=>{_0x3f09d4[a91_0x2129('0x8')](a91_0x2129('0x9'),{'title':'API\x20Examples'});};exports['syncFtp']=(_0x625a01,_0x1783dc)=>{console[a91_0x2129('0xa')](a91_0x2129('0xb'));const _0x1733a3=[];const _0x492f3e=new ftp_1[(a91_0x2129('0xc'))]();_0x492f3e['on']('ready',function(){console[a91_0x2129('0xa')](a91_0x2129('0xd'));_0x492f3e[a91_0x2129('0xe')]('colombia',![],function(_0x2fa061,_0x1e5b55){if(_0x2fa061){}else{for(const _0xcb7608 of _0x1e5b55){console['log'](a91_0x2129('0xf')+_0xcb7608['name']);if(_0xcb7608['name'][a91_0x2129('0x10')]('json')){exports[a91_0x2129('0x5')][a91_0x2129('0x11')][a91_0x2129('0x12')]['findOrCreate']({'where':{'fileName':_0xcb7608['name']}})[a91_0x2129('0x13')]((_0x503c5a,_0x47c626)=>{if(_0x47c626){console['log'](_0xcb7608['name']);_0x1733a3[a91_0x2129('0x14')](_0x503c5a);}});}}}_0x1783dc[a91_0x2129('0x15')]({'data':_0x1733a3});});});_0x492f3e['on'](a91_0x2129('0x16'),function(_0x11e0ff){_0x1783dc[a91_0x2129('0x15')]({'message':_0x11e0ff});});_0x492f3e[a91_0x2129('0x17')]({'host':'ftp.vivotek.com','port':0x15,'user':'ipd','password':a91_0x2129('0x18')});};exports[a91_0x2129('0x19')]=(_0x85ab18,_0x2e0277)=>{exports['sequelize'][a91_0x2129('0x11')][a91_0x2129('0x12')]['findOne']({'where':{'status':null}})[a91_0x2129('0x1a')](_0x3f0545=>{if(_0x3f0545){const _0xe40469=new ftp_1[(a91_0x2129('0xc'))]();_0xe40469['on'](a91_0x2129('0x1b'),function(){console[a91_0x2129('0xa')](a91_0x2129('0x1c')+_0x3f0545[a91_0x2129('0x1d')]);_0xe40469[a91_0x2129('0x1e')](a91_0x2129('0x1f')+_0x3f0545['fileName'],function(_0x4c74bc,_0x38edfa){_0xe40469[a91_0x2129('0x20')]();if(_0x4c74bc){}else{const _0x439744='media/'+_0x3f0545['fileName']+a91_0x2129('0x21');_0x38edfa[a91_0x2129('0x22')](fs_1[a91_0x2129('0xc')][a91_0x2129('0x23')](_0x439744));_0x3f0545[a91_0x2129('0x24')]=0x1;_0x3f0545[a91_0x2129('0x25')]();console[a91_0x2129('0xa')](a91_0x2129('0x26')+_0x3f0545[a91_0x2129('0x1d')]);}});});_0xe40469['on'](a91_0x2129('0x16'),function(_0xb44123){_0x2e0277['json']({'message':_0xb44123});});_0xe40469['connect']({'host':a91_0x2129('0x27'),'port':0x15,'user':a91_0x2129('0x18'),'password':a91_0x2129('0x18')});_0x2e0277[a91_0x2129('0x15')]({'data':_0x3f0545[a91_0x2129('0x1d')]});}else{_0x2e0277[a91_0x2129('0x15')]({'data':[]});}});};exports[a91_0x2129('0x28')]=(_0x52c7e1,_0xc7a427)=>{exports['sequelize'][a91_0x2129('0x11')]['reportFiles']['findOne']({'where':{'status':0x1}})[a91_0x2129('0x1a')](_0x5056f7=>{if(_0x5056f7){const _0x120210=a91_0x2129('0x29')+_0x5056f7['fileName']+'.txt';fs_1[a91_0x2129('0xc')][a91_0x2129('0x2a')](_0x120210,a91_0x2129('0x2b'),function(_0x19f352,_0x1b48e6){if(_0x19f352){_0x5056f7['status']=null;}else{try{const _0xb41cc2=JSON[a91_0x2129('0x2c')](_0x1b48e6);for(const _0x5af9da of _0xb41cc2[a91_0x2129('0x2d')][0x0][a91_0x2129('0x2e')]){const _0x5e7a11=_0x5af9da['In'];const _0x58c8f3=_0x5af9da[a91_0x2129('0x2f')];const _0x5ad845=Date[a91_0x2129('0x2c')](_0x5af9da[a91_0x2129('0x30')]);if(_0x5e7a11>0x0){exports[a91_0x2129('0x5')][a91_0x2129('0x11')][a91_0x2129('0x31')]['create']({'reportFileId':_0x5056f7['id'],'amount':_0x5e7a11,'countingDate':_0x5ad845});}if(_0x58c8f3>0x0){exports[a91_0x2129('0x5')][a91_0x2129('0x11')][a91_0x2129('0x31')][a91_0x2129('0x32')]({'reportFileId':_0x5056f7['id'],'amount':_0x58c8f3*-0x1,'countingDate':_0x5ad845});}}_0x5056f7['status']=0x2;}catch(_0x360126){_0x5056f7[a91_0x2129('0x24')]=null;}}_0x5056f7[a91_0x2129('0x25')]();});_0xc7a427[a91_0x2129('0x15')]({'data':_0x5056f7[a91_0x2129('0x1d')]});}else{_0xc7a427[a91_0x2129('0x15')]({'data':[]});}});};exports['getPassCounting']=(_0x3e053f,_0x186195)=>{exports[a91_0x2129('0x5')][a91_0x2129('0x11')][a91_0x2129('0x31')][a91_0x2129('0x33')]({'where':{'amount':{[exports['sequelize']['Op']['gt']]:0x0}},'order':[[a91_0x2129('0x34'),a91_0x2129('0x35')]]})[a91_0x2129('0x1a')](_0x22ce06=>{_0x186195[a91_0x2129('0x15')]({'data':_0x22ce06});});};exports[a91_0x2129('0x36')]=(_0x3408d4,_0x2e7a20)=>{const _0x138d12=_0x3408d4['query']['month'];const _0x5a66d0=_0x3408d4['query'][a91_0x2129('0x37')];const _0x1822d2=_0x3408d4['query'][a91_0x2129('0x38')];exports[a91_0x2129('0x5')][a91_0x2129('0x11')][a91_0x2129('0x31')][a91_0x2129('0x33')]({'attributes':[a91_0x2129('0x34'),[exports[a91_0x2129('0x5')]['fn'](a91_0x2129('0x39'),exports['sequelize'][a91_0x2129('0x3a')](a91_0x2129('0x3b'))),'total']],'where':{'countingDate':{[exports['sequelize']['Op'][a91_0x2129('0x3c')]]:_0x5a66d0,[exports[a91_0x2129('0x5')]['Op']['lt']]:_0x1822d2},'amount':_0x3408d4['params'][a91_0x2129('0x3d')]=='in'?{[exports[a91_0x2129('0x5')]['Op']['gt']]:0x0}:{[exports[a91_0x2129('0x5')]['Op']['lt']]:0x0}},'group':[exports[a91_0x2129('0x5')]['literal'](a91_0x2129('0x3e'))],'order':[[a91_0x2129('0x34'),a91_0x2129('0x35')]]})[a91_0x2129('0x1a')](_0x2090e7=>{_0x2e7a20[a91_0x2129('0x15')]({'data':_0x2090e7});});};exports[a91_0x2129('0x3f')]=(_0x4e7e7a,_0x4a1933)=>{const _0x28205a=_0x4e7e7a[a91_0x2129('0x40')]['month'];const _0x2df957=_0x4e7e7a['query'][a91_0x2129('0x37')];const _0x1d94f3=_0x4e7e7a[a91_0x2129('0x40')]['endDate'];exports[a91_0x2129('0x5')][a91_0x2129('0x11')][a91_0x2129('0x31')][a91_0x2129('0x33')]({'attributes':[a91_0x2129('0x34'),[exports[a91_0x2129('0x5')]['fn']('DATE_FORMAT',exports[a91_0x2129('0x5')]['col'](a91_0x2129('0x34')),'%Y-%m-%d\x20%H:00'),a91_0x2129('0x41')],[exports[a91_0x2129('0x5')]['fn'](a91_0x2129('0x39'),exports['sequelize'][a91_0x2129('0x3a')](a91_0x2129('0x3b'))),'total']],'where':{'countingDate':{[exports[a91_0x2129('0x5')]['Op'][a91_0x2129('0x3c')]]:_0x2df957,[exports[a91_0x2129('0x5')]['Op']['lt']]:_0x1d94f3},'amount':_0x4e7e7a[a91_0x2129('0x42')][a91_0x2129('0x3d')]=='in'?{[exports[a91_0x2129('0x5')]['Op']['gt']]:0x0}:{[exports[a91_0x2129('0x5')]['Op']['lt']]:0x0}},'group':[exports[a91_0x2129('0x5')]['fn'](a91_0x2129('0x43'),exports[a91_0x2129('0x5')][a91_0x2129('0x3a')](a91_0x2129('0x34'))),exports[a91_0x2129('0x5')]['fn'](a91_0x2129('0x44'),exports[a91_0x2129('0x5')][a91_0x2129('0x3a')](a91_0x2129('0x34'))),exports[a91_0x2129('0x5')]['fn'](a91_0x2129('0x45'),exports[a91_0x2129('0x5')]['col'](a91_0x2129('0x34'))),exports[a91_0x2129('0x5')]['fn']('YEAR',exports[a91_0x2129('0x5')][a91_0x2129('0x3a')](a91_0x2129('0x34')))],'order':[[a91_0x2129('0x34'),'ASC']]})[a91_0x2129('0x1a')](_0x38e823=>{_0x4a1933['json']({'data':_0x38e823});});};exports[a91_0x2129('0x46')]=(_0x242909,_0x5c72d2,_0x34a081)=>{const _0x51dfb7=_0x242909[a91_0x2129('0x47')]['tokens'][a91_0x2129('0x48')](_0x51dfb7=>_0x51dfb7[a91_0x2129('0x49')]===a91_0x2129('0x4a'));fbgraph_1[a91_0x2129('0xc')][a91_0x2129('0x4b')](_0x51dfb7[a91_0x2129('0x4c')]);fbgraph_1['default'][a91_0x2129('0x1e')](_0x242909[a91_0x2129('0x47')][a91_0x2129('0x4a')]+a91_0x2129('0x4d'),(_0x21ec0c,_0x108623)=>{if(_0x21ec0c){return _0x34a081(_0x21ec0c);}_0x5c72d2[a91_0x2129('0x8')](a91_0x2129('0x4e'),{'title':a91_0x2129('0x4f'),'profile':_0x108623});});};