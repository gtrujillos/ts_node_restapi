var a92_0x2553=['tokens','find','facebook','setAccessToken','accessToken','__esModule','defineProperty','ftp','sequelize','setSequelize','render','api/index','log','default','ready','connected','Downloading:\x20','name','endsWith','json','models','reportFiles','push','error','connect','ipd','downloadFtp','findOne','then','connected:','fileName','colombia/','end','.txt','pipe','createWriteStream','status','save','ftp.vivotek.com','processFtp','utf8','parse','Data','CountingInfo','Out','EndTime','passes','create','findAll','countingDate','ASC','query','month','startDate','endDate','sum','amount','total','gte','params','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','DATE_FORMAT','%Y-%m-%d\x20%H:00','countingDateShort','col','direction','HOUR','DAY','MONTH','getFacebook','user'];(function(_0x50b883,_0x29198d){var _0x596409=function(_0x8bb148){while(--_0x8bb148){_0x50b883['push'](_0x50b883['shift']());}};_0x596409(++_0x29198d);}(a92_0x2553,0x1af));var a92_0x3e6f=function(_0x146703,_0x6ccae1){_0x146703=_0x146703-0x0;var _0x3499a1=a92_0x2553[_0x146703];return _0x3499a1;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x4a6f40){return _0x4a6f40&&_0x4a6f40[a92_0x3e6f('0x0')]?_0x4a6f40:{'default':_0x4a6f40};};Object[a92_0x3e6f('0x1')](exports,a92_0x3e6f('0x0'),{'value':!![]});const fbgraph_1=__importDefault(require('fbgraph'));const ftp_1=__importDefault(require(a92_0x3e6f('0x2')));const fs_1=__importDefault(require('fs'));function setSequelize(_0x4748cf){exports[a92_0x3e6f('0x3')]=_0x4748cf;}exports[a92_0x3e6f('0x4')]=setSequelize;exports['getApi']=(_0xfe8009,_0x24fcb4)=>{_0x24fcb4[a92_0x3e6f('0x5')](a92_0x3e6f('0x6'),{'title':'API\x20Examples'});};exports['syncFtp']=(_0x232bd0,_0x295dec)=>{console[a92_0x3e6f('0x7')]('connecting');const _0x499bec=[];const _0x34b4c3=new ftp_1[(a92_0x3e6f('0x8'))]();_0x34b4c3['on'](a92_0x3e6f('0x9'),function(){console['log'](a92_0x3e6f('0xa'));_0x34b4c3['list']('colombia',![],function(_0x45485a,_0x317b09){if(_0x45485a){}else{for(const _0x53da80 of _0x317b09){console['log'](a92_0x3e6f('0xb')+_0x53da80[a92_0x3e6f('0xc')]);if(_0x53da80[a92_0x3e6f('0xc')][a92_0x3e6f('0xd')](a92_0x3e6f('0xe'))){exports['sequelize'][a92_0x3e6f('0xf')][a92_0x3e6f('0x10')]['findOrCreate']({'where':{'fileName':_0x53da80[a92_0x3e6f('0xc')]}})['spread']((_0x20c66c,_0x25496d)=>{if(_0x25496d){console[a92_0x3e6f('0x7')](_0x53da80['name']);_0x499bec[a92_0x3e6f('0x11')](_0x20c66c);}});}}}_0x295dec[a92_0x3e6f('0xe')]({'data':_0x499bec});});});_0x34b4c3['on'](a92_0x3e6f('0x12'),function(_0x17d85e){_0x295dec['json']({'message':_0x17d85e});});_0x34b4c3[a92_0x3e6f('0x13')]({'host':'ftp.vivotek.com','port':0x15,'user':'ipd','password':a92_0x3e6f('0x14')});};exports[a92_0x3e6f('0x15')]=(_0x5cf666,_0x2edef4)=>{exports[a92_0x3e6f('0x3')][a92_0x3e6f('0xf')][a92_0x3e6f('0x10')][a92_0x3e6f('0x16')]({'where':{'status':null}})[a92_0x3e6f('0x17')](_0x51ca8c=>{if(_0x51ca8c){const _0x4b7199=new ftp_1[(a92_0x3e6f('0x8'))]();_0x4b7199['on'](a92_0x3e6f('0x9'),function(){console[a92_0x3e6f('0x7')](a92_0x3e6f('0x18')+_0x51ca8c[a92_0x3e6f('0x19')]);_0x4b7199['get'](a92_0x3e6f('0x1a')+_0x51ca8c['fileName'],function(_0x2cde14,_0x44cc8a){_0x4b7199[a92_0x3e6f('0x1b')]();if(_0x2cde14){}else{const _0x4d706e='media/'+_0x51ca8c[a92_0x3e6f('0x19')]+a92_0x3e6f('0x1c');_0x44cc8a[a92_0x3e6f('0x1d')](fs_1['default'][a92_0x3e6f('0x1e')](_0x4d706e));_0x51ca8c[a92_0x3e6f('0x1f')]=0x1;_0x51ca8c[a92_0x3e6f('0x20')]();console['log']('Downloaded:\x20'+_0x51ca8c[a92_0x3e6f('0x19')]);}});});_0x4b7199['on']('error',function(_0x499701){_0x2edef4[a92_0x3e6f('0xe')]({'message':_0x499701});});_0x4b7199[a92_0x3e6f('0x13')]({'host':a92_0x3e6f('0x21'),'port':0x15,'user':a92_0x3e6f('0x14'),'password':'ipd'});_0x2edef4[a92_0x3e6f('0xe')]({'data':_0x51ca8c[a92_0x3e6f('0x19')]});}else{_0x2edef4[a92_0x3e6f('0xe')]({'data':[]});}});};exports[a92_0x3e6f('0x22')]=(_0x15cf25,_0x2eec15)=>{exports[a92_0x3e6f('0x3')][a92_0x3e6f('0xf')][a92_0x3e6f('0x10')][a92_0x3e6f('0x16')]({'where':{'status':0x1}})['then'](_0x20a78f=>{if(_0x20a78f){const _0x2618b8='media/'+_0x20a78f[a92_0x3e6f('0x19')]+'.txt';fs_1[a92_0x3e6f('0x8')]['readFile'](_0x2618b8,a92_0x3e6f('0x23'),function(_0x58f7e0,_0x3a7322){if(_0x58f7e0){_0x20a78f[a92_0x3e6f('0x1f')]=null;}else{try{const _0x4338ed=JSON[a92_0x3e6f('0x24')](_0x3a7322);for(const _0x16da5f of _0x4338ed[a92_0x3e6f('0x25')][0x0][a92_0x3e6f('0x26')]){const _0x3770dc=_0x16da5f['In'];const _0x235171=_0x16da5f[a92_0x3e6f('0x27')];const _0xe864f4=Date[a92_0x3e6f('0x24')](_0x16da5f[a92_0x3e6f('0x28')]);if(_0x3770dc>0x0){exports['sequelize'][a92_0x3e6f('0xf')][a92_0x3e6f('0x29')][a92_0x3e6f('0x2a')]({'reportFileId':_0x20a78f['id'],'amount':_0x3770dc,'countingDate':_0xe864f4});}if(_0x235171>0x0){exports[a92_0x3e6f('0x3')][a92_0x3e6f('0xf')][a92_0x3e6f('0x29')][a92_0x3e6f('0x2a')]({'reportFileId':_0x20a78f['id'],'amount':_0x235171*-0x1,'countingDate':_0xe864f4});}}_0x20a78f[a92_0x3e6f('0x1f')]=0x2;}catch(_0x3e32dd){_0x20a78f['status']=null;}}_0x20a78f[a92_0x3e6f('0x20')]();});_0x2eec15[a92_0x3e6f('0xe')]({'data':_0x20a78f[a92_0x3e6f('0x19')]});}else{_0x2eec15[a92_0x3e6f('0xe')]({'data':[]});}});};exports['getPassCounting']=(_0x36b91c,_0x24a53d)=>{exports['sequelize'][a92_0x3e6f('0xf')][a92_0x3e6f('0x29')][a92_0x3e6f('0x2b')]({'where':{'amount':{[exports[a92_0x3e6f('0x3')]['Op']['gt']]:0x0}},'order':[[a92_0x3e6f('0x2c'),a92_0x3e6f('0x2d')]]})[a92_0x3e6f('0x17')](_0x273c92=>{_0x24a53d[a92_0x3e6f('0xe')]({'data':_0x273c92});});};exports['getPassCountingByDay']=(_0x557056,_0x484148)=>{const _0x2d4ea4=_0x557056[a92_0x3e6f('0x2e')][a92_0x3e6f('0x2f')];const _0x449f5d=_0x557056[a92_0x3e6f('0x2e')][a92_0x3e6f('0x30')];const _0x2b6041=_0x557056[a92_0x3e6f('0x2e')][a92_0x3e6f('0x31')];exports[a92_0x3e6f('0x3')][a92_0x3e6f('0xf')][a92_0x3e6f('0x29')][a92_0x3e6f('0x2b')]({'attributes':[a92_0x3e6f('0x2c'),[exports['sequelize']['fn'](a92_0x3e6f('0x32'),exports['sequelize']['col'](a92_0x3e6f('0x33'))),a92_0x3e6f('0x34')]],'where':{'countingDate':{[exports[a92_0x3e6f('0x3')]['Op'][a92_0x3e6f('0x35')]]:_0x449f5d,[exports[a92_0x3e6f('0x3')]['Op']['lt']]:_0x2b6041},'amount':_0x557056[a92_0x3e6f('0x36')]['direction']=='in'?{[exports[a92_0x3e6f('0x3')]['Op']['gt']]:0x0}:{[exports[a92_0x3e6f('0x3')]['Op']['lt']]:0x0}},'group':[exports[a92_0x3e6f('0x3')]['literal'](a92_0x3e6f('0x37'))],'order':[[a92_0x3e6f('0x2c'),'ASC']]})[a92_0x3e6f('0x17')](_0x25381a=>{_0x484148[a92_0x3e6f('0xe')]({'data':_0x25381a});});};exports['getPassCountingByHour']=(_0xb1ce98,_0x1d14fd)=>{const _0x1d839d=_0xb1ce98[a92_0x3e6f('0x2e')]['month'];const _0x5926a2=_0xb1ce98[a92_0x3e6f('0x2e')][a92_0x3e6f('0x30')];const _0x137203=_0xb1ce98[a92_0x3e6f('0x2e')][a92_0x3e6f('0x31')];exports[a92_0x3e6f('0x3')][a92_0x3e6f('0xf')][a92_0x3e6f('0x29')][a92_0x3e6f('0x2b')]({'attributes':['countingDate',[exports[a92_0x3e6f('0x3')]['fn'](a92_0x3e6f('0x38'),exports['sequelize']['col']('countingDate'),a92_0x3e6f('0x39')),a92_0x3e6f('0x3a')],[exports[a92_0x3e6f('0x3')]['fn'](a92_0x3e6f('0x32'),exports[a92_0x3e6f('0x3')][a92_0x3e6f('0x3b')](a92_0x3e6f('0x33'))),a92_0x3e6f('0x34')]],'where':{'countingDate':{[exports[a92_0x3e6f('0x3')]['Op'][a92_0x3e6f('0x35')]]:_0x5926a2,[exports['sequelize']['Op']['lt']]:_0x137203},'amount':_0xb1ce98[a92_0x3e6f('0x36')][a92_0x3e6f('0x3c')]=='in'?{[exports[a92_0x3e6f('0x3')]['Op']['gt']]:0x0}:{[exports[a92_0x3e6f('0x3')]['Op']['lt']]:0x0}},'group':[exports[a92_0x3e6f('0x3')]['fn'](a92_0x3e6f('0x3d'),exports[a92_0x3e6f('0x3')][a92_0x3e6f('0x3b')]('countingDate')),exports[a92_0x3e6f('0x3')]['fn'](a92_0x3e6f('0x3e'),exports[a92_0x3e6f('0x3')]['col'](a92_0x3e6f('0x2c'))),exports[a92_0x3e6f('0x3')]['fn'](a92_0x3e6f('0x3f'),exports[a92_0x3e6f('0x3')][a92_0x3e6f('0x3b')](a92_0x3e6f('0x2c'))),exports[a92_0x3e6f('0x3')]['fn']('YEAR',exports['sequelize'][a92_0x3e6f('0x3b')](a92_0x3e6f('0x2c')))],'order':[[a92_0x3e6f('0x2c'),a92_0x3e6f('0x2d')]]})[a92_0x3e6f('0x17')](_0x108052=>{_0x1d14fd['json']({'data':_0x108052});});};exports[a92_0x3e6f('0x40')]=(_0x2bf0a1,_0x4a1019,_0x559874)=>{const _0x1a5e53=_0x2bf0a1[a92_0x3e6f('0x41')][a92_0x3e6f('0x42')][a92_0x3e6f('0x43')](_0x1a5e53=>_0x1a5e53['kind']===a92_0x3e6f('0x44'));fbgraph_1[a92_0x3e6f('0x8')][a92_0x3e6f('0x45')](_0x1a5e53[a92_0x3e6f('0x46')]);fbgraph_1[a92_0x3e6f('0x8')]['get'](_0x2bf0a1['user'][a92_0x3e6f('0x44')]+'?fields=id,name,email,first_name,last_name,gender,link,locale,timezone',(_0x328608,_0x17898d)=>{if(_0x328608){return _0x559874(_0x328608);}_0x4a1019[a92_0x3e6f('0x5')]('api/facebook',{'title':'Facebook\x20API','profile':_0x17898d});});};