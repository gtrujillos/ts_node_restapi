var a92_0x300a=['reportFiles','findOrCreate','spread','push','connect','ipd','then','default','connected:','get','colombia/','end','media/','fileName','.txt','createWriteStream','save','Downloaded:\x20','error','ftp.vivotek.com','findOne','readFile','utf8','Data','CountingInfo','Out','parse','EndTime','passes','create','status','getPassCounting','countingDate','ASC','getPassCountingByDay','month','query','startDate','findAll','col','amount','total','gte','params','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','endDate','DATE_FORMAT','%Y-%m-%d\x20%H:00','countingDateShort','sum','direction','YEAR','user','tokens','kind','facebook','setAccessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','Facebook\x20API','__importDefault','__esModule','fbgraph','ftp','sequelize','render','API\x20Examples','log','connecting','ready','connected','list','colombia','Downloading:\x20','name','endsWith','json','models'];(function(_0xfbcd36,_0x31edc1){var _0x39b764=function(_0x151e98){while(--_0x151e98){_0xfbcd36['push'](_0xfbcd36['shift']());}};_0x39b764(++_0x31edc1);}(a92_0x300a,0x174));var a92_0x3597=function(_0x59aa3b,_0x1a5f0c){_0x59aa3b=_0x59aa3b-0x0;var _0x380ffe=a92_0x300a[_0x59aa3b];return _0x380ffe;};'use strict';var __importDefault=this&&this[a92_0x3597('0x0')]||function(_0xee40a9){return _0xee40a9&&_0xee40a9[a92_0x3597('0x1')]?_0xee40a9:{'default':_0xee40a9};};Object['defineProperty'](exports,a92_0x3597('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a92_0x3597('0x2')));const ftp_1=__importDefault(require(a92_0x3597('0x3')));const fs_1=__importDefault(require('fs'));function setSequelize(_0x318c57){exports[a92_0x3597('0x4')]=_0x318c57;}exports['setSequelize']=setSequelize;exports['getApi']=(_0x5cc550,_0xa3f35b)=>{_0xa3f35b[a92_0x3597('0x5')]('api/index',{'title':a92_0x3597('0x6')});};exports['syncFtp']=(_0x15a835,_0x3f5043)=>{console[a92_0x3597('0x7')](a92_0x3597('0x8'));const _0x1daf01=[];const _0x782344=new ftp_1['default']();_0x782344['on'](a92_0x3597('0x9'),function(){console[a92_0x3597('0x7')](a92_0x3597('0xa'));_0x782344[a92_0x3597('0xb')](a92_0x3597('0xc'),![],function(_0xc248ac,_0x721675){if(_0xc248ac){}else{for(const _0xaa070d of _0x721675){console[a92_0x3597('0x7')](a92_0x3597('0xd')+_0xaa070d[a92_0x3597('0xe')]);if(_0xaa070d[a92_0x3597('0xe')][a92_0x3597('0xf')](a92_0x3597('0x10'))){exports['sequelize'][a92_0x3597('0x11')][a92_0x3597('0x12')][a92_0x3597('0x13')]({'where':{'fileName':_0xaa070d[a92_0x3597('0xe')]}})[a92_0x3597('0x14')]((_0xd8a9af,_0x3dee4f)=>{if(_0x3dee4f){console[a92_0x3597('0x7')](_0xaa070d[a92_0x3597('0xe')]);_0x1daf01[a92_0x3597('0x15')](_0xd8a9af);}});}}}_0x3f5043['json']({'data':_0x1daf01});});});_0x782344['on']('error',function(_0x3b9ced){_0x3f5043[a92_0x3597('0x10')]({'message':_0x3b9ced});});_0x782344[a92_0x3597('0x16')]({'host':'ftp.vivotek.com','port':0x15,'user':a92_0x3597('0x17'),'password':a92_0x3597('0x17')});};exports['downloadFtp']=(_0x224414,_0x26d295)=>{exports[a92_0x3597('0x4')]['models'][a92_0x3597('0x12')]['findOne']({'where':{'status':null}})[a92_0x3597('0x18')](_0x2b48b8=>{if(_0x2b48b8){const _0x4d6d8e=new ftp_1[(a92_0x3597('0x19'))]();_0x4d6d8e['on'](a92_0x3597('0x9'),function(){console[a92_0x3597('0x7')](a92_0x3597('0x1a')+_0x2b48b8['fileName']);_0x4d6d8e[a92_0x3597('0x1b')](a92_0x3597('0x1c')+_0x2b48b8['fileName'],function(_0x5c6141,_0x32db99){_0x4d6d8e[a92_0x3597('0x1d')]();if(_0x5c6141){}else{const _0x599763=a92_0x3597('0x1e')+_0x2b48b8[a92_0x3597('0x1f')]+a92_0x3597('0x20');_0x32db99['pipe'](fs_1[a92_0x3597('0x19')][a92_0x3597('0x21')](_0x599763));_0x2b48b8['status']=0x1;_0x2b48b8[a92_0x3597('0x22')]();console[a92_0x3597('0x7')](a92_0x3597('0x23')+_0x2b48b8[a92_0x3597('0x1f')]);}});});_0x4d6d8e['on'](a92_0x3597('0x24'),function(_0x3ccc35){_0x26d295[a92_0x3597('0x10')]({'message':_0x3ccc35});});_0x4d6d8e['connect']({'host':a92_0x3597('0x25'),'port':0x15,'user':'ipd','password':a92_0x3597('0x17')});_0x26d295[a92_0x3597('0x10')]({'data':_0x2b48b8['fileName']});}else{_0x26d295[a92_0x3597('0x10')]({'data':[]});}});};exports['processFtp']=(_0x4cd4f5,_0x2d6945)=>{exports[a92_0x3597('0x4')][a92_0x3597('0x11')][a92_0x3597('0x12')][a92_0x3597('0x26')]({'where':{'status':0x1}})[a92_0x3597('0x18')](_0x45ad84=>{if(_0x45ad84){const _0x26a13f='media/'+_0x45ad84['fileName']+a92_0x3597('0x20');fs_1[a92_0x3597('0x19')][a92_0x3597('0x27')](_0x26a13f,a92_0x3597('0x28'),function(_0xb692d5,_0x5b3bcb){if(_0xb692d5){_0x45ad84['status']=null;}else{try{const _0x5d0ab2=JSON['parse'](_0x5b3bcb);for(const _0x59798a of _0x5d0ab2[a92_0x3597('0x29')][0x0][a92_0x3597('0x2a')]){const _0x41d2c3=_0x59798a['In'];const _0x282831=_0x59798a[a92_0x3597('0x2b')];const _0x3d5ce6=Date[a92_0x3597('0x2c')](_0x59798a[a92_0x3597('0x2d')]);if(_0x41d2c3>0x0){exports[a92_0x3597('0x4')][a92_0x3597('0x11')][a92_0x3597('0x2e')][a92_0x3597('0x2f')]({'reportFileId':_0x45ad84['id'],'amount':_0x41d2c3,'countingDate':_0x3d5ce6});}if(_0x282831>0x0){exports[a92_0x3597('0x4')][a92_0x3597('0x11')][a92_0x3597('0x2e')][a92_0x3597('0x2f')]({'reportFileId':_0x45ad84['id'],'amount':_0x282831*-0x1,'countingDate':_0x3d5ce6});}}_0x45ad84['status']=0x2;}catch(_0x5ee267){_0x45ad84[a92_0x3597('0x30')]=null;}}_0x45ad84[a92_0x3597('0x22')]();});_0x2d6945[a92_0x3597('0x10')]({'data':_0x45ad84[a92_0x3597('0x1f')]});}else{_0x2d6945[a92_0x3597('0x10')]({'data':[]});}});};exports[a92_0x3597('0x31')]=(_0x39e841,_0x3e36bd)=>{exports['sequelize']['models'][a92_0x3597('0x2e')]['findAll']({'where':{'amount':{[exports[a92_0x3597('0x4')]['Op']['gt']]:0x0}},'order':[[a92_0x3597('0x32'),a92_0x3597('0x33')]]})[a92_0x3597('0x18')](_0x5f287d=>{_0x3e36bd[a92_0x3597('0x10')]({'data':_0x5f287d});});};exports[a92_0x3597('0x34')]=(_0x41c00d,_0x498e89)=>{const _0x8724e3=_0x41c00d['query'][a92_0x3597('0x35')];const _0x57ffa0=_0x41c00d[a92_0x3597('0x36')][a92_0x3597('0x37')];const _0x52391b=_0x41c00d[a92_0x3597('0x36')]['endDate'];exports[a92_0x3597('0x4')]['models'][a92_0x3597('0x2e')][a92_0x3597('0x38')]({'attributes':[a92_0x3597('0x32'),[exports['sequelize']['fn']('sum',exports[a92_0x3597('0x4')][a92_0x3597('0x39')](a92_0x3597('0x3a'))),a92_0x3597('0x3b')]],'where':{'countingDate':{[exports['sequelize']['Op'][a92_0x3597('0x3c')]]:_0x57ffa0,[exports[a92_0x3597('0x4')]['Op']['lt']]:_0x52391b},'amount':_0x41c00d[a92_0x3597('0x3d')]['direction']=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports[a92_0x3597('0x4')]['Op']['lt']]:0x0}},'group':[exports[a92_0x3597('0x4')][a92_0x3597('0x3e')](a92_0x3597('0x3f'))],'order':[[a92_0x3597('0x32'),a92_0x3597('0x33')]]})[a92_0x3597('0x18')](_0x3c0445=>{_0x498e89[a92_0x3597('0x10')]({'data':_0x3c0445});});};exports['getPassCountingByHour']=(_0x16ba9c,_0x1d74d2)=>{const _0x2c5184=_0x16ba9c['query'][a92_0x3597('0x35')];const _0x59fc37=_0x16ba9c[a92_0x3597('0x36')][a92_0x3597('0x37')];const _0xa0a799=_0x16ba9c[a92_0x3597('0x36')][a92_0x3597('0x40')];exports[a92_0x3597('0x4')][a92_0x3597('0x11')][a92_0x3597('0x2e')]['findAll']({'attributes':[a92_0x3597('0x32'),[exports[a92_0x3597('0x4')]['fn'](a92_0x3597('0x41'),exports['sequelize'][a92_0x3597('0x39')](a92_0x3597('0x32')),a92_0x3597('0x42')),a92_0x3597('0x43')],[exports[a92_0x3597('0x4')]['fn'](a92_0x3597('0x44'),exports[a92_0x3597('0x4')][a92_0x3597('0x39')](a92_0x3597('0x3a'))),a92_0x3597('0x3b')]],'where':{'countingDate':{[exports[a92_0x3597('0x4')]['Op'][a92_0x3597('0x3c')]]:_0x59fc37,[exports[a92_0x3597('0x4')]['Op']['lt']]:_0xa0a799},'amount':_0x16ba9c[a92_0x3597('0x3d')][a92_0x3597('0x45')]=='in'?{[exports[a92_0x3597('0x4')]['Op']['gt']]:0x0}:{[exports[a92_0x3597('0x4')]['Op']['lt']]:0x0}},'group':[exports[a92_0x3597('0x4')]['fn']('HOUR',exports[a92_0x3597('0x4')]['col'](a92_0x3597('0x32'))),exports[a92_0x3597('0x4')]['fn']('DAY',exports[a92_0x3597('0x4')][a92_0x3597('0x39')](a92_0x3597('0x32'))),exports[a92_0x3597('0x4')]['fn']('MONTH',exports['sequelize']['col'](a92_0x3597('0x32'))),exports[a92_0x3597('0x4')]['fn'](a92_0x3597('0x46'),exports[a92_0x3597('0x4')]['col']('countingDate'))],'order':[[a92_0x3597('0x32'),'ASC']]})['then'](_0x199eba=>{_0x1d74d2[a92_0x3597('0x10')]({'data':_0x199eba});});};exports['getFacebook']=(_0x50aa08,_0x23085c,_0x3e9688)=>{const _0x35b171=_0x50aa08[a92_0x3597('0x47')][a92_0x3597('0x48')]['find'](_0x35b171=>_0x35b171[a92_0x3597('0x49')]===a92_0x3597('0x4a'));fbgraph_1[a92_0x3597('0x19')][a92_0x3597('0x4b')](_0x35b171['accessToken']);fbgraph_1[a92_0x3597('0x19')]['get'](_0x50aa08['user']['facebook']+a92_0x3597('0x4c'),(_0x35aa3d,_0x4facc2)=>{if(_0x35aa3d){return _0x3e9688(_0x35aa3d);}_0x23085c['render']('api/facebook',{'title':a92_0x3597('0x4d'),'profile':_0x4facc2});});};