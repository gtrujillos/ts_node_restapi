var a92_0x547d=['direction','literal','getPassCountingByHour','month','col','%Y-%m-%d\x20%H:00','countingDateShort','sum','DAY','MONTH','YEAR','getFacebook','user','find','setAccessToken','accessToken','get','facebook','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','api/facebook','Facebook\x20API','__importDefault','defineProperty','fbgraph','sequelize','getApi','API\x20Examples','syncFtp','log','connecting','ready','connected','list','name','json','models','reportFiles','findOrCreate','spread','push','error','connect','downloadFtp','findOne','then','default','connected:','fileName','colombia/','end','.txt','pipe','createWriteStream','save','Downloaded:\x20','ftp.vivotek.com','ipd','media/','utf8','status','Data','CountingInfo','parse','EndTime','passes','create','getPassCounting','findAll','countingDate','ASC','getPassCountingByDay','query','startDate','endDate','amount','total','params'];(function(_0x5a0358,_0x3f370e){var _0x429adc=function(_0x3f4ab3){while(--_0x3f4ab3){_0x5a0358['push'](_0x5a0358['shift']());}};_0x429adc(++_0x3f370e);}(a92_0x547d,0x149));var a92_0x4b26=function(_0x323cbf,_0x321f8d){_0x323cbf=_0x323cbf-0x0;var _0x5b7aed=a92_0x547d[_0x323cbf];return _0x5b7aed;};'use strict';var __importDefault=this&&this[a92_0x4b26('0x0')]||function(_0x48d8d5){return _0x48d8d5&&_0x48d8d5['__esModule']?_0x48d8d5:{'default':_0x48d8d5};};Object[a92_0x4b26('0x1')](exports,'__esModule',{'value':!![]});const fbgraph_1=__importDefault(require(a92_0x4b26('0x2')));const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));function setSequelize(_0x33f2f1){exports[a92_0x4b26('0x3')]=_0x33f2f1;}exports['setSequelize']=setSequelize;exports[a92_0x4b26('0x4')]=(_0x4f5beb,_0x5c6f91)=>{_0x5c6f91['render']('api/index',{'title':a92_0x4b26('0x5')});};exports[a92_0x4b26('0x6')]=(_0x5adeda,_0x1ab784)=>{console[a92_0x4b26('0x7')](a92_0x4b26('0x8'));const _0x5310fb=[];const _0x5c304c=new ftp_1['default']();_0x5c304c['on'](a92_0x4b26('0x9'),function(){console[a92_0x4b26('0x7')](a92_0x4b26('0xa'));_0x5c304c[a92_0x4b26('0xb')]('colombia',![],function(_0x5cb577,_0x2bbc07){if(_0x5cb577){}else{for(const _0x312155 of _0x2bbc07){console[a92_0x4b26('0x7')]('Downloading:\x20'+_0x312155['name']);if(_0x312155[a92_0x4b26('0xc')]['endsWith'](a92_0x4b26('0xd'))){exports['sequelize'][a92_0x4b26('0xe')][a92_0x4b26('0xf')][a92_0x4b26('0x10')]({'where':{'fileName':_0x312155[a92_0x4b26('0xc')]}})[a92_0x4b26('0x11')]((_0x6ff1f,_0x36e273)=>{if(_0x36e273){console[a92_0x4b26('0x7')](_0x312155[a92_0x4b26('0xc')]);_0x5310fb[a92_0x4b26('0x12')](_0x6ff1f);}});}}}_0x1ab784[a92_0x4b26('0xd')]({'data':_0x5310fb});});});_0x5c304c['on'](a92_0x4b26('0x13'),function(_0x4c2264){_0x1ab784[a92_0x4b26('0xd')]({'message':_0x4c2264});});_0x5c304c[a92_0x4b26('0x14')]({'host':'ftp.vivotek.com','port':0x15,'user':'ipd','password':'ipd'});};exports[a92_0x4b26('0x15')]=(_0x4c105b,_0x5229b0)=>{exports[a92_0x4b26('0x3')]['models'][a92_0x4b26('0xf')][a92_0x4b26('0x16')]({'where':{'status':null}})[a92_0x4b26('0x17')](_0x2be597=>{if(_0x2be597){const _0x18167c=new ftp_1[(a92_0x4b26('0x18'))]();_0x18167c['on'](a92_0x4b26('0x9'),function(){console[a92_0x4b26('0x7')](a92_0x4b26('0x19')+_0x2be597[a92_0x4b26('0x1a')]);_0x18167c['get'](a92_0x4b26('0x1b')+_0x2be597[a92_0x4b26('0x1a')],function(_0x5750a1,_0xe51e0){_0x18167c[a92_0x4b26('0x1c')]();if(_0x5750a1){}else{const _0x1e2142='media/'+_0x2be597['fileName']+a92_0x4b26('0x1d');_0xe51e0[a92_0x4b26('0x1e')](fs_1[a92_0x4b26('0x18')][a92_0x4b26('0x1f')](_0x1e2142));_0x2be597['status']=0x1;_0x2be597[a92_0x4b26('0x20')]();console['log'](a92_0x4b26('0x21')+_0x2be597[a92_0x4b26('0x1a')]);}});});_0x18167c['on'](a92_0x4b26('0x13'),function(_0x33c4fd){_0x5229b0[a92_0x4b26('0xd')]({'message':_0x33c4fd});});_0x18167c['connect']({'host':a92_0x4b26('0x22'),'port':0x15,'user':'ipd','password':a92_0x4b26('0x23')});_0x5229b0[a92_0x4b26('0xd')]({'data':_0x2be597[a92_0x4b26('0x1a')]});}else{_0x5229b0['json']({'data':[]});}});};exports['processFtp']=(_0x272951,_0x2b00d2)=>{exports[a92_0x4b26('0x3')]['models'][a92_0x4b26('0xf')][a92_0x4b26('0x16')]({'where':{'status':0x1}})[a92_0x4b26('0x17')](_0x4698ed=>{if(_0x4698ed){const _0x38dff5=a92_0x4b26('0x24')+_0x4698ed[a92_0x4b26('0x1a')]+a92_0x4b26('0x1d');fs_1[a92_0x4b26('0x18')]['readFile'](_0x38dff5,a92_0x4b26('0x25'),function(_0x28816b,_0x81f874){if(_0x28816b){_0x4698ed[a92_0x4b26('0x26')]=null;}else{try{const _0x537318=JSON['parse'](_0x81f874);for(const _0x490c46 of _0x537318[a92_0x4b26('0x27')][0x0][a92_0x4b26('0x28')]){const _0x54b866=_0x490c46['In'];const _0x46c933=_0x490c46['Out'];const _0x2caed6=Date[a92_0x4b26('0x29')](_0x490c46[a92_0x4b26('0x2a')]);if(_0x54b866>0x0){exports[a92_0x4b26('0x3')][a92_0x4b26('0xe')][a92_0x4b26('0x2b')]['create']({'reportFileId':_0x4698ed['id'],'amount':_0x54b866,'countingDate':_0x2caed6});}if(_0x46c933>0x0){exports[a92_0x4b26('0x3')][a92_0x4b26('0xe')]['passes'][a92_0x4b26('0x2c')]({'reportFileId':_0x4698ed['id'],'amount':_0x46c933*-0x1,'countingDate':_0x2caed6});}}_0x4698ed[a92_0x4b26('0x26')]=0x2;}catch(_0x269484){_0x4698ed[a92_0x4b26('0x26')]=null;}}_0x4698ed[a92_0x4b26('0x20')]();});_0x2b00d2[a92_0x4b26('0xd')]({'data':_0x4698ed[a92_0x4b26('0x1a')]});}else{_0x2b00d2[a92_0x4b26('0xd')]({'data':[]});}});};exports[a92_0x4b26('0x2d')]=(_0x5624f2,_0x141712)=>{exports[a92_0x4b26('0x3')]['models']['passes'][a92_0x4b26('0x2e')]({'where':{'amount':{[exports[a92_0x4b26('0x3')]['Op']['gt']]:0x0}},'order':[[a92_0x4b26('0x2f'),a92_0x4b26('0x30')]]})[a92_0x4b26('0x17')](_0x27a8da=>{_0x141712[a92_0x4b26('0xd')]({'data':_0x27a8da});});};exports[a92_0x4b26('0x31')]=(_0x243fd0,_0x217ac2)=>{const _0x1c220b=_0x243fd0[a92_0x4b26('0x32')]['month'];const _0x3a0d61=_0x243fd0['query'][a92_0x4b26('0x33')];const _0x58eef4=_0x243fd0[a92_0x4b26('0x32')][a92_0x4b26('0x34')];exports['sequelize'][a92_0x4b26('0xe')][a92_0x4b26('0x2b')][a92_0x4b26('0x2e')]({'attributes':[a92_0x4b26('0x2f'),[exports[a92_0x4b26('0x3')]['fn']('sum',exports['sequelize']['col'](a92_0x4b26('0x35'))),a92_0x4b26('0x36')]],'where':{'countingDate':{[exports[a92_0x4b26('0x3')]['Op']['gte']]:_0x3a0d61,[exports[a92_0x4b26('0x3')]['Op']['lt']]:_0x58eef4},'amount':_0x243fd0[a92_0x4b26('0x37')][a92_0x4b26('0x38')]=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports[a92_0x4b26('0x3')]['Op']['lt']]:0x0}},'group':[exports[a92_0x4b26('0x3')][a92_0x4b26('0x39')]('YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))')],'order':[[a92_0x4b26('0x2f'),a92_0x4b26('0x30')]]})[a92_0x4b26('0x17')](_0x278aee=>{_0x217ac2['json']({'data':_0x278aee});});};exports[a92_0x4b26('0x3a')]=(_0x37b1b6,_0xac9780)=>{const _0x3539e8=_0x37b1b6[a92_0x4b26('0x32')][a92_0x4b26('0x3b')];const _0x217393=_0x37b1b6['query'][a92_0x4b26('0x33')];const _0x14bb73=_0x37b1b6[a92_0x4b26('0x32')][a92_0x4b26('0x34')];exports[a92_0x4b26('0x3')][a92_0x4b26('0xe')][a92_0x4b26('0x2b')][a92_0x4b26('0x2e')]({'attributes':[a92_0x4b26('0x2f'),[exports['sequelize']['fn']('DATE_FORMAT',exports[a92_0x4b26('0x3')][a92_0x4b26('0x3c')](a92_0x4b26('0x2f')),a92_0x4b26('0x3d')),a92_0x4b26('0x3e')],[exports['sequelize']['fn'](a92_0x4b26('0x3f'),exports[a92_0x4b26('0x3')][a92_0x4b26('0x3c')](a92_0x4b26('0x35'))),a92_0x4b26('0x36')]],'where':{'countingDate':{[exports[a92_0x4b26('0x3')]['Op']['gte']]:_0x217393,[exports[a92_0x4b26('0x3')]['Op']['lt']]:_0x14bb73},'amount':_0x37b1b6[a92_0x4b26('0x37')][a92_0x4b26('0x38')]=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports[a92_0x4b26('0x3')]['Op']['lt']]:0x0}},'group':[exports[a92_0x4b26('0x3')]['fn']('HOUR',exports[a92_0x4b26('0x3')][a92_0x4b26('0x3c')]('countingDate')),exports[a92_0x4b26('0x3')]['fn'](a92_0x4b26('0x40'),exports['sequelize'][a92_0x4b26('0x3c')](a92_0x4b26('0x2f'))),exports['sequelize']['fn'](a92_0x4b26('0x41'),exports[a92_0x4b26('0x3')][a92_0x4b26('0x3c')](a92_0x4b26('0x2f'))),exports[a92_0x4b26('0x3')]['fn'](a92_0x4b26('0x42'),exports[a92_0x4b26('0x3')][a92_0x4b26('0x3c')](a92_0x4b26('0x2f')))],'order':[[a92_0x4b26('0x2f'),a92_0x4b26('0x30')]]})[a92_0x4b26('0x17')](_0x49bbc0=>{_0xac9780[a92_0x4b26('0xd')]({'data':_0x49bbc0});});};exports[a92_0x4b26('0x43')]=(_0xc1aff9,_0x295ee0,_0x2524a9)=>{const _0x1174b6=_0xc1aff9[a92_0x4b26('0x44')]['tokens'][a92_0x4b26('0x45')](_0x1174b6=>_0x1174b6['kind']==='facebook');fbgraph_1['default'][a92_0x4b26('0x46')](_0x1174b6[a92_0x4b26('0x47')]);fbgraph_1['default'][a92_0x4b26('0x48')](_0xc1aff9[a92_0x4b26('0x44')][a92_0x4b26('0x49')]+a92_0x4b26('0x4a'),(_0x706df7,_0x518fc7)=>{if(_0x706df7){return _0x2524a9(_0x706df7);}_0x295ee0['render'](a92_0x4b26('0x4b'),{'title':a92_0x4b26('0x4c'),'profile':_0x518fc7});});};