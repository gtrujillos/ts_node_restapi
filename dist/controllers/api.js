var a91_0x5bf0=['readFile','utf8','Data','parse','EndTime','passes','create','getPassCounting','findAll','countingDate','then','query','month','startDate','endDate','sum','amount','gte','params','direction','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','ASC','col','countingDateShort','total','HOUR','DAY','MONTH','YEAR','find','facebook','setAccessToken','accessToken','get','user','api/facebook','Facebook\x20API','__esModule','defineProperty','ftp','sequelize','render','api/index','syncFtp','connecting','default','ready','log','connected','list','colombia','name','endsWith','json','models','reportFiles','findOrCreate','spread','push','error','connect','ipd','downloadFtp','findOne','colombia/','fileName','media/','.txt','pipe','status','save','Downloaded:\x20','ftp.vivotek.com'];(function(_0x56276f,_0x2e80c7){var _0x1a46c6=function(_0x79851e){while(--_0x79851e){_0x56276f['push'](_0x56276f['shift']());}};_0x1a46c6(++_0x2e80c7);}(a91_0x5bf0,0x14e));var a91_0x3196=function(_0x387d9c,_0x408913){_0x387d9c=_0x387d9c-0x0;var _0xcda39d=a91_0x5bf0[_0x387d9c];return _0xcda39d;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x22e68c){return _0x22e68c&&_0x22e68c[a91_0x3196('0x0')]?_0x22e68c:{'default':_0x22e68c};};Object[a91_0x3196('0x1')](exports,a91_0x3196('0x0'),{'value':!![]});const fbgraph_1=__importDefault(require('fbgraph'));const ftp_1=__importDefault(require(a91_0x3196('0x2')));const fs_1=__importDefault(require('fs'));function setSequelize(_0xe9fdd0){exports[a91_0x3196('0x3')]=_0xe9fdd0;}exports['setSequelize']=setSequelize;exports['getApi']=(_0x1fe27f,_0x1fb0a5)=>{_0x1fb0a5[a91_0x3196('0x4')](a91_0x3196('0x5'),{'title':'API\x20Examples'});};exports[a91_0x3196('0x6')]=(_0x3015c4,_0x378c68)=>{console['log'](a91_0x3196('0x7'));const _0x405eba=[];const _0x4cb327=new ftp_1[(a91_0x3196('0x8'))]();_0x4cb327['on'](a91_0x3196('0x9'),function(){console[a91_0x3196('0xa')](a91_0x3196('0xb'));_0x4cb327[a91_0x3196('0xc')](a91_0x3196('0xd'),![],function(_0x4f3238,_0xa48472){if(_0x4f3238){}else{for(const _0x29d542 of _0xa48472){console[a91_0x3196('0xa')]('Downloading:\x20'+_0x29d542['name']);if(_0x29d542[a91_0x3196('0xe')][a91_0x3196('0xf')](a91_0x3196('0x10'))){exports[a91_0x3196('0x3')][a91_0x3196('0x11')][a91_0x3196('0x12')][a91_0x3196('0x13')]({'where':{'fileName':_0x29d542['name']}})[a91_0x3196('0x14')]((_0x48a360,_0x10f58a)=>{if(_0x10f58a){console[a91_0x3196('0xa')](_0x29d542['name']);_0x405eba[a91_0x3196('0x15')](_0x48a360);}});}}}_0x378c68[a91_0x3196('0x10')]({'data':_0x405eba});});});_0x4cb327['on'](a91_0x3196('0x16'),function(_0x51de7b){_0x378c68['json']({'message':_0x51de7b});});_0x4cb327[a91_0x3196('0x17')]({'host':'ftp.vivotek.com','port':0x15,'user':a91_0x3196('0x18'),'password':a91_0x3196('0x18')});};exports[a91_0x3196('0x19')]=(_0x1412ef,_0x598b0b)=>{exports['sequelize']['models'][a91_0x3196('0x12')][a91_0x3196('0x1a')]({'where':{'status':null}})['then'](_0x19e879=>{if(_0x19e879){const _0x11f992=new ftp_1[(a91_0x3196('0x8'))]();_0x11f992['on']('ready',function(){console['log']('connected:'+_0x19e879['fileName']);_0x11f992['get'](a91_0x3196('0x1b')+_0x19e879[a91_0x3196('0x1c')],function(_0xa37586,_0x435dc3){_0x11f992['end']();if(_0xa37586){}else{const _0x34fa7f=a91_0x3196('0x1d')+_0x19e879[a91_0x3196('0x1c')]+a91_0x3196('0x1e');_0x435dc3[a91_0x3196('0x1f')](fs_1[a91_0x3196('0x8')]['createWriteStream'](_0x34fa7f));_0x19e879[a91_0x3196('0x20')]=0x1;_0x19e879[a91_0x3196('0x21')]();console[a91_0x3196('0xa')](a91_0x3196('0x22')+_0x19e879[a91_0x3196('0x1c')]);}});});_0x11f992['on'](a91_0x3196('0x16'),function(_0x4f897a){_0x598b0b[a91_0x3196('0x10')]({'message':_0x4f897a});});_0x11f992[a91_0x3196('0x17')]({'host':a91_0x3196('0x23'),'port':0x15,'user':a91_0x3196('0x18'),'password':a91_0x3196('0x18')});_0x598b0b[a91_0x3196('0x10')]({'data':_0x19e879[a91_0x3196('0x1c')]});}else{_0x598b0b[a91_0x3196('0x10')]({'data':[]});}});};exports['processFtp']=(_0x1651a8,_0x186598)=>{exports['sequelize'][a91_0x3196('0x11')][a91_0x3196('0x12')]['findOne']({'where':{'status':0x1}})['then'](_0x11d106=>{if(_0x11d106){const _0x2fbd4c=a91_0x3196('0x1d')+_0x11d106['fileName']+a91_0x3196('0x1e');fs_1[a91_0x3196('0x8')][a91_0x3196('0x24')](_0x2fbd4c,a91_0x3196('0x25'),function(_0x33cd73,_0x58a52a){if(_0x33cd73){_0x11d106[a91_0x3196('0x20')]=null;}else{try{const _0x65891b=JSON['parse'](_0x58a52a);for(const _0x57f0c5 of _0x65891b[a91_0x3196('0x26')][0x0]['CountingInfo']){const _0x54d894=_0x57f0c5['In'];const _0x510e5f=_0x57f0c5['Out'];const _0x4f167c=Date[a91_0x3196('0x27')](_0x57f0c5[a91_0x3196('0x28')]);if(_0x54d894>0x0){exports[a91_0x3196('0x3')]['models'][a91_0x3196('0x29')][a91_0x3196('0x2a')]({'reportFileId':_0x11d106['id'],'amount':_0x54d894,'countingDate':_0x4f167c});}if(_0x510e5f>0x0){exports[a91_0x3196('0x3')][a91_0x3196('0x11')][a91_0x3196('0x29')][a91_0x3196('0x2a')]({'reportFileId':_0x11d106['id'],'amount':_0x510e5f*-0x1,'countingDate':_0x4f167c});}}_0x11d106[a91_0x3196('0x20')]=0x2;}catch(_0x251fd0){_0x11d106[a91_0x3196('0x20')]=null;}}_0x11d106[a91_0x3196('0x21')]();});_0x186598[a91_0x3196('0x10')]({'data':_0x11d106[a91_0x3196('0x1c')]});}else{_0x186598[a91_0x3196('0x10')]({'data':[]});}});};exports[a91_0x3196('0x2b')]=(_0x24d20c,_0x8c825b)=>{exports['sequelize']['models']['passes'][a91_0x3196('0x2c')]({'where':{'amount':{[exports[a91_0x3196('0x3')]['Op']['gt']]:0x0}},'order':[[a91_0x3196('0x2d'),'ASC']]})[a91_0x3196('0x2e')](_0x59b3f9=>{_0x8c825b[a91_0x3196('0x10')]({'data':_0x59b3f9});});};exports['getPassCountingByDay']=(_0x4edb93,_0xe757c7)=>{const _0x5e028d=_0x4edb93[a91_0x3196('0x2f')][a91_0x3196('0x30')];const _0x53672a=_0x4edb93[a91_0x3196('0x2f')][a91_0x3196('0x31')];const _0x4467f1=_0x4edb93[a91_0x3196('0x2f')][a91_0x3196('0x32')];exports['sequelize'][a91_0x3196('0x11')][a91_0x3196('0x29')][a91_0x3196('0x2c')]({'attributes':[a91_0x3196('0x2d'),[exports['sequelize']['fn'](a91_0x3196('0x33'),exports[a91_0x3196('0x3')]['col'](a91_0x3196('0x34'))),'total']],'where':{'countingDate':{[exports['sequelize']['Op'][a91_0x3196('0x35')]]:_0x53672a,[exports['sequelize']['Op']['lt']]:_0x4467f1},'amount':_0x4edb93[a91_0x3196('0x36')][a91_0x3196('0x37')]=='in'?{[exports[a91_0x3196('0x3')]['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports[a91_0x3196('0x3')][a91_0x3196('0x38')](a91_0x3196('0x39'))],'order':[['countingDate',a91_0x3196('0x3a')]]})[a91_0x3196('0x2e')](_0xca12bb=>{_0xe757c7['json']({'data':_0xca12bb});});};exports['getPassCountingByHour']=(_0x258bac,_0x537866)=>{const _0x476f30=_0x258bac['query'][a91_0x3196('0x30')];const _0x164eea=_0x258bac[a91_0x3196('0x2f')][a91_0x3196('0x31')];const _0x372405=_0x258bac[a91_0x3196('0x2f')][a91_0x3196('0x32')];exports[a91_0x3196('0x3')][a91_0x3196('0x11')][a91_0x3196('0x29')]['findAll']({'attributes':[a91_0x3196('0x2d'),[exports[a91_0x3196('0x3')]['fn']('DATE_FORMAT',exports[a91_0x3196('0x3')][a91_0x3196('0x3b')](a91_0x3196('0x2d')),'%Y-%m-%d\x20%H:00'),a91_0x3196('0x3c')],[exports['sequelize']['fn']('sum',exports[a91_0x3196('0x3')][a91_0x3196('0x3b')](a91_0x3196('0x34'))),a91_0x3196('0x3d')]],'where':{'countingDate':{[exports[a91_0x3196('0x3')]['Op'][a91_0x3196('0x35')]]:_0x164eea,[exports[a91_0x3196('0x3')]['Op']['lt']]:_0x372405},'amount':_0x258bac[a91_0x3196('0x36')][a91_0x3196('0x37')]=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports[a91_0x3196('0x3')]['Op']['lt']]:0x0}},'group':[exports['sequelize']['fn'](a91_0x3196('0x3e'),exports[a91_0x3196('0x3')]['col'](a91_0x3196('0x2d'))),exports['sequelize']['fn'](a91_0x3196('0x3f'),exports[a91_0x3196('0x3')][a91_0x3196('0x3b')](a91_0x3196('0x2d'))),exports['sequelize']['fn'](a91_0x3196('0x40'),exports[a91_0x3196('0x3')][a91_0x3196('0x3b')]('countingDate')),exports[a91_0x3196('0x3')]['fn'](a91_0x3196('0x41'),exports[a91_0x3196('0x3')]['col']('countingDate'))],'order':[['countingDate',a91_0x3196('0x3a')]]})[a91_0x3196('0x2e')](_0x1b7244=>{_0x537866[a91_0x3196('0x10')]({'data':_0x1b7244});});};exports['getFacebook']=(_0x23a53c,_0x5c9d03,_0x37920c)=>{const _0x39c044=_0x23a53c['user']['tokens'][a91_0x3196('0x42')](_0x39c044=>_0x39c044['kind']===a91_0x3196('0x43'));fbgraph_1[a91_0x3196('0x8')][a91_0x3196('0x44')](_0x39c044[a91_0x3196('0x45')]);fbgraph_1[a91_0x3196('0x8')][a91_0x3196('0x46')](_0x23a53c[a91_0x3196('0x47')][a91_0x3196('0x43')]+'?fields=id,name,email,first_name,last_name,gender,link,locale,timezone',(_0x2e2c6f,_0x507edc)=>{if(_0x2e2c6f){return _0x37920c(_0x2e2c6f);}_0x5c9d03[a91_0x3196('0x4')](a91_0x3196('0x48'),{'title':a91_0x3196('0x49'),'profile':_0x507edc});});};