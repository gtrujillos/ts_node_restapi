var a92_0x4e13=['error','processFtp','readFile','status','Data','CountingInfo','Out','parse','passes','create','getPassCounting','findAll','countingDate','ASC','getPassCountingByDay','query','month','startDate','endDate','sum','col','amount','total','params','direction','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','DATE_FORMAT','%Y-%m-%d\x20%H:00','countingDateShort','gte','HOUR','DAY','MONTH','YEAR','getFacebook','user','tokens','kind','setAccessToken','accessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','Facebook\x20API','__importDefault','__esModule','defineProperty','fbgraph','sequelize','setSequelize','getApi','render','syncFtp','default','ready','log','list','colombia','Downloading:\x20','name','endsWith','json','models','reportFiles','push','connect','ftp.vivotek.com','ipd','findOne','then','connected:','get','end','media/','fileName','createWriteStream','save'];(function(_0x2c0ffe,_0x4f84fd){var _0x81d4e7=function(_0xa78faf){while(--_0xa78faf){_0x2c0ffe['push'](_0x2c0ffe['shift']());}};_0x81d4e7(++_0x4f84fd);}(a92_0x4e13,0xc6));var a92_0x124b=function(_0x38eb70,_0x2f3a8b){_0x38eb70=_0x38eb70-0x0;var _0x42f039=a92_0x4e13[_0x38eb70];return _0x42f039;};'use strict';var __importDefault=this&&this[a92_0x124b('0x0')]||function(_0x4576d9){return _0x4576d9&&_0x4576d9[a92_0x124b('0x1')]?_0x4576d9:{'default':_0x4576d9};};Object[a92_0x124b('0x2')](exports,a92_0x124b('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a92_0x124b('0x3')));const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));function setSequelize(_0x1e495a){exports[a92_0x124b('0x4')]=_0x1e495a;}exports[a92_0x124b('0x5')]=setSequelize;exports[a92_0x124b('0x6')]=(_0x3722ea,_0x4582e8)=>{_0x4582e8[a92_0x124b('0x7')]('api/index',{'title':'API\x20Examples'});};exports[a92_0x124b('0x8')]=(_0x55595a,_0x2f4f43)=>{console['log']('connecting');const _0xf296c9=[];const _0x104b14=new ftp_1[(a92_0x124b('0x9'))]();_0x104b14['on'](a92_0x124b('0xa'),function(){console[a92_0x124b('0xb')]('connected');_0x104b14[a92_0x124b('0xc')](a92_0x124b('0xd'),![],function(_0x2a7122,_0x2e6941){if(_0x2a7122){}else{for(const _0x4a61ac of _0x2e6941){console[a92_0x124b('0xb')](a92_0x124b('0xe')+_0x4a61ac[a92_0x124b('0xf')]);if(_0x4a61ac[a92_0x124b('0xf')][a92_0x124b('0x10')](a92_0x124b('0x11'))){exports[a92_0x124b('0x4')][a92_0x124b('0x12')][a92_0x124b('0x13')]['findOrCreate']({'where':{'fileName':_0x4a61ac[a92_0x124b('0xf')]}})['spread']((_0x302b06,_0x1d584e)=>{if(_0x1d584e){console[a92_0x124b('0xb')](_0x4a61ac[a92_0x124b('0xf')]);_0xf296c9[a92_0x124b('0x14')](_0x302b06);}});}}}_0x2f4f43[a92_0x124b('0x11')]({'data':_0xf296c9});});});_0x104b14['on']('error',function(_0x2f0fc9){_0x2f4f43[a92_0x124b('0x11')]({'message':_0x2f0fc9});});_0x104b14[a92_0x124b('0x15')]({'host':a92_0x124b('0x16'),'port':0x15,'user':'ipd','password':a92_0x124b('0x17')});};exports['downloadFtp']=(_0x4a0593,_0x5a705e)=>{exports['sequelize']['models'][a92_0x124b('0x13')][a92_0x124b('0x18')]({'where':{'status':null}})[a92_0x124b('0x19')](_0x1469c0=>{if(_0x1469c0){const _0x11758d=new ftp_1[(a92_0x124b('0x9'))]();_0x11758d['on'](a92_0x124b('0xa'),function(){console[a92_0x124b('0xb')](a92_0x124b('0x1a')+_0x1469c0['fileName']);_0x11758d[a92_0x124b('0x1b')]('colombia/'+_0x1469c0['fileName'],function(_0x5b9d17,_0x5994bf){_0x11758d[a92_0x124b('0x1c')]();if(_0x5b9d17){}else{const _0x46ed7d=a92_0x124b('0x1d')+_0x1469c0[a92_0x124b('0x1e')]+'.txt';_0x5994bf['pipe'](fs_1[a92_0x124b('0x9')][a92_0x124b('0x1f')](_0x46ed7d));_0x1469c0['status']=0x1;_0x1469c0[a92_0x124b('0x20')]();console['log']('Downloaded:\x20'+_0x1469c0[a92_0x124b('0x1e')]);}});});_0x11758d['on'](a92_0x124b('0x21'),function(_0x272d57){_0x5a705e[a92_0x124b('0x11')]({'message':_0x272d57});});_0x11758d[a92_0x124b('0x15')]({'host':'ftp.vivotek.com','port':0x15,'user':'ipd','password':a92_0x124b('0x17')});_0x5a705e['json']({'data':_0x1469c0['fileName']});}else{_0x5a705e[a92_0x124b('0x11')]({'data':[]});}});};exports[a92_0x124b('0x22')]=(_0x4967ba,_0x1ba986)=>{exports[a92_0x124b('0x4')][a92_0x124b('0x12')][a92_0x124b('0x13')][a92_0x124b('0x18')]({'where':{'status':0x1}})['then'](_0x36c13e=>{if(_0x36c13e){const _0x1aa922='media/'+_0x36c13e[a92_0x124b('0x1e')]+'.txt';fs_1[a92_0x124b('0x9')][a92_0x124b('0x23')](_0x1aa922,'utf8',function(_0x30f5d0,_0x592445){if(_0x30f5d0){_0x36c13e[a92_0x124b('0x24')]=null;}else{try{const _0x1b88f4=JSON['parse'](_0x592445);for(const _0x50058c of _0x1b88f4[a92_0x124b('0x25')][0x0][a92_0x124b('0x26')]){const _0x2d828c=_0x50058c['In'];const _0xc5a920=_0x50058c[a92_0x124b('0x27')];const _0x17bc71=Date[a92_0x124b('0x28')](_0x50058c['EndTime']);if(_0x2d828c>0x0){exports[a92_0x124b('0x4')]['models'][a92_0x124b('0x29')][a92_0x124b('0x2a')]({'reportFileId':_0x36c13e['id'],'amount':_0x2d828c,'countingDate':_0x17bc71});}if(_0xc5a920>0x0){exports['sequelize'][a92_0x124b('0x12')][a92_0x124b('0x29')][a92_0x124b('0x2a')]({'reportFileId':_0x36c13e['id'],'amount':_0xc5a920*-0x1,'countingDate':_0x17bc71});}}_0x36c13e[a92_0x124b('0x24')]=0x2;}catch(_0x59430f){_0x36c13e['status']=null;}}_0x36c13e[a92_0x124b('0x20')]();});_0x1ba986[a92_0x124b('0x11')]({'data':_0x36c13e['fileName']});}else{_0x1ba986[a92_0x124b('0x11')]({'data':[]});}});};exports[a92_0x124b('0x2b')]=(_0x5737b1,_0x59a78b)=>{exports[a92_0x124b('0x4')][a92_0x124b('0x12')][a92_0x124b('0x29')][a92_0x124b('0x2c')]({'where':{'amount':{[exports[a92_0x124b('0x4')]['Op']['gt']]:0x0}},'order':[[a92_0x124b('0x2d'),a92_0x124b('0x2e')]]})[a92_0x124b('0x19')](_0x4cfff7=>{_0x59a78b[a92_0x124b('0x11')]({'data':_0x4cfff7});});};exports[a92_0x124b('0x2f')]=(_0x45f77f,_0x375c3e)=>{const _0x349349=_0x45f77f[a92_0x124b('0x30')][a92_0x124b('0x31')];const _0x57a69d=_0x45f77f[a92_0x124b('0x30')][a92_0x124b('0x32')];const _0x11c548=_0x45f77f[a92_0x124b('0x30')][a92_0x124b('0x33')];exports['sequelize'][a92_0x124b('0x12')][a92_0x124b('0x29')]['findAll']({'attributes':[a92_0x124b('0x2d'),[exports[a92_0x124b('0x4')]['fn'](a92_0x124b('0x34'),exports['sequelize'][a92_0x124b('0x35')](a92_0x124b('0x36'))),a92_0x124b('0x37')]],'where':{'countingDate':{[exports[a92_0x124b('0x4')]['Op']['gte']]:_0x57a69d,[exports[a92_0x124b('0x4')]['Op']['lt']]:_0x11c548},'amount':_0x45f77f[a92_0x124b('0x38')][a92_0x124b('0x39')]=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports[a92_0x124b('0x4')][a92_0x124b('0x3a')](a92_0x124b('0x3b'))],'order':[[a92_0x124b('0x2d'),a92_0x124b('0x2e')]]})[a92_0x124b('0x19')](_0x255cdc=>{_0x375c3e[a92_0x124b('0x11')]({'data':_0x255cdc});});};exports[a92_0x124b('0x3c')]=(_0x2a43e1,_0x23dafd)=>{const _0x1ecb45=_0x2a43e1[a92_0x124b('0x30')][a92_0x124b('0x31')];const _0xe0dde4=_0x2a43e1[a92_0x124b('0x30')][a92_0x124b('0x32')];const _0x337f03=_0x2a43e1[a92_0x124b('0x30')][a92_0x124b('0x33')];exports[a92_0x124b('0x4')][a92_0x124b('0x12')][a92_0x124b('0x29')][a92_0x124b('0x2c')]({'attributes':[a92_0x124b('0x2d'),[exports[a92_0x124b('0x4')]['fn'](a92_0x124b('0x3d'),exports[a92_0x124b('0x4')]['col'](a92_0x124b('0x2d')),a92_0x124b('0x3e')),a92_0x124b('0x3f')],[exports[a92_0x124b('0x4')]['fn']('sum',exports[a92_0x124b('0x4')]['col']('amount')),a92_0x124b('0x37')]],'where':{'countingDate':{[exports['sequelize']['Op'][a92_0x124b('0x40')]]:_0xe0dde4,[exports[a92_0x124b('0x4')]['Op']['lt']]:_0x337f03},'amount':_0x2a43e1[a92_0x124b('0x38')][a92_0x124b('0x39')]=='in'?{[exports[a92_0x124b('0x4')]['Op']['gt']]:0x0}:{[exports[a92_0x124b('0x4')]['Op']['lt']]:0x0}},'group':[exports[a92_0x124b('0x4')]['fn'](a92_0x124b('0x41'),exports['sequelize'][a92_0x124b('0x35')](a92_0x124b('0x2d'))),exports['sequelize']['fn'](a92_0x124b('0x42'),exports[a92_0x124b('0x4')][a92_0x124b('0x35')]('countingDate')),exports[a92_0x124b('0x4')]['fn'](a92_0x124b('0x43'),exports[a92_0x124b('0x4')][a92_0x124b('0x35')](a92_0x124b('0x2d'))),exports['sequelize']['fn'](a92_0x124b('0x44'),exports[a92_0x124b('0x4')]['col'](a92_0x124b('0x2d')))],'order':[[a92_0x124b('0x2d'),'ASC']]})[a92_0x124b('0x19')](_0x100726=>{_0x23dafd[a92_0x124b('0x11')]({'data':_0x100726});});};exports[a92_0x124b('0x45')]=(_0x2a8c45,_0x225aa2,_0x5ea935)=>{const _0xd96042=_0x2a8c45[a92_0x124b('0x46')][a92_0x124b('0x47')]['find'](_0xd96042=>_0xd96042[a92_0x124b('0x48')]==='facebook');fbgraph_1[a92_0x124b('0x9')][a92_0x124b('0x49')](_0xd96042[a92_0x124b('0x4a')]);fbgraph_1[a92_0x124b('0x9')][a92_0x124b('0x1b')](_0x2a8c45[a92_0x124b('0x46')]['facebook']+a92_0x124b('0x4b'),(_0x139ab0,_0x3ef6f5)=>{if(_0x139ab0){return _0x5ea935(_0x139ab0);}_0x225aa2[a92_0x124b('0x7')]('api/facebook',{'title':a92_0x124b('0x4c'),'profile':_0x3ef6f5});});};