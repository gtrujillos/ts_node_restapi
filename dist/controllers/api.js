var a92_0x2c51=['create','save','getPassCounting','passes','findAll','getPassCountingByDay','query','countingDate','sum','col','amount','total','gte','ASC','startDate','endDate','DATE_FORMAT','countingDateShort','direction','HOUR','DAY','MONTH','YEAR','getFacebook','tokens','find','setAccessToken','accessToken','get','facebook','api/facebook','Facebook\x20API','__importDefault','__esModule','defineProperty','ftp','sequelize','getApi','render','api/index','API\x20Examples','connecting','default','log','connected','list','colombia','name','json','reportFiles','findOrCreate','spread','push','connect','ftp.vivotek.com','ipd','models','findOne','ready','connected:','fileName','end','media/','pipe','createWriteStream','status','Downloaded:\x20','error','then','.txt','utf8','parse','Data','CountingInfo','Out'];(function(_0x256e22,_0x46a02e){var _0x3b7e81=function(_0x170ea6){while(--_0x170ea6){_0x256e22['push'](_0x256e22['shift']());}};_0x3b7e81(++_0x46a02e);}(a92_0x2c51,0xb6));var a92_0x42e1=function(_0x2810f6,_0x1cfbe7){_0x2810f6=_0x2810f6-0x0;var _0x215cd5=a92_0x2c51[_0x2810f6];return _0x215cd5;};'use strict';var __importDefault=this&&this[a92_0x42e1('0x0')]||function(_0x358d5a){return _0x358d5a&&_0x358d5a[a92_0x42e1('0x1')]?_0x358d5a:{'default':_0x358d5a};};Object[a92_0x42e1('0x2')](exports,'__esModule',{'value':!![]});const fbgraph_1=__importDefault(require('fbgraph'));const ftp_1=__importDefault(require(a92_0x42e1('0x3')));const fs_1=__importDefault(require('fs'));function setSequelize(_0x4c5cb8){exports[a92_0x42e1('0x4')]=_0x4c5cb8;}exports['setSequelize']=setSequelize;exports[a92_0x42e1('0x5')]=(_0x549b83,_0x5ad711)=>{_0x5ad711[a92_0x42e1('0x6')](a92_0x42e1('0x7'),{'title':a92_0x42e1('0x8')});};exports['syncFtp']=(_0x543300,_0x59c36c)=>{console['log'](a92_0x42e1('0x9'));const _0x1fd91d=[];const _0x2f4ddb=new ftp_1[(a92_0x42e1('0xa'))]();_0x2f4ddb['on']('ready',function(){console[a92_0x42e1('0xb')](a92_0x42e1('0xc'));_0x2f4ddb[a92_0x42e1('0xd')](a92_0x42e1('0xe'),![],function(_0x5e9423,_0x184bdf){if(_0x5e9423){}else{for(const _0x48930c of _0x184bdf){console[a92_0x42e1('0xb')]('Downloading:\x20'+_0x48930c[a92_0x42e1('0xf')]);if(_0x48930c[a92_0x42e1('0xf')]['endsWith'](a92_0x42e1('0x10'))){exports[a92_0x42e1('0x4')]['models'][a92_0x42e1('0x11')][a92_0x42e1('0x12')]({'where':{'fileName':_0x48930c['name']}})[a92_0x42e1('0x13')]((_0xc04502,_0x292b82)=>{if(_0x292b82){console[a92_0x42e1('0xb')](_0x48930c[a92_0x42e1('0xf')]);_0x1fd91d[a92_0x42e1('0x14')](_0xc04502);}});}}}_0x59c36c[a92_0x42e1('0x10')]({'data':_0x1fd91d});});});_0x2f4ddb['on']('error',function(_0x344f5b){_0x59c36c[a92_0x42e1('0x10')]({'message':_0x344f5b});});_0x2f4ddb[a92_0x42e1('0x15')]({'host':a92_0x42e1('0x16'),'port':0x15,'user':a92_0x42e1('0x17'),'password':'ipd'});};exports['downloadFtp']=(_0x251d9c,_0x547062)=>{exports['sequelize'][a92_0x42e1('0x18')][a92_0x42e1('0x11')][a92_0x42e1('0x19')]({'where':{'status':null}})['then'](_0x574464=>{if(_0x574464){const _0x34ab3a=new ftp_1[(a92_0x42e1('0xa'))]();_0x34ab3a['on'](a92_0x42e1('0x1a'),function(){console[a92_0x42e1('0xb')](a92_0x42e1('0x1b')+_0x574464[a92_0x42e1('0x1c')]);_0x34ab3a['get']('colombia/'+_0x574464[a92_0x42e1('0x1c')],function(_0x24f875,_0x4eea43){_0x34ab3a[a92_0x42e1('0x1d')]();if(_0x24f875){}else{const _0x13ca7d=a92_0x42e1('0x1e')+_0x574464[a92_0x42e1('0x1c')]+'.txt';_0x4eea43[a92_0x42e1('0x1f')](fs_1[a92_0x42e1('0xa')][a92_0x42e1('0x20')](_0x13ca7d));_0x574464[a92_0x42e1('0x21')]=0x1;_0x574464['save']();console[a92_0x42e1('0xb')](a92_0x42e1('0x22')+_0x574464[a92_0x42e1('0x1c')]);}});});_0x34ab3a['on'](a92_0x42e1('0x23'),function(_0x1fde91){_0x547062[a92_0x42e1('0x10')]({'message':_0x1fde91});});_0x34ab3a[a92_0x42e1('0x15')]({'host':a92_0x42e1('0x16'),'port':0x15,'user':a92_0x42e1('0x17'),'password':a92_0x42e1('0x17')});_0x547062[a92_0x42e1('0x10')]({'data':_0x574464['fileName']});}else{_0x547062['json']({'data':[]});}});};exports['processFtp']=(_0x494646,_0x3d0a20)=>{exports[a92_0x42e1('0x4')][a92_0x42e1('0x18')][a92_0x42e1('0x11')][a92_0x42e1('0x19')]({'where':{'status':0x1}})[a92_0x42e1('0x24')](_0x3ae5a8=>{if(_0x3ae5a8){const _0x2389d7=a92_0x42e1('0x1e')+_0x3ae5a8[a92_0x42e1('0x1c')]+a92_0x42e1('0x25');fs_1[a92_0x42e1('0xa')]['readFile'](_0x2389d7,a92_0x42e1('0x26'),function(_0x150900,_0x4963c7){if(_0x150900){_0x3ae5a8[a92_0x42e1('0x21')]=null;}else{try{const _0x2912d6=JSON[a92_0x42e1('0x27')](_0x4963c7);for(const _0x3eb531 of _0x2912d6[a92_0x42e1('0x28')][0x0][a92_0x42e1('0x29')]){const _0x203a25=_0x3eb531['In'];const _0x1b0aa8=_0x3eb531[a92_0x42e1('0x2a')];const _0x31e4df=Date[a92_0x42e1('0x27')](_0x3eb531['EndTime']);if(_0x203a25>0x0){exports['sequelize']['models']['passes'][a92_0x42e1('0x2b')]({'reportFileId':_0x3ae5a8['id'],'amount':_0x203a25,'countingDate':_0x31e4df});}if(_0x1b0aa8>0x0){exports[a92_0x42e1('0x4')][a92_0x42e1('0x18')]['passes'][a92_0x42e1('0x2b')]({'reportFileId':_0x3ae5a8['id'],'amount':_0x1b0aa8*-0x1,'countingDate':_0x31e4df});}}_0x3ae5a8['status']=0x2;}catch(_0x11d3be){_0x3ae5a8[a92_0x42e1('0x21')]=null;}}_0x3ae5a8[a92_0x42e1('0x2c')]();});_0x3d0a20[a92_0x42e1('0x10')]({'data':_0x3ae5a8[a92_0x42e1('0x1c')]});}else{_0x3d0a20[a92_0x42e1('0x10')]({'data':[]});}});};exports[a92_0x42e1('0x2d')]=(_0x4b1636,_0x556c44)=>{exports[a92_0x42e1('0x4')][a92_0x42e1('0x18')][a92_0x42e1('0x2e')][a92_0x42e1('0x2f')]({'where':{'amount':{[exports[a92_0x42e1('0x4')]['Op']['gt']]:0x0}},'order':[['countingDate','ASC']]})[a92_0x42e1('0x24')](_0x3f3eb4=>{_0x556c44[a92_0x42e1('0x10')]({'data':_0x3f3eb4});});};exports[a92_0x42e1('0x30')]=(_0x440b52,_0x5d756a)=>{const _0x17d17e=_0x440b52[a92_0x42e1('0x31')]['month'];const _0x4609cf=_0x440b52[a92_0x42e1('0x31')]['startDate'];const _0x2e6033=_0x440b52['query']['endDate'];exports[a92_0x42e1('0x4')][a92_0x42e1('0x18')][a92_0x42e1('0x2e')][a92_0x42e1('0x2f')]({'attributes':[a92_0x42e1('0x32'),[exports[a92_0x42e1('0x4')]['fn'](a92_0x42e1('0x33'),exports['sequelize'][a92_0x42e1('0x34')](a92_0x42e1('0x35'))),a92_0x42e1('0x36')]],'where':{'countingDate':{[exports[a92_0x42e1('0x4')]['Op'][a92_0x42e1('0x37')]]:_0x4609cf,[exports[a92_0x42e1('0x4')]['Op']['lt']]:_0x2e6033},'amount':_0x440b52['params']['direction']=='in'?{[exports[a92_0x42e1('0x4')]['Op']['gt']]:0x0}:{[exports[a92_0x42e1('0x4')]['Op']['lt']]:0x0}},'group':[exports[a92_0x42e1('0x4')]['literal']('YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))')],'order':[[a92_0x42e1('0x32'),a92_0x42e1('0x38')]]})['then'](_0x406b75=>{_0x5d756a[a92_0x42e1('0x10')]({'data':_0x406b75});});};exports['getPassCountingByHour']=(_0x4753f4,_0x44097b)=>{const _0x3ecb38=_0x4753f4[a92_0x42e1('0x31')]['month'];const _0x4c317c=_0x4753f4[a92_0x42e1('0x31')][a92_0x42e1('0x39')];const _0x532f1c=_0x4753f4['query'][a92_0x42e1('0x3a')];exports['sequelize'][a92_0x42e1('0x18')]['passes']['findAll']({'attributes':['countingDate',[exports['sequelize']['fn'](a92_0x42e1('0x3b'),exports[a92_0x42e1('0x4')]['col'](a92_0x42e1('0x32')),'%Y-%m-%d\x20%H:00'),a92_0x42e1('0x3c')],[exports[a92_0x42e1('0x4')]['fn'](a92_0x42e1('0x33'),exports[a92_0x42e1('0x4')][a92_0x42e1('0x34')](a92_0x42e1('0x35'))),a92_0x42e1('0x36')]],'where':{'countingDate':{[exports[a92_0x42e1('0x4')]['Op'][a92_0x42e1('0x37')]]:_0x4c317c,[exports['sequelize']['Op']['lt']]:_0x532f1c},'amount':_0x4753f4['params'][a92_0x42e1('0x3d')]=='in'?{[exports[a92_0x42e1('0x4')]['Op']['gt']]:0x0}:{[exports[a92_0x42e1('0x4')]['Op']['lt']]:0x0}},'group':[exports[a92_0x42e1('0x4')]['fn'](a92_0x42e1('0x3e'),exports[a92_0x42e1('0x4')][a92_0x42e1('0x34')](a92_0x42e1('0x32'))),exports[a92_0x42e1('0x4')]['fn'](a92_0x42e1('0x3f'),exports[a92_0x42e1('0x4')]['col'](a92_0x42e1('0x32'))),exports[a92_0x42e1('0x4')]['fn'](a92_0x42e1('0x40'),exports[a92_0x42e1('0x4')][a92_0x42e1('0x34')](a92_0x42e1('0x32'))),exports[a92_0x42e1('0x4')]['fn'](a92_0x42e1('0x41'),exports[a92_0x42e1('0x4')][a92_0x42e1('0x34')](a92_0x42e1('0x32')))],'order':[[a92_0x42e1('0x32'),a92_0x42e1('0x38')]]})[a92_0x42e1('0x24')](_0x32397d=>{_0x44097b[a92_0x42e1('0x10')]({'data':_0x32397d});});};exports[a92_0x42e1('0x42')]=(_0x1972e1,_0x514265,_0x4f6be1)=>{const _0x4adec7=_0x1972e1['user'][a92_0x42e1('0x43')][a92_0x42e1('0x44')](_0x4adec7=>_0x4adec7['kind']==='facebook');fbgraph_1[a92_0x42e1('0xa')][a92_0x42e1('0x45')](_0x4adec7[a92_0x42e1('0x46')]);fbgraph_1[a92_0x42e1('0xa')][a92_0x42e1('0x47')](_0x1972e1['user'][a92_0x42e1('0x48')]+'?fields=id,name,email,first_name,last_name,gender,link,locale,timezone',(_0xc6d20c,_0x1abcc1)=>{if(_0xc6d20c){return _0x4f6be1(_0xc6d20c);}_0x514265[a92_0x42e1('0x6')](a92_0x42e1('0x49'),{'title':a92_0x42e1('0x4a'),'profile':_0x1abcc1});});};