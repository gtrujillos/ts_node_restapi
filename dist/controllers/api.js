var a92_0xcbe4=['name','json','models','reportFiles','spread','push','connect','ftp.vivotek.com','ipd','downloadFtp','then','ready','connected:','fileName','get','colombia/','end','media/','.txt','createWriteStream','save','Downloaded:\x20','default','readFile','utf8','status','parse','Data','CountingInfo','EndTime','passes','create','getPassCounting','findAll','getPassCountingByDay','query','month','endDate','countingDate','sum','col','amount','total','gte','direction','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','startDate','countingDateShort','params','HOUR','DAY','ASC','getFacebook','user','find','kind','facebook','setAccessToken','accessToken','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','api/facebook','Facebook\x20API','__importDefault','__esModule','defineProperty','sequelize','setSequelize','api/index','API\x20Examples','syncFtp','log','connected','list','colombia','Downloading:\x20'];(function(_0x471731,_0x50c478){var _0x46091a=function(_0x4438fb){while(--_0x4438fb){_0x471731['push'](_0x471731['shift']());}};_0x46091a(++_0x50c478);}(a92_0xcbe4,0x8d));var a92_0x49f9=function(_0x4c4997,_0x432421){_0x4c4997=_0x4c4997-0x0;var _0x4d93c3=a92_0xcbe4[_0x4c4997];return _0x4d93c3;};'use strict';var __importDefault=this&&this[a92_0x49f9('0x0')]||function(_0x4ee3cb){return _0x4ee3cb&&_0x4ee3cb[a92_0x49f9('0x1')]?_0x4ee3cb:{'default':_0x4ee3cb};};Object[a92_0x49f9('0x2')](exports,'__esModule',{'value':!![]});const fbgraph_1=__importDefault(require('fbgraph'));const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));function setSequelize(_0x34a25b){exports[a92_0x49f9('0x3')]=_0x34a25b;}exports[a92_0x49f9('0x4')]=setSequelize;exports['getApi']=(_0x58f757,_0x14f27b)=>{_0x14f27b['render'](a92_0x49f9('0x5'),{'title':a92_0x49f9('0x6')});};exports[a92_0x49f9('0x7')]=(_0x525138,_0x626ab3)=>{console[a92_0x49f9('0x8')]('connecting');const _0x510e04=[];const _0x57a20c=new ftp_1['default']();_0x57a20c['on']('ready',function(){console[a92_0x49f9('0x8')](a92_0x49f9('0x9'));_0x57a20c[a92_0x49f9('0xa')](a92_0x49f9('0xb'),![],function(_0x37e4df,_0x182142){if(_0x37e4df){}else{for(const _0x12c5b8 of _0x182142){console[a92_0x49f9('0x8')](a92_0x49f9('0xc')+_0x12c5b8[a92_0x49f9('0xd')]);if(_0x12c5b8['name']['endsWith'](a92_0x49f9('0xe'))){exports[a92_0x49f9('0x3')][a92_0x49f9('0xf')][a92_0x49f9('0x10')]['findOrCreate']({'where':{'fileName':_0x12c5b8[a92_0x49f9('0xd')]}})[a92_0x49f9('0x11')]((_0x1b580e,_0x3e7c7d)=>{if(_0x3e7c7d){console[a92_0x49f9('0x8')](_0x12c5b8['name']);_0x510e04[a92_0x49f9('0x12')](_0x1b580e);}});}}}_0x626ab3[a92_0x49f9('0xe')]({'data':_0x510e04});});});_0x57a20c['on']('error',function(_0xc40308){_0x626ab3['json']({'message':_0xc40308});});_0x57a20c[a92_0x49f9('0x13')]({'host':a92_0x49f9('0x14'),'port':0x15,'user':a92_0x49f9('0x15'),'password':'ipd'});};exports[a92_0x49f9('0x16')]=(_0x1b6b90,_0x34b8f9)=>{exports[a92_0x49f9('0x3')]['models'][a92_0x49f9('0x10')]['findOne']({'where':{'status':null}})[a92_0x49f9('0x17')](_0x2b1909=>{if(_0x2b1909){const _0x4ad542=new ftp_1['default']();_0x4ad542['on'](a92_0x49f9('0x18'),function(){console[a92_0x49f9('0x8')](a92_0x49f9('0x19')+_0x2b1909[a92_0x49f9('0x1a')]);_0x4ad542[a92_0x49f9('0x1b')](a92_0x49f9('0x1c')+_0x2b1909['fileName'],function(_0x13b6cd,_0x318bb2){_0x4ad542[a92_0x49f9('0x1d')]();if(_0x13b6cd){}else{const _0x576993=a92_0x49f9('0x1e')+_0x2b1909[a92_0x49f9('0x1a')]+a92_0x49f9('0x1f');_0x318bb2['pipe'](fs_1['default'][a92_0x49f9('0x20')](_0x576993));_0x2b1909['status']=0x1;_0x2b1909[a92_0x49f9('0x21')]();console[a92_0x49f9('0x8')](a92_0x49f9('0x22')+_0x2b1909[a92_0x49f9('0x1a')]);}});});_0x4ad542['on']('error',function(_0x9a08b7){_0x34b8f9['json']({'message':_0x9a08b7});});_0x4ad542[a92_0x49f9('0x13')]({'host':a92_0x49f9('0x14'),'port':0x15,'user':a92_0x49f9('0x15'),'password':a92_0x49f9('0x15')});_0x34b8f9[a92_0x49f9('0xe')]({'data':_0x2b1909[a92_0x49f9('0x1a')]});}else{_0x34b8f9['json']({'data':[]});}});};exports['processFtp']=(_0x20eee1,_0x4f0bd9)=>{exports[a92_0x49f9('0x3')]['models']['reportFiles']['findOne']({'where':{'status':0x1}})['then'](_0x30c686=>{if(_0x30c686){const _0x911826=a92_0x49f9('0x1e')+_0x30c686['fileName']+a92_0x49f9('0x1f');fs_1[a92_0x49f9('0x23')][a92_0x49f9('0x24')](_0x911826,a92_0x49f9('0x25'),function(_0x3f360c,_0x17b9b7){if(_0x3f360c){_0x30c686[a92_0x49f9('0x26')]=null;}else{try{const _0x4980e3=JSON[a92_0x49f9('0x27')](_0x17b9b7);for(const _0xc18da5 of _0x4980e3[a92_0x49f9('0x28')][0x0][a92_0x49f9('0x29')]){const _0x460f8c=_0xc18da5['In'];const _0x368bbf=_0xc18da5['Out'];const _0x247d3c=Date[a92_0x49f9('0x27')](_0xc18da5[a92_0x49f9('0x2a')]);if(_0x460f8c>0x0){exports['sequelize'][a92_0x49f9('0xf')][a92_0x49f9('0x2b')][a92_0x49f9('0x2c')]({'reportFileId':_0x30c686['id'],'amount':_0x460f8c,'countingDate':_0x247d3c});}if(_0x368bbf>0x0){exports[a92_0x49f9('0x3')][a92_0x49f9('0xf')][a92_0x49f9('0x2b')][a92_0x49f9('0x2c')]({'reportFileId':_0x30c686['id'],'amount':_0x368bbf*-0x1,'countingDate':_0x247d3c});}}_0x30c686[a92_0x49f9('0x26')]=0x2;}catch(_0x5375bf){_0x30c686['status']=null;}}_0x30c686['save']();});_0x4f0bd9[a92_0x49f9('0xe')]({'data':_0x30c686[a92_0x49f9('0x1a')]});}else{_0x4f0bd9['json']({'data':[]});}});};exports[a92_0x49f9('0x2d')]=(_0x510fa4,_0x81de11)=>{exports['sequelize']['models']['passes'][a92_0x49f9('0x2e')]({'where':{'amount':{[exports[a92_0x49f9('0x3')]['Op']['gt']]:0x0}},'order':[['countingDate','ASC']]})['then'](_0x155543=>{_0x81de11[a92_0x49f9('0xe')]({'data':_0x155543});});};exports[a92_0x49f9('0x2f')]=(_0x4d8888,_0xd6d4d9)=>{const _0x4ae1c4=_0x4d8888[a92_0x49f9('0x30')][a92_0x49f9('0x31')];const _0x54b0f0=_0x4d8888[a92_0x49f9('0x30')]['startDate'];const _0x29273d=_0x4d8888[a92_0x49f9('0x30')][a92_0x49f9('0x32')];exports[a92_0x49f9('0x3')][a92_0x49f9('0xf')][a92_0x49f9('0x2b')][a92_0x49f9('0x2e')]({'attributes':[a92_0x49f9('0x33'),[exports['sequelize']['fn'](a92_0x49f9('0x34'),exports['sequelize'][a92_0x49f9('0x35')](a92_0x49f9('0x36'))),a92_0x49f9('0x37')]],'where':{'countingDate':{[exports[a92_0x49f9('0x3')]['Op'][a92_0x49f9('0x38')]]:_0x54b0f0,[exports[a92_0x49f9('0x3')]['Op']['lt']]:_0x29273d},'amount':_0x4d8888['params'][a92_0x49f9('0x39')]=='in'?{[exports[a92_0x49f9('0x3')]['Op']['gt']]:0x0}:{[exports[a92_0x49f9('0x3')]['Op']['lt']]:0x0}},'group':[exports[a92_0x49f9('0x3')][a92_0x49f9('0x3a')](a92_0x49f9('0x3b'))],'order':[[a92_0x49f9('0x33'),'ASC']]})[a92_0x49f9('0x17')](_0x99c150=>{_0xd6d4d9[a92_0x49f9('0xe')]({'data':_0x99c150});});};exports[a92_0x49f9('0x3c')]=(_0x453547,_0x3e06f3)=>{const _0x3c9284=_0x453547[a92_0x49f9('0x30')][a92_0x49f9('0x31')];const _0x1b2d4f=_0x453547[a92_0x49f9('0x30')][a92_0x49f9('0x3d')];const _0x203ac4=_0x453547['query'][a92_0x49f9('0x32')];exports[a92_0x49f9('0x3')][a92_0x49f9('0xf')][a92_0x49f9('0x2b')]['findAll']({'attributes':[a92_0x49f9('0x33'),[exports[a92_0x49f9('0x3')]['fn']('DATE_FORMAT',exports[a92_0x49f9('0x3')][a92_0x49f9('0x35')]('countingDate'),'%Y-%m-%d\x20%H:00'),a92_0x49f9('0x3e')],[exports['sequelize']['fn']('sum',exports[a92_0x49f9('0x3')][a92_0x49f9('0x35')](a92_0x49f9('0x36'))),a92_0x49f9('0x37')]],'where':{'countingDate':{[exports[a92_0x49f9('0x3')]['Op'][a92_0x49f9('0x38')]]:_0x1b2d4f,[exports[a92_0x49f9('0x3')]['Op']['lt']]:_0x203ac4},'amount':_0x453547[a92_0x49f9('0x3f')][a92_0x49f9('0x39')]=='in'?{[exports[a92_0x49f9('0x3')]['Op']['gt']]:0x0}:{[exports[a92_0x49f9('0x3')]['Op']['lt']]:0x0}},'group':[exports[a92_0x49f9('0x3')]['fn'](a92_0x49f9('0x40'),exports['sequelize'][a92_0x49f9('0x35')]('countingDate')),exports[a92_0x49f9('0x3')]['fn'](a92_0x49f9('0x41'),exports[a92_0x49f9('0x3')]['col'](a92_0x49f9('0x33'))),exports[a92_0x49f9('0x3')]['fn']('MONTH',exports[a92_0x49f9('0x3')][a92_0x49f9('0x35')](a92_0x49f9('0x33'))),exports['sequelize']['fn']('YEAR',exports[a92_0x49f9('0x3')][a92_0x49f9('0x35')](a92_0x49f9('0x33')))],'order':[[a92_0x49f9('0x33'),a92_0x49f9('0x42')]]})[a92_0x49f9('0x17')](_0x318fea=>{_0x3e06f3['json']({'data':_0x318fea});});};exports[a92_0x49f9('0x43')]=(_0x3a32c9,_0x1317fb,_0x4897e8)=>{const _0x144bc7=_0x3a32c9[a92_0x49f9('0x44')]['tokens'][a92_0x49f9('0x45')](_0x144bc7=>_0x144bc7[a92_0x49f9('0x46')]===a92_0x49f9('0x47'));fbgraph_1[a92_0x49f9('0x23')][a92_0x49f9('0x48')](_0x144bc7[a92_0x49f9('0x49')]);fbgraph_1['default']['get'](_0x3a32c9[a92_0x49f9('0x44')][a92_0x49f9('0x47')]+a92_0x49f9('0x4a'),(_0x2bb006,_0x249d2c)=>{if(_0x2bb006){return _0x4897e8(_0x2bb006);}_0x1317fb['render'](a92_0x49f9('0x4b'),{'title':a92_0x49f9('0x4c'),'profile':_0x249d2c});});};