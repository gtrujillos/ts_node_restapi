var a180_0x8e0e=['findOrCreate','push','error','ftp.vivotek.com','ipd','downloadFtp','then','connected:','fileName','get','colombia/','end','.txt','createWriteStream','status','save','Downloaded:\x20','connect','processFtp','findOne','media/','utf8','parse','Data','CountingInfo','EndTime','passes','create','getPassCounting','findAll','countingDate','query','startDate','endDate','gte','params','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','ASC','getPassCountingByHour','month','countingDateShort','col','amount','total','HOUR','DAY','MONTH','getFacebook','tokens','find','kind','setAccessToken','accessToken','facebook','api/facebook','Facebook\x20API','__importDefault','__esModule','defineProperty','fbgraph','sequelize','getApi','render','API\x20Examples','syncFtp','log','connecting','default','ready','connected','colombia','Downloading:\x20','name','endsWith','json','models','reportFiles'];(function(_0x84d992,_0x5e2293){var _0x14ca9c=function(_0x43cb44){while(--_0x43cb44){_0x84d992['push'](_0x84d992['shift']());}};_0x14ca9c(++_0x5e2293);}(a180_0x8e0e,0x171));var a180_0x1655=function(_0x4d0e9a,_0x4a9611){_0x4d0e9a=_0x4d0e9a-0x0;var _0x57b65c=a180_0x8e0e[_0x4d0e9a];return _0x57b65c;};'use strict';var __importDefault=this&&this[a180_0x1655('0x0')]||function(_0x58293d){return _0x58293d&&_0x58293d[a180_0x1655('0x1')]?_0x58293d:{'default':_0x58293d};};Object[a180_0x1655('0x2')](exports,'__esModule',{'value':!![]});const fbgraph_1=__importDefault(require(a180_0x1655('0x3')));const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));function setSequelize(_0x429f2e){exports[a180_0x1655('0x4')]=_0x429f2e;}exports['setSequelize']=setSequelize;exports[a180_0x1655('0x5')]=(_0x593b51,_0x172a3b)=>{_0x172a3b[a180_0x1655('0x6')]('api/index',{'title':a180_0x1655('0x7')});};exports[a180_0x1655('0x8')]=(_0x562887,_0x12d77d)=>{console[a180_0x1655('0x9')](a180_0x1655('0xa'));const _0x5184e5=[];const _0x4fc9b7=new ftp_1[(a180_0x1655('0xb'))]();_0x4fc9b7['on'](a180_0x1655('0xc'),function(){console[a180_0x1655('0x9')](a180_0x1655('0xd'));_0x4fc9b7['list'](a180_0x1655('0xe'),![],function(_0xa981fe,_0x29e4f5){if(_0xa981fe){}else{for(const _0x3af25a of _0x29e4f5){console[a180_0x1655('0x9')](a180_0x1655('0xf')+_0x3af25a[a180_0x1655('0x10')]);if(_0x3af25a[a180_0x1655('0x10')][a180_0x1655('0x11')](a180_0x1655('0x12'))){exports['sequelize'][a180_0x1655('0x13')][a180_0x1655('0x14')][a180_0x1655('0x15')]({'where':{'fileName':_0x3af25a[a180_0x1655('0x10')]}})['spread']((_0x229c61,_0x273e02)=>{if(_0x273e02){console[a180_0x1655('0x9')](_0x3af25a[a180_0x1655('0x10')]);_0x5184e5[a180_0x1655('0x16')](_0x229c61);}});}}}_0x12d77d[a180_0x1655('0x12')]({'data':_0x5184e5});});});_0x4fc9b7['on'](a180_0x1655('0x17'),function(_0x4550af){_0x12d77d[a180_0x1655('0x12')]({'message':_0x4550af});});_0x4fc9b7['connect']({'host':a180_0x1655('0x18'),'port':0x15,'user':a180_0x1655('0x19'),'password':'ipd'});};exports[a180_0x1655('0x1a')]=(_0x3cb612,_0x356a01)=>{exports[a180_0x1655('0x4')][a180_0x1655('0x13')][a180_0x1655('0x14')]['findOne']({'where':{'status':null}})[a180_0x1655('0x1b')](_0xe31a8a=>{if(_0xe31a8a){const _0x5eef6f=new ftp_1['default']();_0x5eef6f['on'](a180_0x1655('0xc'),function(){console['log'](a180_0x1655('0x1c')+_0xe31a8a[a180_0x1655('0x1d')]);_0x5eef6f[a180_0x1655('0x1e')](a180_0x1655('0x1f')+_0xe31a8a[a180_0x1655('0x1d')],function(_0x31eb33,_0x5c203d){_0x5eef6f[a180_0x1655('0x20')]();if(_0x31eb33){}else{const _0x498a21='media/'+_0xe31a8a[a180_0x1655('0x1d')]+a180_0x1655('0x21');_0x5c203d['pipe'](fs_1[a180_0x1655('0xb')][a180_0x1655('0x22')](_0x498a21));_0xe31a8a[a180_0x1655('0x23')]=0x1;_0xe31a8a[a180_0x1655('0x24')]();console[a180_0x1655('0x9')](a180_0x1655('0x25')+_0xe31a8a[a180_0x1655('0x1d')]);}});});_0x5eef6f['on'](a180_0x1655('0x17'),function(_0x25951e){_0x356a01[a180_0x1655('0x12')]({'message':_0x25951e});});_0x5eef6f[a180_0x1655('0x26')]({'host':a180_0x1655('0x18'),'port':0x15,'user':a180_0x1655('0x19'),'password':a180_0x1655('0x19')});_0x356a01[a180_0x1655('0x12')]({'data':_0xe31a8a[a180_0x1655('0x1d')]});}else{_0x356a01[a180_0x1655('0x12')]({'data':[]});}});};exports[a180_0x1655('0x27')]=(_0xc15d19,_0x4a483c)=>{exports[a180_0x1655('0x4')][a180_0x1655('0x13')][a180_0x1655('0x14')][a180_0x1655('0x28')]({'where':{'status':0x1}})['then'](_0x4d4d48=>{if(_0x4d4d48){const _0x4f896a=a180_0x1655('0x29')+_0x4d4d48[a180_0x1655('0x1d')]+a180_0x1655('0x21');fs_1['default']['readFile'](_0x4f896a,a180_0x1655('0x2a'),function(_0x2c1c70,_0x1d0ef6){if(_0x2c1c70){_0x4d4d48[a180_0x1655('0x23')]=null;}else{try{const _0x140f2c=JSON[a180_0x1655('0x2b')](_0x1d0ef6);for(const _0x3a62fa of _0x140f2c[a180_0x1655('0x2c')][0x0][a180_0x1655('0x2d')]){const _0x412454=_0x3a62fa['In'];const _0x163627=_0x3a62fa['Out'];const _0x5c7843=Date[a180_0x1655('0x2b')](_0x3a62fa[a180_0x1655('0x2e')]);if(_0x412454>0x0){exports[a180_0x1655('0x4')][a180_0x1655('0x13')][a180_0x1655('0x2f')][a180_0x1655('0x30')]({'reportFileId':_0x4d4d48['id'],'amount':_0x412454,'countingDate':_0x5c7843});}if(_0x163627>0x0){exports[a180_0x1655('0x4')]['models']['passes']['create']({'reportFileId':_0x4d4d48['id'],'amount':_0x163627*-0x1,'countingDate':_0x5c7843});}}_0x4d4d48['status']=0x2;}catch(_0x59cf0b){_0x4d4d48[a180_0x1655('0x23')]=null;}}_0x4d4d48['save']();});_0x4a483c[a180_0x1655('0x12')]({'data':_0x4d4d48[a180_0x1655('0x1d')]});}else{_0x4a483c['json']({'data':[]});}});};exports[a180_0x1655('0x31')]=(_0x5000c6,_0x73553)=>{exports[a180_0x1655('0x4')][a180_0x1655('0x13')][a180_0x1655('0x2f')][a180_0x1655('0x32')]({'where':{'amount':{[exports[a180_0x1655('0x4')]['Op']['gt']]:0x0}},'order':[[a180_0x1655('0x33'),'ASC']]})[a180_0x1655('0x1b')](_0x475c93=>{_0x73553[a180_0x1655('0x12')]({'data':_0x475c93});});};exports['getPassCountingByDay']=(_0x36923f,_0x4e3d55)=>{const _0x2ae502=_0x36923f['query']['month'];const _0x43e735=_0x36923f[a180_0x1655('0x34')][a180_0x1655('0x35')];const _0x4c760b=_0x36923f['query'][a180_0x1655('0x36')];exports[a180_0x1655('0x4')][a180_0x1655('0x13')]['passes']['findAll']({'attributes':[a180_0x1655('0x33'),[exports[a180_0x1655('0x4')]['fn']('sum',exports[a180_0x1655('0x4')]['col']('amount')),'total']],'where':{'countingDate':{[exports[a180_0x1655('0x4')]['Op'][a180_0x1655('0x37')]]:_0x43e735,[exports[a180_0x1655('0x4')]['Op']['lt']]:_0x4c760b},'amount':_0x36923f[a180_0x1655('0x38')]['direction']=='in'?{[exports[a180_0x1655('0x4')]['Op']['gt']]:0x0}:{[exports[a180_0x1655('0x4')]['Op']['lt']]:0x0}},'group':[exports[a180_0x1655('0x4')][a180_0x1655('0x39')](a180_0x1655('0x3a'))],'order':[['countingDate',a180_0x1655('0x3b')]]})[a180_0x1655('0x1b')](_0x5b36ef=>{_0x4e3d55[a180_0x1655('0x12')]({'data':_0x5b36ef});});};exports[a180_0x1655('0x3c')]=(_0x30990e,_0x47991d)=>{const _0x3cb0ef=_0x30990e[a180_0x1655('0x34')][a180_0x1655('0x3d')];const _0x568fdf=_0x30990e[a180_0x1655('0x34')][a180_0x1655('0x35')];const _0x14f817=_0x30990e[a180_0x1655('0x34')]['endDate'];exports[a180_0x1655('0x4')][a180_0x1655('0x13')][a180_0x1655('0x2f')]['findAll']({'attributes':['countingDate',[exports[a180_0x1655('0x4')]['fn']('DATE_FORMAT',exports['sequelize']['col'](a180_0x1655('0x33')),'%Y-%m-%d\x20%H:00'),a180_0x1655('0x3e')],[exports['sequelize']['fn']('sum',exports['sequelize'][a180_0x1655('0x3f')](a180_0x1655('0x40'))),a180_0x1655('0x41')]],'where':{'countingDate':{[exports[a180_0x1655('0x4')]['Op']['gte']]:_0x568fdf,[exports[a180_0x1655('0x4')]['Op']['lt']]:_0x14f817},'amount':_0x30990e[a180_0x1655('0x38')]['direction']=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports[a180_0x1655('0x4')]['fn'](a180_0x1655('0x42'),exports[a180_0x1655('0x4')]['col'](a180_0x1655('0x33'))),exports[a180_0x1655('0x4')]['fn'](a180_0x1655('0x43'),exports[a180_0x1655('0x4')]['col']('countingDate')),exports[a180_0x1655('0x4')]['fn'](a180_0x1655('0x44'),exports[a180_0x1655('0x4')][a180_0x1655('0x3f')](a180_0x1655('0x33'))),exports[a180_0x1655('0x4')]['fn']('YEAR',exports[a180_0x1655('0x4')][a180_0x1655('0x3f')](a180_0x1655('0x33')))],'order':[[a180_0x1655('0x33'),a180_0x1655('0x3b')]]})[a180_0x1655('0x1b')](_0xbdfe1a=>{_0x47991d[a180_0x1655('0x12')]({'data':_0xbdfe1a});});};exports[a180_0x1655('0x45')]=(_0x294aed,_0x1a50a9,_0x494994)=>{const _0x3685d9=_0x294aed['user'][a180_0x1655('0x46')][a180_0x1655('0x47')](_0x3685d9=>_0x3685d9[a180_0x1655('0x48')]==='facebook');fbgraph_1[a180_0x1655('0xb')][a180_0x1655('0x49')](_0x3685d9[a180_0x1655('0x4a')]);fbgraph_1[a180_0x1655('0xb')][a180_0x1655('0x1e')](_0x294aed['user'][a180_0x1655('0x4b')]+'?fields=id,name,email,first_name,last_name,gender,link,locale,timezone',(_0x69af6a,_0x4dc560)=>{if(_0x69af6a){return _0x494994(_0x69af6a);}_0x1a50a9[a180_0x1655('0x6')](a180_0x1655('0x4c'),{'title':a180_0x1655('0x4d'),'profile':_0x4dc560});});};