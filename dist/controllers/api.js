var a92_0x2804=['push','error','connect','ftp.vivotek.com','ipd','findOne','then','default','fileName','get','end','media/','pipe','createWriteStream','save','Downloaded:\x20','processFtp','.txt','readFile','utf8','status','parse','Data','CountingInfo','Out','EndTime','passes','create','getPassCountingByDay','query','month','startDate','endDate','countingDate','sum','col','amount','total','gte','params','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','ASC','findAll','DATE_FORMAT','%Y-%m-%d\x20%H:00','countingDateShort','direction','HOUR','DAY','MONTH','YEAR','getFacebook','user','tokens','find','facebook','setAccessToken','api/facebook','Facebook\x20API','__importDefault','defineProperty','__esModule','fbgraph','ftp','sequelize','setSequelize','getApi','render','api/index','API\x20Examples','syncFtp','log','connecting','ready','list','colombia','Downloading:\x20','name','endsWith','json','models','reportFiles'];(function(_0x47e785,_0x53aa05){var _0x48b83d=function(_0x3f8cb7){while(--_0x3f8cb7){_0x47e785['push'](_0x47e785['shift']());}};_0x48b83d(++_0x53aa05);}(a92_0x2804,0x1db));var a92_0x36d2=function(_0x51d61e,_0x5c4e07){_0x51d61e=_0x51d61e-0x0;var _0x4c8b47=a92_0x2804[_0x51d61e];return _0x4c8b47;};'use strict';var __importDefault=this&&this[a92_0x36d2('0x0')]||function(_0xec30e5){return _0xec30e5&&_0xec30e5['__esModule']?_0xec30e5:{'default':_0xec30e5};};Object[a92_0x36d2('0x1')](exports,a92_0x36d2('0x2'),{'value':!![]});const fbgraph_1=__importDefault(require(a92_0x36d2('0x3')));const ftp_1=__importDefault(require(a92_0x36d2('0x4')));const fs_1=__importDefault(require('fs'));function setSequelize(_0x50c2a9){exports[a92_0x36d2('0x5')]=_0x50c2a9;}exports[a92_0x36d2('0x6')]=setSequelize;exports[a92_0x36d2('0x7')]=(_0x482e66,_0x4e2665)=>{_0x4e2665[a92_0x36d2('0x8')](a92_0x36d2('0x9'),{'title':a92_0x36d2('0xa')});};exports[a92_0x36d2('0xb')]=(_0x400582,_0x285365)=>{console[a92_0x36d2('0xc')](a92_0x36d2('0xd'));const _0x57643f=[];const _0xced4b=new ftp_1['default']();_0xced4b['on'](a92_0x36d2('0xe'),function(){console[a92_0x36d2('0xc')]('connected');_0xced4b[a92_0x36d2('0xf')](a92_0x36d2('0x10'),![],function(_0x51f1c0,_0x4076c1){if(_0x51f1c0){}else{for(const _0x4820c of _0x4076c1){console[a92_0x36d2('0xc')](a92_0x36d2('0x11')+_0x4820c['name']);if(_0x4820c[a92_0x36d2('0x12')][a92_0x36d2('0x13')](a92_0x36d2('0x14'))){exports[a92_0x36d2('0x5')][a92_0x36d2('0x15')][a92_0x36d2('0x16')]['findOrCreate']({'where':{'fileName':_0x4820c['name']}})['spread']((_0x15c729,_0x355069)=>{if(_0x355069){console[a92_0x36d2('0xc')](_0x4820c['name']);_0x57643f[a92_0x36d2('0x17')](_0x15c729);}});}}}_0x285365[a92_0x36d2('0x14')]({'data':_0x57643f});});});_0xced4b['on'](a92_0x36d2('0x18'),function(_0x2b30a4){_0x285365[a92_0x36d2('0x14')]({'message':_0x2b30a4});});_0xced4b[a92_0x36d2('0x19')]({'host':a92_0x36d2('0x1a'),'port':0x15,'user':a92_0x36d2('0x1b'),'password':a92_0x36d2('0x1b')});};exports['downloadFtp']=(_0x10bd1f,_0x3f1fa5)=>{exports[a92_0x36d2('0x5')][a92_0x36d2('0x15')][a92_0x36d2('0x16')][a92_0x36d2('0x1c')]({'where':{'status':null}})[a92_0x36d2('0x1d')](_0x42a7e5=>{if(_0x42a7e5){const _0x218040=new ftp_1[(a92_0x36d2('0x1e'))]();_0x218040['on'](a92_0x36d2('0xe'),function(){console[a92_0x36d2('0xc')]('connected:'+_0x42a7e5[a92_0x36d2('0x1f')]);_0x218040[a92_0x36d2('0x20')]('colombia/'+_0x42a7e5[a92_0x36d2('0x1f')],function(_0xe056e8,_0x412871){_0x218040[a92_0x36d2('0x21')]();if(_0xe056e8){}else{const _0x12de51=a92_0x36d2('0x22')+_0x42a7e5[a92_0x36d2('0x1f')]+'.txt';_0x412871[a92_0x36d2('0x23')](fs_1[a92_0x36d2('0x1e')][a92_0x36d2('0x24')](_0x12de51));_0x42a7e5['status']=0x1;_0x42a7e5[a92_0x36d2('0x25')]();console['log'](a92_0x36d2('0x26')+_0x42a7e5[a92_0x36d2('0x1f')]);}});});_0x218040['on'](a92_0x36d2('0x18'),function(_0x4c1f96){_0x3f1fa5[a92_0x36d2('0x14')]({'message':_0x4c1f96});});_0x218040[a92_0x36d2('0x19')]({'host':'ftp.vivotek.com','port':0x15,'user':a92_0x36d2('0x1b'),'password':'ipd'});_0x3f1fa5[a92_0x36d2('0x14')]({'data':_0x42a7e5[a92_0x36d2('0x1f')]});}else{_0x3f1fa5['json']({'data':[]});}});};exports[a92_0x36d2('0x27')]=(_0xd28265,_0x284056)=>{exports['sequelize'][a92_0x36d2('0x15')]['reportFiles'][a92_0x36d2('0x1c')]({'where':{'status':0x1}})[a92_0x36d2('0x1d')](_0x51a8fc=>{if(_0x51a8fc){const _0x52b386='media/'+_0x51a8fc[a92_0x36d2('0x1f')]+a92_0x36d2('0x28');fs_1[a92_0x36d2('0x1e')][a92_0x36d2('0x29')](_0x52b386,a92_0x36d2('0x2a'),function(_0x546917,_0x30d4ad){if(_0x546917){_0x51a8fc[a92_0x36d2('0x2b')]=null;}else{try{const _0x15e4a9=JSON[a92_0x36d2('0x2c')](_0x30d4ad);for(const _0x181f99 of _0x15e4a9[a92_0x36d2('0x2d')][0x0][a92_0x36d2('0x2e')]){const _0x21a6d8=_0x181f99['In'];const _0x20483b=_0x181f99[a92_0x36d2('0x2f')];const _0x16ccd5=Date['parse'](_0x181f99[a92_0x36d2('0x30')]);if(_0x21a6d8>0x0){exports[a92_0x36d2('0x5')]['models'][a92_0x36d2('0x31')][a92_0x36d2('0x32')]({'reportFileId':_0x51a8fc['id'],'amount':_0x21a6d8,'countingDate':_0x16ccd5});}if(_0x20483b>0x0){exports['sequelize'][a92_0x36d2('0x15')][a92_0x36d2('0x31')]['create']({'reportFileId':_0x51a8fc['id'],'amount':_0x20483b*-0x1,'countingDate':_0x16ccd5});}}_0x51a8fc[a92_0x36d2('0x2b')]=0x2;}catch(_0x37b7b5){_0x51a8fc[a92_0x36d2('0x2b')]=null;}}_0x51a8fc['save']();});_0x284056[a92_0x36d2('0x14')]({'data':_0x51a8fc[a92_0x36d2('0x1f')]});}else{_0x284056['json']({'data':[]});}});};exports['getPassCounting']=(_0x416463,_0x4d46cf)=>{exports[a92_0x36d2('0x5')][a92_0x36d2('0x15')][a92_0x36d2('0x31')]['findAll']({'where':{'amount':{[exports[a92_0x36d2('0x5')]['Op']['gt']]:0x0}},'order':[['countingDate','ASC']]})[a92_0x36d2('0x1d')](_0x5e8b65=>{_0x4d46cf[a92_0x36d2('0x14')]({'data':_0x5e8b65});});};exports[a92_0x36d2('0x33')]=(_0x39851e,_0x544b7e)=>{const _0x2fe57a=_0x39851e[a92_0x36d2('0x34')][a92_0x36d2('0x35')];const _0x1a29e1=_0x39851e[a92_0x36d2('0x34')][a92_0x36d2('0x36')];const _0x56ff9d=_0x39851e[a92_0x36d2('0x34')][a92_0x36d2('0x37')];exports[a92_0x36d2('0x5')][a92_0x36d2('0x15')][a92_0x36d2('0x31')]['findAll']({'attributes':[a92_0x36d2('0x38'),[exports['sequelize']['fn'](a92_0x36d2('0x39'),exports[a92_0x36d2('0x5')][a92_0x36d2('0x3a')](a92_0x36d2('0x3b'))),a92_0x36d2('0x3c')]],'where':{'countingDate':{[exports[a92_0x36d2('0x5')]['Op'][a92_0x36d2('0x3d')]]:_0x1a29e1,[exports['sequelize']['Op']['lt']]:_0x56ff9d},'amount':_0x39851e[a92_0x36d2('0x3e')]['direction']=='in'?{[exports[a92_0x36d2('0x5')]['Op']['gt']]:0x0}:{[exports[a92_0x36d2('0x5')]['Op']['lt']]:0x0}},'group':[exports[a92_0x36d2('0x5')][a92_0x36d2('0x3f')](a92_0x36d2('0x40'))],'order':[['countingDate',a92_0x36d2('0x41')]]})['then'](_0x5906bd=>{_0x544b7e['json']({'data':_0x5906bd});});};exports['getPassCountingByHour']=(_0x5e0238,_0x31171c)=>{const _0x47e466=_0x5e0238['query'][a92_0x36d2('0x35')];const _0x3a8d2c=_0x5e0238[a92_0x36d2('0x34')][a92_0x36d2('0x36')];const _0x2eff89=_0x5e0238['query'][a92_0x36d2('0x37')];exports[a92_0x36d2('0x5')][a92_0x36d2('0x15')][a92_0x36d2('0x31')][a92_0x36d2('0x42')]({'attributes':[a92_0x36d2('0x38'),[exports[a92_0x36d2('0x5')]['fn'](a92_0x36d2('0x43'),exports[a92_0x36d2('0x5')]['col']('countingDate'),a92_0x36d2('0x44')),a92_0x36d2('0x45')],[exports['sequelize']['fn']('sum',exports[a92_0x36d2('0x5')][a92_0x36d2('0x3a')](a92_0x36d2('0x3b'))),'total']],'where':{'countingDate':{[exports['sequelize']['Op'][a92_0x36d2('0x3d')]]:_0x3a8d2c,[exports[a92_0x36d2('0x5')]['Op']['lt']]:_0x2eff89},'amount':_0x5e0238['params'][a92_0x36d2('0x46')]=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports[a92_0x36d2('0x5')]['Op']['lt']]:0x0}},'group':[exports['sequelize']['fn'](a92_0x36d2('0x47'),exports[a92_0x36d2('0x5')][a92_0x36d2('0x3a')](a92_0x36d2('0x38'))),exports['sequelize']['fn'](a92_0x36d2('0x48'),exports[a92_0x36d2('0x5')][a92_0x36d2('0x3a')](a92_0x36d2('0x38'))),exports['sequelize']['fn'](a92_0x36d2('0x49'),exports[a92_0x36d2('0x5')][a92_0x36d2('0x3a')]('countingDate')),exports[a92_0x36d2('0x5')]['fn'](a92_0x36d2('0x4a'),exports['sequelize'][a92_0x36d2('0x3a')]('countingDate'))],'order':[[a92_0x36d2('0x38'),a92_0x36d2('0x41')]]})[a92_0x36d2('0x1d')](_0x3da738=>{_0x31171c['json']({'data':_0x3da738});});};exports[a92_0x36d2('0x4b')]=(_0x2e4ab9,_0x1d0d1c,_0x34a696)=>{const _0x5ed076=_0x2e4ab9[a92_0x36d2('0x4c')][a92_0x36d2('0x4d')][a92_0x36d2('0x4e')](_0x5ed076=>_0x5ed076['kind']===a92_0x36d2('0x4f'));fbgraph_1[a92_0x36d2('0x1e')][a92_0x36d2('0x50')](_0x5ed076['accessToken']);fbgraph_1[a92_0x36d2('0x1e')][a92_0x36d2('0x20')](_0x2e4ab9[a92_0x36d2('0x4c')][a92_0x36d2('0x4f')]+'?fields=id,name,email,first_name,last_name,gender,link,locale,timezone',(_0x51646f,_0x35070b)=>{if(_0x51646f){return _0x34a696(_0x51646f);}_0x1d0d1c['render'](a92_0x36d2('0x51'),{'title':a92_0x36d2('0x52'),'profile':_0x35070b});});};