var a91_0x5ee7=['ASC','getPassCountingByDay','query','month','startDate','findAll','countingDate','sum','col','amount','gte','params','direction','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','endDate','DATE_FORMAT','%Y-%m-%d\x20%H:00','DAY','YEAR','user','tokens','kind','facebook','setAccessToken','accessToken','get','api/facebook','Facebook\x20API','__importDefault','__esModule','defineProperty','fbgraph','sequelize','setSequelize','getApi','render','api/index','API\x20Examples','syncFtp','log','ready','connected','colombia','Downloading:\x20','name','endsWith','json','models','reportFiles','findOrCreate','spread','error','connect','ftp.vivotek.com','ipd','then','default','connected:','colombia/','fileName','end','.txt','pipe','createWriteStream','status','save','Downloaded:\x20','processFtp','findOne','media/','readFile','utf8','parse','Data','CountingInfo','passes','create','getPassCounting'];(function(_0x1bedd3,_0x119bb3){var _0x23f794=function(_0x4b44fb){while(--_0x4b44fb){_0x1bedd3['push'](_0x1bedd3['shift']());}};_0x23f794(++_0x119bb3);}(a91_0x5ee7,0x159));var a91_0x2609=function(_0x59ec58,_0x38cab2){_0x59ec58=_0x59ec58-0x0;var _0x234a7b=a91_0x5ee7[_0x59ec58];return _0x234a7b;};'use strict';var __importDefault=this&&this[a91_0x2609('0x0')]||function(_0x3a72e9){return _0x3a72e9&&_0x3a72e9[a91_0x2609('0x1')]?_0x3a72e9:{'default':_0x3a72e9};};Object[a91_0x2609('0x2')](exports,a91_0x2609('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a91_0x2609('0x3')));const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));function setSequelize(_0x38540f){exports[a91_0x2609('0x4')]=_0x38540f;}exports[a91_0x2609('0x5')]=setSequelize;exports[a91_0x2609('0x6')]=(_0x4d800f,_0x4b21b1)=>{_0x4b21b1[a91_0x2609('0x7')](a91_0x2609('0x8'),{'title':a91_0x2609('0x9')});};exports[a91_0x2609('0xa')]=(_0x288acd,_0x273bd9)=>{console[a91_0x2609('0xb')]('connecting');const _0x4529c7=[];const _0x4ba5ca=new ftp_1['default']();_0x4ba5ca['on'](a91_0x2609('0xc'),function(){console['log'](a91_0x2609('0xd'));_0x4ba5ca['list'](a91_0x2609('0xe'),![],function(_0x32481f,_0x30c431){if(_0x32481f){}else{for(const _0x2f638c of _0x30c431){console['log'](a91_0x2609('0xf')+_0x2f638c[a91_0x2609('0x10')]);if(_0x2f638c[a91_0x2609('0x10')][a91_0x2609('0x11')](a91_0x2609('0x12'))){exports['sequelize'][a91_0x2609('0x13')][a91_0x2609('0x14')][a91_0x2609('0x15')]({'where':{'fileName':_0x2f638c['name']}})[a91_0x2609('0x16')]((_0x41bd21,_0x2e417c)=>{if(_0x2e417c){console['log'](_0x2f638c[a91_0x2609('0x10')]);_0x4529c7['push'](_0x41bd21);}});}}}_0x273bd9['json']({'data':_0x4529c7});});});_0x4ba5ca['on'](a91_0x2609('0x17'),function(_0x43a7bd){_0x273bd9[a91_0x2609('0x12')]({'message':_0x43a7bd});});_0x4ba5ca[a91_0x2609('0x18')]({'host':a91_0x2609('0x19'),'port':0x15,'user':a91_0x2609('0x1a'),'password':a91_0x2609('0x1a')});};exports['downloadFtp']=(_0x818615,_0x33bf5b)=>{exports['sequelize'][a91_0x2609('0x13')]['reportFiles']['findOne']({'where':{'status':null}})[a91_0x2609('0x1b')](_0x531d72=>{if(_0x531d72){const _0x104cf7=new ftp_1[(a91_0x2609('0x1c'))]();_0x104cf7['on'](a91_0x2609('0xc'),function(){console['log'](a91_0x2609('0x1d')+_0x531d72['fileName']);_0x104cf7['get'](a91_0x2609('0x1e')+_0x531d72[a91_0x2609('0x1f')],function(_0x141aac,_0x3c771c){_0x104cf7[a91_0x2609('0x20')]();if(_0x141aac){}else{const _0x1d6790='media/'+_0x531d72[a91_0x2609('0x1f')]+a91_0x2609('0x21');_0x3c771c[a91_0x2609('0x22')](fs_1[a91_0x2609('0x1c')][a91_0x2609('0x23')](_0x1d6790));_0x531d72[a91_0x2609('0x24')]=0x1;_0x531d72[a91_0x2609('0x25')]();console[a91_0x2609('0xb')](a91_0x2609('0x26')+_0x531d72['fileName']);}});});_0x104cf7['on']('error',function(_0x5a92d3){_0x33bf5b[a91_0x2609('0x12')]({'message':_0x5a92d3});});_0x104cf7[a91_0x2609('0x18')]({'host':a91_0x2609('0x19'),'port':0x15,'user':a91_0x2609('0x1a'),'password':a91_0x2609('0x1a')});_0x33bf5b['json']({'data':_0x531d72[a91_0x2609('0x1f')]});}else{_0x33bf5b[a91_0x2609('0x12')]({'data':[]});}});};exports[a91_0x2609('0x27')]=(_0xbe485b,_0x2fb94c)=>{exports[a91_0x2609('0x4')][a91_0x2609('0x13')][a91_0x2609('0x14')][a91_0x2609('0x28')]({'where':{'status':0x1}})[a91_0x2609('0x1b')](_0x312bd6=>{if(_0x312bd6){const _0x22d626=a91_0x2609('0x29')+_0x312bd6[a91_0x2609('0x1f')]+a91_0x2609('0x21');fs_1['default'][a91_0x2609('0x2a')](_0x22d626,a91_0x2609('0x2b'),function(_0x500a39,_0x2f4ac8){if(_0x500a39){_0x312bd6[a91_0x2609('0x24')]=null;}else{try{const _0x442553=JSON[a91_0x2609('0x2c')](_0x2f4ac8);for(const _0x4e7a4b of _0x442553[a91_0x2609('0x2d')][0x0][a91_0x2609('0x2e')]){const _0x233a15=_0x4e7a4b['In'];const _0x478439=_0x4e7a4b['Out'];const _0x4a9974=Date[a91_0x2609('0x2c')](_0x4e7a4b['EndTime']);if(_0x233a15>0x0){exports[a91_0x2609('0x4')][a91_0x2609('0x13')][a91_0x2609('0x2f')][a91_0x2609('0x30')]({'reportFileId':_0x312bd6['id'],'amount':_0x233a15,'countingDate':_0x4a9974});}if(_0x478439>0x0){exports[a91_0x2609('0x4')][a91_0x2609('0x13')]['passes'][a91_0x2609('0x30')]({'reportFileId':_0x312bd6['id'],'amount':_0x478439*-0x1,'countingDate':_0x4a9974});}}_0x312bd6['status']=0x2;}catch(_0x49a9b8){_0x312bd6['status']=null;}}_0x312bd6['save']();});_0x2fb94c[a91_0x2609('0x12')]({'data':_0x312bd6[a91_0x2609('0x1f')]});}else{_0x2fb94c[a91_0x2609('0x12')]({'data':[]});}});};exports[a91_0x2609('0x31')]=(_0x560fbe,_0x3ca6c4)=>{exports['sequelize'][a91_0x2609('0x13')][a91_0x2609('0x2f')]['findAll']({'where':{'amount':{[exports[a91_0x2609('0x4')]['Op']['gt']]:0x0}},'order':[['countingDate',a91_0x2609('0x32')]]})[a91_0x2609('0x1b')](_0x552ce9=>{_0x3ca6c4[a91_0x2609('0x12')]({'data':_0x552ce9});});};exports[a91_0x2609('0x33')]=(_0x12dfa1,_0x27cd5a)=>{const _0x8a2877=_0x12dfa1[a91_0x2609('0x34')][a91_0x2609('0x35')];const _0x4990b2=_0x12dfa1['query'][a91_0x2609('0x36')];const _0x1d8967=_0x12dfa1['query']['endDate'];exports['sequelize'][a91_0x2609('0x13')][a91_0x2609('0x2f')][a91_0x2609('0x37')]({'attributes':[a91_0x2609('0x38'),[exports[a91_0x2609('0x4')]['fn'](a91_0x2609('0x39'),exports['sequelize'][a91_0x2609('0x3a')](a91_0x2609('0x3b'))),'total']],'where':{'countingDate':{[exports[a91_0x2609('0x4')]['Op'][a91_0x2609('0x3c')]]:_0x4990b2,[exports[a91_0x2609('0x4')]['Op']['lt']]:_0x1d8967},'amount':_0x12dfa1[a91_0x2609('0x3d')][a91_0x2609('0x3e')]=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports[a91_0x2609('0x4')]['Op']['lt']]:0x0}},'group':[exports[a91_0x2609('0x4')]['literal'](a91_0x2609('0x3f'))],'order':[[a91_0x2609('0x38'),a91_0x2609('0x32')]]})[a91_0x2609('0x1b')](_0x3cd011=>{_0x27cd5a['json']({'data':_0x3cd011});});};exports[a91_0x2609('0x40')]=(_0x5db25c,_0x29828e)=>{const _0x5d15fa=_0x5db25c[a91_0x2609('0x34')][a91_0x2609('0x35')];const _0xcd61af=_0x5db25c['query']['startDate'];const _0x218866=_0x5db25c['query'][a91_0x2609('0x41')];exports[a91_0x2609('0x4')][a91_0x2609('0x13')]['passes'][a91_0x2609('0x37')]({'attributes':[a91_0x2609('0x38'),[exports[a91_0x2609('0x4')]['fn'](a91_0x2609('0x42'),exports['sequelize']['col']('countingDate'),a91_0x2609('0x43')),'countingDateShort'],[exports['sequelize']['fn']('sum',exports['sequelize'][a91_0x2609('0x3a')](a91_0x2609('0x3b'))),'total']],'where':{'countingDate':{[exports[a91_0x2609('0x4')]['Op']['gte']]:_0xcd61af,[exports[a91_0x2609('0x4')]['Op']['lt']]:_0x218866},'amount':_0x5db25c['params'][a91_0x2609('0x3e')]=='in'?{[exports[a91_0x2609('0x4')]['Op']['gt']]:0x0}:{[exports[a91_0x2609('0x4')]['Op']['lt']]:0x0}},'group':[exports[a91_0x2609('0x4')]['fn']('HOUR',exports['sequelize']['col'](a91_0x2609('0x38'))),exports['sequelize']['fn'](a91_0x2609('0x44'),exports[a91_0x2609('0x4')]['col'](a91_0x2609('0x38'))),exports[a91_0x2609('0x4')]['fn']('MONTH',exports[a91_0x2609('0x4')][a91_0x2609('0x3a')](a91_0x2609('0x38'))),exports['sequelize']['fn'](a91_0x2609('0x45'),exports[a91_0x2609('0x4')]['col'](a91_0x2609('0x38')))],'order':[[a91_0x2609('0x38'),a91_0x2609('0x32')]]})[a91_0x2609('0x1b')](_0x585ea9=>{_0x29828e['json']({'data':_0x585ea9});});};exports['getFacebook']=(_0x331615,_0x4c8683,_0x509781)=>{const _0x22bff1=_0x331615[a91_0x2609('0x46')][a91_0x2609('0x47')]['find'](_0x22bff1=>_0x22bff1[a91_0x2609('0x48')]===a91_0x2609('0x49'));fbgraph_1['default'][a91_0x2609('0x4a')](_0x22bff1[a91_0x2609('0x4b')]);fbgraph_1[a91_0x2609('0x1c')][a91_0x2609('0x4c')](_0x331615['user'][a91_0x2609('0x49')]+'?fields=id,name,email,first_name,last_name,gender,link,locale,timezone',(_0x3e5c86,_0x3e92fe)=>{if(_0x3e5c86){return _0x509781(_0x3e5c86);}_0x4c8683[a91_0x2609('0x7')](a91_0x2609('0x4d'),{'title':a91_0x2609('0x4e'),'profile':_0x3e92fe});});};