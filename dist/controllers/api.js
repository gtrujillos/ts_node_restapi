var a92_0x4ddd=['create','getPassCounting','countingDate','ASC','getPassCountingByDay','query','month','startDate','findAll','sum','col','amount','total','params','direction','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','%Y-%m-%d\x20%H:00','gte','HOUR','DAY','MONTH','YEAR','getFacebook','user','tokens','find','setAccessToken','accessToken','facebook','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','api/facebook','Facebook\x20API','defineProperty','fbgraph','sequelize','getApi','render','API\x20Examples','log','connecting','default','ready','list','colombia','Downloading:\x20','name','json','models','reportFiles','findOrCreate','error','connect','ftp.vivotek.com','ipd','downloadFtp','findOne','then','connected:','fileName','get','end','media/','.txt','pipe','createWriteStream','status','save','readFile','utf8','parse','Data','CountingInfo','Out','EndTime','passes'];(function(_0xe56d,_0x3f3ec5){var _0x1c4a8d=function(_0x151380){while(--_0x151380){_0xe56d['push'](_0xe56d['shift']());}};_0x1c4a8d(++_0x3f3ec5);}(a92_0x4ddd,0xb9));var a92_0x42a0=function(_0x50c220,_0x3f50d3){_0x50c220=_0x50c220-0x0;var _0x3fee6a=a92_0x4ddd[_0x50c220];return _0x3fee6a;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x11d505){return _0x11d505&&_0x11d505['__esModule']?_0x11d505:{'default':_0x11d505};};Object[a92_0x42a0('0x0')](exports,'__esModule',{'value':!![]});const fbgraph_1=__importDefault(require(a92_0x42a0('0x1')));const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));function setSequelize(_0x874704){exports[a92_0x42a0('0x2')]=_0x874704;}exports['setSequelize']=setSequelize;exports[a92_0x42a0('0x3')]=(_0x4cc48f,_0x2d127e)=>{_0x2d127e[a92_0x42a0('0x4')]('api/index',{'title':a92_0x42a0('0x5')});};exports['syncFtp']=(_0x343c2a,_0x28535a)=>{console[a92_0x42a0('0x6')](a92_0x42a0('0x7'));const _0x22c006=[];const _0xd27881=new ftp_1[(a92_0x42a0('0x8'))]();_0xd27881['on'](a92_0x42a0('0x9'),function(){console[a92_0x42a0('0x6')]('connected');_0xd27881[a92_0x42a0('0xa')](a92_0x42a0('0xb'),![],function(_0x277af5,_0x5d029c){if(_0x277af5){}else{for(const _0x39d630 of _0x5d029c){console['log'](a92_0x42a0('0xc')+_0x39d630[a92_0x42a0('0xd')]);if(_0x39d630['name']['endsWith'](a92_0x42a0('0xe'))){exports['sequelize'][a92_0x42a0('0xf')][a92_0x42a0('0x10')][a92_0x42a0('0x11')]({'where':{'fileName':_0x39d630[a92_0x42a0('0xd')]}})['spread']((_0x2841a3,_0x4c3e73)=>{if(_0x4c3e73){console[a92_0x42a0('0x6')](_0x39d630[a92_0x42a0('0xd')]);_0x22c006['push'](_0x2841a3);}});}}}_0x28535a['json']({'data':_0x22c006});});});_0xd27881['on'](a92_0x42a0('0x12'),function(_0x3410bd){_0x28535a[a92_0x42a0('0xe')]({'message':_0x3410bd});});_0xd27881[a92_0x42a0('0x13')]({'host':a92_0x42a0('0x14'),'port':0x15,'user':a92_0x42a0('0x15'),'password':a92_0x42a0('0x15')});};exports[a92_0x42a0('0x16')]=(_0x4b7177,_0x4a1ea6)=>{exports['sequelize']['models'][a92_0x42a0('0x10')][a92_0x42a0('0x17')]({'where':{'status':null}})[a92_0x42a0('0x18')](_0x388245=>{if(_0x388245){const _0xaf2237=new ftp_1['default']();_0xaf2237['on'](a92_0x42a0('0x9'),function(){console[a92_0x42a0('0x6')](a92_0x42a0('0x19')+_0x388245[a92_0x42a0('0x1a')]);_0xaf2237[a92_0x42a0('0x1b')]('colombia/'+_0x388245['fileName'],function(_0x11be06,_0x2cb68f){_0xaf2237[a92_0x42a0('0x1c')]();if(_0x11be06){}else{const _0x46ca4a=a92_0x42a0('0x1d')+_0x388245[a92_0x42a0('0x1a')]+a92_0x42a0('0x1e');_0x2cb68f[a92_0x42a0('0x1f')](fs_1['default'][a92_0x42a0('0x20')](_0x46ca4a));_0x388245[a92_0x42a0('0x21')]=0x1;_0x388245[a92_0x42a0('0x22')]();console[a92_0x42a0('0x6')]('Downloaded:\x20'+_0x388245['fileName']);}});});_0xaf2237['on'](a92_0x42a0('0x12'),function(_0x14a8d0){_0x4a1ea6['json']({'message':_0x14a8d0});});_0xaf2237['connect']({'host':'ftp.vivotek.com','port':0x15,'user':a92_0x42a0('0x15'),'password':a92_0x42a0('0x15')});_0x4a1ea6[a92_0x42a0('0xe')]({'data':_0x388245[a92_0x42a0('0x1a')]});}else{_0x4a1ea6[a92_0x42a0('0xe')]({'data':[]});}});};exports['processFtp']=(_0xe9d2ad,_0x21f80d)=>{exports[a92_0x42a0('0x2')][a92_0x42a0('0xf')][a92_0x42a0('0x10')][a92_0x42a0('0x17')]({'where':{'status':0x1}})[a92_0x42a0('0x18')](_0x38a243=>{if(_0x38a243){const _0x458e02=a92_0x42a0('0x1d')+_0x38a243[a92_0x42a0('0x1a')]+'.txt';fs_1[a92_0x42a0('0x8')][a92_0x42a0('0x23')](_0x458e02,a92_0x42a0('0x24'),function(_0x28d80b,_0x21124d){if(_0x28d80b){_0x38a243[a92_0x42a0('0x21')]=null;}else{try{const _0x31fa28=JSON[a92_0x42a0('0x25')](_0x21124d);for(const _0x1aa483 of _0x31fa28[a92_0x42a0('0x26')][0x0][a92_0x42a0('0x27')]){const _0x443b0f=_0x1aa483['In'];const _0x3ff499=_0x1aa483[a92_0x42a0('0x28')];const _0x456b2a=Date['parse'](_0x1aa483[a92_0x42a0('0x29')]);if(_0x443b0f>0x0){exports[a92_0x42a0('0x2')]['models'][a92_0x42a0('0x2a')][a92_0x42a0('0x2b')]({'reportFileId':_0x38a243['id'],'amount':_0x443b0f,'countingDate':_0x456b2a});}if(_0x3ff499>0x0){exports[a92_0x42a0('0x2')][a92_0x42a0('0xf')][a92_0x42a0('0x2a')][a92_0x42a0('0x2b')]({'reportFileId':_0x38a243['id'],'amount':_0x3ff499*-0x1,'countingDate':_0x456b2a});}}_0x38a243[a92_0x42a0('0x21')]=0x2;}catch(_0x234629){_0x38a243['status']=null;}}_0x38a243[a92_0x42a0('0x22')]();});_0x21f80d[a92_0x42a0('0xe')]({'data':_0x38a243['fileName']});}else{_0x21f80d[a92_0x42a0('0xe')]({'data':[]});}});};exports[a92_0x42a0('0x2c')]=(_0x590cca,_0x281a21)=>{exports[a92_0x42a0('0x2')][a92_0x42a0('0xf')][a92_0x42a0('0x2a')]['findAll']({'where':{'amount':{[exports['sequelize']['Op']['gt']]:0x0}},'order':[[a92_0x42a0('0x2d'),a92_0x42a0('0x2e')]]})[a92_0x42a0('0x18')](_0x5b3978=>{_0x281a21[a92_0x42a0('0xe')]({'data':_0x5b3978});});};exports[a92_0x42a0('0x2f')]=(_0x364ed0,_0x35c0e3)=>{const _0x5829cd=_0x364ed0[a92_0x42a0('0x30')][a92_0x42a0('0x31')];const _0x5b589d=_0x364ed0[a92_0x42a0('0x30')][a92_0x42a0('0x32')];const _0x5681f2=_0x364ed0[a92_0x42a0('0x30')]['endDate'];exports[a92_0x42a0('0x2')][a92_0x42a0('0xf')]['passes'][a92_0x42a0('0x33')]({'attributes':[a92_0x42a0('0x2d'),[exports[a92_0x42a0('0x2')]['fn'](a92_0x42a0('0x34'),exports[a92_0x42a0('0x2')][a92_0x42a0('0x35')](a92_0x42a0('0x36'))),a92_0x42a0('0x37')]],'where':{'countingDate':{[exports[a92_0x42a0('0x2')]['Op']['gte']]:_0x5b589d,[exports[a92_0x42a0('0x2')]['Op']['lt']]:_0x5681f2},'amount':_0x364ed0[a92_0x42a0('0x38')][a92_0x42a0('0x39')]=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports[a92_0x42a0('0x2')]['Op']['lt']]:0x0}},'group':[exports[a92_0x42a0('0x2')][a92_0x42a0('0x3a')](a92_0x42a0('0x3b'))],'order':[[a92_0x42a0('0x2d'),a92_0x42a0('0x2e')]]})[a92_0x42a0('0x18')](_0x13ae77=>{_0x35c0e3[a92_0x42a0('0xe')]({'data':_0x13ae77});});};exports['getPassCountingByHour']=(_0xdd5850,_0x33d126)=>{const _0x305c5a=_0xdd5850[a92_0x42a0('0x30')][a92_0x42a0('0x31')];const _0x3269fe=_0xdd5850[a92_0x42a0('0x30')][a92_0x42a0('0x32')];const _0x2be3ae=_0xdd5850[a92_0x42a0('0x30')]['endDate'];exports[a92_0x42a0('0x2')][a92_0x42a0('0xf')]['passes'][a92_0x42a0('0x33')]({'attributes':[a92_0x42a0('0x2d'),[exports[a92_0x42a0('0x2')]['fn']('DATE_FORMAT',exports[a92_0x42a0('0x2')][a92_0x42a0('0x35')](a92_0x42a0('0x2d')),a92_0x42a0('0x3c')),'countingDateShort'],[exports[a92_0x42a0('0x2')]['fn'](a92_0x42a0('0x34'),exports[a92_0x42a0('0x2')][a92_0x42a0('0x35')](a92_0x42a0('0x36'))),'total']],'where':{'countingDate':{[exports[a92_0x42a0('0x2')]['Op'][a92_0x42a0('0x3d')]]:_0x3269fe,[exports[a92_0x42a0('0x2')]['Op']['lt']]:_0x2be3ae},'amount':_0xdd5850['params']['direction']=='in'?{[exports[a92_0x42a0('0x2')]['Op']['gt']]:0x0}:{[exports[a92_0x42a0('0x2')]['Op']['lt']]:0x0}},'group':[exports[a92_0x42a0('0x2')]['fn'](a92_0x42a0('0x3e'),exports['sequelize'][a92_0x42a0('0x35')](a92_0x42a0('0x2d'))),exports[a92_0x42a0('0x2')]['fn'](a92_0x42a0('0x3f'),exports[a92_0x42a0('0x2')]['col'](a92_0x42a0('0x2d'))),exports[a92_0x42a0('0x2')]['fn'](a92_0x42a0('0x40'),exports['sequelize'][a92_0x42a0('0x35')]('countingDate')),exports[a92_0x42a0('0x2')]['fn'](a92_0x42a0('0x41'),exports[a92_0x42a0('0x2')][a92_0x42a0('0x35')](a92_0x42a0('0x2d')))],'order':[[a92_0x42a0('0x2d'),a92_0x42a0('0x2e')]]})[a92_0x42a0('0x18')](_0x364f15=>{_0x33d126['json']({'data':_0x364f15});});};exports[a92_0x42a0('0x42')]=(_0x3cf5ac,_0x410744,_0x3b7eb1)=>{const _0x26de62=_0x3cf5ac[a92_0x42a0('0x43')][a92_0x42a0('0x44')][a92_0x42a0('0x45')](_0x26de62=>_0x26de62['kind']==='facebook');fbgraph_1['default'][a92_0x42a0('0x46')](_0x26de62[a92_0x42a0('0x47')]);fbgraph_1[a92_0x42a0('0x8')]['get'](_0x3cf5ac[a92_0x42a0('0x43')][a92_0x42a0('0x48')]+a92_0x42a0('0x49'),(_0x47e2a2,_0xc5410a)=>{if(_0x47e2a2){return _0x3b7eb1(_0x47e2a2);}_0x410744[a92_0x42a0('0x4')](a92_0x42a0('0x4a'),{'title':a92_0x42a0('0x4b'),'profile':_0xc5410a});});};