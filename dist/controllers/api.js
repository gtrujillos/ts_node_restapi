var a85_0x2645=['facebook','setAccessToken','accessToken','user','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','api/facebook','Facebook\x20API','__esModule','defineProperty','fbgraph','sequelize','setSequelize','getApi','api/index','API\x20Examples','syncFtp','log','connecting','default','ready','connected','list','name','endsWith','json','models','reportFiles','spread','push','error','connect','ipd','downloadFtp','findOne','then','connected:','get','colombia/','fileName','media/','.txt','pipe','createWriteStream','Downloaded:\x20','ftp.vivotek.com','processFtp','readFile','status','Data','Out','parse','EndTime','passes','create','save','getPassCounting','findAll','countingDate','ASC','getPassCountingByDay','month','query','startDate','endDate','amount','total','gte','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','DATE_FORMAT','col','%Y-%m-%d\x20%H:00','countingDateShort','sum','params','direction','HOUR','YEAR','tokens','kind'];(function(_0x259d48,_0x2edf07){var _0x71cf21=function(_0x417d35){while(--_0x417d35){_0x259d48['push'](_0x259d48['shift']());}};_0x71cf21(++_0x2edf07);}(a85_0x2645,0x14b));var a85_0x2ba2=function(_0x5d9c4f,_0x1327d4){_0x5d9c4f=_0x5d9c4f-0x0;var _0x51e8b0=a85_0x2645[_0x5d9c4f];return _0x51e8b0;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x5101fe){return _0x5101fe&&_0x5101fe[a85_0x2ba2('0x0')]?_0x5101fe:{'default':_0x5101fe};};Object[a85_0x2ba2('0x1')](exports,'__esModule',{'value':!![]});const fbgraph_1=__importDefault(require(a85_0x2ba2('0x2')));const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));function setSequelize(_0x199197){exports[a85_0x2ba2('0x3')]=_0x199197;}exports[a85_0x2ba2('0x4')]=setSequelize;exports[a85_0x2ba2('0x5')]=(_0x398909,_0x1100f0)=>{_0x1100f0['render'](a85_0x2ba2('0x6'),{'title':a85_0x2ba2('0x7')});};exports[a85_0x2ba2('0x8')]=(_0x4577b4,_0x537df3)=>{console[a85_0x2ba2('0x9')](a85_0x2ba2('0xa'));const _0x478322=[];const _0x10ea36=new ftp_1[(a85_0x2ba2('0xb'))]();_0x10ea36['on'](a85_0x2ba2('0xc'),function(){console[a85_0x2ba2('0x9')](a85_0x2ba2('0xd'));_0x10ea36[a85_0x2ba2('0xe')]('colombia',![],function(_0x3560d1,_0x509676){if(_0x3560d1){}else{for(const _0x2d2f74 of _0x509676){console[a85_0x2ba2('0x9')]('Downloading:\x20'+_0x2d2f74[a85_0x2ba2('0xf')]);if(_0x2d2f74[a85_0x2ba2('0xf')][a85_0x2ba2('0x10')](a85_0x2ba2('0x11'))){exports[a85_0x2ba2('0x3')][a85_0x2ba2('0x12')][a85_0x2ba2('0x13')]['findOrCreate']({'where':{'fileName':_0x2d2f74[a85_0x2ba2('0xf')]}})[a85_0x2ba2('0x14')]((_0x291919,_0x26609f)=>{if(_0x26609f){console[a85_0x2ba2('0x9')](_0x2d2f74['name']);_0x478322[a85_0x2ba2('0x15')](_0x291919);}});}}}_0x537df3[a85_0x2ba2('0x11')]({'data':_0x478322});});});_0x10ea36['on'](a85_0x2ba2('0x16'),function(_0x507069){_0x537df3[a85_0x2ba2('0x11')]({'message':_0x507069});});_0x10ea36[a85_0x2ba2('0x17')]({'host':'ftp.vivotek.com','port':0x15,'user':a85_0x2ba2('0x18'),'password':a85_0x2ba2('0x18')});};exports[a85_0x2ba2('0x19')]=(_0x3ff420,_0x51972e)=>{exports[a85_0x2ba2('0x3')][a85_0x2ba2('0x12')][a85_0x2ba2('0x13')][a85_0x2ba2('0x1a')]({'where':{'status':null}})[a85_0x2ba2('0x1b')](_0x2156c4=>{if(_0x2156c4){const _0x128ff1=new ftp_1[(a85_0x2ba2('0xb'))]();_0x128ff1['on'](a85_0x2ba2('0xc'),function(){console['log'](a85_0x2ba2('0x1c')+_0x2156c4['fileName']);_0x128ff1[a85_0x2ba2('0x1d')](a85_0x2ba2('0x1e')+_0x2156c4[a85_0x2ba2('0x1f')],function(_0x9c5e64,_0x1e6bb7){_0x128ff1['end']();if(_0x9c5e64){}else{const _0x1b452d=a85_0x2ba2('0x20')+_0x2156c4[a85_0x2ba2('0x1f')]+a85_0x2ba2('0x21');_0x1e6bb7[a85_0x2ba2('0x22')](fs_1[a85_0x2ba2('0xb')][a85_0x2ba2('0x23')](_0x1b452d));_0x2156c4['status']=0x1;_0x2156c4['save']();console['log'](a85_0x2ba2('0x24')+_0x2156c4[a85_0x2ba2('0x1f')]);}});});_0x128ff1['on'](a85_0x2ba2('0x16'),function(_0x3cf164){_0x51972e[a85_0x2ba2('0x11')]({'message':_0x3cf164});});_0x128ff1[a85_0x2ba2('0x17')]({'host':a85_0x2ba2('0x25'),'port':0x15,'user':a85_0x2ba2('0x18'),'password':a85_0x2ba2('0x18')});_0x51972e[a85_0x2ba2('0x11')]({'data':_0x2156c4[a85_0x2ba2('0x1f')]});}else{_0x51972e[a85_0x2ba2('0x11')]({'data':[]});}});};exports[a85_0x2ba2('0x26')]=(_0x26a36e,_0x301e5e)=>{exports[a85_0x2ba2('0x3')][a85_0x2ba2('0x12')]['reportFiles'][a85_0x2ba2('0x1a')]({'where':{'status':0x1}})[a85_0x2ba2('0x1b')](_0x3585bf=>{if(_0x3585bf){const _0x5437bb=a85_0x2ba2('0x20')+_0x3585bf[a85_0x2ba2('0x1f')]+a85_0x2ba2('0x21');fs_1[a85_0x2ba2('0xb')][a85_0x2ba2('0x27')](_0x5437bb,'utf8',function(_0x1c213f,_0x3d292a){if(_0x1c213f){_0x3585bf[a85_0x2ba2('0x28')]=null;}else{try{const _0x1261ee=JSON['parse'](_0x3d292a);for(const _0x19f14a of _0x1261ee[a85_0x2ba2('0x29')][0x0]['CountingInfo']){const _0x5754e2=_0x19f14a['In'];const _0x563448=_0x19f14a[a85_0x2ba2('0x2a')];const _0x4965d2=Date[a85_0x2ba2('0x2b')](_0x19f14a[a85_0x2ba2('0x2c')]);if(_0x5754e2>0x0){exports[a85_0x2ba2('0x3')][a85_0x2ba2('0x12')][a85_0x2ba2('0x2d')][a85_0x2ba2('0x2e')]({'reportFileId':_0x3585bf['id'],'amount':_0x5754e2,'countingDate':_0x4965d2});}if(_0x563448>0x0){exports[a85_0x2ba2('0x3')][a85_0x2ba2('0x12')][a85_0x2ba2('0x2d')][a85_0x2ba2('0x2e')]({'reportFileId':_0x3585bf['id'],'amount':_0x563448*-0x1,'countingDate':_0x4965d2});}}_0x3585bf[a85_0x2ba2('0x28')]=0x2;}catch(_0x2d1e29){_0x3585bf[a85_0x2ba2('0x28')]=null;}}_0x3585bf[a85_0x2ba2('0x2f')]();});_0x301e5e[a85_0x2ba2('0x11')]({'data':_0x3585bf[a85_0x2ba2('0x1f')]});}else{_0x301e5e['json']({'data':[]});}});};exports[a85_0x2ba2('0x30')]=(_0x580c9c,_0x3e071a)=>{exports['sequelize'][a85_0x2ba2('0x12')][a85_0x2ba2('0x2d')][a85_0x2ba2('0x31')]({'where':{'amount':{[exports[a85_0x2ba2('0x3')]['Op']['gt']]:0x0}},'order':[[a85_0x2ba2('0x32'),a85_0x2ba2('0x33')]]})['then'](_0x13689f=>{_0x3e071a['json']({'data':_0x13689f});});};exports[a85_0x2ba2('0x34')]=(_0x2793ea,_0x782ff6)=>{const _0x89c349=_0x2793ea['query'][a85_0x2ba2('0x35')];const _0xcb87d=_0x2793ea[a85_0x2ba2('0x36')][a85_0x2ba2('0x37')];const _0x184b69=_0x2793ea[a85_0x2ba2('0x36')][a85_0x2ba2('0x38')];exports[a85_0x2ba2('0x3')]['models'][a85_0x2ba2('0x2d')]['findAll']({'attributes':[a85_0x2ba2('0x32'),[exports[a85_0x2ba2('0x3')]['fn']('sum',exports[a85_0x2ba2('0x3')]['col'](a85_0x2ba2('0x39'))),a85_0x2ba2('0x3a')]],'where':{'countingDate':{[exports[a85_0x2ba2('0x3')]['Op'][a85_0x2ba2('0x3b')]]:_0xcb87d,[exports[a85_0x2ba2('0x3')]['Op']['lt']]:_0x184b69},'amount':_0x2793ea['params']['direction']=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports[a85_0x2ba2('0x3')]['Op']['lt']]:0x0}},'group':[exports[a85_0x2ba2('0x3')][a85_0x2ba2('0x3c')](a85_0x2ba2('0x3d'))],'order':[[a85_0x2ba2('0x32'),a85_0x2ba2('0x33')]]})[a85_0x2ba2('0x1b')](_0x2978b0=>{_0x782ff6['json']({'data':_0x2978b0});});};exports[a85_0x2ba2('0x3e')]=(_0x8850e3,_0x4794bc)=>{const _0x1fc285=_0x8850e3[a85_0x2ba2('0x36')][a85_0x2ba2('0x35')];const _0x283961=_0x8850e3['query']['startDate'];const _0xccac16=_0x8850e3['query']['endDate'];exports[a85_0x2ba2('0x3')][a85_0x2ba2('0x12')][a85_0x2ba2('0x2d')][a85_0x2ba2('0x31')]({'attributes':[a85_0x2ba2('0x32'),[exports[a85_0x2ba2('0x3')]['fn'](a85_0x2ba2('0x3f'),exports[a85_0x2ba2('0x3')][a85_0x2ba2('0x40')]('countingDate'),a85_0x2ba2('0x41')),a85_0x2ba2('0x42')],[exports['sequelize']['fn'](a85_0x2ba2('0x43'),exports[a85_0x2ba2('0x3')][a85_0x2ba2('0x40')](a85_0x2ba2('0x39'))),a85_0x2ba2('0x3a')]],'where':{'countingDate':{[exports[a85_0x2ba2('0x3')]['Op'][a85_0x2ba2('0x3b')]]:_0x283961,[exports[a85_0x2ba2('0x3')]['Op']['lt']]:_0xccac16},'amount':_0x8850e3[a85_0x2ba2('0x44')][a85_0x2ba2('0x45')]=='in'?{[exports[a85_0x2ba2('0x3')]['Op']['gt']]:0x0}:{[exports[a85_0x2ba2('0x3')]['Op']['lt']]:0x0}},'group':[exports[a85_0x2ba2('0x3')]['fn'](a85_0x2ba2('0x46'),exports[a85_0x2ba2('0x3')]['col'](a85_0x2ba2('0x32'))),exports[a85_0x2ba2('0x3')]['fn']('DAY',exports[a85_0x2ba2('0x3')][a85_0x2ba2('0x40')](a85_0x2ba2('0x32'))),exports[a85_0x2ba2('0x3')]['fn']('MONTH',exports[a85_0x2ba2('0x3')][a85_0x2ba2('0x40')](a85_0x2ba2('0x32'))),exports[a85_0x2ba2('0x3')]['fn'](a85_0x2ba2('0x47'),exports['sequelize']['col'](a85_0x2ba2('0x32')))],'order':[[a85_0x2ba2('0x32'),a85_0x2ba2('0x33')]]})[a85_0x2ba2('0x1b')](_0x592efa=>{_0x4794bc[a85_0x2ba2('0x11')]({'data':_0x592efa});});};exports['getFacebook']=(_0x55107b,_0x54424d,_0x1c88a1)=>{const _0x50aa77=_0x55107b['user'][a85_0x2ba2('0x48')]['find'](_0x50aa77=>_0x50aa77[a85_0x2ba2('0x49')]===a85_0x2ba2('0x4a'));fbgraph_1[a85_0x2ba2('0xb')][a85_0x2ba2('0x4b')](_0x50aa77[a85_0x2ba2('0x4c')]);fbgraph_1[a85_0x2ba2('0xb')][a85_0x2ba2('0x1d')](_0x55107b[a85_0x2ba2('0x4d')][a85_0x2ba2('0x4a')]+a85_0x2ba2('0x4e'),(_0x2e13e6,_0x3b7196)=>{if(_0x2e13e6){return _0x1c88a1(_0x2e13e6);}_0x54424d['render'](a85_0x2ba2('0x4f'),{'title':a85_0x2ba2('0x50'),'profile':_0x3b7196});});};