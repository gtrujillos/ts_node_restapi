var a92_0x231f=['col','%Y-%m-%d\x20%H:00','countingDateShort','params','DAY','YEAR','getFacebook','user','tokens','find','kind','facebook','setAccessToken','accessToken','get','?fields=id,name,email,first_name,last_name,gender,link,locale,timezone','api/facebook','Facebook\x20API','__esModule','defineProperty','fbgraph','ftp','sequelize','getApi','render','api/index','API\x20Examples','syncFtp','log','ready','connected','list','colombia','Downloading:\x20','name','endsWith','models','reportFiles','findOrCreate','spread','push','error','json','connect','ftp.vivotek.com','ipd','findOne','then','default','fileName','colombia/','end','media/','.txt','pipe','createWriteStream','status','save','Downloaded:\x20','processFtp','readFile','utf8','Data','parse','EndTime','passes','create','findAll','countingDate','ASC','month','query','startDate','endDate','sum','amount','total','gte','direction','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','DATE_FORMAT'];(function(_0x5bcda8,_0x4d069c){var _0x111462=function(_0x194bc3){while(--_0x194bc3){_0x5bcda8['push'](_0x5bcda8['shift']());}};_0x111462(++_0x4d069c);}(a92_0x231f,0x10b));var a92_0x193f=function(_0x198a3a,_0x3cea71){_0x198a3a=_0x198a3a-0x0;var _0x239fbd=a92_0x231f[_0x198a3a];return _0x239fbd;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x376b97){return _0x376b97&&_0x376b97[a92_0x193f('0x0')]?_0x376b97:{'default':_0x376b97};};Object[a92_0x193f('0x1')](exports,a92_0x193f('0x0'),{'value':!![]});const fbgraph_1=__importDefault(require(a92_0x193f('0x2')));const ftp_1=__importDefault(require(a92_0x193f('0x3')));const fs_1=__importDefault(require('fs'));function setSequelize(_0x349425){exports[a92_0x193f('0x4')]=_0x349425;}exports['setSequelize']=setSequelize;exports[a92_0x193f('0x5')]=(_0x4c6eb9,_0x2b9cf3)=>{_0x2b9cf3[a92_0x193f('0x6')](a92_0x193f('0x7'),{'title':a92_0x193f('0x8')});};exports[a92_0x193f('0x9')]=(_0x18b290,_0x40de57)=>{console[a92_0x193f('0xa')]('connecting');const _0x53e5eb=[];const _0x119881=new ftp_1['default']();_0x119881['on'](a92_0x193f('0xb'),function(){console[a92_0x193f('0xa')](a92_0x193f('0xc'));_0x119881[a92_0x193f('0xd')](a92_0x193f('0xe'),![],function(_0x1557d2,_0x4e67f2){if(_0x1557d2){}else{for(const _0x69c975 of _0x4e67f2){console[a92_0x193f('0xa')](a92_0x193f('0xf')+_0x69c975[a92_0x193f('0x10')]);if(_0x69c975[a92_0x193f('0x10')][a92_0x193f('0x11')]('json')){exports[a92_0x193f('0x4')][a92_0x193f('0x12')][a92_0x193f('0x13')][a92_0x193f('0x14')]({'where':{'fileName':_0x69c975[a92_0x193f('0x10')]}})[a92_0x193f('0x15')]((_0x356c4f,_0x23fe31)=>{if(_0x23fe31){console[a92_0x193f('0xa')](_0x69c975[a92_0x193f('0x10')]);_0x53e5eb[a92_0x193f('0x16')](_0x356c4f);}});}}}_0x40de57['json']({'data':_0x53e5eb});});});_0x119881['on'](a92_0x193f('0x17'),function(_0x2b1300){_0x40de57[a92_0x193f('0x18')]({'message':_0x2b1300});});_0x119881[a92_0x193f('0x19')]({'host':a92_0x193f('0x1a'),'port':0x15,'user':'ipd','password':a92_0x193f('0x1b')});};exports['downloadFtp']=(_0x5a79b1,_0x2a1bdf)=>{exports['sequelize'][a92_0x193f('0x12')][a92_0x193f('0x13')][a92_0x193f('0x1c')]({'where':{'status':null}})[a92_0x193f('0x1d')](_0x6ad8ed=>{if(_0x6ad8ed){const _0x1bad31=new ftp_1[(a92_0x193f('0x1e'))]();_0x1bad31['on'](a92_0x193f('0xb'),function(){console[a92_0x193f('0xa')]('connected:'+_0x6ad8ed[a92_0x193f('0x1f')]);_0x1bad31['get'](a92_0x193f('0x20')+_0x6ad8ed[a92_0x193f('0x1f')],function(_0x2cd1e9,_0x422285){_0x1bad31[a92_0x193f('0x21')]();if(_0x2cd1e9){}else{const _0x41d7e0=a92_0x193f('0x22')+_0x6ad8ed[a92_0x193f('0x1f')]+a92_0x193f('0x23');_0x422285[a92_0x193f('0x24')](fs_1['default'][a92_0x193f('0x25')](_0x41d7e0));_0x6ad8ed[a92_0x193f('0x26')]=0x1;_0x6ad8ed[a92_0x193f('0x27')]();console[a92_0x193f('0xa')](a92_0x193f('0x28')+_0x6ad8ed[a92_0x193f('0x1f')]);}});});_0x1bad31['on'](a92_0x193f('0x17'),function(_0x25631b){_0x2a1bdf[a92_0x193f('0x18')]({'message':_0x25631b});});_0x1bad31[a92_0x193f('0x19')]({'host':a92_0x193f('0x1a'),'port':0x15,'user':a92_0x193f('0x1b'),'password':a92_0x193f('0x1b')});_0x2a1bdf[a92_0x193f('0x18')]({'data':_0x6ad8ed[a92_0x193f('0x1f')]});}else{_0x2a1bdf[a92_0x193f('0x18')]({'data':[]});}});};exports[a92_0x193f('0x29')]=(_0x10b49b,_0x45015c)=>{exports['sequelize'][a92_0x193f('0x12')][a92_0x193f('0x13')]['findOne']({'where':{'status':0x1}})['then'](_0x36d4e1=>{if(_0x36d4e1){const _0x26436b=a92_0x193f('0x22')+_0x36d4e1[a92_0x193f('0x1f')]+a92_0x193f('0x23');fs_1[a92_0x193f('0x1e')][a92_0x193f('0x2a')](_0x26436b,a92_0x193f('0x2b'),function(_0x4bedee,_0x290c62){if(_0x4bedee){_0x36d4e1[a92_0x193f('0x26')]=null;}else{try{const _0x406991=JSON['parse'](_0x290c62);for(const _0x501201 of _0x406991[a92_0x193f('0x2c')][0x0]['CountingInfo']){const _0x96d21e=_0x501201['In'];const _0x39537b=_0x501201['Out'];const _0x373d64=Date[a92_0x193f('0x2d')](_0x501201[a92_0x193f('0x2e')]);if(_0x96d21e>0x0){exports[a92_0x193f('0x4')][a92_0x193f('0x12')][a92_0x193f('0x2f')]['create']({'reportFileId':_0x36d4e1['id'],'amount':_0x96d21e,'countingDate':_0x373d64});}if(_0x39537b>0x0){exports[a92_0x193f('0x4')][a92_0x193f('0x12')][a92_0x193f('0x2f')][a92_0x193f('0x30')]({'reportFileId':_0x36d4e1['id'],'amount':_0x39537b*-0x1,'countingDate':_0x373d64});}}_0x36d4e1['status']=0x2;}catch(_0x35311f){_0x36d4e1[a92_0x193f('0x26')]=null;}}_0x36d4e1['save']();});_0x45015c[a92_0x193f('0x18')]({'data':_0x36d4e1[a92_0x193f('0x1f')]});}else{_0x45015c[a92_0x193f('0x18')]({'data':[]});}});};exports['getPassCounting']=(_0x43dcfc,_0x4bbf07)=>{exports[a92_0x193f('0x4')][a92_0x193f('0x12')]['passes'][a92_0x193f('0x31')]({'where':{'amount':{[exports[a92_0x193f('0x4')]['Op']['gt']]:0x0}},'order':[[a92_0x193f('0x32'),a92_0x193f('0x33')]]})[a92_0x193f('0x1d')](_0x2abd56=>{_0x4bbf07['json']({'data':_0x2abd56});});};exports['getPassCountingByDay']=(_0x4161d2,_0x489cff)=>{const _0x590f3b=_0x4161d2['query'][a92_0x193f('0x34')];const _0x36fa76=_0x4161d2[a92_0x193f('0x35')][a92_0x193f('0x36')];const _0xd8e9b3=_0x4161d2['query'][a92_0x193f('0x37')];exports[a92_0x193f('0x4')][a92_0x193f('0x12')][a92_0x193f('0x2f')][a92_0x193f('0x31')]({'attributes':[a92_0x193f('0x32'),[exports[a92_0x193f('0x4')]['fn'](a92_0x193f('0x38'),exports[a92_0x193f('0x4')]['col'](a92_0x193f('0x39'))),a92_0x193f('0x3a')]],'where':{'countingDate':{[exports['sequelize']['Op'][a92_0x193f('0x3b')]]:_0x36fa76,[exports[a92_0x193f('0x4')]['Op']['lt']]:_0xd8e9b3},'amount':_0x4161d2['params'][a92_0x193f('0x3c')]=='in'?{[exports[a92_0x193f('0x4')]['Op']['gt']]:0x0}:{[exports[a92_0x193f('0x4')]['Op']['lt']]:0x0}},'group':[exports[a92_0x193f('0x4')][a92_0x193f('0x3d')](a92_0x193f('0x3e'))],'order':[['countingDate',a92_0x193f('0x33')]]})[a92_0x193f('0x1d')](_0x447f60=>{_0x489cff[a92_0x193f('0x18')]({'data':_0x447f60});});};exports[a92_0x193f('0x3f')]=(_0xc3b786,_0x2fe1ab)=>{const _0x49146e=_0xc3b786['query'][a92_0x193f('0x34')];const _0x270c1a=_0xc3b786[a92_0x193f('0x35')][a92_0x193f('0x36')];const _0x14e6df=_0xc3b786[a92_0x193f('0x35')][a92_0x193f('0x37')];exports['sequelize'][a92_0x193f('0x12')][a92_0x193f('0x2f')][a92_0x193f('0x31')]({'attributes':[a92_0x193f('0x32'),[exports[a92_0x193f('0x4')]['fn'](a92_0x193f('0x40'),exports['sequelize'][a92_0x193f('0x41')](a92_0x193f('0x32')),a92_0x193f('0x42')),a92_0x193f('0x43')],[exports['sequelize']['fn']('sum',exports['sequelize']['col'](a92_0x193f('0x39'))),'total']],'where':{'countingDate':{[exports['sequelize']['Op'][a92_0x193f('0x3b')]]:_0x270c1a,[exports[a92_0x193f('0x4')]['Op']['lt']]:_0x14e6df},'amount':_0xc3b786[a92_0x193f('0x44')]['direction']=='in'?{[exports[a92_0x193f('0x4')]['Op']['gt']]:0x0}:{[exports['sequelize']['Op']['lt']]:0x0}},'group':[exports[a92_0x193f('0x4')]['fn']('HOUR',exports[a92_0x193f('0x4')][a92_0x193f('0x41')](a92_0x193f('0x32'))),exports[a92_0x193f('0x4')]['fn'](a92_0x193f('0x45'),exports[a92_0x193f('0x4')][a92_0x193f('0x41')](a92_0x193f('0x32'))),exports[a92_0x193f('0x4')]['fn']('MONTH',exports[a92_0x193f('0x4')][a92_0x193f('0x41')](a92_0x193f('0x32'))),exports[a92_0x193f('0x4')]['fn'](a92_0x193f('0x46'),exports[a92_0x193f('0x4')][a92_0x193f('0x41')](a92_0x193f('0x32')))],'order':[[a92_0x193f('0x32'),a92_0x193f('0x33')]]})[a92_0x193f('0x1d')](_0x54fb94=>{_0x2fe1ab[a92_0x193f('0x18')]({'data':_0x54fb94});});};exports[a92_0x193f('0x47')]=(_0x5a8e95,_0x3e6202,_0x35af2a)=>{const _0x2ed084=_0x5a8e95[a92_0x193f('0x48')][a92_0x193f('0x49')][a92_0x193f('0x4a')](_0x2ed084=>_0x2ed084[a92_0x193f('0x4b')]===a92_0x193f('0x4c'));fbgraph_1[a92_0x193f('0x1e')][a92_0x193f('0x4d')](_0x2ed084[a92_0x193f('0x4e')]);fbgraph_1[a92_0x193f('0x1e')][a92_0x193f('0x4f')](_0x5a8e95[a92_0x193f('0x48')]['facebook']+a92_0x193f('0x50'),(_0x59e741,_0x4d56bb)=>{if(_0x59e741){return _0x35af2a(_0x59e741);}_0x3e6202[a92_0x193f('0x6')](a92_0x193f('0x51'),{'title':a92_0x193f('0x52'),'profile':_0x4d56bb});});};