var a198_0x4add=['Facebook\x20API','__importDefault','__esModule','defineProperty','fbgraph','ftp','setSequelize','getApi','render','api/index','API\x20Examples','syncFtp','ready','log','list','colombia','Downloading:\x20','name','endsWith','json','sequelize','models','reportFiles','findOrCreate','spread','push','error','connect','ftp.vivotek.com','ipd','downloadFtp','findOne','get','colombia/','fileName','end','.txt','pipe','default','createWriteStream','status','Downloaded:\x20','processFtp','then','media/','utf8','parse','Data','CountingInfo','Out','EndTime','passes','create','countingDate','ASC','query','startDate','endDate','findAll','sum','col','amount','direction','literal','YEAR(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20MONTH(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27)),\x20DAY(CONVERT_TZ(countingDate,\x27+00:00\x27,\x27-05:00\x27))','getPassCountingByHour','month','DATE_FORMAT','%Y-%m-%d\x20%H:00','countingDateShort','total','HOUR','DAY','YEAR','getFacebook','user','tokens','find','kind','accessToken','facebook','api/facebook'];(function(_0xb67384,_0x27295a){var _0x156d7c=function(_0x52a1f8){while(--_0x52a1f8){_0xb67384['push'](_0xb67384['shift']());}};_0x156d7c(++_0x27295a);}(a198_0x4add,0xf7));var a198_0x1b6f=function(_0x21cd22,_0x3a07d){_0x21cd22=_0x21cd22-0x0;var _0x57c52e=a198_0x4add[_0x21cd22];return _0x57c52e;};'use strict';var __importDefault=this&&this[a198_0x1b6f('0x0')]||function(_0x17392e){return _0x17392e&&_0x17392e[a198_0x1b6f('0x1')]?_0x17392e:{'default':_0x17392e};};Object[a198_0x1b6f('0x2')](exports,a198_0x1b6f('0x1'),{'value':!![]});const fbgraph_1=__importDefault(require(a198_0x1b6f('0x3')));const ftp_1=__importDefault(require(a198_0x1b6f('0x4')));const fs_1=__importDefault(require('fs'));function setSequelize(_0x2a57b7){exports['sequelize']=_0x2a57b7;}exports[a198_0x1b6f('0x5')]=setSequelize;exports[a198_0x1b6f('0x6')]=(_0x494c38,_0x117449)=>{_0x117449[a198_0x1b6f('0x7')](a198_0x1b6f('0x8'),{'title':a198_0x1b6f('0x9')});};exports[a198_0x1b6f('0xa')]=(_0xbcac57,_0x56126c)=>{console['log']('connecting');const _0x2cbb82=[];const _0x1853ee=new ftp_1['default']();_0x1853ee['on'](a198_0x1b6f('0xb'),function(){console[a198_0x1b6f('0xc')]('connected');_0x1853ee[a198_0x1b6f('0xd')](a198_0x1b6f('0xe'),![],function(_0x13acdc,_0x428874){if(_0x13acdc){}else{for(const _0x5d618c of _0x428874){console[a198_0x1b6f('0xc')](a198_0x1b6f('0xf')+_0x5d618c[a198_0x1b6f('0x10')]);if(_0x5d618c[a198_0x1b6f('0x10')][a198_0x1b6f('0x11')](a198_0x1b6f('0x12'))){exports[a198_0x1b6f('0x13')][a198_0x1b6f('0x14')][a198_0x1b6f('0x15')][a198_0x1b6f('0x16')]({'where':{'fileName':_0x5d618c['name']}})[a198_0x1b6f('0x17')]((_0x2bdd20,_0xa3a811)=>{if(_0xa3a811){console[a198_0x1b6f('0xc')](_0x5d618c[a198_0x1b6f('0x10')]);_0x2cbb82[a198_0x1b6f('0x18')](_0x2bdd20);}});}}}_0x56126c[a198_0x1b6f('0x12')]({'data':_0x2cbb82});});});_0x1853ee['on'](a198_0x1b6f('0x19'),function(_0x4a2bc6){_0x56126c['json']({'message':_0x4a2bc6});});_0x1853ee[a198_0x1b6f('0x1a')]({'host':a198_0x1b6f('0x1b'),'port':0x15,'user':a198_0x1b6f('0x1c'),'password':a198_0x1b6f('0x1c')});};exports[a198_0x1b6f('0x1d')]=(_0x484e5a,_0x4a1da4)=>{exports[a198_0x1b6f('0x13')][a198_0x1b6f('0x14')][a198_0x1b6f('0x15')][a198_0x1b6f('0x1e')]({'where':{'status':null}})['then'](_0x241a6f=>{if(_0x241a6f){const _0x215961=new ftp_1['default']();_0x215961['on']('ready',function(){console[a198_0x1b6f('0xc')]('connected:'+_0x241a6f['fileName']);_0x215961[a198_0x1b6f('0x1f')](a198_0x1b6f('0x20')+_0x241a6f[a198_0x1b6f('0x21')],function(_0x4291f6,_0x11f7b2){_0x215961[a198_0x1b6f('0x22')]();if(_0x4291f6){}else{const _0x3cc6be='media/'+_0x241a6f['fileName']+a198_0x1b6f('0x23');_0x11f7b2[a198_0x1b6f('0x24')](fs_1[a198_0x1b6f('0x25')][a198_0x1b6f('0x26')](_0x3cc6be));_0x241a6f[a198_0x1b6f('0x27')]=0x1;_0x241a6f['save']();console[a198_0x1b6f('0xc')](a198_0x1b6f('0x28')+_0x241a6f[a198_0x1b6f('0x21')]);}});});_0x215961['on'](a198_0x1b6f('0x19'),function(_0x5d6293){_0x4a1da4[a198_0x1b6f('0x12')]({'message':_0x5d6293});});_0x215961[a198_0x1b6f('0x1a')]({'host':a198_0x1b6f('0x1b'),'port':0x15,'user':'ipd','password':a198_0x1b6f('0x1c')});_0x4a1da4[a198_0x1b6f('0x12')]({'data':_0x241a6f[a198_0x1b6f('0x21')]});}else{_0x4a1da4[a198_0x1b6f('0x12')]({'data':[]});}});};exports[a198_0x1b6f('0x29')]=(_0x1f63c0,_0x56deaf)=>{exports[a198_0x1b6f('0x13')]['models']['reportFiles'][a198_0x1b6f('0x1e')]({'where':{'status':0x1}})[a198_0x1b6f('0x2a')](_0x1cb1c2=>{if(_0x1cb1c2){const _0x2dc54c=a198_0x1b6f('0x2b')+_0x1cb1c2['fileName']+a198_0x1b6f('0x23');fs_1[a198_0x1b6f('0x25')]['readFile'](_0x2dc54c,a198_0x1b6f('0x2c'),function(_0x2ceca6,_0x3109b7){if(_0x2ceca6){_0x1cb1c2[a198_0x1b6f('0x27')]=null;}else{try{const _0x952489=JSON[a198_0x1b6f('0x2d')](_0x3109b7);for(const _0x27c1a8 of _0x952489[a198_0x1b6f('0x2e')][0x0][a198_0x1b6f('0x2f')]){const _0x16555c=_0x27c1a8['In'];const _0x1b4cfb=_0x27c1a8[a198_0x1b6f('0x30')];const _0x322b6c=Date[a198_0x1b6f('0x2d')](_0x27c1a8[a198_0x1b6f('0x31')]);if(_0x16555c>0x0){exports[a198_0x1b6f('0x13')][a198_0x1b6f('0x14')][a198_0x1b6f('0x32')][a198_0x1b6f('0x33')]({'reportFileId':_0x1cb1c2['id'],'amount':_0x16555c,'countingDate':_0x322b6c});}if(_0x1b4cfb>0x0){exports[a198_0x1b6f('0x13')][a198_0x1b6f('0x14')][a198_0x1b6f('0x32')][a198_0x1b6f('0x33')]({'reportFileId':_0x1cb1c2['id'],'amount':_0x1b4cfb*-0x1,'countingDate':_0x322b6c});}}_0x1cb1c2[a198_0x1b6f('0x27')]=0x2;}catch(_0xa1bde7){_0x1cb1c2['status']=null;}}_0x1cb1c2['save']();});_0x56deaf['json']({'data':_0x1cb1c2['fileName']});}else{_0x56deaf[a198_0x1b6f('0x12')]({'data':[]});}});};exports['getPassCounting']=(_0x2344a8,_0x5fcb9d)=>{exports[a198_0x1b6f('0x13')]['models']['passes']['findAll']({'where':{'amount':{[exports[a198_0x1b6f('0x13')]['Op']['gt']]:0x0}},'order':[[a198_0x1b6f('0x34'),a198_0x1b6f('0x35')]]})[a198_0x1b6f('0x2a')](_0x5832da=>{_0x5fcb9d[a198_0x1b6f('0x12')]({'data':_0x5832da});});};exports['getPassCountingByDay']=(_0x1cbd06,_0x6c6843)=>{const _0x39a9ae=_0x1cbd06['query']['month'];const _0x5be7d1=_0x1cbd06[a198_0x1b6f('0x36')][a198_0x1b6f('0x37')];const _0x307c6f=_0x1cbd06['query'][a198_0x1b6f('0x38')];exports['sequelize'][a198_0x1b6f('0x14')][a198_0x1b6f('0x32')][a198_0x1b6f('0x39')]({'attributes':[a198_0x1b6f('0x34'),[exports['sequelize']['fn'](a198_0x1b6f('0x3a'),exports[a198_0x1b6f('0x13')][a198_0x1b6f('0x3b')](a198_0x1b6f('0x3c'))),'total']],'where':{'countingDate':{[exports[a198_0x1b6f('0x13')]['Op']['gte']]:_0x5be7d1,[exports[a198_0x1b6f('0x13')]['Op']['lt']]:_0x307c6f},'amount':_0x1cbd06['params'][a198_0x1b6f('0x3d')]=='in'?{[exports['sequelize']['Op']['gt']]:0x0}:{[exports[a198_0x1b6f('0x13')]['Op']['lt']]:0x0}},'group':[exports[a198_0x1b6f('0x13')][a198_0x1b6f('0x3e')](a198_0x1b6f('0x3f'))],'order':[['countingDate',a198_0x1b6f('0x35')]]})[a198_0x1b6f('0x2a')](_0x117378=>{_0x6c6843['json']({'data':_0x117378});});};exports[a198_0x1b6f('0x40')]=(_0x103b3f,_0x49848e)=>{const _0x550d64=_0x103b3f[a198_0x1b6f('0x36')][a198_0x1b6f('0x41')];const _0x258a21=_0x103b3f[a198_0x1b6f('0x36')][a198_0x1b6f('0x37')];const _0x427a9d=_0x103b3f[a198_0x1b6f('0x36')][a198_0x1b6f('0x38')];exports[a198_0x1b6f('0x13')]['models']['passes'][a198_0x1b6f('0x39')]({'attributes':[a198_0x1b6f('0x34'),[exports[a198_0x1b6f('0x13')]['fn'](a198_0x1b6f('0x42'),exports['sequelize']['col']('countingDate'),a198_0x1b6f('0x43')),a198_0x1b6f('0x44')],[exports[a198_0x1b6f('0x13')]['fn'](a198_0x1b6f('0x3a'),exports[a198_0x1b6f('0x13')][a198_0x1b6f('0x3b')](a198_0x1b6f('0x3c'))),a198_0x1b6f('0x45')]],'where':{'countingDate':{[exports[a198_0x1b6f('0x13')]['Op']['gte']]:_0x258a21,[exports[a198_0x1b6f('0x13')]['Op']['lt']]:_0x427a9d},'amount':_0x103b3f['params']['direction']=='in'?{[exports[a198_0x1b6f('0x13')]['Op']['gt']]:0x0}:{[exports[a198_0x1b6f('0x13')]['Op']['lt']]:0x0}},'group':[exports[a198_0x1b6f('0x13')]['fn'](a198_0x1b6f('0x46'),exports[a198_0x1b6f('0x13')][a198_0x1b6f('0x3b')](a198_0x1b6f('0x34'))),exports['sequelize']['fn'](a198_0x1b6f('0x47'),exports['sequelize']['col'](a198_0x1b6f('0x34'))),exports['sequelize']['fn']('MONTH',exports[a198_0x1b6f('0x13')][a198_0x1b6f('0x3b')](a198_0x1b6f('0x34'))),exports[a198_0x1b6f('0x13')]['fn'](a198_0x1b6f('0x48'),exports[a198_0x1b6f('0x13')]['col'](a198_0x1b6f('0x34')))],'order':[[a198_0x1b6f('0x34'),a198_0x1b6f('0x35')]]})[a198_0x1b6f('0x2a')](_0x12a1b9=>{_0x49848e[a198_0x1b6f('0x12')]({'data':_0x12a1b9});});};exports[a198_0x1b6f('0x49')]=(_0x296212,_0x44d5cb,_0x1e99b7)=>{const _0x1b1231=_0x296212[a198_0x1b6f('0x4a')][a198_0x1b6f('0x4b')][a198_0x1b6f('0x4c')](_0x1b1231=>_0x1b1231[a198_0x1b6f('0x4d')]==='facebook');fbgraph_1[a198_0x1b6f('0x25')]['setAccessToken'](_0x1b1231[a198_0x1b6f('0x4e')]);fbgraph_1['default'][a198_0x1b6f('0x1f')](_0x296212[a198_0x1b6f('0x4a')][a198_0x1b6f('0x4f')]+'?fields=id,name,email,first_name,last_name,gender,link,locale,timezone',(_0x1e3871,_0x464372)=>{if(_0x1e3871){return _0x1e99b7(_0x1e3871);}_0x44d5cb[a198_0x1b6f('0x7')](a198_0x1b6f('0x50'),{'title':a198_0x1b6f('0x51'),'profile':_0x464372});});};