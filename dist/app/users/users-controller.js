var a167_0x43a3=['public','shared','getInstance','userRelationshipsController','include','usersModel','first_name','last_name','nickname','count','find','errorResponse','protocol','://','host','encryptId','created_by_user_id','password','status','created_at','image_url','/users/profile_image/','successResponse','authentication\x20failed','model','body','email','then','user','emailTakenError','username','save','catch','stack','updateUserProfileImage','parse','path','env','FILES_FOLDER','users/','ensureDirSync','.jpg','rename','decryptId','existsSync','sendFile','__esModule','../../infrastructure/sequelize-utils','../../infrastructure/base-controller','../controllers','../../infrastructure/response-utils','fs-extra','../../resources/locale-strings','default','featured','countFeatured','countRelationships','bind','relationships','activities','getUserProfile','updateUserProfile','getUserProfileImage','params'];(function(_0x208c99,_0x297704){var _0xfb741d=function(_0xe4153b){while(--_0xe4153b){_0x208c99['push'](_0x208c99['shift']());}};_0xfb741d(++_0x297704);}(a167_0x43a3,0x12e));var a167_0x468f=function(_0x2061cb,_0x11e86e){_0x2061cb=_0x2061cb-0x0;var _0x1ef44a=a167_0x43a3[_0x2061cb];return _0x1ef44a;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x1d7b10){return _0x1d7b10&&_0x1d7b10[a167_0x468f('0x0')]?_0x1d7b10:{'default':_0x1d7b10};};Object['defineProperty'](exports,a167_0x468f('0x0'),{'value':!![]});const sequelize_utils_1=__importDefault(require(a167_0x468f('0x1')));const base_controller_1=__importDefault(require(a167_0x468f('0x2')));const crudOptions_1=__importDefault(require('../shared/models/crudOptions'));const controllers_1=__importDefault(require(a167_0x468f('0x3')));const models_1=__importDefault(require('../models'));const format=require('string-format');const responseUtils=require(a167_0x468f('0x4'));const fsExtra=require(a167_0x468f('0x5'));const formidable=require('formidable');const LocaleStrings=require(a167_0x468f('0x6'));class UsersController extends base_controller_1[a167_0x468f('0x7')]{constructor(_0x4b6236){super(_0x4b6236,null);this[a167_0x468f('0x8')]=this[a167_0x468f('0x8')]['bind'](this);this[a167_0x468f('0x9')]=this[a167_0x468f('0x9')]['bind'](this);this[a167_0x468f('0xa')]=this[a167_0x468f('0xa')][a167_0x468f('0xb')](this);this[a167_0x468f('0xc')]=this[a167_0x468f('0xc')]['bind'](this);this['activities']=this[a167_0x468f('0xd')][a167_0x468f('0xb')](this);this[a167_0x468f('0xe')]=this[a167_0x468f('0xe')][a167_0x468f('0xb')](this);this[a167_0x468f('0xf')]=this[a167_0x468f('0xf')][a167_0x468f('0xb')](this);this[a167_0x468f('0x10')]=this[a167_0x468f('0x10')][a167_0x468f('0xb')](this);}[a167_0x468f('0x8')](_0x530069,_0x384698,_0x12f2c4){_0x530069[a167_0x468f('0x11')]={'is_private':![]};const _0x4e7138=new crudOptions_1[(a167_0x468f('0x7'))]();_0x4e7138[a167_0x468f('0x12')]=!![];_0x4e7138[a167_0x468f('0x13')]=!![];return this['find'](_0x530069,_0x384698,_0x12f2c4,_0x4e7138);}[a167_0x468f('0x9')](_0x2ffa2e,_0x346f68,_0x20b80e){_0x2ffa2e[a167_0x468f('0x11')]={'is_private':![]};const _0x5a80bb=new crudOptions_1['default']();_0x5a80bb[a167_0x468f('0x12')]=!![];_0x5a80bb[a167_0x468f('0x13')]=!![];return this['count'](_0x2ffa2e,_0x346f68,_0x20b80e,_0x5a80bb);}[a167_0x468f('0xc')](_0x4a9305,_0x3b71ca,_0x3cecae){const _0x5d29ab=controllers_1[a167_0x468f('0x7')][a167_0x468f('0x14')]()[a167_0x468f('0x15')];const _0x38c74d=new crudOptions_1['default']();_0x38c74d['public']=!![];_0x38c74d[a167_0x468f('0x13')]=!![];_0x38c74d[a167_0x468f('0x16')]=[{'model':models_1[a167_0x468f('0x7')][a167_0x468f('0x14')]()[a167_0x468f('0x17')],'attributes':['id',a167_0x468f('0x18'),a167_0x468f('0x19'),a167_0x468f('0x1a')]}];return _0x5d29ab['find'](_0x4a9305,_0x3b71ca,_0x3cecae,_0x38c74d);}[a167_0x468f('0xa')](_0x1f3b88,_0x3f73cb,_0x36dbbc){const _0x1bee66=controllers_1[a167_0x468f('0x7')][a167_0x468f('0x14')]()['userRelationshipsController'];const _0x2946ff=new crudOptions_1['default']();_0x2946ff['public']=!![];_0x2946ff[a167_0x468f('0x13')]=!![];return _0x1bee66[a167_0x468f('0x1b')](_0x1f3b88,_0x3f73cb,_0x36dbbc,_0x2946ff);}[a167_0x468f('0xd')](_0x48222c,_0x2a5b33,_0x1c6190){const _0x1dc41f=controllers_1['default'][a167_0x468f('0x14')]()[a167_0x468f('0x15')];const _0x5353ac=new crudOptions_1[(a167_0x468f('0x7'))]();_0x5353ac['public']=!![];_0x5353ac[a167_0x468f('0x13')]=!![];_0x5353ac[a167_0x468f('0x16')]=[{'model':models_1['default'][a167_0x468f('0x14')]()[a167_0x468f('0x17')]}];return _0x1dc41f[a167_0x468f('0x1c')](_0x48222c,_0x2a5b33,_0x1c6190,_0x5353ac);}['getUserProfile'](_0x555838,_0x187b4f,_0x5d8606){if(!_0x555838['user']){return responseUtils[a167_0x468f('0x1d')](_0x555838,_0x187b4f,'authentication\x20failed',0x191);}const _0x136f86=_0x555838[a167_0x468f('0x1e')]+a167_0x468f('0x1f')+_0x555838['get'](a167_0x468f('0x20'));const _0x1827c7=sequelize_utils_1['default'][a167_0x468f('0x21')](Object['assign']({},_0x555838['user'],{}));delete _0x1827c7[a167_0x468f('0x22')];delete _0x1827c7['updated_by_user_id'];delete _0x1827c7['deleted_by_user_id'];delete _0x1827c7[a167_0x468f('0x23')];delete _0x1827c7[a167_0x468f('0x24')];delete _0x1827c7[a167_0x468f('0x25')];delete _0x1827c7['updated_at'];delete _0x1827c7['deleted_at'];_0x1827c7[a167_0x468f('0x26')]=_0x136f86+a167_0x468f('0x27')+_0x1827c7['id'];return responseUtils[a167_0x468f('0x28')](_0x555838,_0x187b4f,_0x1827c7,0xc8);}[a167_0x468f('0xf')](_0x5be9c7,_0x587107,_0x3a50a6){if(!_0x5be9c7['user']){return responseUtils[a167_0x468f('0x1d')](_0x5be9c7,_0x587107,a167_0x468f('0x29'),0x191);}this[a167_0x468f('0x2a')]['findOne']({'where':{'email':_0x5be9c7[a167_0x468f('0x2b')][a167_0x468f('0x2c')]}})[a167_0x468f('0x2d')](_0x80db6a=>{if(_0x80db6a){if(_0x80db6a['id']!=_0x5be9c7[a167_0x468f('0x2e')]['id']){return responseUtils[a167_0x468f('0x1d')](_0x5be9c7,_0x587107,format(LocaleStrings[a167_0x468f('0x2f')],_0x5be9c7['body']['email']),0x193);}}_0x5be9c7[a167_0x468f('0x2b')]['id']=sequelize_utils_1[a167_0x468f('0x7')]['encryptId'](_0x5be9c7['user']['id']);_0x5be9c7[a167_0x468f('0x2b')][a167_0x468f('0x30')]=_0x5be9c7['body'][a167_0x468f('0x2c')];return this[a167_0x468f('0x31')](_0x5be9c7,null,null)['then'](function(_0x3b83e4,_0x1a565f){return responseUtils[a167_0x468f('0x28')](_0x5be9c7,_0x587107,!![],0xc8);})[a167_0x468f('0x32')](_0x14709e=>{return responseUtils[a167_0x468f('0x1d')](_0x5be9c7,_0x587107,_0x14709e[a167_0x468f('0x33')],0x1f4);});})['catch'](_0x1f210e=>{return responseUtils['errorResponse'](_0x5be9c7,_0x587107,_0x1f210e[a167_0x468f('0x33')],0x1f4);});}[a167_0x468f('0x34')](_0x3a0216,_0x55d2a7,_0x3cc24){if(!_0x3a0216[a167_0x468f('0x2e')]){return responseUtils['errorResponse'](_0x3a0216,_0x55d2a7,'authentication\x20failed',0x191);}const _0x1606c4=formidable({'multiples':!![]});_0x1606c4[a167_0x468f('0x35')](_0x3a0216,(_0x5de7da,_0x355803,_0x71369e)=>{if(_0x5de7da){return responseUtils[a167_0x468f('0x1d')](_0x55d2a7,_0x5de7da['stack'],0x1f4);}const _0x5dafae=_0x3a0216[a167_0x468f('0x2e')];const _0x53f1eb=_0x71369e['image'][a167_0x468f('0x36')];const _0x3d4f81=process[a167_0x468f('0x37')][a167_0x468f('0x38')]+a167_0x468f('0x39');fsExtra[a167_0x468f('0x3a')](_0x3d4f81);const _0x36f21b=_0x3d4f81+_0x5dafae['id']+a167_0x468f('0x3b');fsExtra[a167_0x468f('0x3c')](_0x53f1eb,_0x36f21b,function(_0x5de7da){if(_0x5de7da)throw _0x5de7da;return responseUtils[a167_0x468f('0x28')](_0x3a0216,_0x55d2a7,!![],0xc8);});});}['getUserProfileImage'](_0x2d4bcd,_0x10922d,_0x28f272){const _0x506262=sequelize_utils_1[a167_0x468f('0x7')][a167_0x468f('0x3d')](_0x2d4bcd[a167_0x468f('0x11')]['id']);const _0x3e53f3=process['env'][a167_0x468f('0x38')]+'users/'+_0x506262+a167_0x468f('0x3b');if(fsExtra[a167_0x468f('0x3e')](_0x3e53f3)){_0x10922d[a167_0x468f('0x3f')](_0x3e53f3);}else{return responseUtils[a167_0x468f('0x1d')](_0x2d4bcd,_0x10922d,null,0x194);}}}exports[a167_0x468f('0x7')]=UsersController;