var a167_0x4b96=['getUserProfile','updateUserProfile','params','public','shared','find','relationships','getInstance','userRelationshipsController','usersModel','first_name','last_name','count','errorResponse','protocol','get','host','encryptId','created_by_user_id','updated_by_user_id','deleted_by_user_id','password','status','created_at','updated_at','deleted_at','image_url','/users/profile_image/','user','model','email','emailTakenError','body','save','successResponse','catch','stack','parse','image','path','env','users/','.jpg','rename','getUserProfileImage','decryptId','FILES_FOLDER','__importDefault','__esModule','defineProperty','../shared/models/crudOptions','../controllers','../models','string-format','../../infrastructure/response-utils','fs-extra','../../resources/locale-strings','default','featured','bind','countFeatured','countRelationships','activities'];(function(_0xb67384,_0x27295a){var _0x156d7c=function(_0x52a1f8){while(--_0x52a1f8){_0xb67384['push'](_0xb67384['shift']());}};_0x156d7c(++_0x27295a);}(a167_0x4b96,0xec));var a167_0x403b=function(_0x484682,_0xee1377){_0x484682=_0x484682-0x0;var _0x40eeae=a167_0x4b96[_0x484682];return _0x40eeae;};'use strict';var __importDefault=this&&this[a167_0x403b('0x0')]||function(_0x51f3ca){return _0x51f3ca&&_0x51f3ca[a167_0x403b('0x1')]?_0x51f3ca:{'default':_0x51f3ca};};Object[a167_0x403b('0x2')](exports,a167_0x403b('0x1'),{'value':!![]});const sequelize_utils_1=__importDefault(require('../../infrastructure/sequelize-utils'));const base_controller_1=__importDefault(require('../../infrastructure/base-controller'));const crudOptions_1=__importDefault(require(a167_0x403b('0x3')));const controllers_1=__importDefault(require(a167_0x403b('0x4')));const models_1=__importDefault(require(a167_0x403b('0x5')));const format=require(a167_0x403b('0x6'));const responseUtils=require(a167_0x403b('0x7'));const fsExtra=require(a167_0x403b('0x8'));const formidable=require('formidable');const LocaleStrings=require(a167_0x403b('0x9'));class UsersController extends base_controller_1[a167_0x403b('0xa')]{constructor(_0x2f28b2){super(_0x2f28b2,null);this[a167_0x403b('0xb')]=this[a167_0x403b('0xb')][a167_0x403b('0xc')](this);this[a167_0x403b('0xd')]=this[a167_0x403b('0xd')][a167_0x403b('0xc')](this);this[a167_0x403b('0xe')]=this['countRelationships'][a167_0x403b('0xc')](this);this['relationships']=this['relationships']['bind'](this);this[a167_0x403b('0xf')]=this[a167_0x403b('0xf')]['bind'](this);this[a167_0x403b('0x10')]=this[a167_0x403b('0x10')]['bind'](this);this['updateUserProfile']=this[a167_0x403b('0x11')][a167_0x403b('0xc')](this);this['getUserProfileImage']=this['getUserProfileImage'][a167_0x403b('0xc')](this);}[a167_0x403b('0xb')](_0x36a92d,_0xd012bc,_0x43a232){_0x36a92d[a167_0x403b('0x12')]={'is_private':![]};const _0x476737=new crudOptions_1[(a167_0x403b('0xa'))]();_0x476737[a167_0x403b('0x13')]=!![];_0x476737[a167_0x403b('0x14')]=!![];return this[a167_0x403b('0x15')](_0x36a92d,_0xd012bc,_0x43a232,_0x476737);}[a167_0x403b('0xd')](_0x2fcddc,_0x18d984,_0x2746cc){_0x2fcddc[a167_0x403b('0x12')]={'is_private':![]};const _0x27d1a7=new crudOptions_1['default']();_0x27d1a7[a167_0x403b('0x13')]=!![];_0x27d1a7['shared']=!![];return this['count'](_0x2fcddc,_0x18d984,_0x2746cc,_0x27d1a7);}[a167_0x403b('0x16')](_0x220898,_0x5ed9a2,_0x4ae616){const _0x38b358=controllers_1[a167_0x403b('0xa')][a167_0x403b('0x17')]()[a167_0x403b('0x18')];const _0x592124=new crudOptions_1['default']();_0x592124[a167_0x403b('0x13')]=!![];_0x592124[a167_0x403b('0x14')]=!![];_0x592124['include']=[{'model':models_1['default'][a167_0x403b('0x17')]()[a167_0x403b('0x19')],'attributes':['id',a167_0x403b('0x1a'),a167_0x403b('0x1b'),'nickname']}];return _0x38b358[a167_0x403b('0x15')](_0x220898,_0x5ed9a2,_0x4ae616,_0x592124);}[a167_0x403b('0xe')](_0x4f4005,_0x60960e,_0x1e9e82){const _0x3a5e27=controllers_1[a167_0x403b('0xa')][a167_0x403b('0x17')]()[a167_0x403b('0x18')];const _0x1fc6a0=new crudOptions_1[(a167_0x403b('0xa'))]();_0x1fc6a0[a167_0x403b('0x13')]=!![];_0x1fc6a0['shared']=!![];return _0x3a5e27[a167_0x403b('0x1c')](_0x4f4005,_0x60960e,_0x1e9e82,_0x1fc6a0);}[a167_0x403b('0xf')](_0x3f31ff,_0x5d7b07,_0x5157ea){const _0x5d5b3d=controllers_1[a167_0x403b('0xa')]['getInstance']()[a167_0x403b('0x18')];const _0x4a84e7=new crudOptions_1[(a167_0x403b('0xa'))]();_0x4a84e7[a167_0x403b('0x13')]=!![];_0x4a84e7['shared']=!![];_0x4a84e7['include']=[{'model':models_1['default'][a167_0x403b('0x17')]()['usersModel']}];return _0x5d5b3d['find'](_0x3f31ff,_0x5d7b07,_0x5157ea,_0x4a84e7);}[a167_0x403b('0x10')](_0x960f09,_0x2d47c2,_0x5e2d9f){if(!_0x960f09['user']){return responseUtils[a167_0x403b('0x1d')](_0x960f09,_0x2d47c2,'authentication\x20failed',0x191);}const _0x5a603c=_0x960f09[a167_0x403b('0x1e')]+'://'+_0x960f09[a167_0x403b('0x1f')](a167_0x403b('0x20'));const _0x1508a8=sequelize_utils_1[a167_0x403b('0xa')][a167_0x403b('0x21')](Object['assign']({},_0x960f09['user'],{}));delete _0x1508a8[a167_0x403b('0x22')];delete _0x1508a8[a167_0x403b('0x23')];delete _0x1508a8[a167_0x403b('0x24')];delete _0x1508a8[a167_0x403b('0x25')];delete _0x1508a8[a167_0x403b('0x26')];delete _0x1508a8[a167_0x403b('0x27')];delete _0x1508a8[a167_0x403b('0x28')];delete _0x1508a8[a167_0x403b('0x29')];_0x1508a8[a167_0x403b('0x2a')]=_0x5a603c+a167_0x403b('0x2b')+_0x1508a8['id'];return responseUtils['successResponse'](_0x960f09,_0x2d47c2,_0x1508a8,0xc8);}[a167_0x403b('0x11')](_0x164096,_0x2de533,_0x20e23e){if(!_0x164096[a167_0x403b('0x2c')]){return responseUtils[a167_0x403b('0x1d')](_0x164096,_0x2de533,'authentication\x20failed',0x191);}this[a167_0x403b('0x2d')]['findOne']({'where':{'email':_0x164096['body'][a167_0x403b('0x2e')]}})['then'](_0x8631c2=>{if(_0x8631c2){if(_0x8631c2['id']!=_0x164096[a167_0x403b('0x2c')]['id']){return responseUtils[a167_0x403b('0x1d')](_0x164096,_0x2de533,format(LocaleStrings[a167_0x403b('0x2f')],_0x164096['body'][a167_0x403b('0x2e')]),0x193);}}_0x164096['body']['id']=sequelize_utils_1['default'][a167_0x403b('0x21')](_0x164096['user']['id']);_0x164096[a167_0x403b('0x30')]['username']=_0x164096[a167_0x403b('0x30')][a167_0x403b('0x2e')];return this[a167_0x403b('0x31')](_0x164096,null,null)['then'](function(_0x1457e4,_0x170f0f){return responseUtils[a167_0x403b('0x32')](_0x164096,_0x2de533,!![],0xc8);})[a167_0x403b('0x33')](_0x532110=>{return responseUtils[a167_0x403b('0x1d')](_0x164096,_0x2de533,_0x532110['stack'],0x1f4);});})['catch'](_0x4684d2=>{return responseUtils[a167_0x403b('0x1d')](_0x164096,_0x2de533,_0x4684d2[a167_0x403b('0x34')],0x1f4);});}['updateUserProfileImage'](_0x1eaedb,_0x12e7eb,_0x15fe39){if(!_0x1eaedb[a167_0x403b('0x2c')]){return responseUtils[a167_0x403b('0x1d')](_0x1eaedb,_0x12e7eb,'authentication\x20failed',0x191);}const _0xa07d8a=formidable({'multiples':!![]});_0xa07d8a[a167_0x403b('0x35')](_0x1eaedb,(_0x5e74c0,_0x5f5186,_0x4fcd0e)=>{if(_0x5e74c0){return responseUtils[a167_0x403b('0x1d')](_0x12e7eb,_0x5e74c0[a167_0x403b('0x34')],0x1f4);}const _0x2e3017=_0x1eaedb[a167_0x403b('0x2c')];const _0x3bca52=_0x4fcd0e[a167_0x403b('0x36')][a167_0x403b('0x37')];const _0x1a7003=process[a167_0x403b('0x38')]['FILES_FOLDER']+a167_0x403b('0x39');fsExtra['ensureDirSync'](_0x1a7003);const _0x130c44=_0x1a7003+_0x2e3017['id']+a167_0x403b('0x3a');fsExtra[a167_0x403b('0x3b')](_0x3bca52,_0x130c44,function(_0x5e74c0){if(_0x5e74c0)throw _0x5e74c0;return responseUtils[a167_0x403b('0x32')](_0x1eaedb,_0x12e7eb,!![],0xc8);});});}[a167_0x403b('0x3c')](_0x11b093,_0x1e96c2,_0x44f5e3){const _0x3cdb5f=sequelize_utils_1[a167_0x403b('0xa')][a167_0x403b('0x3d')](_0x11b093[a167_0x403b('0x12')]['id']);const _0x27c4bd=process[a167_0x403b('0x38')][a167_0x403b('0x3e')]+a167_0x403b('0x39')+_0x3cdb5f+a167_0x403b('0x3a');if(fsExtra['existsSync'](_0x27c4bd)){_0x1e96c2['sendFile'](_0x27c4bd);}else{return responseUtils[a167_0x403b('0x1d')](_0x11b093,_0x1e96c2,null,0x194);}}}exports[a167_0x403b('0xa')]=UsersController;