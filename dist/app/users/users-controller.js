var a167_0x38fe=['fs-extra','formidable','../../resources/locale-strings','default','bind','countFeatured','countRelationships','relationships','activities','getUserProfile','updateUserProfile','getUserProfileImage','featured','params','public','shared','count','getInstance','userRelationshipsController','include','usersModel','first_name','last_name','errorResponse','authentication\x20failed','protocol','://','host','assign','created_by_user_id','updated_by_user_id','deleted_by_user_id','password','status','created_at','updated_at','deleted_at','/users/profile_image/','successResponse','user','findOne','body','email','then','encryptId','username','catch','updateUserProfileImage','parse','stack','image','path','env','FILES_FOLDER','users/','ensureDirSync','.jpg','rename','existsSync','sendFile','__importDefault','defineProperty','__esModule','../controllers','../models'];(function(_0x4b4117,_0xbcf531){var _0x49999f=function(_0x4b0994){while(--_0x4b0994){_0x4b4117['push'](_0x4b4117['shift']());}};_0x49999f(++_0xbcf531);}(a167_0x38fe,0xbe));var a167_0x3957=function(_0x2deea0,_0x9fc8bb){_0x2deea0=_0x2deea0-0x0;var _0x27faad=a167_0x38fe[_0x2deea0];return _0x27faad;};'use strict';var __importDefault=this&&this[a167_0x3957('0x0')]||function(_0x4ad610){return _0x4ad610&&_0x4ad610['__esModule']?_0x4ad610:{'default':_0x4ad610};};Object[a167_0x3957('0x1')](exports,a167_0x3957('0x2'),{'value':!![]});const sequelize_utils_1=__importDefault(require('../../infrastructure/sequelize-utils'));const base_controller_1=__importDefault(require('../../infrastructure/base-controller'));const crudOptions_1=__importDefault(require('../shared/models/crudOptions'));const controllers_1=__importDefault(require(a167_0x3957('0x3')));const models_1=__importDefault(require(a167_0x3957('0x4')));const format=require('string-format');const responseUtils=require('../../infrastructure/response-utils');const fsExtra=require(a167_0x3957('0x5'));const formidable=require(a167_0x3957('0x6'));const LocaleStrings=require(a167_0x3957('0x7'));class UsersController extends base_controller_1[a167_0x3957('0x8')]{constructor(_0x150d3d){super(_0x150d3d,null);this['featured']=this['featured'][a167_0x3957('0x9')](this);this[a167_0x3957('0xa')]=this['countFeatured']['bind'](this);this[a167_0x3957('0xb')]=this[a167_0x3957('0xb')][a167_0x3957('0x9')](this);this[a167_0x3957('0xc')]=this['relationships']['bind'](this);this['activities']=this[a167_0x3957('0xd')][a167_0x3957('0x9')](this);this[a167_0x3957('0xe')]=this['getUserProfile']['bind'](this);this[a167_0x3957('0xf')]=this[a167_0x3957('0xf')][a167_0x3957('0x9')](this);this[a167_0x3957('0x10')]=this['getUserProfileImage']['bind'](this);}[a167_0x3957('0x11')](_0x1474db,_0x398f7f,_0x2e268c){_0x1474db[a167_0x3957('0x12')]={'is_private':![]};const _0x40d357=new crudOptions_1[(a167_0x3957('0x8'))]();_0x40d357[a167_0x3957('0x13')]=!![];_0x40d357[a167_0x3957('0x14')]=!![];return this['find'](_0x1474db,_0x398f7f,_0x2e268c,_0x40d357);}[a167_0x3957('0xa')](_0x3eb55d,_0x3fb9c9,_0x264182){_0x3eb55d[a167_0x3957('0x12')]={'is_private':![]};const _0x154fe2=new crudOptions_1[(a167_0x3957('0x8'))]();_0x154fe2[a167_0x3957('0x13')]=!![];_0x154fe2['shared']=!![];return this[a167_0x3957('0x15')](_0x3eb55d,_0x3fb9c9,_0x264182,_0x154fe2);}['relationships'](_0x10db4d,_0x4d11aa,_0x1cebbc){const _0x7a2e0d=controllers_1[a167_0x3957('0x8')][a167_0x3957('0x16')]()[a167_0x3957('0x17')];const _0x3864f9=new crudOptions_1[(a167_0x3957('0x8'))]();_0x3864f9[a167_0x3957('0x13')]=!![];_0x3864f9[a167_0x3957('0x14')]=!![];_0x3864f9[a167_0x3957('0x18')]=[{'model':models_1['default'][a167_0x3957('0x16')]()[a167_0x3957('0x19')],'attributes':['id',a167_0x3957('0x1a'),a167_0x3957('0x1b'),'nickname']}];return _0x7a2e0d['find'](_0x10db4d,_0x4d11aa,_0x1cebbc,_0x3864f9);}[a167_0x3957('0xb')](_0x528bd0,_0x26866a,_0x371165){const _0x50a79d=controllers_1[a167_0x3957('0x8')][a167_0x3957('0x16')]()['userRelationshipsController'];const _0x231b87=new crudOptions_1[(a167_0x3957('0x8'))]();_0x231b87[a167_0x3957('0x13')]=!![];_0x231b87['shared']=!![];return _0x50a79d[a167_0x3957('0x15')](_0x528bd0,_0x26866a,_0x371165,_0x231b87);}['activities'](_0x87ab85,_0x3871f5,_0x2622e3){const _0xab66f9=controllers_1[a167_0x3957('0x8')][a167_0x3957('0x16')]()[a167_0x3957('0x17')];const _0x505f69=new crudOptions_1[(a167_0x3957('0x8'))]();_0x505f69[a167_0x3957('0x13')]=!![];_0x505f69[a167_0x3957('0x14')]=!![];_0x505f69[a167_0x3957('0x18')]=[{'model':models_1['default'][a167_0x3957('0x16')]()[a167_0x3957('0x19')]}];return _0xab66f9['find'](_0x87ab85,_0x3871f5,_0x2622e3,_0x505f69);}[a167_0x3957('0xe')](_0xfce848,_0x4efa00,_0x54db18){if(!_0xfce848['user']){return responseUtils[a167_0x3957('0x1c')](_0xfce848,_0x4efa00,a167_0x3957('0x1d'),0x191);}const _0x4e72d8=_0xfce848[a167_0x3957('0x1e')]+a167_0x3957('0x1f')+_0xfce848['get'](a167_0x3957('0x20'));const _0x13f004=sequelize_utils_1[a167_0x3957('0x8')]['encryptId'](Object[a167_0x3957('0x21')]({},_0xfce848['user'],{}));delete _0x13f004[a167_0x3957('0x22')];delete _0x13f004[a167_0x3957('0x23')];delete _0x13f004[a167_0x3957('0x24')];delete _0x13f004[a167_0x3957('0x25')];delete _0x13f004[a167_0x3957('0x26')];delete _0x13f004[a167_0x3957('0x27')];delete _0x13f004[a167_0x3957('0x28')];delete _0x13f004[a167_0x3957('0x29')];_0x13f004['image_url']=_0x4e72d8+a167_0x3957('0x2a')+_0x13f004['id'];return responseUtils[a167_0x3957('0x2b')](_0xfce848,_0x4efa00,_0x13f004,0xc8);}[a167_0x3957('0xf')](_0x47b21e,_0x9decfe,_0x4bd25a){if(!_0x47b21e[a167_0x3957('0x2c')]){return responseUtils[a167_0x3957('0x1c')](_0x47b21e,_0x9decfe,'authentication\x20failed',0x191);}this['model'][a167_0x3957('0x2d')]({'where':{'email':_0x47b21e[a167_0x3957('0x2e')][a167_0x3957('0x2f')]}})[a167_0x3957('0x30')](_0x41cc1d=>{if(_0x41cc1d){if(_0x41cc1d['id']!=_0x47b21e[a167_0x3957('0x2c')]['id']){return responseUtils['errorResponse'](_0x47b21e,_0x9decfe,format(LocaleStrings['emailTakenError'],_0x47b21e[a167_0x3957('0x2e')]['email']),0x193);}}_0x47b21e['body']['id']=sequelize_utils_1[a167_0x3957('0x8')][a167_0x3957('0x31')](_0x47b21e[a167_0x3957('0x2c')]['id']);_0x47b21e[a167_0x3957('0x2e')][a167_0x3957('0x32')]=_0x47b21e[a167_0x3957('0x2e')][a167_0x3957('0x2f')];return this['save'](_0x47b21e,null,null)[a167_0x3957('0x30')](function(_0x276e63,_0xbe36ca){return responseUtils[a167_0x3957('0x2b')](_0x47b21e,_0x9decfe,!![],0xc8);})[a167_0x3957('0x33')](_0x463252=>{return responseUtils[a167_0x3957('0x1c')](_0x47b21e,_0x9decfe,_0x463252['stack'],0x1f4);});})[a167_0x3957('0x33')](_0x2417ea=>{return responseUtils['errorResponse'](_0x47b21e,_0x9decfe,_0x2417ea['stack'],0x1f4);});}[a167_0x3957('0x34')](_0x531dc9,_0x4f20ec,_0x42462d){if(!_0x531dc9[a167_0x3957('0x2c')]){return responseUtils[a167_0x3957('0x1c')](_0x531dc9,_0x4f20ec,a167_0x3957('0x1d'),0x191);}const _0x2994fb=formidable({'multiples':!![]});_0x2994fb[a167_0x3957('0x35')](_0x531dc9,(_0x23072b,_0x1d1102,_0xcc5d43)=>{if(_0x23072b){return responseUtils[a167_0x3957('0x1c')](_0x4f20ec,_0x23072b[a167_0x3957('0x36')],0x1f4);}const _0xc772e2=_0x531dc9[a167_0x3957('0x2c')];const _0x593907=_0xcc5d43[a167_0x3957('0x37')][a167_0x3957('0x38')];const _0x24e7f5=process[a167_0x3957('0x39')][a167_0x3957('0x3a')]+a167_0x3957('0x3b');fsExtra[a167_0x3957('0x3c')](_0x24e7f5);const _0x1c17c4=_0x24e7f5+_0xc772e2['id']+a167_0x3957('0x3d');fsExtra[a167_0x3957('0x3e')](_0x593907,_0x1c17c4,function(_0x23072b){if(_0x23072b)throw _0x23072b;return responseUtils[a167_0x3957('0x2b')](_0x531dc9,_0x4f20ec,!![],0xc8);});});}[a167_0x3957('0x10')](_0x539f3a,_0x5b4bb4,_0x4678b9){const _0x21ef08=sequelize_utils_1[a167_0x3957('0x8')]['decryptId'](_0x539f3a[a167_0x3957('0x12')]['id']);const _0x191677=process['env'][a167_0x3957('0x3a')]+a167_0x3957('0x3b')+_0x21ef08+a167_0x3957('0x3d');if(fsExtra[a167_0x3957('0x3f')](_0x191677)){_0x5b4bb4[a167_0x3957('0x40')](_0x191677);}else{return responseUtils['errorResponse'](_0x539f3a,_0x5b4bb4,null,0x194);}}}exports[a167_0x3957('0x8')]=UsersController;