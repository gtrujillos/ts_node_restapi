var a37_0x3db1=['createAccount','model','body','username','last_name','email','password','then','usernameNotFoundError','toJSON','secret','token','successResponse','errorResponse','passwordNotMatchError','catch','stack','usernameTakenError','generateHash','create','default','defineProperty','__esModule','jsonwebtoken','i18n','../../config/jwt.js','../../infrastructure/response-utils','../../resources/locale-strings','login','bind'];(function(_0x2fbeca,_0x302170){var _0x1ae02f=function(_0x1066ee){while(--_0x1066ee){_0x2fbeca['push'](_0x2fbeca['shift']());}};_0x1ae02f(++_0x302170);}(a37_0x3db1,0x8d));var a37_0x76aa=function(_0x2d96bc,_0x374446){_0x2d96bc=_0x2d96bc-0x0;var _0x3396f6=a37_0x3db1[_0x2d96bc];return _0x3396f6;};'use strict';Object[a37_0x76aa('0x0')](exports,a37_0x76aa('0x1'),{'value':!![]});const jwt=require(a37_0x76aa('0x2'));const i18n=require(a37_0x76aa('0x3'));const configJwt=require(a37_0x76aa('0x4'));const authUtils=require('../../infrastructure/auth-utils');const responseUtils=require(a37_0x76aa('0x5'));const LocaleStrings=require(a37_0x76aa('0x6'));class AuthConstroller{constructor(_0x3653ac){this['model']=_0x3653ac;this['login']=this[a37_0x76aa('0x7')][a37_0x76aa('0x8')](this);this['createAccount']=this[a37_0x76aa('0x9')]['bind'](this);}[a37_0x76aa('0x7')](_0x4123b5,_0x15680e,_0x35d6a2){this[a37_0x76aa('0xa')]['findOne']({'where':{'username':_0x4123b5[a37_0x76aa('0xb')][a37_0x76aa('0xc')]},'attributes':['id','first_name',a37_0x76aa('0xd'),a37_0x76aa('0xe'),'username',a37_0x76aa('0xf')]})[a37_0x76aa('0x10')](_0xa1b8d6=>{if(!_0xa1b8d6){return responseUtils['errorResponse'](_0x15680e,LocaleStrings[a37_0x76aa('0x11')],0x193);}if(authUtils['validPassword'](_0x4123b5[a37_0x76aa('0xb')]['password'],_0xa1b8d6[a37_0x76aa('0xf')])){_0xa1b8d6=_0xa1b8d6[a37_0x76aa('0x12')]();const _0x3712bd={'id':_0xa1b8d6['id']};const _0x58892e=jwt['sign'](_0x3712bd,configJwt[a37_0x76aa('0x13')]);delete _0xa1b8d6[a37_0x76aa('0xf')];_0xa1b8d6[a37_0x76aa('0x14')]=_0x58892e;return responseUtils[a37_0x76aa('0x15')](_0x15680e,_0xa1b8d6,0xc8);}else{return responseUtils[a37_0x76aa('0x16')](_0x15680e,_0x15680e['__'](LocaleStrings[a37_0x76aa('0x17')]),0x193);}})[a37_0x76aa('0x18')](_0x13bc02=>{return responseUtils[a37_0x76aa('0x16')](_0x15680e,_0x13bc02[a37_0x76aa('0x19')],0x1f4);});}[a37_0x76aa('0x9')](_0x720d19,_0x2cf425,_0x4d7f02){this['model']['findOne']({'where':{'username':_0x720d19[a37_0x76aa('0xb')]['username']}})[a37_0x76aa('0x10')](function(_0x1138d7){if(_0x1138d7){return responseUtils[a37_0x76aa('0x16')](_0x2cf425,_0x2cf425['__'](LocaleStrings[a37_0x76aa('0x1a')],_0x720d19[a37_0x76aa('0xb')]['username']),0x193);}else{_0x720d19[a37_0x76aa('0xb')][a37_0x76aa('0xe')]=_0x720d19['body']['username'];const _0x4e907f={'username':_0x720d19[a37_0x76aa('0xb')]['username'],'password':authUtils[a37_0x76aa('0x1b')](_0x720d19[a37_0x76aa('0xb')]['password'])};this[a37_0x76aa('0xa')][a37_0x76aa('0x1c')](_0x4e907f)[a37_0x76aa('0x10')](function(_0x1c0435,_0x5409ed){return responseUtils[a37_0x76aa('0x15')](_0x2cf425,_0x1c0435,0xc8);})[a37_0x76aa('0x18')](_0x12deff=>{return responseUtils[a37_0x76aa('0x16')](_0x2cf425,_0x12deff[a37_0x76aa('0x19')],0x1f4);});}})[a37_0x76aa('0x18')](_0x31a967=>{return responseUtils[a37_0x76aa('0x16')](_0x2cf425,_0x31a967['stack'],0x1f4);});}}exports[a37_0x76aa('0x1d')]=AuthConstroller;