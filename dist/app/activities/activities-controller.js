var a0_0x2850=['../../infrastructure/response-utils','default','bind','saveTimeLog','getTimeLogs','getTimeLogsTotal','assign','body','dataValues','encryptId','product_id','getInstance','activityProductsController','save','successResponse','errorResponse','report_back','activity_type_name','params','log','description','timeLogsController','activityTimeLogsController','productTimeLogsController','saveImage','user','authentication\x20failed','filesController','fields','activity_id','activityFilesController','file_id','catch','getImages','decryptId','public','shared','updated_at','DESC','attributes','filesModel','title','type','find','req.params','orderBy','include','name','is_private','count','saveTimeLog\x20req.body','activityTimeLogResult:\x20','timeLogsModel','__awaiter','done','value','then','next','__importDefault','__esModule','defineProperty','../../infrastructure/base-controller','../shared/models/crudOptions','../controllers','../../infrastructure/sequelize-utils','fs-extra','formidable'];(function(_0x29dd6e,_0x2d3d5f){var _0x39b6ef=function(_0x172f12){while(--_0x172f12){_0x29dd6e['push'](_0x29dd6e['shift']());}};_0x39b6ef(++_0x2d3d5f);}(a0_0x2850,0x184));var a0_0x50b8=function(_0x29a0f4,_0x97930e){_0x29a0f4=_0x29a0f4-0x0;var _0x33e39f=a0_0x2850[_0x29a0f4];return _0x33e39f;};'use strict';var __awaiter=this&&this[a0_0x50b8('0x0')]||function(_0x190e79,_0x1f6a79,_0x4663e3,_0x5c299b){function _0x380281(_0x1e52ae){return _0x1e52ae instanceof _0x4663e3?_0x1e52ae:new _0x4663e3(function(_0x5391b0){_0x5391b0(_0x1e52ae);});}return new(_0x4663e3||(_0x4663e3=Promise))(function(_0x300a6a,_0x1b3896){function _0x1cb4ed(_0x2fbd1f){try{_0x32be3b(_0x5c299b['next'](_0x2fbd1f));}catch(_0x24afaf){_0x1b3896(_0x24afaf);}}function _0x2da73a(_0x4a457e){try{_0x32be3b(_0x5c299b['throw'](_0x4a457e));}catch(_0x5709ed){_0x1b3896(_0x5709ed);}}function _0x32be3b(_0x1721c6){_0x1721c6[a0_0x50b8('0x1')]?_0x300a6a(_0x1721c6[a0_0x50b8('0x2')]):_0x380281(_0x1721c6[a0_0x50b8('0x2')])[a0_0x50b8('0x3')](_0x1cb4ed,_0x2da73a);}_0x32be3b((_0x5c299b=_0x5c299b['apply'](_0x190e79,_0x1f6a79||[]))[a0_0x50b8('0x4')]());});};var __importDefault=this&&this[a0_0x50b8('0x5')]||function(_0x53be0e){return _0x53be0e&&_0x53be0e[a0_0x50b8('0x6')]?_0x53be0e:{'default':_0x53be0e};};Object[a0_0x50b8('0x7')](exports,a0_0x50b8('0x6'),{'value':!![]});const base_controller_1=__importDefault(require(a0_0x50b8('0x8')));const crudOptions_1=__importDefault(require(a0_0x50b8('0x9')));const models_1=__importDefault(require('../models'));const controllers_1=__importDefault(require(a0_0x50b8('0xa')));const sequelize_utils_1=__importDefault(require(a0_0x50b8('0xb')));const fsExtra=require(a0_0x50b8('0xc'));const formidable=require(a0_0x50b8('0xd'));const responseUtils=require(a0_0x50b8('0xe'));class ActivitiesController extends base_controller_1[a0_0x50b8('0xf')]{constructor(_0x17408b){super(_0x17408b,null);this['report']=this['report']['bind'](this);this['saveImage']=this['saveImage'][a0_0x50b8('0x10')](this);this['getImages']=this['getImages'][a0_0x50b8('0x10')](this);this['getImagesTotal']=this['getImagesTotal'][a0_0x50b8('0x10')](this);this[a0_0x50b8('0x11')]=this[a0_0x50b8('0x11')][a0_0x50b8('0x10')](this);this[a0_0x50b8('0x12')]=this[a0_0x50b8('0x12')][a0_0x50b8('0x10')](this);this[a0_0x50b8('0x13')]=this[a0_0x50b8('0x13')][a0_0x50b8('0x10')](this);}['report'](_0x2e195b,_0x44eab8,_0xde8248,_0x4d9f58=new crudOptions_1['default']()){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x151c04=Object[a0_0x50b8('0x14')]({},_0x2e195b[a0_0x50b8('0x15')]);const _0x340599=new crudOptions_1[(a0_0x50b8('0xf'))]();const _0xe2d567=yield this['save'](_0x2e195b,null,null,_0x340599);if(_0xe2d567[a0_0x50b8('0x16')]){const _0x4fec52=sequelize_utils_1[a0_0x50b8('0xf')][a0_0x50b8('0x17')](_0xe2d567[a0_0x50b8('0x16')]['id']);if(_0x151c04[a0_0x50b8('0x18')]){_0x2e195b['body']={'product_id':_0x151c04['product_id'],'activity_id':_0x4fec52};const _0x40ec48=yield controllers_1[a0_0x50b8('0xf')][a0_0x50b8('0x19')]()[a0_0x50b8('0x1a')][a0_0x50b8('0x1b')](_0x2e195b,null,null);}return responseUtils[a0_0x50b8('0x1c')](_0x2e195b,_0x44eab8,{'id':_0x4fec52},0xc8);}else{return responseUtils[a0_0x50b8('0x1d')](_0x2e195b,_0x44eab8,null,0x193);}});}[a0_0x50b8('0x1e')](_0x2bf276,_0x59fae6,_0x3707c1,_0x59e9d4=new crudOptions_1[(a0_0x50b8('0xf'))]()){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x47903b=Object[a0_0x50b8('0x14')]({},_0x2bf276[a0_0x50b8('0x15')]);const _0x37c7e6=new crudOptions_1['default']();if(_0x47903b[a0_0x50b8('0x1f')]){_0x2bf276[a0_0x50b8('0x15')]={'name':_0x47903b[a0_0x50b8('0x1f')]};_0x2bf276[a0_0x50b8('0x20')]=_0x2bf276['body'];const _0x449a7d=yield controllers_1['default']['getInstance']()['activityTypesController']['findOrCreate'](_0x2bf276,null,null);let _0xfdf69d=null;if(_0x449a7d['dataValues']){_0xfdf69d=sequelize_utils_1[a0_0x50b8('0xf')][a0_0x50b8('0x17')](_0x449a7d['dataValues']['id']);_0x2bf276[a0_0x50b8('0x15')]['activity_type_id']=_0xfdf69d;}_0x2bf276[a0_0x50b8('0x15')]=_0x47903b;_0x2bf276[a0_0x50b8('0x15')]['activity_type_id']=_0xfdf69d;console[a0_0x50b8('0x21')]('activityType\x20req.body',_0x2bf276[a0_0x50b8('0x15')]);}const _0x27b3e2=yield this[a0_0x50b8('0x1b')](_0x2bf276,null,null,_0x37c7e6);if(_0x27b3e2[a0_0x50b8('0x16')]){const _0xcc87c0=sequelize_utils_1[a0_0x50b8('0xf')][a0_0x50b8('0x17')](_0x27b3e2[a0_0x50b8('0x16')]['id']);delete _0x2bf276[a0_0x50b8('0x15')][a0_0x50b8('0x22')];const _0x1f5d5a=yield controllers_1[a0_0x50b8('0xf')][a0_0x50b8('0x19')]()[a0_0x50b8('0x23')][a0_0x50b8('0x1b')](_0x2bf276,null,null);if(_0x1f5d5a){const _0xc1cc20=sequelize_utils_1[a0_0x50b8('0xf')][a0_0x50b8('0x17')](_0x1f5d5a[a0_0x50b8('0x16')]['id']);_0x2bf276[a0_0x50b8('0x15')]={'time_log_id':_0xc1cc20,'activity_id':_0xcc87c0};const _0x3de18f=yield controllers_1[a0_0x50b8('0xf')][a0_0x50b8('0x19')]()[a0_0x50b8('0x24')]['save'](_0x2bf276,null,null);}if(_0x47903b[a0_0x50b8('0x18')]){_0x2bf276[a0_0x50b8('0x15')]={'product_id':_0x47903b[a0_0x50b8('0x18')],'activity_id':_0xcc87c0};const _0x1794a9=yield controllers_1[a0_0x50b8('0xf')]['getInstance']()[a0_0x50b8('0x1a')][a0_0x50b8('0x1b')](_0x2bf276,null,null);_0x2bf276[a0_0x50b8('0x15')]={'product_id':_0x47903b[a0_0x50b8('0x18')],'activity_id':_0xcc87c0};const _0xd54446=yield controllers_1[a0_0x50b8('0xf')]['getInstance']()[a0_0x50b8('0x25')][a0_0x50b8('0x1b')](_0x2bf276,null,null);}return responseUtils[a0_0x50b8('0x1c')](_0x2bf276,_0x59fae6,{'id':_0xcc87c0},0xc8);}else{return responseUtils[a0_0x50b8('0x1d')](_0x2bf276,_0x59fae6,null,0x193);}});}[a0_0x50b8('0x26')](_0x111cfe,_0x24e280,_0x3e12a5){console[a0_0x50b8('0x21')]('saveImage');if(!_0x111cfe[a0_0x50b8('0x27')]){return responseUtils[a0_0x50b8('0x1d')](_0x111cfe,_0x24e280,a0_0x50b8('0x28'),0x191);}controllers_1[a0_0x50b8('0xf')][a0_0x50b8('0x19')]()[a0_0x50b8('0x29')]['saveFile'](_0x111cfe,null,null)[a0_0x50b8('0x3')](_0x6d77ed=>{console['log']('saveImage\x20fileResult:',_0x6d77ed);_0x111cfe[a0_0x50b8('0x15')]={'file_id':sequelize_utils_1[a0_0x50b8('0xf')]['encryptId'](_0x6d77ed['data']['id']),'activity_id':_0x6d77ed[a0_0x50b8('0x2a')][a0_0x50b8('0x2b')]};console[a0_0x50b8('0x21')]('req.body',_0x111cfe[a0_0x50b8('0x15')]);controllers_1[a0_0x50b8('0xf')][a0_0x50b8('0x19')]()[a0_0x50b8('0x2c')][a0_0x50b8('0x1b')](_0x111cfe,null,null)['then'](_0x1f9af=>{const _0x52c728={'file_id':sequelize_utils_1['default'][a0_0x50b8('0x17')](_0x1f9af[a0_0x50b8('0x2d')])};responseUtils[a0_0x50b8('0x1c')](_0x111cfe,_0x24e280,_0x52c728,0xc8);})[a0_0x50b8('0x2e')](_0x9a0934=>{return responseUtils['errorResponse'](_0x111cfe,_0x24e280,_0x9a0934['stack'],0x1f4);});},_0x11e141=>{return responseUtils[a0_0x50b8('0x1d')](_0x111cfe,_0x24e280,_0x11e141,0x1f4);});}[a0_0x50b8('0x2f')](_0xe03a3c,_0xc063db,_0x3db5d5){_0xe03a3c['params']=sequelize_utils_1[a0_0x50b8('0xf')][a0_0x50b8('0x30')](_0xe03a3c['params']);console[a0_0x50b8('0x21')]('req.params',_0xe03a3c[a0_0x50b8('0x20')]);const _0x4518dc=new crudOptions_1['default']();_0x4518dc[a0_0x50b8('0x31')]=!![];_0x4518dc[a0_0x50b8('0x32')]=!![];_0x4518dc['orderBy']=[[a0_0x50b8('0x33'),a0_0x50b8('0x34')]];_0x4518dc[a0_0x50b8('0x35')]=['id',a0_0x50b8('0x2d')];_0x4518dc['include']=[{'model':models_1[a0_0x50b8('0xf')][a0_0x50b8('0x19')]()[a0_0x50b8('0x36')],'attributes':[a0_0x50b8('0x37'),'name',a0_0x50b8('0x38'),'is_private']}];return controllers_1['default'][a0_0x50b8('0x19')]()[a0_0x50b8('0x2c')][a0_0x50b8('0x39')](_0xe03a3c,_0xc063db,_0x3db5d5,_0x4518dc);}['getImagesTotal'](_0x421c65,_0x560c6c,_0x2ed63f){_0x421c65[a0_0x50b8('0x20')]=sequelize_utils_1[a0_0x50b8('0xf')][a0_0x50b8('0x30')](_0x421c65[a0_0x50b8('0x20')]);console[a0_0x50b8('0x21')](a0_0x50b8('0x3a'),_0x421c65[a0_0x50b8('0x20')]);const _0x581e95=new crudOptions_1[(a0_0x50b8('0xf'))]();_0x581e95[a0_0x50b8('0x31')]=!![];_0x581e95[a0_0x50b8('0x32')]=!![];_0x581e95[a0_0x50b8('0x3b')]=[[a0_0x50b8('0x33'),a0_0x50b8('0x34')]];_0x581e95[a0_0x50b8('0x35')]=['id',a0_0x50b8('0x2d')];_0x581e95[a0_0x50b8('0x3c')]=[{'model':models_1[a0_0x50b8('0xf')][a0_0x50b8('0x19')]()[a0_0x50b8('0x36')],'attributes':[a0_0x50b8('0x37'),a0_0x50b8('0x3d'),a0_0x50b8('0x38'),a0_0x50b8('0x3e')]}];return controllers_1['default'][a0_0x50b8('0x19')]()['activityFilesController'][a0_0x50b8('0x3f')](_0x421c65,_0x560c6c,_0x2ed63f,_0x581e95);}[a0_0x50b8('0x11')](_0xa89d24,_0x24c0ad,_0x4cb461){console[a0_0x50b8('0x21')](a0_0x50b8('0x40'),_0xa89d24[a0_0x50b8('0x15')]);if(!_0xa89d24[a0_0x50b8('0x27')]){return responseUtils['errorResponse'](_0xa89d24,_0x24c0ad,a0_0x50b8('0x28'),0x191);}const _0x2df5e1=_0xa89d24[a0_0x50b8('0x15')][a0_0x50b8('0x2b')];_0xa89d24[a0_0x50b8('0x15')]={'started_at':_0xa89d24[a0_0x50b8('0x15')]['started_at'],'ended_at':_0xa89d24['body']['ended_at'],'description':_0xa89d24['body'][a0_0x50b8('0x22')],'is_private':_0xa89d24[a0_0x50b8('0x15')][a0_0x50b8('0x3e')]};controllers_1[a0_0x50b8('0xf')][a0_0x50b8('0x19')]()[a0_0x50b8('0x23')]['save'](_0xa89d24,null,null)[a0_0x50b8('0x3')](_0x163d99=>{_0xa89d24[a0_0x50b8('0x15')]={'time_log_id':sequelize_utils_1[a0_0x50b8('0xf')]['encryptId'](_0x163d99[a0_0x50b8('0x16')]['id']),'activity_id':_0x2df5e1};console[a0_0x50b8('0x21')]('timeLogResult\x20req.body:\x20',_0xa89d24[a0_0x50b8('0x15')]);controllers_1['default'][a0_0x50b8('0x19')]()['activityTimeLogsController'][a0_0x50b8('0x1b')](_0xa89d24,null,null)['then'](_0x4badee=>{console[a0_0x50b8('0x21')](a0_0x50b8('0x41'),_0x4badee[a0_0x50b8('0x16')]);responseUtils[a0_0x50b8('0x1c')](_0xa89d24,_0x24c0ad,_0x4badee,0xc8);})[a0_0x50b8('0x2e')](_0xc5ae37=>{return responseUtils['errorResponse'](_0xa89d24,_0x24c0ad,_0xc5ae37['stack'],0x1f4);});})[a0_0x50b8('0x2e')](_0x3afa56=>{return responseUtils[a0_0x50b8('0x1d')](_0xa89d24,_0x24c0ad,_0x3afa56['stack'],0x1f4);});}['getTimeLogs'](_0x18dff7,_0x31c4cd,_0x215a80){_0x18dff7[a0_0x50b8('0x20')]=sequelize_utils_1[a0_0x50b8('0xf')][a0_0x50b8('0x30')](_0x18dff7['params']);console[a0_0x50b8('0x21')](a0_0x50b8('0x3a'),_0x18dff7[a0_0x50b8('0x20')]);const _0x24845a=new crudOptions_1[(a0_0x50b8('0xf'))]();_0x24845a[a0_0x50b8('0x31')]=!![];_0x24845a[a0_0x50b8('0x32')]=!![];_0x24845a[a0_0x50b8('0x3b')]=[[a0_0x50b8('0x33'),a0_0x50b8('0x34')]];_0x24845a['include']=[{'model':models_1[a0_0x50b8('0xf')]['getInstance']()['timeLogsModel']}];return controllers_1[a0_0x50b8('0xf')][a0_0x50b8('0x19')]()[a0_0x50b8('0x24')][a0_0x50b8('0x39')](_0x18dff7,_0x31c4cd,_0x215a80,_0x24845a);}[a0_0x50b8('0x13')](_0x3672a7,_0x1b34ad,_0x32e0b9){_0x3672a7[a0_0x50b8('0x20')]=sequelize_utils_1[a0_0x50b8('0xf')][a0_0x50b8('0x30')](_0x3672a7['params']);console[a0_0x50b8('0x21')](a0_0x50b8('0x3a'),_0x3672a7['params']);const _0x11ebb3=new crudOptions_1[(a0_0x50b8('0xf'))]();_0x11ebb3[a0_0x50b8('0x31')]=!![];_0x11ebb3[a0_0x50b8('0x32')]=!![];_0x11ebb3[a0_0x50b8('0x3b')]=[[a0_0x50b8('0x33'),'DESC']];_0x11ebb3[a0_0x50b8('0x3c')]=[{'model':models_1['default'][a0_0x50b8('0x19')]()[a0_0x50b8('0x42')]}];return controllers_1[a0_0x50b8('0xf')][a0_0x50b8('0x19')]()[a0_0x50b8('0x24')]['count'](_0x3672a7,_0x1b34ad,_0x32e0b9,_0x11ebb3);}}exports['default']=ActivitiesController;