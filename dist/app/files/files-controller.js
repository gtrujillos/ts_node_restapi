var a72_0x59dd=['renameSync','body','type','is_private','log','files\x20req.body','successResponse','dataValues','stack','default','done','value','then','apply','next','__esModule','defineProperty','../../infrastructure/base-controller','uuid','jsonwebtoken','i18n','../../infrastructure/auth-utils','../../infrastructure/response-utils','../../resources/locale-strings','formidable','saveFile','bind','user','errorResponse','authentication\x20failed','parse','upload_file','env','FILES_FOLDER','ensureDirSync'];(function(_0x3d8df6,_0x17f215){var _0x179a4f=function(_0x125eb0){while(--_0x125eb0){_0x3d8df6['push'](_0x3d8df6['shift']());}};_0x179a4f(++_0x17f215);}(a72_0x59dd,0xff));var a72_0x6481=function(_0x23c05c,_0x148b80){_0x23c05c=_0x23c05c-0x0;var _0x34e058=a72_0x59dd[_0x23c05c];return _0x34e058;};'use strict';var __awaiter=this&&this['__awaiter']||function(_0x16c25b,_0x23d59a,_0x14e512,_0xb2907b){function _0x5edb79(_0x3255fa){return _0x3255fa instanceof _0x14e512?_0x3255fa:new _0x14e512(function(_0x194bd1){_0x194bd1(_0x3255fa);});}return new(_0x14e512||(_0x14e512=Promise))(function(_0x5b591d,_0x2fd547){function _0x373e24(_0x1981fe){try{_0x5763c2(_0xb2907b['next'](_0x1981fe));}catch(_0x1ea20c){_0x2fd547(_0x1ea20c);}}function _0x51c109(_0xe2ec05){try{_0x5763c2(_0xb2907b['throw'](_0xe2ec05));}catch(_0x23be82){_0x2fd547(_0x23be82);}}function _0x5763c2(_0x39ed23){_0x39ed23[a72_0x6481('0x0')]?_0x5b591d(_0x39ed23[a72_0x6481('0x1')]):_0x5edb79(_0x39ed23[a72_0x6481('0x1')])[a72_0x6481('0x2')](_0x373e24,_0x51c109);}_0x5763c2((_0xb2907b=_0xb2907b[a72_0x6481('0x3')](_0x16c25b,_0x23d59a||[]))[a72_0x6481('0x4')]());});};var __importDefault=this&&this['__importDefault']||function(_0x354711){return _0x354711&&_0x354711[a72_0x6481('0x5')]?_0x354711:{'default':_0x354711};};Object[a72_0x6481('0x6')](exports,'__esModule',{'value':!![]});const base_controller_1=__importDefault(require(a72_0x6481('0x7')));const uuid_1=require(a72_0x6481('0x8'));const jwt=require(a72_0x6481('0x9'));const i18n=require(a72_0x6481('0xa'));const authUtils=require(a72_0x6481('0xb'));const responseUtils=require(a72_0x6481('0xc'));const LocaleStrings=require(a72_0x6481('0xd'));const format=require('string-format');const formidable=require(a72_0x6481('0xe'));const fsExtra=require('fs-extra');class FilesController extends base_controller_1['default']{constructor(_0x1aab21){super(_0x1aab21,null);this[a72_0x6481('0xf')]=this[a72_0x6481('0xf')][a72_0x6481('0x10')](this);}[a72_0x6481('0xf')](_0xf450e5,_0x5b44e0,_0x1de433){return __awaiter(this,void 0x0,void 0x0,function*(){if(!_0xf450e5[a72_0x6481('0x11')]){return responseUtils[a72_0x6481('0x12')](_0xf450e5,_0x5b44e0,a72_0x6481('0x13'),0x191);}const _0x257e60=formidable({'multiples':!![]});const _0xef6a67=uuid_1['v4']();return yield new Promise(function(_0x1dc9ea,_0x20a29c){_0x257e60[a72_0x6481('0x14')](_0xf450e5,(_0xce8e86,_0x5104ca,_0xe01854)=>{const _0x49f609=_0xe01854[a72_0x6481('0x15')];console['log']('files',_0xe01854);if(_0x49f609==null){if(_0x5b44e0){return responseUtils[a72_0x6481('0x12')](_0xf450e5,_0x5b44e0,null,0x190);}else{_0x20a29c(null);return;}}const _0x52b067=_0x49f609['path'];const _0x2099e6=process[a72_0x6481('0x16')][a72_0x6481('0x17')]+'files/';fsExtra[a72_0x6481('0x18')](_0x2099e6);const _0x445c78=_0x2099e6+_0xef6a67;fsExtra[a72_0x6481('0x19')](_0x52b067,_0x445c78);_0xf450e5[a72_0x6481('0x1a')]={'size':_0x49f609['size'],'stored_name':_0xef6a67,'name':_0x49f609['name'],'type':_0x49f609[a72_0x6481('0x1b')],'is_private':_0x5104ca[a72_0x6481('0x1c')]!=null?_0x5104ca[a72_0x6481('0x1c')]:!![]};console[a72_0x6481('0x1d')](a72_0x6481('0x1e'),_0xf450e5[a72_0x6481('0x1a')]);return this['save'](_0xf450e5,null,_0x1de433)[a72_0x6481('0x2')](_0x1beda6=>{if(_0x5b44e0){return responseUtils[a72_0x6481('0x1f')](_0xf450e5,_0x5b44e0,_0x1beda6,0xc8);}else{_0x1dc9ea({'data':_0x1beda6[a72_0x6481('0x20')],'fields':_0x5104ca});}})['catch'](_0xce8e86=>{if(_0x5b44e0){return responseUtils[a72_0x6481('0x12')](_0xf450e5,_0x5b44e0,_0xce8e86[a72_0x6481('0x21')],0x1f4);}else{_0x20a29c(_0xce8e86);}});});}[a72_0x6481('0x10')](this));});}}exports[a72_0x6481('0x22')]=FilesController;