var a81_0x1944=['fileDir','files/','saveFile','bind','viewFile','user','authentication\x20failed','parse','upload_file','errorResponse','path','renameSync','body','size','name','is_private','save','dataValues','stack','log','files\x20req.body\x20err2','params','file_id','public','getInstance','filesController','findById','stored_name','writeHead','createReadStream','__awaiter','next','throw','done','value','then','apply','__importDefault','__esModule','defineProperty','../../infrastructure/base-controller','uuid','../shared/models/crudOptions','jsonwebtoken','i18n','../../infrastructure/auth-utils','../../infrastructure/response-utils','string-format','formidable','fs-extra','default'];(function(_0x1b22ed,_0x1a02f2){var _0x3f1730=function(_0x73668a){while(--_0x73668a){_0x1b22ed['push'](_0x1b22ed['shift']());}};_0x3f1730(++_0x1a02f2);}(a81_0x1944,0x1b6));var a81_0x2351=function(_0x50a20f,_0x296c52){_0x50a20f=_0x50a20f-0x0;var _0x4bbaeb=a81_0x1944[_0x50a20f];return _0x4bbaeb;};'use strict';var __awaiter=this&&this[a81_0x2351('0x0')]||function(_0x34d6b6,_0x4867af,_0x3b940f,_0x5d385c){function _0x33cded(_0x1b5551){return _0x1b5551 instanceof _0x3b940f?_0x1b5551:new _0x3b940f(function(_0x2cd414){_0x2cd414(_0x1b5551);});}return new(_0x3b940f||(_0x3b940f=Promise))(function(_0x2dd7d3,_0x4cb4f2){function _0x3b4f70(_0x2310bf){try{_0x4e45b8(_0x5d385c[a81_0x2351('0x1')](_0x2310bf));}catch(_0x3f37d9){_0x4cb4f2(_0x3f37d9);}}function _0x23ba33(_0x5e3885){try{_0x4e45b8(_0x5d385c[a81_0x2351('0x2')](_0x5e3885));}catch(_0x45bcfa){_0x4cb4f2(_0x45bcfa);}}function _0x4e45b8(_0x1d3abf){_0x1d3abf[a81_0x2351('0x3')]?_0x2dd7d3(_0x1d3abf['value']):_0x33cded(_0x1d3abf[a81_0x2351('0x4')])[a81_0x2351('0x5')](_0x3b4f70,_0x23ba33);}_0x4e45b8((_0x5d385c=_0x5d385c[a81_0x2351('0x6')](_0x34d6b6,_0x4867af||[]))['next']());});};var __importDefault=this&&this[a81_0x2351('0x7')]||function(_0x57b307){return _0x57b307&&_0x57b307[a81_0x2351('0x8')]?_0x57b307:{'default':_0x57b307};};Object[a81_0x2351('0x9')](exports,a81_0x2351('0x8'),{'value':!![]});const base_controller_1=__importDefault(require(a81_0x2351('0xa')));const controllers_1=__importDefault(require('../controllers'));const uuid_1=require(a81_0x2351('0xb'));const crudOptions_1=__importDefault(require(a81_0x2351('0xc')));const jwt=require(a81_0x2351('0xd'));const i18n=require(a81_0x2351('0xe'));const authUtils=require(a81_0x2351('0xf'));const responseUtils=require(a81_0x2351('0x10'));const LocaleStrings=require('../../resources/locale-strings');const format=require(a81_0x2351('0x11'));const formidable=require(a81_0x2351('0x12'));const fsExtra=require(a81_0x2351('0x13'));class FilesController extends base_controller_1[a81_0x2351('0x14')]{constructor(_0x724385){super(_0x724385,null);this[a81_0x2351('0x15')]=process['env']['FILES_FOLDER']+a81_0x2351('0x16');this[a81_0x2351('0x17')]=this[a81_0x2351('0x17')][a81_0x2351('0x18')](this);this[a81_0x2351('0x19')]=this[a81_0x2351('0x19')][a81_0x2351('0x18')](this);}['saveFile'](_0x25a46c,_0x509f5e,_0x3cfacd){return __awaiter(this,void 0x0,void 0x0,function*(){if(!_0x25a46c[a81_0x2351('0x1a')]){return responseUtils['errorResponse'](_0x25a46c,_0x509f5e,a81_0x2351('0x1b'),0x191);}const _0x30b328=formidable({'multiples':!![]});const _0x3366bf=uuid_1['v4']();return yield new Promise(function(_0x37d021,_0x1bd631){_0x30b328[a81_0x2351('0x1c')](_0x25a46c,(_0x5c5819,_0xf408b3,_0x2cbb4a)=>{const _0x2cab1f=_0x2cbb4a[a81_0x2351('0x1d')];if(_0x2cab1f==null){if(_0x509f5e){return responseUtils[a81_0x2351('0x1e')](_0x25a46c,_0x509f5e,null,0x190);}else{_0x1bd631(null);return;}}try{const _0x478af7=_0x2cab1f[a81_0x2351('0x1f')];fsExtra['ensureDirSync'](this[a81_0x2351('0x15')]);const _0x308d8c=this['fileDir']+_0x3366bf;fsExtra[a81_0x2351('0x20')](_0x478af7,_0x308d8c);_0x25a46c[a81_0x2351('0x21')]={'size':_0x2cab1f[a81_0x2351('0x22')],'stored_name':_0x3366bf,'name':_0x2cab1f[a81_0x2351('0x23')],'type':_0x2cab1f['type'],'is_private':_0xf408b3[a81_0x2351('0x24')]!=null?_0xf408b3[a81_0x2351('0x24')]:!![]};return this[a81_0x2351('0x25')](_0x25a46c,null,_0x3cfacd)[a81_0x2351('0x5')](_0x1788ad=>{if(_0x509f5e){return responseUtils['successResponse'](_0x25a46c,_0x509f5e,_0x1788ad,0xc8);}else{_0x37d021({'data':_0x1788ad[a81_0x2351('0x26')],'fields':_0xf408b3});}})['catch'](_0x5c5819=>{if(_0x509f5e){return responseUtils[a81_0x2351('0x1e')](_0x25a46c,_0x509f5e,_0x5c5819[a81_0x2351('0x27')],0x1f4);}else{_0x1bd631(_0x5c5819);}});}catch(_0x5b7dec){console[a81_0x2351('0x28')](a81_0x2351('0x29'),_0x5b7dec);if(_0x509f5e){return responseUtils[a81_0x2351('0x1e')](_0x25a46c,_0x509f5e,_0x5b7dec[a81_0x2351('0x27')],0x1f4);}else{_0x1bd631(_0x5b7dec);}}});}[a81_0x2351('0x18')](this));});}[a81_0x2351('0x19')](_0x5d0aff,_0x1f5a7e,_0x3740c0){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x2684a6=_0x5d0aff[a81_0x2351('0x2a')][a81_0x2351('0x2b')];_0x5d0aff[a81_0x2351('0x2a')]={'id':_0x2684a6};const _0x1d1d1b=new crudOptions_1['default']();_0x1d1d1b[a81_0x2351('0x2c')]=!![];controllers_1[a81_0x2351('0x14')][a81_0x2351('0x2d')]()[a81_0x2351('0x2e')][a81_0x2351('0x2f')](_0x5d0aff,null,_0x3740c0,_0x1d1d1b)[a81_0x2351('0x5')](_0x4d7b35=>{const _0x378a3b=this[a81_0x2351('0x15')]+_0x4d7b35[a81_0x2351('0x30')];_0x1f5a7e[a81_0x2351('0x31')](0xc8,{'content-type':_0x4d7b35['type']});fsExtra[a81_0x2351('0x32')](_0x378a3b)['pipe'](_0x1f5a7e);},_0x5d8a64=>{return responseUtils[a81_0x2351('0x1e')](_0x5d0aff,_0x1f5a7e,_0x5d8a64,0x1f4);});});}}exports[a81_0x2351('0x14')]=FilesController;