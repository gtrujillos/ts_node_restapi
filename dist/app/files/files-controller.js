var a72_0x4920=['files\x20filePath','body','size','name','is_private','save','dataValues','stack','files\x20req.body\x20err2','bind','__awaiter','next','throw','value','then','apply','__importDefault','__esModule','../../infrastructure/base-controller','uuid','jsonwebtoken','../../infrastructure/auth-utils','../../infrastructure/response-utils','string-format','formidable','default','saveFile','log','errorResponse','authentication\x20failed','parse','upload_file','files','env','FILES_FOLDER','files/','ensureDirSync','renameSync'];(function(_0x23d026,_0x1a6658){var _0x4336d7=function(_0x421dd4){while(--_0x421dd4){_0x23d026['push'](_0x23d026['shift']());}};_0x4336d7(++_0x1a6658);}(a72_0x4920,0x7c));var a72_0x3214=function(_0x6b8934,_0x32e380){_0x6b8934=_0x6b8934-0x0;var _0x25dddb=a72_0x4920[_0x6b8934];return _0x25dddb;};'use strict';var __awaiter=this&&this[a72_0x3214('0x0')]||function(_0x19e3e1,_0x2a6110,_0x449a0b,_0x44f9e7){function _0x562391(_0x5e799c){return _0x5e799c instanceof _0x449a0b?_0x5e799c:new _0x449a0b(function(_0x28675b){_0x28675b(_0x5e799c);});}return new(_0x449a0b||(_0x449a0b=Promise))(function(_0x4e25e2,_0x50cdb3){function _0x17dcc3(_0x465c08){try{_0x432e98(_0x44f9e7[a72_0x3214('0x1')](_0x465c08));}catch(_0x140cb6){_0x50cdb3(_0x140cb6);}}function _0x22f08f(_0x496fc2){try{_0x432e98(_0x44f9e7[a72_0x3214('0x2')](_0x496fc2));}catch(_0x5445c7){_0x50cdb3(_0x5445c7);}}function _0x432e98(_0x284bd4){_0x284bd4['done']?_0x4e25e2(_0x284bd4[a72_0x3214('0x3')]):_0x562391(_0x284bd4[a72_0x3214('0x3')])[a72_0x3214('0x4')](_0x17dcc3,_0x22f08f);}_0x432e98((_0x44f9e7=_0x44f9e7[a72_0x3214('0x5')](_0x19e3e1,_0x2a6110||[]))[a72_0x3214('0x1')]());});};var __importDefault=this&&this[a72_0x3214('0x6')]||function(_0x31c03b){return _0x31c03b&&_0x31c03b[a72_0x3214('0x7')]?_0x31c03b:{'default':_0x31c03b};};Object['defineProperty'](exports,a72_0x3214('0x7'),{'value':!![]});const base_controller_1=__importDefault(require(a72_0x3214('0x8')));const uuid_1=require(a72_0x3214('0x9'));const jwt=require(a72_0x3214('0xa'));const i18n=require('i18n');const authUtils=require(a72_0x3214('0xb'));const responseUtils=require(a72_0x3214('0xc'));const LocaleStrings=require('../../resources/locale-strings');const format=require(a72_0x3214('0xd'));const formidable=require(a72_0x3214('0xe'));const fsExtra=require('fs-extra');class FilesController extends base_controller_1[a72_0x3214('0xf')]{constructor(_0x3e3c3b){super(_0x3e3c3b,null);this[a72_0x3214('0x10')]=this[a72_0x3214('0x10')]['bind'](this);}['saveFile'](_0x132fcc,_0x42698b,_0x43fc35){return __awaiter(this,void 0x0,void 0x0,function*(){console[a72_0x3214('0x11')]('saveFile');if(!_0x132fcc['user']){return responseUtils[a72_0x3214('0x12')](_0x132fcc,_0x42698b,a72_0x3214('0x13'),0x191);}const _0x4e4c45=formidable({'multiples':!![]});const _0x3cb2d6=uuid_1['v4']();return yield new Promise(function(_0x2ec92c,_0x1b82a9){_0x4e4c45[a72_0x3214('0x14')](_0x132fcc,(_0x3aecba,_0x33f8a4,_0x559f8b)=>{const _0x2f0304=_0x559f8b[a72_0x3214('0x15')];console[a72_0x3214('0x11')](a72_0x3214('0x16'),_0x559f8b);if(_0x2f0304==null){if(_0x42698b){return responseUtils['errorResponse'](_0x132fcc,_0x42698b,null,0x190);}else{_0x1b82a9(null);return;}}try{const _0x3399de=_0x2f0304['path'];const _0x4746b8=process[a72_0x3214('0x17')][a72_0x3214('0x18')]+a72_0x3214('0x19');fsExtra[a72_0x3214('0x1a')](_0x4746b8);const _0x28bd2e=_0x4746b8+_0x3cb2d6;fsExtra[a72_0x3214('0x1b')](_0x3399de,_0x28bd2e);console[a72_0x3214('0x11')](a72_0x3214('0x1c'),_0x28bd2e,_0x3399de);_0x132fcc[a72_0x3214('0x1d')]={'size':_0x2f0304[a72_0x3214('0x1e')],'stored_name':_0x3cb2d6,'name':_0x2f0304[a72_0x3214('0x1f')],'type':_0x2f0304['type'],'is_private':_0x33f8a4[a72_0x3214('0x20')]!=null?_0x33f8a4[a72_0x3214('0x20')]:!![]};console[a72_0x3214('0x11')]('files\x20req.body',_0x132fcc[a72_0x3214('0x1d')]);return this[a72_0x3214('0x21')](_0x132fcc,null,_0x43fc35)['then'](_0xff6970=>{if(_0x42698b){return responseUtils['successResponse'](_0x132fcc,_0x42698b,_0xff6970,0xc8);}else{_0x2ec92c({'data':_0xff6970[a72_0x3214('0x22')],'fields':_0x33f8a4});}})['catch'](_0x3aecba=>{console[a72_0x3214('0x11')]('files\x20req.body\x20err1',_0x3aecba);if(_0x42698b){return responseUtils['errorResponse'](_0x132fcc,_0x42698b,_0x3aecba[a72_0x3214('0x23')],0x1f4);}else{_0x1b82a9(_0x3aecba);}});}catch(_0xf5bb5f){console['log'](a72_0x3214('0x24'),_0xf5bb5f);if(_0x42698b){return responseUtils[a72_0x3214('0x12')](_0x132fcc,_0x42698b,_0xf5bb5f[a72_0x3214('0x23')],0x1f4);}else{_0x1b82a9(_0xf5bb5f);}}});}[a72_0x3214('0x25')](this));});}}exports['default']=FilesController;