var a162_0x1399=['puerta','ingresos','locationPointsModel','defineProperty','__esModule','ftp','../../infrastructure/controller-utils','../../infrastructure/sequelize-utils','moment','default','bind','downloadFtp','processFtp','syncFtp','log','connecting','list','colombia','endsWith','json','size','models','syncFilesModel','findOrCreate','name','spread','push','error','connect','ftp.vivotek.com','ipd','findOne','ready','file_name','get','colombia/','.txt','status','save','then','existsSync','fileName:\x20','fileSizeInBytes:\x20','utf8','parse','Data','CountingInfo','Out','passCountingsModel','create','uploadEvent','zlib','file','path','filename','createReadStream','createWriteStream','createGunzip','pipe','finish','statSync','readFile','eventos','fecha','hora','\x20-05:00','YYYYMMDD\x20HHmmss\x20Z','latitud','longitud','velocidad'];(function(_0x2abcc2,_0x29d0dc){var _0x1b50c5=function(_0x3440df){while(--_0x3440df){_0x2abcc2['push'](_0x2abcc2['shift']());}};_0x1b50c5(++_0x29d0dc);}(a162_0x1399,0xd5));var a162_0x48e7=function(_0xec4531,_0xffac68){_0xec4531=_0xec4531-0x0;var _0x46197a=a162_0x1399[_0xec4531];return _0x46197a;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x18a538){return _0x18a538&&_0x18a538['__esModule']?_0x18a538:{'default':_0x18a538};};Object[a162_0x48e7('0x0')](exports,a162_0x48e7('0x1'),{'value':!![]});const ftp_1=__importDefault(require(a162_0x48e7('0x2')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a162_0x48e7('0x3')));const sequelize_utils_1=__importDefault(require(a162_0x48e7('0x4')));const moment_1=__importDefault(require(a162_0x48e7('0x5')));const UPLOAD_PATH='media';class SyncFilesController extends controller_utils_1[a162_0x48e7('0x6')]{constructor(_0x75bd5a){super(_0x75bd5a,null);this['syncFtp']=this['syncFtp'][a162_0x48e7('0x7')](this);this[a162_0x48e7('0x8')]=this[a162_0x48e7('0x8')]['bind'](this);this[a162_0x48e7('0x9')]=this['processFtp']['bind'](this);}[a162_0x48e7('0xa')](_0x4f192f,_0x3708f0,_0x3204ee){console[a162_0x48e7('0xb')](a162_0x48e7('0xc'));const _0x5541de=[];const _0x8ec6c8=new ftp_1[(a162_0x48e7('0x6'))]();_0x8ec6c8['on']('ready',function(){console['log']('connected');_0x8ec6c8[a162_0x48e7('0xd')](a162_0x48e7('0xe'),![],function(_0xeb6e12,_0x1fe4d1){if(_0xeb6e12){console[a162_0x48e7('0xb')](_0xeb6e12);}else{for(const _0x4e5c61 of _0x1fe4d1){if(_0x4e5c61['name'][a162_0x48e7('0xf')](a162_0x48e7('0x10'))&&_0x4e5c61[a162_0x48e7('0x11')]>0x0){sequelize_utils_1[a162_0x48e7('0x6')][a162_0x48e7('0x12')][a162_0x48e7('0x13')][a162_0x48e7('0x14')]({'where':{'file_name':_0x4e5c61[a162_0x48e7('0x15')]}})[a162_0x48e7('0x16')]((_0x46ab33,_0x31b136)=>{if(_0x31b136){_0x5541de[a162_0x48e7('0x17')](_0x46ab33);}});}}}});});_0x8ec6c8['on'](a162_0x48e7('0x18'),function(_0x3d8ea3){});_0x8ec6c8[a162_0x48e7('0x19')]({'host':a162_0x48e7('0x1a'),'port':0x15,'user':a162_0x48e7('0x1b'),'password':a162_0x48e7('0x1b')});_0x3708f0['json']({'data':[]});}[a162_0x48e7('0x8')](_0xe1e014,_0x176ec2,_0x11f154){sequelize_utils_1[a162_0x48e7('0x6')][a162_0x48e7('0x12')][a162_0x48e7('0x13')][a162_0x48e7('0x1c')]({'where':{'status':null}})['then'](_0x110179=>{if(_0x110179){const _0x4e4444=new ftp_1[(a162_0x48e7('0x6'))]();_0x4e4444['on'](a162_0x48e7('0x1d'),function(){console[a162_0x48e7('0xb')]('connected:'+_0x110179[a162_0x48e7('0x1e')]);_0x4e4444[a162_0x48e7('0x1f')](a162_0x48e7('0x20')+_0x110179[a162_0x48e7('0x1e')],function(_0x554e57,_0x154055){_0x4e4444['end']();if(_0x554e57){}else{const _0x156449='media/'+_0x110179[a162_0x48e7('0x1e')]+a162_0x48e7('0x21');_0x154055['pipe'](fs_1[a162_0x48e7('0x6')]['createWriteStream'](_0x156449));_0x110179[a162_0x48e7('0x22')]=0x1;_0x110179[a162_0x48e7('0x23')]();console[a162_0x48e7('0xb')]('Downloaded:\x20'+_0x110179['fileName']);}});});_0x4e4444['on']('error',function(_0x5ed144){});_0x4e4444[a162_0x48e7('0x19')]({'host':'ftp.vivotek.com','port':0x15,'user':a162_0x48e7('0x1b'),'password':a162_0x48e7('0x1b')});}else{}});_0x176ec2[a162_0x48e7('0x10')]({'data':[]});}[a162_0x48e7('0x9')](_0x4a5973,_0x447de5,_0x5041fc){sequelize_utils_1[a162_0x48e7('0x6')][a162_0x48e7('0x12')][a162_0x48e7('0x13')]['findOne']({'where':{'status':0x1}})[a162_0x48e7('0x24')](_0x1aff24=>{if(_0x1aff24){const _0x56d698='media/'+_0x1aff24['file_name']+a162_0x48e7('0x21');if(fs_1[a162_0x48e7('0x6')][a162_0x48e7('0x25')](_0x56d698)){const _0x1d7425=fs_1[a162_0x48e7('0x6')]['statSync'](_0x56d698);const _0x389440=_0x1d7425[a162_0x48e7('0x11')];console[a162_0x48e7('0xb')](a162_0x48e7('0x26')+_0x56d698);console['log'](a162_0x48e7('0x27')+_0x389440);if(_0x389440>0x0){fs_1['default']['readFile'](_0x56d698,a162_0x48e7('0x28'),function(_0x474d9d,_0xe98fa1){if(_0x474d9d){_0x1aff24[a162_0x48e7('0x22')]=null;}else{try{const _0x13045a=JSON[a162_0x48e7('0x29')](_0xe98fa1);for(const _0x1a68ed of _0x13045a[a162_0x48e7('0x2a')][0x0][a162_0x48e7('0x2b')]){const _0x370d23=_0x1a68ed['In'];const _0x291778=_0x1a68ed[a162_0x48e7('0x2c')];const _0x476d9f=Date['parse'](_0x1a68ed['EndTime']);if(_0x370d23>0x0){sequelize_utils_1[a162_0x48e7('0x6')][a162_0x48e7('0x12')][a162_0x48e7('0x2d')][a162_0x48e7('0x2e')]({'amount':_0x370d23,'counted_at':_0x476d9f});}if(_0x291778>0x0){sequelize_utils_1[a162_0x48e7('0x6')][a162_0x48e7('0x12')][a162_0x48e7('0x2d')][a162_0x48e7('0x2e')]({'amount':_0x291778*-0x1,'counted_at':_0x476d9f});}}_0x1aff24[a162_0x48e7('0x22')]=0x2;}catch(_0x8b5e64){_0x1aff24['status']=null;}}_0x1aff24['save']();});}else{_0x1aff24[a162_0x48e7('0x22')]=null;_0x1aff24[a162_0x48e7('0x23')]();}}else{_0x1aff24[a162_0x48e7('0x22')]=null;_0x1aff24['save']();}}else{}});_0x447de5[a162_0x48e7('0x10')]({'data':[]});}[a162_0x48e7('0x2f')](_0x5d88ca,_0x43fcbd,_0x3e1958){const _0x57f74d=require(a162_0x48e7('0x30'));const _0x409285=_0x5d88ca[a162_0x48e7('0x31')][a162_0x48e7('0x32')];const _0x34f8d2=UPLOAD_PATH+'/'+_0x5d88ca[a162_0x48e7('0x31')][a162_0x48e7('0x33')]+'.json';const _0x14468b=fs_1['default'][a162_0x48e7('0x34')](_0x409285);const _0x301e65=fs_1[a162_0x48e7('0x6')][a162_0x48e7('0x35')](_0x34f8d2);const _0x1f8b15=_0x57f74d[a162_0x48e7('0x36')]();console[a162_0x48e7('0xb')](_0x5d88ca[a162_0x48e7('0x31')]);_0x14468b[a162_0x48e7('0x37')](_0x1f8b15)[a162_0x48e7('0x37')](_0x301e65)['on'](a162_0x48e7('0x38'),_0x142a34=>{if(_0x142a34)return console['error'](_0x142a34);else{const _0x54643a=fs_1[a162_0x48e7('0x6')][a162_0x48e7('0x39')](_0x409285);const _0x55d71f=_0x54643a[a162_0x48e7('0x11')];if(_0x55d71f>0x0){fs_1[a162_0x48e7('0x6')][a162_0x48e7('0x3a')](_0x34f8d2,a162_0x48e7('0x28'),function(_0x142a34,_0xb0521c){if(_0x142a34){return console[a162_0x48e7('0x18')](_0x142a34);}else{try{const _0x1484c9=JSON['parse'](_0xb0521c);console[a162_0x48e7('0xb')](_0x1484c9);const _0xda9989=_0x1484c9[a162_0x48e7('0x3b')][0x0][a162_0x48e7('0x3c')];const _0x251038=_0x1484c9[a162_0x48e7('0x3b')][0x0][a162_0x48e7('0x3d')];const _0x249541=moment_1[a162_0x48e7('0x6')](_0xda9989+'\x20'+_0x251038+a162_0x48e7('0x3e'),a162_0x48e7('0x3f'));const _0x147d15=parseFloat(_0x1484c9[a162_0x48e7('0x3b')][0x0][a162_0x48e7('0x40')]['replace'](',','.'));const _0xe71649=parseFloat(_0x1484c9[a162_0x48e7('0x3b')][0x0][a162_0x48e7('0x41')]['replace'](',','.'));const _0xc8b5d7=_0x1484c9[a162_0x48e7('0x3b')][0x0][a162_0x48e7('0x42')];const _0x5c3518=_0x1484c9[a162_0x48e7('0x3b')][0x0][a162_0x48e7('0x43')][0x0][a162_0x48e7('0x44')];const _0x3d62bb=_0x1484c9[a162_0x48e7('0x3b')][0x0]['puerta'][0x0]['salidas'];console['log'](_0x147d15);console[a162_0x48e7('0xb')](_0xe71649);console[a162_0x48e7('0xb')](_0xc8b5d7);console[a162_0x48e7('0xb')](_0x5c3518);console[a162_0x48e7('0xb')](_0x3d62bb);console['log'](_0x249541);if(_0x5c3518>0x0){sequelize_utils_1[a162_0x48e7('0x6')][a162_0x48e7('0x12')][a162_0x48e7('0x2d')][a162_0x48e7('0x2e')]({'amount':_0x5c3518,'counted_at':_0x249541});}sequelize_utils_1[a162_0x48e7('0x6')][a162_0x48e7('0x12')][a162_0x48e7('0x45')][a162_0x48e7('0x2e')]({'device_id':null,'lat':''+_0x147d15,'lon':''+_0xe71649,'tracked_at':_0x249541});}catch(_0x28469b){return console[a162_0x48e7('0x18')](_0x28469b);}}});}}});_0x43fcbd['json']({'status':0x1,'data':_0x5d88ca['file']});}}exports[a162_0x48e7('0x6')]=SyncFilesController;