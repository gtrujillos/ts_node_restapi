var a162_0xf9db=['ingresos','__importDefault','__esModule','ftp','../../infrastructure/controller-utils','../../infrastructure/sequelize-utils','moment','media','default','syncFtp','bind','downloadFtp','processFtp','log','connecting','ready','connected','list','colombia','name','endsWith','json','size','models','findOrCreate','spread','connect','ftp.vivotek.com','ipd','syncFilesModel','then','connected:','file_name','get','colombia/','end','media/','.txt','pipe','createWriteStream','status','Downloaded:\x20','fileName','error','findOne','existsSync','fileName:\x20','readFile','utf8','parse','Data','CountingInfo','Out','passCountingsModel','create','save','uploadEvent','zlib','file','.json','createReadStream','createGunzip','statSync','eventos','fecha','hora','replace','velocidad','puerta'];(function(_0x1a2628,_0x528615){var _0x4025a2=function(_0x2a0bf2){while(--_0x2a0bf2){_0x1a2628['push'](_0x1a2628['shift']());}};_0x4025a2(++_0x528615);}(a162_0xf9db,0xd0));var a162_0xf019=function(_0x21e7d7,_0x8f28e5){_0x21e7d7=_0x21e7d7-0x0;var _0x242f93=a162_0xf9db[_0x21e7d7];return _0x242f93;};'use strict';var __importDefault=this&&this[a162_0xf019('0x0')]||function(_0x41e680){return _0x41e680&&_0x41e680[a162_0xf019('0x1')]?_0x41e680:{'default':_0x41e680};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const ftp_1=__importDefault(require(a162_0xf019('0x2')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a162_0xf019('0x3')));const sequelize_utils_1=__importDefault(require(a162_0xf019('0x4')));const moment_1=__importDefault(require(a162_0xf019('0x5')));const UPLOAD_PATH=a162_0xf019('0x6');class SyncFilesController extends controller_utils_1[a162_0xf019('0x7')]{constructor(_0x56d4e6){super(_0x56d4e6,null);this[a162_0xf019('0x8')]=this[a162_0xf019('0x8')][a162_0xf019('0x9')](this);this[a162_0xf019('0xa')]=this[a162_0xf019('0xa')][a162_0xf019('0x9')](this);this['processFtp']=this[a162_0xf019('0xb')][a162_0xf019('0x9')](this);}[a162_0xf019('0x8')](_0x318031,_0x3e7a34,_0x568264){console[a162_0xf019('0xc')](a162_0xf019('0xd'));const _0x1baf52=[];const _0x4ee3b2=new ftp_1[(a162_0xf019('0x7'))]();_0x4ee3b2['on'](a162_0xf019('0xe'),function(){console[a162_0xf019('0xc')](a162_0xf019('0xf'));_0x4ee3b2[a162_0xf019('0x10')](a162_0xf019('0x11'),![],function(_0x6bfd1f,_0x5eca4b){if(_0x6bfd1f){console[a162_0xf019('0xc')](_0x6bfd1f);}else{for(const _0xba21e9 of _0x5eca4b){if(_0xba21e9[a162_0xf019('0x12')][a162_0xf019('0x13')](a162_0xf019('0x14'))&&_0xba21e9[a162_0xf019('0x15')]>0x0){sequelize_utils_1[a162_0xf019('0x7')][a162_0xf019('0x16')]['syncFilesModel'][a162_0xf019('0x17')]({'where':{'file_name':_0xba21e9[a162_0xf019('0x12')]}})[a162_0xf019('0x18')]((_0x119604,_0x8557cf)=>{if(_0x8557cf){_0x1baf52['push'](_0x119604);}});}}}});});_0x4ee3b2['on']('error',function(_0x48d05b){});_0x4ee3b2[a162_0xf019('0x19')]({'host':a162_0xf019('0x1a'),'port':0x15,'user':a162_0xf019('0x1b'),'password':a162_0xf019('0x1b')});_0x3e7a34['json']({'data':[]});}[a162_0xf019('0xa')](_0x130769,_0x189b81,_0x23e686){sequelize_utils_1[a162_0xf019('0x7')][a162_0xf019('0x16')][a162_0xf019('0x1c')]['findOne']({'where':{'status':null}})[a162_0xf019('0x1d')](_0x167b49=>{if(_0x167b49){const _0x47d1c2=new ftp_1['default']();_0x47d1c2['on'](a162_0xf019('0xe'),function(){console[a162_0xf019('0xc')](a162_0xf019('0x1e')+_0x167b49[a162_0xf019('0x1f')]);_0x47d1c2[a162_0xf019('0x20')](a162_0xf019('0x21')+_0x167b49[a162_0xf019('0x1f')],function(_0x2be247,_0x20ab10){_0x47d1c2[a162_0xf019('0x22')]();if(_0x2be247){}else{const _0x33e19a=a162_0xf019('0x23')+_0x167b49[a162_0xf019('0x1f')]+a162_0xf019('0x24');_0x20ab10[a162_0xf019('0x25')](fs_1['default'][a162_0xf019('0x26')](_0x33e19a));_0x167b49[a162_0xf019('0x27')]=0x1;_0x167b49['save']();console[a162_0xf019('0xc')](a162_0xf019('0x28')+_0x167b49[a162_0xf019('0x29')]);}});});_0x47d1c2['on'](a162_0xf019('0x2a'),function(_0x1c2959){});_0x47d1c2[a162_0xf019('0x19')]({'host':a162_0xf019('0x1a'),'port':0x15,'user':a162_0xf019('0x1b'),'password':a162_0xf019('0x1b')});}else{}});_0x189b81[a162_0xf019('0x14')]({'data':[]});}[a162_0xf019('0xb')](_0x1d87ce,_0x4d36b6,_0x29a7fc){sequelize_utils_1[a162_0xf019('0x7')]['models'][a162_0xf019('0x1c')][a162_0xf019('0x2b')]({'where':{'status':0x1}})[a162_0xf019('0x1d')](_0x273084=>{if(_0x273084){const _0x50b63e=a162_0xf019('0x23')+_0x273084[a162_0xf019('0x1f')]+a162_0xf019('0x24');if(fs_1[a162_0xf019('0x7')][a162_0xf019('0x2c')](_0x50b63e)){const _0x506718=fs_1[a162_0xf019('0x7')]['statSync'](_0x50b63e);const _0x3d0aa6=_0x506718['size'];console['log'](a162_0xf019('0x2d')+_0x50b63e);console[a162_0xf019('0xc')]('fileSizeInBytes:\x20'+_0x3d0aa6);if(_0x3d0aa6>0x0){fs_1[a162_0xf019('0x7')][a162_0xf019('0x2e')](_0x50b63e,a162_0xf019('0x2f'),function(_0x3b0e93,_0x196f40){if(_0x3b0e93){_0x273084[a162_0xf019('0x27')]=null;}else{try{const _0xb6a2da=JSON[a162_0xf019('0x30')](_0x196f40);for(const _0x2af24b of _0xb6a2da[a162_0xf019('0x31')][0x0][a162_0xf019('0x32')]){const _0x1afd03=_0x2af24b['In'];const _0x486c59=_0x2af24b[a162_0xf019('0x33')];const _0x4b2909=Date[a162_0xf019('0x30')](_0x2af24b['EndTime']);if(_0x1afd03>0x0){sequelize_utils_1[a162_0xf019('0x7')][a162_0xf019('0x16')][a162_0xf019('0x34')][a162_0xf019('0x35')]({'amount':_0x1afd03,'counted_at':_0x4b2909});}if(_0x486c59>0x0){sequelize_utils_1[a162_0xf019('0x7')]['models'][a162_0xf019('0x34')][a162_0xf019('0x35')]({'amount':_0x486c59*-0x1,'counted_at':_0x4b2909});}}_0x273084[a162_0xf019('0x27')]=0x2;}catch(_0x58bc73){_0x273084['status']=null;}}_0x273084[a162_0xf019('0x36')]();});}else{_0x273084[a162_0xf019('0x27')]=null;_0x273084[a162_0xf019('0x36')]();}}else{_0x273084[a162_0xf019('0x27')]=null;_0x273084[a162_0xf019('0x36')]();}}else{}});_0x4d36b6[a162_0xf019('0x14')]({'data':[]});}[a162_0xf019('0x37')](_0x43de3a,_0x26042e,_0x4abecb){const _0x445db5=require(a162_0xf019('0x38'));const _0x2f5ab6=_0x43de3a[a162_0xf019('0x39')]['path'];const _0x554b1b=UPLOAD_PATH+'/'+_0x43de3a['file']['filename']+a162_0xf019('0x3a');const _0x39857f=fs_1[a162_0xf019('0x7')][a162_0xf019('0x3b')](_0x2f5ab6);const _0x37dac3=fs_1[a162_0xf019('0x7')][a162_0xf019('0x26')](_0x554b1b);const _0x34b2cd=_0x445db5[a162_0xf019('0x3c')]();console[a162_0xf019('0xc')](_0x43de3a['file']);_0x39857f[a162_0xf019('0x25')](_0x34b2cd)[a162_0xf019('0x25')](_0x37dac3)['on']('finish',_0x17966b=>{if(_0x17966b)return console['error'](_0x17966b);else{const _0x2dad38=fs_1['default'][a162_0xf019('0x3d')](_0x2f5ab6);const _0x346bc9=_0x2dad38[a162_0xf019('0x15')];if(_0x346bc9>0x0){fs_1[a162_0xf019('0x7')][a162_0xf019('0x2e')](_0x554b1b,a162_0xf019('0x2f'),function(_0x17966b,_0x5df410){if(_0x17966b){return console[a162_0xf019('0x2a')](_0x17966b);}else{try{const _0x4f33f1=JSON[a162_0xf019('0x30')](_0x5df410);console[a162_0xf019('0xc')](_0x4f33f1);const _0x54c2f3=_0x4f33f1[a162_0xf019('0x3e')][0x0][a162_0xf019('0x3f')];const _0x3615a6=_0x4f33f1['eventos'][0x0][a162_0xf019('0x40')];const _0x212987=moment_1[a162_0xf019('0x7')](_0x54c2f3+'\x20'+_0x3615a6+'\x20-05:00','YYYYMMDD\x20HHmmss\x20Z');const _0x266b80=parseFloat(_0x4f33f1[a162_0xf019('0x3e')][0x0]['latitud'][a162_0xf019('0x41')](',','.'));const _0x523f61=parseFloat(_0x4f33f1[a162_0xf019('0x3e')][0x0]['longitud'][a162_0xf019('0x41')](',','.'));const _0x4d1820=_0x4f33f1[a162_0xf019('0x3e')][0x0][a162_0xf019('0x42')];const _0x4d0f4c=_0x4f33f1['eventos'][0x0][a162_0xf019('0x43')][0x0][a162_0xf019('0x44')];const _0x16edbf=_0x4f33f1[a162_0xf019('0x3e')][0x0]['puerta'][0x0]['salidas'];console['log'](_0x266b80);console[a162_0xf019('0xc')](_0x523f61);console[a162_0xf019('0xc')](_0x4d1820);console[a162_0xf019('0xc')](_0x4d0f4c);console['log'](_0x16edbf);console[a162_0xf019('0xc')](_0x212987);if(_0x4d0f4c>0x0){sequelize_utils_1['default'][a162_0xf019('0x16')][a162_0xf019('0x34')]['create']({'amount':_0x4d0f4c,'counted_at':_0x212987});}sequelize_utils_1['default'][a162_0xf019('0x16')]['locationPointsModel'][a162_0xf019('0x35')]({'device_id':null,'lat':''+_0x266b80,'lon':''+_0x523f61,'tracked_at':_0x212987});}catch(_0x297c9a){return console[a162_0xf019('0x2a')](_0x297c9a);}}});}}});_0x26042e[a162_0xf019('0x14')]({'status':0x1,'data':_0x43de3a[a162_0xf019('0x39')]});}}exports[a162_0xf019('0x7')]=SyncFilesController;