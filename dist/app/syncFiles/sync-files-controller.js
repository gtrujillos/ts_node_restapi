var a162_0x1625=['defineProperty','ftp','../../infrastructure/controller-utils','../../infrastructure/sequelize-utils','moment','media','default','syncFtp','bind','processFtp','connecting','ready','log','colombia','name','endsWith','json','size','models','syncFilesModel','findOrCreate','push','error','connect','ftp.vivotek.com','ipd','then','file_name','get','end','.txt','pipe','status','save','Downloaded:\x20','findOne','statSync','fileName:\x20','fileSizeInBytes:\x20','readFile','utf8','parse','Data','CountingInfo','Out','passCountingsModel','create','file','path','filename','.json','createReadStream','createGunzip','finish','eventos','fecha','hora','YYYYMMDD\x20HHmmss\x20Z','latitud','replace','longitud','puerta','ingresos','salidas','locationPointsModel','__importDefault','__esModule'];(function(_0x1e681a,_0x4e60a1){var _0x4dacbc=function(_0x596ee9){while(--_0x596ee9){_0x1e681a['push'](_0x1e681a['shift']());}};_0x4dacbc(++_0x4e60a1);}(a162_0x1625,0xc7));var a162_0xd649=function(_0x553300,_0x5e9d1a){_0x553300=_0x553300-0x0;var _0x33ce83=a162_0x1625[_0x553300];return _0x33ce83;};'use strict';var __importDefault=this&&this[a162_0xd649('0x0')]||function(_0x4cdbb7){return _0x4cdbb7&&_0x4cdbb7[a162_0xd649('0x1')]?_0x4cdbb7:{'default':_0x4cdbb7};};Object[a162_0xd649('0x2')](exports,a162_0xd649('0x1'),{'value':!![]});const ftp_1=__importDefault(require(a162_0xd649('0x3')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a162_0xd649('0x4')));const sequelize_utils_1=__importDefault(require(a162_0xd649('0x5')));const moment_1=__importDefault(require(a162_0xd649('0x6')));const UPLOAD_PATH=a162_0xd649('0x7');class SyncFilesController extends controller_utils_1[a162_0xd649('0x8')]{constructor(_0x3b6c5f){super(_0x3b6c5f,null);this[a162_0xd649('0x9')]=this['syncFtp']['bind'](this);this['downloadFtp']=this['downloadFtp'][a162_0xd649('0xa')](this);this['processFtp']=this[a162_0xd649('0xb')]['bind'](this);}[a162_0xd649('0x9')](_0x46aa82,_0x215f73,_0x23886d){console['log'](a162_0xd649('0xc'));const _0x18363d=[];const _0x4d9e5a=new ftp_1[(a162_0xd649('0x8'))]();_0x4d9e5a['on'](a162_0xd649('0xd'),function(){console[a162_0xd649('0xe')]('connected');_0x4d9e5a['list'](a162_0xd649('0xf'),![],function(_0x2608cd,_0x2d1c97){if(_0x2608cd){console[a162_0xd649('0xe')](_0x2608cd);}else{for(const _0x5e506c of _0x2d1c97){if(_0x5e506c[a162_0xd649('0x10')][a162_0xd649('0x11')](a162_0xd649('0x12'))&&_0x5e506c[a162_0xd649('0x13')]>0x0){sequelize_utils_1[a162_0xd649('0x8')][a162_0xd649('0x14')][a162_0xd649('0x15')][a162_0xd649('0x16')]({'where':{'file_name':_0x5e506c[a162_0xd649('0x10')]}})['spread']((_0x345db4,_0x29d77a)=>{if(_0x29d77a){_0x18363d[a162_0xd649('0x17')](_0x345db4);}});}}}});});_0x4d9e5a['on'](a162_0xd649('0x18'),function(_0x5859c2){});_0x4d9e5a[a162_0xd649('0x19')]({'host':a162_0xd649('0x1a'),'port':0x15,'user':a162_0xd649('0x1b'),'password':a162_0xd649('0x1b')});_0x215f73[a162_0xd649('0x12')]({'data':[]});}['downloadFtp'](_0x539cf3,_0x349aaa,_0x3caeb1){sequelize_utils_1['default'][a162_0xd649('0x14')]['syncFilesModel']['findOne']({'where':{'status':null}})[a162_0xd649('0x1c')](_0x18fa3e=>{if(_0x18fa3e){const _0x5e857d=new ftp_1[(a162_0xd649('0x8'))]();_0x5e857d['on']('ready',function(){console['log']('connected:'+_0x18fa3e[a162_0xd649('0x1d')]);_0x5e857d[a162_0xd649('0x1e')]('colombia/'+_0x18fa3e[a162_0xd649('0x1d')],function(_0xdeadad,_0x635ee9){_0x5e857d[a162_0xd649('0x1f')]();if(_0xdeadad){}else{const _0x1e9a47='media/'+_0x18fa3e['file_name']+a162_0xd649('0x20');_0x635ee9[a162_0xd649('0x21')](fs_1[a162_0xd649('0x8')]['createWriteStream'](_0x1e9a47));_0x18fa3e[a162_0xd649('0x22')]=0x1;_0x18fa3e[a162_0xd649('0x23')]();console['log'](a162_0xd649('0x24')+_0x18fa3e['fileName']);}});});_0x5e857d['on']('error',function(_0x3d1916){});_0x5e857d['connect']({'host':a162_0xd649('0x1a'),'port':0x15,'user':a162_0xd649('0x1b'),'password':a162_0xd649('0x1b')});}else{}});_0x349aaa[a162_0xd649('0x12')]({'data':[]});}['processFtp'](_0x3731de,_0x4d40a0,_0x1e6f49){sequelize_utils_1['default'][a162_0xd649('0x14')]['syncFilesModel'][a162_0xd649('0x25')]({'where':{'status':0x1}})[a162_0xd649('0x1c')](_0x277778=>{if(_0x277778){const _0x542f52='media/'+_0x277778[a162_0xd649('0x1d')]+a162_0xd649('0x20');if(fs_1[a162_0xd649('0x8')]['existsSync'](_0x542f52)){const _0x5a0ce8=fs_1['default'][a162_0xd649('0x26')](_0x542f52);const _0x4bf098=_0x5a0ce8[a162_0xd649('0x13')];console[a162_0xd649('0xe')](a162_0xd649('0x27')+_0x542f52);console[a162_0xd649('0xe')](a162_0xd649('0x28')+_0x4bf098);if(_0x4bf098>0x0){fs_1[a162_0xd649('0x8')][a162_0xd649('0x29')](_0x542f52,a162_0xd649('0x2a'),function(_0xa7689c,_0xf8e006){if(_0xa7689c){_0x277778[a162_0xd649('0x22')]=null;}else{try{const _0x290a6b=JSON[a162_0xd649('0x2b')](_0xf8e006);for(const _0x11886b of _0x290a6b[a162_0xd649('0x2c')][0x0][a162_0xd649('0x2d')]){const _0x15b108=_0x11886b['In'];const _0x45200a=_0x11886b[a162_0xd649('0x2e')];const _0x561029=Date[a162_0xd649('0x2b')](_0x11886b['EndTime']);if(_0x15b108>0x0){sequelize_utils_1[a162_0xd649('0x8')][a162_0xd649('0x14')][a162_0xd649('0x2f')]['create']({'amount':_0x15b108,'counted_at':_0x561029});}if(_0x45200a>0x0){sequelize_utils_1[a162_0xd649('0x8')][a162_0xd649('0x14')]['passCountingsModel'][a162_0xd649('0x30')]({'amount':_0x45200a*-0x1,'counted_at':_0x561029});}}_0x277778[a162_0xd649('0x22')]=0x2;}catch(_0x337c27){_0x277778[a162_0xd649('0x22')]=null;}}_0x277778['save']();});}else{_0x277778[a162_0xd649('0x22')]=null;_0x277778[a162_0xd649('0x23')]();}}else{_0x277778[a162_0xd649('0x22')]=null;_0x277778[a162_0xd649('0x23')]();}}else{}});_0x4d40a0[a162_0xd649('0x12')]({'data':[]});}['uploadEvent'](_0x31fa31,_0xddaa95,_0x52f03e){const _0x5d61c3=require('zlib');const _0x4c313d=_0x31fa31[a162_0xd649('0x31')][a162_0xd649('0x32')];const _0x4a7837=UPLOAD_PATH+'/'+_0x31fa31[a162_0xd649('0x31')][a162_0xd649('0x33')]+a162_0xd649('0x34');const _0x3f1c08=fs_1[a162_0xd649('0x8')][a162_0xd649('0x35')](_0x4c313d);const _0x1c5100=fs_1['default']['createWriteStream'](_0x4a7837);const _0xbee523=_0x5d61c3[a162_0xd649('0x36')]();console[a162_0xd649('0xe')](_0x31fa31['file']);_0x3f1c08[a162_0xd649('0x21')](_0xbee523)[a162_0xd649('0x21')](_0x1c5100)['on'](a162_0xd649('0x37'),_0xb7b980=>{if(_0xb7b980)return console[a162_0xd649('0x18')](_0xb7b980);else{const _0x2d832c=fs_1[a162_0xd649('0x8')][a162_0xd649('0x26')](_0x4c313d);const _0x483fb0=_0x2d832c['size'];if(_0x483fb0>0x0){fs_1['default']['readFile'](_0x4a7837,a162_0xd649('0x2a'),function(_0xb7b980,_0xd9495){if(_0xb7b980){return console[a162_0xd649('0x18')](_0xb7b980);}else{try{const _0x3da60b=JSON[a162_0xd649('0x2b')](_0xd9495);console[a162_0xd649('0xe')](_0x3da60b);const _0x4f9371=_0x3da60b[a162_0xd649('0x38')][0x0][a162_0xd649('0x39')];const _0x4f1b8e=_0x3da60b[a162_0xd649('0x38')][0x0][a162_0xd649('0x3a')];const _0x5a3d94=moment_1[a162_0xd649('0x8')](_0x4f9371+'\x20'+_0x4f1b8e+'\x20-05:00',a162_0xd649('0x3b'));const _0x36f462=parseFloat(_0x3da60b[a162_0xd649('0x38')][0x0][a162_0xd649('0x3c')][a162_0xd649('0x3d')](',','.'));const _0x48d78d=parseFloat(_0x3da60b['eventos'][0x0][a162_0xd649('0x3e')]['replace'](',','.'));const _0x573529=_0x3da60b['eventos'][0x0]['velocidad'];const _0xf8e74=_0x3da60b[a162_0xd649('0x38')][0x0][a162_0xd649('0x3f')][0x0][a162_0xd649('0x40')];const _0x314286=_0x3da60b[a162_0xd649('0x38')][0x0][a162_0xd649('0x3f')][0x0][a162_0xd649('0x41')];console[a162_0xd649('0xe')](_0x36f462);console[a162_0xd649('0xe')](_0x48d78d);console[a162_0xd649('0xe')](_0x573529);console[a162_0xd649('0xe')](_0xf8e74);console[a162_0xd649('0xe')](_0x314286);console[a162_0xd649('0xe')](_0x5a3d94);if(_0xf8e74>0x0){sequelize_utils_1['default'][a162_0xd649('0x14')][a162_0xd649('0x2f')][a162_0xd649('0x30')]({'amount':_0xf8e74,'counted_at':_0x5a3d94});}sequelize_utils_1[a162_0xd649('0x8')][a162_0xd649('0x14')][a162_0xd649('0x42')]['create']({'device_id':null,'lat':''+_0x36f462,'lon':''+_0x48d78d,'tracked_at':_0x5a3d94});}catch(_0x3b9fed){return console['error'](_0x3b9fed);}}});}}});_0xddaa95[a162_0xd649('0x12')]({'status':0x1,'data':_0x31fa31[a162_0xd649('0x31')]});}}exports[a162_0xd649('0x8')]=SyncFilesController;