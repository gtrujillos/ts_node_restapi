var a126_0x284d=['spread','push','error','ftp.vivotek.com','ipd','findOne','connected:','file_name','get','colombia/','end','media/','.txt','createWriteStream','status','save','Downloaded:\x20','fileName','processFtp','syncFilesModel','then','existsSync','statSync','fileName:\x20','fileSizeInBytes:\x20','readFile','utf8','parse','Data','CountingInfo','Out','EndTime','passCountingsModel','create','uploadEvent','zlib','file','path','filename','createReadStream','pipe','finish','eventos','fecha','hora','latitud','replace','longitud','velocidad','puerta','ingresos','salidas','locationPointsModel','__importDefault','__esModule','defineProperty','moment','syncFtp','bind','downloadFtp','log','connecting','default','ready','connected','list','colombia','json','size','models','findOrCreate','name'];(function(_0x52c4cf,_0x5db03c){var _0x502874=function(_0x3d8c16){while(--_0x3d8c16){_0x52c4cf['push'](_0x52c4cf['shift']());}};_0x502874(++_0x5db03c);}(a126_0x284d,0x155));var a126_0x5481=function(_0x324325,_0x139af5){_0x324325=_0x324325-0x0;var _0x279237=a126_0x284d[_0x324325];return _0x279237;};'use strict';var __importDefault=this&&this[a126_0x5481('0x0')]||function(_0x20df9d){return _0x20df9d&&_0x20df9d[a126_0x5481('0x1')]?_0x20df9d:{'default':_0x20df9d};};Object[a126_0x5481('0x2')](exports,a126_0x5481('0x1'),{'value':!![]});const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));const base_controller_1=__importDefault(require('../../infrastructure/base-controller'));const sequelize_utils_1=__importDefault(require('../../infrastructure/sequelize-utils'));const moment_1=__importDefault(require(a126_0x5481('0x3')));const UPLOAD_PATH='media';class SyncFilesController extends base_controller_1['default']{constructor(_0x435b0e){super(_0x435b0e,null);this[a126_0x5481('0x4')]=this[a126_0x5481('0x4')][a126_0x5481('0x5')](this);this[a126_0x5481('0x6')]=this[a126_0x5481('0x6')][a126_0x5481('0x5')](this);this['processFtp']=this['processFtp']['bind'](this);}['syncFtp'](_0x18e780,_0x2136af,_0x45a3b7){console[a126_0x5481('0x7')](a126_0x5481('0x8'));const _0xb17bf6=[];const _0x291539=new ftp_1[(a126_0x5481('0x9'))]();_0x291539['on'](a126_0x5481('0xa'),function(){console[a126_0x5481('0x7')](a126_0x5481('0xb'));_0x291539[a126_0x5481('0xc')](a126_0x5481('0xd'),![],function(_0x10f6e4,_0x2ecce7){if(_0x10f6e4){console['log'](_0x10f6e4);}else{for(const _0x5a43c5 of _0x2ecce7){if(_0x5a43c5['name']['endsWith'](a126_0x5481('0xe'))&&_0x5a43c5[a126_0x5481('0xf')]>0x0){sequelize_utils_1[a126_0x5481('0x9')][a126_0x5481('0x10')]['syncFilesModel'][a126_0x5481('0x11')]({'where':{'file_name':_0x5a43c5[a126_0x5481('0x12')]}})[a126_0x5481('0x13')]((_0x4bc8e0,_0x997b27)=>{if(_0x997b27){_0xb17bf6[a126_0x5481('0x14')](_0x4bc8e0);}});}}}});});_0x291539['on'](a126_0x5481('0x15'),function(_0x7c9984){});_0x291539['connect']({'host':a126_0x5481('0x16'),'port':0x15,'user':a126_0x5481('0x17'),'password':a126_0x5481('0x17')});_0x2136af[a126_0x5481('0xe')]({'data':[]});}[a126_0x5481('0x6')](_0x5d2d9b,_0x2204a6,_0xfe9099){sequelize_utils_1['default']['models']['syncFilesModel'][a126_0x5481('0x18')]({'where':{'status':null}})['then'](_0xc88300=>{if(_0xc88300){const _0x1ab1a4=new ftp_1['default']();_0x1ab1a4['on']('ready',function(){console[a126_0x5481('0x7')](a126_0x5481('0x19')+_0xc88300[a126_0x5481('0x1a')]);_0x1ab1a4[a126_0x5481('0x1b')](a126_0x5481('0x1c')+_0xc88300[a126_0x5481('0x1a')],function(_0x5a200f,_0x45c887){_0x1ab1a4[a126_0x5481('0x1d')]();if(_0x5a200f){}else{const _0x17b83f=a126_0x5481('0x1e')+_0xc88300['file_name']+a126_0x5481('0x1f');_0x45c887['pipe'](fs_1[a126_0x5481('0x9')][a126_0x5481('0x20')](_0x17b83f));_0xc88300[a126_0x5481('0x21')]=0x1;_0xc88300[a126_0x5481('0x22')]();console[a126_0x5481('0x7')](a126_0x5481('0x23')+_0xc88300[a126_0x5481('0x24')]);}});});_0x1ab1a4['on']('error',function(_0x1e6ef2){});_0x1ab1a4['connect']({'host':a126_0x5481('0x16'),'port':0x15,'user':a126_0x5481('0x17'),'password':a126_0x5481('0x17')});}else{}});_0x2204a6[a126_0x5481('0xe')]({'data':[]});}[a126_0x5481('0x25')](_0x2980d6,_0x70300d,_0x68b400){sequelize_utils_1[a126_0x5481('0x9')]['models'][a126_0x5481('0x26')][a126_0x5481('0x18')]({'where':{'status':0x1}})[a126_0x5481('0x27')](_0x4e924d=>{if(_0x4e924d){const _0x11b657=a126_0x5481('0x1e')+_0x4e924d['file_name']+a126_0x5481('0x1f');if(fs_1['default'][a126_0x5481('0x28')](_0x11b657)){const _0x551374=fs_1[a126_0x5481('0x9')][a126_0x5481('0x29')](_0x11b657);const _0xee574a=_0x551374[a126_0x5481('0xf')];console['log'](a126_0x5481('0x2a')+_0x11b657);console[a126_0x5481('0x7')](a126_0x5481('0x2b')+_0xee574a);if(_0xee574a>0x0){fs_1['default'][a126_0x5481('0x2c')](_0x11b657,a126_0x5481('0x2d'),function(_0x1700b1,_0x436f12){if(_0x1700b1){_0x4e924d[a126_0x5481('0x21')]=null;}else{try{const _0xbcb77d=JSON[a126_0x5481('0x2e')](_0x436f12);for(const _0x595656 of _0xbcb77d[a126_0x5481('0x2f')][0x0][a126_0x5481('0x30')]){const _0x34a0d2=_0x595656['In'];const _0x5f002f=_0x595656[a126_0x5481('0x31')];const _0x56f19a=Date[a126_0x5481('0x2e')](_0x595656[a126_0x5481('0x32')]);if(_0x34a0d2>0x0){sequelize_utils_1[a126_0x5481('0x9')][a126_0x5481('0x10')][a126_0x5481('0x33')][a126_0x5481('0x34')]({'amount':_0x34a0d2,'counted_at':_0x56f19a});}if(_0x5f002f>0x0){sequelize_utils_1[a126_0x5481('0x9')][a126_0x5481('0x10')][a126_0x5481('0x33')][a126_0x5481('0x34')]({'amount':_0x5f002f*-0x1,'counted_at':_0x56f19a});}}_0x4e924d[a126_0x5481('0x21')]=0x2;}catch(_0x5c562b){_0x4e924d[a126_0x5481('0x21')]=null;}}_0x4e924d[a126_0x5481('0x22')]();});}else{_0x4e924d['status']=null;_0x4e924d['save']();}}else{_0x4e924d[a126_0x5481('0x21')]=null;_0x4e924d['save']();}}else{}});_0x70300d[a126_0x5481('0xe')]({'data':[]});}[a126_0x5481('0x35')](_0x374c7e,_0x1820e3,_0x5051f9){const _0x57e5ce=require(a126_0x5481('0x36'));const _0x4fa65c=_0x374c7e[a126_0x5481('0x37')][a126_0x5481('0x38')];const _0x103186=UPLOAD_PATH+'/'+_0x374c7e['file'][a126_0x5481('0x39')]+'.json';const _0x3aa089=fs_1[a126_0x5481('0x9')][a126_0x5481('0x3a')](_0x4fa65c);const _0x32f70a=fs_1[a126_0x5481('0x9')]['createWriteStream'](_0x103186);const _0x1a02dc=_0x57e5ce['createGunzip']();console['log'](_0x374c7e[a126_0x5481('0x37')]);_0x3aa089[a126_0x5481('0x3b')](_0x1a02dc)[a126_0x5481('0x3b')](_0x32f70a)['on'](a126_0x5481('0x3c'),_0x111cfe=>{if(_0x111cfe)return console['error'](_0x111cfe);else{const _0x5ecd11=fs_1['default']['statSync'](_0x4fa65c);const _0x4d3a42=_0x5ecd11['size'];if(_0x4d3a42>0x0){fs_1['default']['readFile'](_0x103186,a126_0x5481('0x2d'),function(_0x111cfe,_0x47ac38){if(_0x111cfe){return console[a126_0x5481('0x15')](_0x111cfe);}else{try{const _0x44b646=JSON[a126_0x5481('0x2e')](_0x47ac38);console[a126_0x5481('0x7')](_0x44b646);const _0x2e29a2=_0x44b646[a126_0x5481('0x3d')][0x0][a126_0x5481('0x3e')];const _0x894895=_0x44b646['eventos'][0x0][a126_0x5481('0x3f')];const _0x243436=moment_1[a126_0x5481('0x9')](_0x2e29a2+'\x20'+_0x894895+'\x20-05:00','YYYYMMDD\x20HHmmss\x20Z');const _0x455023=parseFloat(_0x44b646['eventos'][0x0][a126_0x5481('0x40')][a126_0x5481('0x41')](',','.'));const _0x3aab29=parseFloat(_0x44b646['eventos'][0x0][a126_0x5481('0x42')][a126_0x5481('0x41')](',','.'));const _0x4fa39e=_0x44b646[a126_0x5481('0x3d')][0x0][a126_0x5481('0x43')];const _0x362e42=_0x44b646['eventos'][0x0][a126_0x5481('0x44')][0x0][a126_0x5481('0x45')];const _0x52def2=_0x44b646[a126_0x5481('0x3d')][0x0]['puerta'][0x0][a126_0x5481('0x46')];console[a126_0x5481('0x7')](_0x455023);console[a126_0x5481('0x7')](_0x3aab29);console[a126_0x5481('0x7')](_0x4fa39e);console[a126_0x5481('0x7')](_0x362e42);console[a126_0x5481('0x7')](_0x52def2);console[a126_0x5481('0x7')](_0x243436);if(_0x362e42>0x0){sequelize_utils_1[a126_0x5481('0x9')][a126_0x5481('0x10')][a126_0x5481('0x33')][a126_0x5481('0x34')]({'amount':_0x362e42,'counted_at':_0x243436});}sequelize_utils_1['default']['models'][a126_0x5481('0x47')]['create']({'device_id':null,'lat':''+_0x455023,'lon':''+_0x3aab29,'tracked_at':_0x243436});}catch(_0x1b5b60){return console['error'](_0x1b5b60);}}});}}});_0x1820e3['json']({'status':0x1,'data':_0x374c7e[a126_0x5481('0x37')]});}}exports[a126_0x5481('0x9')]=SyncFilesController;