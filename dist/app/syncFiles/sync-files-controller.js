var a73_0x5ebe=['colombia','name','json','default','models','syncFilesModel','findOrCreate','spread','push','error','connect','ipd','findOne','then','connected:','file_name','get','colombia/','media/','.txt','pipe','createWriteStream','status','save','Downloaded:\x20','fileName','ftp.vivotek.com','existsSync','statSync','size','fileName:\x20','fileSizeInBytes:\x20','utf8','parse','Data','CountingInfo','Out','passCountingsModel','create','zlib','file','filename','.json','createGunzip','finish','eventos','fecha','hora','\x20-05:00','YYYYMMDD\x20HHmmss\x20Z','latitud','replace','puerta','ingresos','__esModule','ftp','../../infrastructure/sequelize-utils','moment','media','syncFtp','bind','downloadFtp','processFtp','log','ready','connected','list'];(function(_0x186c2a,_0x537a64){var _0x7d23ae=function(_0x91c933){while(--_0x91c933){_0x186c2a['push'](_0x186c2a['shift']());}};_0x7d23ae(++_0x537a64);}(a73_0x5ebe,0x142));var a73_0x3474=function(_0x2d8f05,_0x4b81bb){_0x2d8f05=_0x2d8f05-0x0;var _0x4d74cb=a73_0x5ebe[_0x2d8f05];return _0x4d74cb;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x269c55){return _0x269c55&&_0x269c55[a73_0x3474('0x0')]?_0x269c55:{'default':_0x269c55};};Object['defineProperty'](exports,a73_0x3474('0x0'),{'value':!![]});const ftp_1=__importDefault(require(a73_0x3474('0x1')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require('../../infrastructure/controller-utils'));const sequelize_utils_1=__importDefault(require(a73_0x3474('0x2')));const moment_1=__importDefault(require(a73_0x3474('0x3')));const UPLOAD_PATH=a73_0x3474('0x4');class SyncFilesController extends controller_utils_1['default']{constructor(_0x893948){super(_0x893948,null);this[a73_0x3474('0x5')]=this['syncFtp'][a73_0x3474('0x6')](this);this[a73_0x3474('0x7')]=this[a73_0x3474('0x7')][a73_0x3474('0x6')](this);this[a73_0x3474('0x8')]=this['processFtp']['bind'](this);}[a73_0x3474('0x5')](_0x49dde8,_0x53c9ea,_0x47adb0){console[a73_0x3474('0x9')]('connecting');const _0x393da6=[];const _0x364d3f=new ftp_1['default']();_0x364d3f['on'](a73_0x3474('0xa'),function(){console['log'](a73_0x3474('0xb'));_0x364d3f[a73_0x3474('0xc')](a73_0x3474('0xd'),![],function(_0x6a461a,_0x346789){if(_0x6a461a){console[a73_0x3474('0x9')](_0x6a461a);}else{for(const _0x3a7afc of _0x346789){if(_0x3a7afc[a73_0x3474('0xe')]['endsWith'](a73_0x3474('0xf'))&&_0x3a7afc['size']>0x0){sequelize_utils_1[a73_0x3474('0x10')][a73_0x3474('0x11')][a73_0x3474('0x12')][a73_0x3474('0x13')]({'where':{'file_name':_0x3a7afc['name']}})[a73_0x3474('0x14')]((_0x2faef6,_0x2ef554)=>{if(_0x2ef554){_0x393da6[a73_0x3474('0x15')](_0x2faef6);}});}}}});});_0x364d3f['on'](a73_0x3474('0x16'),function(_0x365cd5){});_0x364d3f[a73_0x3474('0x17')]({'host':'ftp.vivotek.com','port':0x15,'user':a73_0x3474('0x18'),'password':a73_0x3474('0x18')});_0x53c9ea[a73_0x3474('0xf')]({'data':[]});}[a73_0x3474('0x7')](_0x3da18d,_0x236d19,_0x1bcc55){sequelize_utils_1[a73_0x3474('0x10')][a73_0x3474('0x11')][a73_0x3474('0x12')][a73_0x3474('0x19')]({'where':{'status':null}})[a73_0x3474('0x1a')](_0x2caf92=>{if(_0x2caf92){const _0x2496e9=new ftp_1['default']();_0x2496e9['on'](a73_0x3474('0xa'),function(){console[a73_0x3474('0x9')](a73_0x3474('0x1b')+_0x2caf92[a73_0x3474('0x1c')]);_0x2496e9[a73_0x3474('0x1d')](a73_0x3474('0x1e')+_0x2caf92[a73_0x3474('0x1c')],function(_0x3181ec,_0x47200b){_0x2496e9['end']();if(_0x3181ec){}else{const _0xd33dad=a73_0x3474('0x1f')+_0x2caf92[a73_0x3474('0x1c')]+a73_0x3474('0x20');_0x47200b[a73_0x3474('0x21')](fs_1[a73_0x3474('0x10')][a73_0x3474('0x22')](_0xd33dad));_0x2caf92[a73_0x3474('0x23')]=0x1;_0x2caf92[a73_0x3474('0x24')]();console['log'](a73_0x3474('0x25')+_0x2caf92[a73_0x3474('0x26')]);}});});_0x2496e9['on'](a73_0x3474('0x16'),function(_0x170ec9){});_0x2496e9[a73_0x3474('0x17')]({'host':a73_0x3474('0x27'),'port':0x15,'user':a73_0x3474('0x18'),'password':a73_0x3474('0x18')});}else{}});_0x236d19[a73_0x3474('0xf')]({'data':[]});}['processFtp'](_0x11102a,_0x2607ba,_0x3b3f26){sequelize_utils_1[a73_0x3474('0x10')]['models'][a73_0x3474('0x12')][a73_0x3474('0x19')]({'where':{'status':0x1}})[a73_0x3474('0x1a')](_0x4b562b=>{if(_0x4b562b){const _0xeb4327=a73_0x3474('0x1f')+_0x4b562b[a73_0x3474('0x1c')]+a73_0x3474('0x20');if(fs_1[a73_0x3474('0x10')][a73_0x3474('0x28')](_0xeb4327)){const _0x32c7ec=fs_1['default'][a73_0x3474('0x29')](_0xeb4327);const _0x854881=_0x32c7ec[a73_0x3474('0x2a')];console[a73_0x3474('0x9')](a73_0x3474('0x2b')+_0xeb4327);console[a73_0x3474('0x9')](a73_0x3474('0x2c')+_0x854881);if(_0x854881>0x0){fs_1[a73_0x3474('0x10')]['readFile'](_0xeb4327,a73_0x3474('0x2d'),function(_0x4a4b8a,_0x4c20a9){if(_0x4a4b8a){_0x4b562b['status']=null;}else{try{const _0x1b9dce=JSON[a73_0x3474('0x2e')](_0x4c20a9);for(const _0x390437 of _0x1b9dce[a73_0x3474('0x2f')][0x0][a73_0x3474('0x30')]){const _0x3a398c=_0x390437['In'];const _0x54ee3b=_0x390437[a73_0x3474('0x31')];const _0x2fb87a=Date[a73_0x3474('0x2e')](_0x390437['EndTime']);if(_0x3a398c>0x0){sequelize_utils_1[a73_0x3474('0x10')][a73_0x3474('0x11')][a73_0x3474('0x32')]['create']({'amount':_0x3a398c,'counted_at':_0x2fb87a});}if(_0x54ee3b>0x0){sequelize_utils_1['default'][a73_0x3474('0x11')]['passCountingsModel'][a73_0x3474('0x33')]({'amount':_0x54ee3b*-0x1,'counted_at':_0x2fb87a});}}_0x4b562b['status']=0x2;}catch(_0x287451){_0x4b562b[a73_0x3474('0x23')]=null;}}_0x4b562b[a73_0x3474('0x24')]();});}else{_0x4b562b[a73_0x3474('0x23')]=null;_0x4b562b['save']();}}else{_0x4b562b[a73_0x3474('0x23')]=null;_0x4b562b[a73_0x3474('0x24')]();}}else{}});_0x2607ba[a73_0x3474('0xf')]({'data':[]});}['uploadEvent'](_0x2c513a,_0x1db321,_0x1502e7){const _0x56ea79=require(a73_0x3474('0x34'));const _0x2e3e80=_0x2c513a['file']['path'];const _0x2dce5c=UPLOAD_PATH+'/'+_0x2c513a[a73_0x3474('0x35')][a73_0x3474('0x36')]+a73_0x3474('0x37');const _0x883f81=fs_1[a73_0x3474('0x10')]['createReadStream'](_0x2e3e80);const _0x36868d=fs_1[a73_0x3474('0x10')][a73_0x3474('0x22')](_0x2dce5c);const _0x413286=_0x56ea79[a73_0x3474('0x38')]();console[a73_0x3474('0x9')](_0x2c513a[a73_0x3474('0x35')]);_0x883f81[a73_0x3474('0x21')](_0x413286)[a73_0x3474('0x21')](_0x36868d)['on'](a73_0x3474('0x39'),_0x33e8dc=>{if(_0x33e8dc)return console[a73_0x3474('0x16')](_0x33e8dc);else{const _0x5802f7=fs_1[a73_0x3474('0x10')][a73_0x3474('0x29')](_0x2e3e80);const _0x501def=_0x5802f7[a73_0x3474('0x2a')];if(_0x501def>0x0){fs_1[a73_0x3474('0x10')]['readFile'](_0x2dce5c,a73_0x3474('0x2d'),function(_0x33e8dc,_0x57a2af){if(_0x33e8dc){return console[a73_0x3474('0x16')](_0x33e8dc);}else{try{const _0x2966f8=JSON[a73_0x3474('0x2e')](_0x57a2af);console[a73_0x3474('0x9')](_0x2966f8);const _0x55aecd=_0x2966f8[a73_0x3474('0x3a')][0x0][a73_0x3474('0x3b')];const _0xddc703=_0x2966f8[a73_0x3474('0x3a')][0x0][a73_0x3474('0x3c')];const _0x30aa9b=moment_1[a73_0x3474('0x10')](_0x55aecd+'\x20'+_0xddc703+a73_0x3474('0x3d'),a73_0x3474('0x3e'));const _0x519fd7=parseFloat(_0x2966f8[a73_0x3474('0x3a')][0x0][a73_0x3474('0x3f')]['replace'](',','.'));const _0x9ad753=parseFloat(_0x2966f8[a73_0x3474('0x3a')][0x0]['longitud'][a73_0x3474('0x40')](',','.'));const _0x33e616=_0x2966f8[a73_0x3474('0x3a')][0x0]['velocidad'];const _0x53fe07=_0x2966f8[a73_0x3474('0x3a')][0x0][a73_0x3474('0x41')][0x0][a73_0x3474('0x42')];const _0x3b2e46=_0x2966f8['eventos'][0x0][a73_0x3474('0x41')][0x0]['salidas'];console['log'](_0x519fd7);console['log'](_0x9ad753);console[a73_0x3474('0x9')](_0x33e616);console['log'](_0x53fe07);console[a73_0x3474('0x9')](_0x3b2e46);console['log'](_0x30aa9b);if(_0x53fe07>0x0){sequelize_utils_1[a73_0x3474('0x10')][a73_0x3474('0x11')][a73_0x3474('0x32')][a73_0x3474('0x33')]({'amount':_0x53fe07,'counted_at':_0x30aa9b});}sequelize_utils_1[a73_0x3474('0x10')][a73_0x3474('0x11')]['locationPointsModel'][a73_0x3474('0x33')]({'device_id':null,'lat':''+_0x519fd7,'lon':''+_0x9ad753,'tracked_at':_0x30aa9b});}catch(_0x10b067){return console['error'](_0x10b067);}}});}}});_0x1db321[a73_0x3474('0xf')]({'status':0x1,'data':_0x2c513a[a73_0x3474('0x35')]});}}exports[a73_0x3474('0x10')]=SyncFilesController;