var a73_0x5406=['end','media/','.txt','pipe','createWriteStream','status','save','Downloaded:\x20','fileName','error','then','existsSync','statSync','fileSizeInBytes:\x20','readFile','utf8','parse','CountingInfo','Out','EndTime','passCountingsModel','create','zlib','path','file','createReadStream','createGunzip','finish','eventos','fecha','\x20-05:00','YYYYMMDD\x20HHmmss\x20Z','latitud','longitud','replace','ingresos','puerta','salidas','locationPointsModel','__importDefault','__esModule','defineProperty','ftp','../../infrastructure/controller-utils','../../infrastructure/sequelize-utils','moment','media','default','syncFtp','downloadFtp','bind','processFtp','log','connecting','connected','list','colombia','json','size','models','syncFilesModel','findOrCreate','spread','push','connect','ftp.vivotek.com','ipd','findOne','ready','connected:','file_name','get'];(function(_0x467c25,_0xae4c3c){var _0x24c1d5=function(_0x484fe7){while(--_0x484fe7){_0x467c25['push'](_0x467c25['shift']());}};_0x24c1d5(++_0xae4c3c);}(a73_0x5406,0x18f));var a73_0x557b=function(_0xa3f70,_0x2bc123){_0xa3f70=_0xa3f70-0x0;var _0x13f034=a73_0x5406[_0xa3f70];return _0x13f034;};'use strict';var __importDefault=this&&this[a73_0x557b('0x0')]||function(_0x48c7cf){return _0x48c7cf&&_0x48c7cf[a73_0x557b('0x1')]?_0x48c7cf:{'default':_0x48c7cf};};Object[a73_0x557b('0x2')](exports,'__esModule',{'value':!![]});const ftp_1=__importDefault(require(a73_0x557b('0x3')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a73_0x557b('0x4')));const sequelize_utils_1=__importDefault(require(a73_0x557b('0x5')));const moment_1=__importDefault(require(a73_0x557b('0x6')));const UPLOAD_PATH=a73_0x557b('0x7');class SyncFilesController extends controller_utils_1[a73_0x557b('0x8')]{constructor(_0x48c183){super(_0x48c183,null);this[a73_0x557b('0x9')]=this[a73_0x557b('0x9')]['bind'](this);this[a73_0x557b('0xa')]=this[a73_0x557b('0xa')][a73_0x557b('0xb')](this);this['processFtp']=this[a73_0x557b('0xc')][a73_0x557b('0xb')](this);}['syncFtp'](_0x466bda,_0x232ace,_0x3a68d4){console[a73_0x557b('0xd')](a73_0x557b('0xe'));const _0x4d405a=[];const _0x11c42e=new ftp_1['default']();_0x11c42e['on']('ready',function(){console[a73_0x557b('0xd')](a73_0x557b('0xf'));_0x11c42e[a73_0x557b('0x10')](a73_0x557b('0x11'),![],function(_0x1f635e,_0x237ce0){if(_0x1f635e){console[a73_0x557b('0xd')](_0x1f635e);}else{for(const _0x1985d9 of _0x237ce0){if(_0x1985d9['name']['endsWith'](a73_0x557b('0x12'))&&_0x1985d9[a73_0x557b('0x13')]>0x0){sequelize_utils_1['default'][a73_0x557b('0x14')][a73_0x557b('0x15')][a73_0x557b('0x16')]({'where':{'file_name':_0x1985d9['name']}})[a73_0x557b('0x17')]((_0x229080,_0x243762)=>{if(_0x243762){_0x4d405a[a73_0x557b('0x18')](_0x229080);}});}}}});});_0x11c42e['on']('error',function(_0x55ad2d){});_0x11c42e[a73_0x557b('0x19')]({'host':a73_0x557b('0x1a'),'port':0x15,'user':a73_0x557b('0x1b'),'password':a73_0x557b('0x1b')});_0x232ace[a73_0x557b('0x12')]({'data':[]});}[a73_0x557b('0xa')](_0x4fce26,_0x1fb0df,_0x48f0ef){sequelize_utils_1[a73_0x557b('0x8')][a73_0x557b('0x14')][a73_0x557b('0x15')][a73_0x557b('0x1c')]({'where':{'status':null}})['then'](_0x3046a0=>{if(_0x3046a0){const _0x583a67=new ftp_1[(a73_0x557b('0x8'))]();_0x583a67['on'](a73_0x557b('0x1d'),function(){console[a73_0x557b('0xd')](a73_0x557b('0x1e')+_0x3046a0[a73_0x557b('0x1f')]);_0x583a67[a73_0x557b('0x20')]('colombia/'+_0x3046a0[a73_0x557b('0x1f')],function(_0x11ee03,_0x20a007){_0x583a67[a73_0x557b('0x21')]();if(_0x11ee03){}else{const _0x15bd18=a73_0x557b('0x22')+_0x3046a0[a73_0x557b('0x1f')]+a73_0x557b('0x23');_0x20a007[a73_0x557b('0x24')](fs_1[a73_0x557b('0x8')][a73_0x557b('0x25')](_0x15bd18));_0x3046a0[a73_0x557b('0x26')]=0x1;_0x3046a0[a73_0x557b('0x27')]();console[a73_0x557b('0xd')](a73_0x557b('0x28')+_0x3046a0[a73_0x557b('0x29')]);}});});_0x583a67['on'](a73_0x557b('0x2a'),function(_0x4c48d0){});_0x583a67[a73_0x557b('0x19')]({'host':'ftp.vivotek.com','port':0x15,'user':'ipd','password':a73_0x557b('0x1b')});}else{}});_0x1fb0df[a73_0x557b('0x12')]({'data':[]});}[a73_0x557b('0xc')](_0xe7565b,_0x44749a,_0x40dae8){sequelize_utils_1[a73_0x557b('0x8')][a73_0x557b('0x14')][a73_0x557b('0x15')][a73_0x557b('0x1c')]({'where':{'status':0x1}})[a73_0x557b('0x2b')](_0x458fec=>{if(_0x458fec){const _0x4cbbbe='media/'+_0x458fec[a73_0x557b('0x1f')]+'.txt';if(fs_1[a73_0x557b('0x8')][a73_0x557b('0x2c')](_0x4cbbbe)){const _0x4f566a=fs_1[a73_0x557b('0x8')][a73_0x557b('0x2d')](_0x4cbbbe);const _0x414585=_0x4f566a[a73_0x557b('0x13')];console[a73_0x557b('0xd')]('fileName:\x20'+_0x4cbbbe);console[a73_0x557b('0xd')](a73_0x557b('0x2e')+_0x414585);if(_0x414585>0x0){fs_1['default'][a73_0x557b('0x2f')](_0x4cbbbe,a73_0x557b('0x30'),function(_0x1d0d3e,_0x595f7a){if(_0x1d0d3e){_0x458fec[a73_0x557b('0x26')]=null;}else{try{const _0xaaa8c3=JSON[a73_0x557b('0x31')](_0x595f7a);for(const _0x5cbf45 of _0xaaa8c3['Data'][0x0][a73_0x557b('0x32')]){const _0x4896d3=_0x5cbf45['In'];const _0x35ff90=_0x5cbf45[a73_0x557b('0x33')];const _0x1e9835=Date[a73_0x557b('0x31')](_0x5cbf45[a73_0x557b('0x34')]);if(_0x4896d3>0x0){sequelize_utils_1[a73_0x557b('0x8')][a73_0x557b('0x14')][a73_0x557b('0x35')]['create']({'amount':_0x4896d3,'counted_at':_0x1e9835});}if(_0x35ff90>0x0){sequelize_utils_1[a73_0x557b('0x8')][a73_0x557b('0x14')][a73_0x557b('0x35')][a73_0x557b('0x36')]({'amount':_0x35ff90*-0x1,'counted_at':_0x1e9835});}}_0x458fec[a73_0x557b('0x26')]=0x2;}catch(_0xd90ac0){_0x458fec[a73_0x557b('0x26')]=null;}}_0x458fec[a73_0x557b('0x27')]();});}else{_0x458fec[a73_0x557b('0x26')]=null;_0x458fec[a73_0x557b('0x27')]();}}else{_0x458fec[a73_0x557b('0x26')]=null;_0x458fec[a73_0x557b('0x27')]();}}else{}});_0x44749a[a73_0x557b('0x12')]({'data':[]});}['uploadEvent'](_0xf41c1d,_0x2c85fa,_0x1fb958){const _0x47c96d=require(a73_0x557b('0x37'));const _0x2f19f1=_0xf41c1d['file'][a73_0x557b('0x38')];const _0x355ca3=UPLOAD_PATH+'/'+_0xf41c1d[a73_0x557b('0x39')]['filename']+'.json';const _0x25f0dc=fs_1[a73_0x557b('0x8')][a73_0x557b('0x3a')](_0x2f19f1);const _0x327d94=fs_1['default'][a73_0x557b('0x25')](_0x355ca3);const _0x24589d=_0x47c96d[a73_0x557b('0x3b')]();console[a73_0x557b('0xd')](_0xf41c1d[a73_0x557b('0x39')]);_0x25f0dc[a73_0x557b('0x24')](_0x24589d)[a73_0x557b('0x24')](_0x327d94)['on'](a73_0x557b('0x3c'),_0x24b3f7=>{if(_0x24b3f7)return console[a73_0x557b('0x2a')](_0x24b3f7);else{const _0x465a69=fs_1['default'][a73_0x557b('0x2d')](_0x2f19f1);const _0x4b4b36=_0x465a69[a73_0x557b('0x13')];if(_0x4b4b36>0x0){fs_1[a73_0x557b('0x8')][a73_0x557b('0x2f')](_0x355ca3,'utf8',function(_0x24b3f7,_0x3033cf){if(_0x24b3f7){return console[a73_0x557b('0x2a')](_0x24b3f7);}else{try{const _0x4004af=JSON[a73_0x557b('0x31')](_0x3033cf);console[a73_0x557b('0xd')](_0x4004af);const _0x25b15f=_0x4004af[a73_0x557b('0x3d')][0x0][a73_0x557b('0x3e')];const _0x239721=_0x4004af['eventos'][0x0]['hora'];const _0x149923=moment_1[a73_0x557b('0x8')](_0x25b15f+'\x20'+_0x239721+a73_0x557b('0x3f'),a73_0x557b('0x40'));const _0x181dd6=parseFloat(_0x4004af['eventos'][0x0][a73_0x557b('0x41')]['replace'](',','.'));const _0x19005c=parseFloat(_0x4004af['eventos'][0x0][a73_0x557b('0x42')][a73_0x557b('0x43')](',','.'));const _0x5e3294=_0x4004af[a73_0x557b('0x3d')][0x0]['velocidad'];const _0x42b0a6=_0x4004af['eventos'][0x0]['puerta'][0x0][a73_0x557b('0x44')];const _0x445b73=_0x4004af['eventos'][0x0][a73_0x557b('0x45')][0x0][a73_0x557b('0x46')];console[a73_0x557b('0xd')](_0x181dd6);console['log'](_0x19005c);console['log'](_0x5e3294);console[a73_0x557b('0xd')](_0x42b0a6);console[a73_0x557b('0xd')](_0x445b73);console[a73_0x557b('0xd')](_0x149923);if(_0x42b0a6>0x0){sequelize_utils_1[a73_0x557b('0x8')]['models']['passCountingsModel']['create']({'amount':_0x42b0a6,'counted_at':_0x149923});}sequelize_utils_1[a73_0x557b('0x8')]['models'][a73_0x557b('0x47')][a73_0x557b('0x36')]({'device_id':null,'lat':''+_0x181dd6,'lon':''+_0x19005c,'tracked_at':_0x149923});}catch(_0x529bf0){return console[a73_0x557b('0x2a')](_0x529bf0);}}});}}});_0x2c85fa[a73_0x557b('0x12')]({'status':0x1,'data':_0xf41c1d[a73_0x557b('0x39')]});}}exports[a73_0x557b('0x8')]=SyncFilesController;