var a73_0x2609=['createWriteStream','createGunzip','eventos','fecha','hora','latitud','replace','longitud','velocidad','puerta','salidas','__importDefault','__esModule','defineProperty','ftp','../../infrastructure/controller-utils','../../infrastructure/sequelize-utils','moment','media','syncFtp','downloadFtp','bind','processFtp','log','connecting','default','ready','connected','colombia','endsWith','size','syncFilesModel','name','spread','error','connect','ipd','json','models','findOne','then','connected:','file_name','get','colombia/','end','media/','.txt','pipe','status','save','Downloaded:\x20','fileName','ftp.vivotek.com','statSync','fileName:\x20','fileSizeInBytes:\x20','readFile','utf8','parse','Data','CountingInfo','Out','passCountingsModel','create','uploadEvent','file','path','filename','createReadStream'];(function(_0x3cb573,_0x46088c){var _0x8aa3d0=function(_0x5cc4e7){while(--_0x5cc4e7){_0x3cb573['push'](_0x3cb573['shift']());}};_0x8aa3d0(++_0x46088c);}(a73_0x2609,0x169));var a73_0x548b=function(_0x13b4ff,_0x378f20){_0x13b4ff=_0x13b4ff-0x0;var _0x236d59=a73_0x2609[_0x13b4ff];return _0x236d59;};'use strict';var __importDefault=this&&this[a73_0x548b('0x0')]||function(_0x50a95a){return _0x50a95a&&_0x50a95a[a73_0x548b('0x1')]?_0x50a95a:{'default':_0x50a95a};};Object[a73_0x548b('0x2')](exports,a73_0x548b('0x1'),{'value':!![]});const ftp_1=__importDefault(require(a73_0x548b('0x3')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a73_0x548b('0x4')));const sequelize_utils_1=__importDefault(require(a73_0x548b('0x5')));const moment_1=__importDefault(require(a73_0x548b('0x6')));const UPLOAD_PATH=a73_0x548b('0x7');class SyncFilesController extends controller_utils_1['default']{constructor(_0x4371f4){super(_0x4371f4,null);this[a73_0x548b('0x8')]=this[a73_0x548b('0x8')]['bind'](this);this[a73_0x548b('0x9')]=this[a73_0x548b('0x9')][a73_0x548b('0xa')](this);this[a73_0x548b('0xb')]=this[a73_0x548b('0xb')]['bind'](this);}[a73_0x548b('0x8')](_0x12fa3d,_0x3c0fe0,_0x47ef79){console[a73_0x548b('0xc')](a73_0x548b('0xd'));const _0x6f29b8=[];const _0x5b8875=new ftp_1[(a73_0x548b('0xe'))]();_0x5b8875['on'](a73_0x548b('0xf'),function(){console['log'](a73_0x548b('0x10'));_0x5b8875['list'](a73_0x548b('0x11'),![],function(_0x33f800,_0x45f456){if(_0x33f800){console[a73_0x548b('0xc')](_0x33f800);}else{for(const _0x5a874a of _0x45f456){if(_0x5a874a['name'][a73_0x548b('0x12')]('json')&&_0x5a874a[a73_0x548b('0x13')]>0x0){sequelize_utils_1[a73_0x548b('0xe')]['models'][a73_0x548b('0x14')]['findOrCreate']({'where':{'file_name':_0x5a874a[a73_0x548b('0x15')]}})[a73_0x548b('0x16')]((_0x330039,_0x3bcdd5)=>{if(_0x3bcdd5){_0x6f29b8['push'](_0x330039);}});}}}});});_0x5b8875['on'](a73_0x548b('0x17'),function(_0x13d2d6){});_0x5b8875[a73_0x548b('0x18')]({'host':'ftp.vivotek.com','port':0x15,'user':a73_0x548b('0x19'),'password':a73_0x548b('0x19')});_0x3c0fe0[a73_0x548b('0x1a')]({'data':[]});}[a73_0x548b('0x9')](_0x188e96,_0x9c52bc,_0x4a1d78){sequelize_utils_1['default'][a73_0x548b('0x1b')][a73_0x548b('0x14')][a73_0x548b('0x1c')]({'where':{'status':null}})[a73_0x548b('0x1d')](_0x5c4cdd=>{if(_0x5c4cdd){const _0x3040e8=new ftp_1['default']();_0x3040e8['on']('ready',function(){console[a73_0x548b('0xc')](a73_0x548b('0x1e')+_0x5c4cdd[a73_0x548b('0x1f')]);_0x3040e8[a73_0x548b('0x20')](a73_0x548b('0x21')+_0x5c4cdd['file_name'],function(_0x29527e,_0x353fc6){_0x3040e8[a73_0x548b('0x22')]();if(_0x29527e){}else{const _0x301cb2=a73_0x548b('0x23')+_0x5c4cdd[a73_0x548b('0x1f')]+a73_0x548b('0x24');_0x353fc6[a73_0x548b('0x25')](fs_1[a73_0x548b('0xe')]['createWriteStream'](_0x301cb2));_0x5c4cdd[a73_0x548b('0x26')]=0x1;_0x5c4cdd[a73_0x548b('0x27')]();console[a73_0x548b('0xc')](a73_0x548b('0x28')+_0x5c4cdd[a73_0x548b('0x29')]);}});});_0x3040e8['on'](a73_0x548b('0x17'),function(_0x14ed00){});_0x3040e8[a73_0x548b('0x18')]({'host':a73_0x548b('0x2a'),'port':0x15,'user':'ipd','password':a73_0x548b('0x19')});}else{}});_0x9c52bc[a73_0x548b('0x1a')]({'data':[]});}[a73_0x548b('0xb')](_0x3cfb2b,_0x91300f,_0x217daa){sequelize_utils_1[a73_0x548b('0xe')]['models'][a73_0x548b('0x14')][a73_0x548b('0x1c')]({'where':{'status':0x1}})['then'](_0x12bf98=>{if(_0x12bf98){const _0x12e4ec='media/'+_0x12bf98[a73_0x548b('0x1f')]+a73_0x548b('0x24');if(fs_1[a73_0x548b('0xe')]['existsSync'](_0x12e4ec)){const _0x31724e=fs_1['default'][a73_0x548b('0x2b')](_0x12e4ec);const _0x169bad=_0x31724e[a73_0x548b('0x13')];console['log'](a73_0x548b('0x2c')+_0x12e4ec);console['log'](a73_0x548b('0x2d')+_0x169bad);if(_0x169bad>0x0){fs_1['default'][a73_0x548b('0x2e')](_0x12e4ec,a73_0x548b('0x2f'),function(_0x139f18,_0x272d77){if(_0x139f18){_0x12bf98['status']=null;}else{try{const _0x2fb290=JSON[a73_0x548b('0x30')](_0x272d77);for(const _0x3c29ed of _0x2fb290[a73_0x548b('0x31')][0x0][a73_0x548b('0x32')]){const _0x2d07f3=_0x3c29ed['In'];const _0x3fa361=_0x3c29ed[a73_0x548b('0x33')];const _0x36e999=Date[a73_0x548b('0x30')](_0x3c29ed['EndTime']);if(_0x2d07f3>0x0){sequelize_utils_1[a73_0x548b('0xe')][a73_0x548b('0x1b')][a73_0x548b('0x34')]['create']({'amount':_0x2d07f3,'counted_at':_0x36e999});}if(_0x3fa361>0x0){sequelize_utils_1[a73_0x548b('0xe')]['models']['passCountingsModel'][a73_0x548b('0x35')]({'amount':_0x3fa361*-0x1,'counted_at':_0x36e999});}}_0x12bf98['status']=0x2;}catch(_0x39a2dd){_0x12bf98[a73_0x548b('0x26')]=null;}}_0x12bf98['save']();});}else{_0x12bf98[a73_0x548b('0x26')]=null;_0x12bf98['save']();}}else{_0x12bf98[a73_0x548b('0x26')]=null;_0x12bf98[a73_0x548b('0x27')]();}}else{}});_0x91300f[a73_0x548b('0x1a')]({'data':[]});}[a73_0x548b('0x36')](_0x360696,_0x460666,_0x509a2a){const _0x8b992=require('zlib');const _0x5f08e4=_0x360696[a73_0x548b('0x37')][a73_0x548b('0x38')];const _0x2fb4c0=UPLOAD_PATH+'/'+_0x360696[a73_0x548b('0x37')][a73_0x548b('0x39')]+'.json';const _0x5ecd82=fs_1[a73_0x548b('0xe')][a73_0x548b('0x3a')](_0x5f08e4);const _0x3e0524=fs_1[a73_0x548b('0xe')][a73_0x548b('0x3b')](_0x2fb4c0);const _0x249518=_0x8b992[a73_0x548b('0x3c')]();console[a73_0x548b('0xc')](_0x360696['file']);_0x5ecd82['pipe'](_0x249518)[a73_0x548b('0x25')](_0x3e0524)['on']('finish',_0xd27c80=>{if(_0xd27c80)return console[a73_0x548b('0x17')](_0xd27c80);else{const _0x36896d=fs_1[a73_0x548b('0xe')][a73_0x548b('0x2b')](_0x5f08e4);const _0x4d6098=_0x36896d[a73_0x548b('0x13')];if(_0x4d6098>0x0){fs_1[a73_0x548b('0xe')]['readFile'](_0x2fb4c0,a73_0x548b('0x2f'),function(_0xd27c80,_0x314373){if(_0xd27c80){return console[a73_0x548b('0x17')](_0xd27c80);}else{try{const _0x49a892=JSON['parse'](_0x314373);console[a73_0x548b('0xc')](_0x49a892);const _0x5ef611=_0x49a892[a73_0x548b('0x3d')][0x0][a73_0x548b('0x3e')];const _0x130883=_0x49a892[a73_0x548b('0x3d')][0x0][a73_0x548b('0x3f')];const _0x936c35=moment_1[a73_0x548b('0xe')](_0x5ef611+'\x20'+_0x130883+'\x20-05:00','YYYYMMDD\x20HHmmss\x20Z');const _0x3f4a10=parseFloat(_0x49a892[a73_0x548b('0x3d')][0x0][a73_0x548b('0x40')][a73_0x548b('0x41')](',','.'));const _0x37a8cb=parseFloat(_0x49a892[a73_0x548b('0x3d')][0x0][a73_0x548b('0x42')][a73_0x548b('0x41')](',','.'));const _0x3a7765=_0x49a892['eventos'][0x0][a73_0x548b('0x43')];const _0xcd0288=_0x49a892[a73_0x548b('0x3d')][0x0][a73_0x548b('0x44')][0x0]['ingresos'];const _0x4c9d8a=_0x49a892[a73_0x548b('0x3d')][0x0][a73_0x548b('0x44')][0x0][a73_0x548b('0x45')];console[a73_0x548b('0xc')](_0x3f4a10);console['log'](_0x37a8cb);console['log'](_0x3a7765);console[a73_0x548b('0xc')](_0xcd0288);console[a73_0x548b('0xc')](_0x4c9d8a);console[a73_0x548b('0xc')](_0x936c35);if(_0xcd0288>0x0){sequelize_utils_1[a73_0x548b('0xe')][a73_0x548b('0x1b')][a73_0x548b('0x34')][a73_0x548b('0x35')]({'amount':_0xcd0288,'counted_at':_0x936c35});}sequelize_utils_1['default']['models']['locationPointsModel'][a73_0x548b('0x35')]({'device_id':null,'lat':''+_0x3f4a10,'lon':''+_0x37a8cb,'tracked_at':_0x936c35});}catch(_0x2ba723){return console[a73_0x548b('0x17')](_0x2ba723);}}});}}});_0x460666[a73_0x548b('0x1a')]({'status':0x1,'data':_0x360696[a73_0x548b('0x37')]});}}exports['default']=SyncFilesController;