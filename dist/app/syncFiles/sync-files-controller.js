var a73_0xb6ef=['connected','colombia','name','json','default','models','syncFilesModel','spread','push','error','ftp.vivotek.com','ipd','downloadFtp','findOne','then','connected:','get','file_name','end','media/','.txt','pipe','createWriteStream','save','Downloaded:\x20','fileName','connect','existsSync','statSync','size','fileName:\x20','readFile','utf8','status','parse','Data','CountingInfo','Out','passCountingsModel','create','uploadEvent','zlib','file','filename','.json','createReadStream','eventos','fecha','hora','\x20-05:00','YYYYMMDD\x20HHmmss\x20Z','latitud','replace','puerta','ingresos','salidas','locationPointsModel','__importDefault','__esModule','../../infrastructure/controller-utils','../../infrastructure/sequelize-utils','media','syncFtp','bind','processFtp','log','connecting','ready'];(function(_0x3e339e,_0x1f76c3){var _0x43be12=function(_0x110d6e){while(--_0x110d6e){_0x3e339e['push'](_0x3e339e['shift']());}};_0x43be12(++_0x1f76c3);}(a73_0xb6ef,0x18d));var a73_0xb401=function(_0x419dd4,_0x1f4ca0){_0x419dd4=_0x419dd4-0x0;var _0x253e0e=a73_0xb6ef[_0x419dd4];return _0x253e0e;};'use strict';var __importDefault=this&&this[a73_0xb401('0x0')]||function(_0x55c882){return _0x55c882&&_0x55c882[a73_0xb401('0x1')]?_0x55c882:{'default':_0x55c882};};Object['defineProperty'](exports,a73_0xb401('0x1'),{'value':!![]});const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a73_0xb401('0x2')));const sequelize_utils_1=__importDefault(require(a73_0xb401('0x3')));const moment_1=__importDefault(require('moment'));const UPLOAD_PATH=a73_0xb401('0x4');class SyncFilesController extends controller_utils_1['default']{constructor(_0x179d33){super(_0x179d33,null);this['syncFtp']=this[a73_0xb401('0x5')][a73_0xb401('0x6')](this);this['downloadFtp']=this['downloadFtp']['bind'](this);this[a73_0xb401('0x7')]=this['processFtp']['bind'](this);}['syncFtp'](_0x36d9ba,_0x3e3fb4,_0x769dac){console[a73_0xb401('0x8')](a73_0xb401('0x9'));const _0x34dcd9=[];const _0x484ec2=new ftp_1['default']();_0x484ec2['on'](a73_0xb401('0xa'),function(){console[a73_0xb401('0x8')](a73_0xb401('0xb'));_0x484ec2['list'](a73_0xb401('0xc'),![],function(_0x409723,_0x269530){if(_0x409723){console[a73_0xb401('0x8')](_0x409723);}else{for(const _0x1f6b06 of _0x269530){if(_0x1f6b06[a73_0xb401('0xd')]['endsWith'](a73_0xb401('0xe'))&&_0x1f6b06['size']>0x0){sequelize_utils_1[a73_0xb401('0xf')][a73_0xb401('0x10')][a73_0xb401('0x11')]['findOrCreate']({'where':{'file_name':_0x1f6b06['name']}})[a73_0xb401('0x12')]((_0x5dd8d3,_0x4b8ac6)=>{if(_0x4b8ac6){_0x34dcd9[a73_0xb401('0x13')](_0x5dd8d3);}});}}}});});_0x484ec2['on'](a73_0xb401('0x14'),function(_0x384878){});_0x484ec2['connect']({'host':a73_0xb401('0x15'),'port':0x15,'user':a73_0xb401('0x16'),'password':'ipd'});_0x3e3fb4[a73_0xb401('0xe')]({'data':[]});}[a73_0xb401('0x17')](_0x3b60b0,_0xd3e207,_0x155a13){sequelize_utils_1[a73_0xb401('0xf')][a73_0xb401('0x10')]['syncFilesModel'][a73_0xb401('0x18')]({'where':{'status':null}})[a73_0xb401('0x19')](_0x114d28=>{if(_0x114d28){const _0x31377=new ftp_1['default']();_0x31377['on']('ready',function(){console[a73_0xb401('0x8')](a73_0xb401('0x1a')+_0x114d28['file_name']);_0x31377[a73_0xb401('0x1b')]('colombia/'+_0x114d28[a73_0xb401('0x1c')],function(_0x43fb0d,_0x2ca596){_0x31377[a73_0xb401('0x1d')]();if(_0x43fb0d){}else{const _0x314586=a73_0xb401('0x1e')+_0x114d28[a73_0xb401('0x1c')]+a73_0xb401('0x1f');_0x2ca596[a73_0xb401('0x20')](fs_1['default'][a73_0xb401('0x21')](_0x314586));_0x114d28['status']=0x1;_0x114d28[a73_0xb401('0x22')]();console[a73_0xb401('0x8')](a73_0xb401('0x23')+_0x114d28[a73_0xb401('0x24')]);}});});_0x31377['on'](a73_0xb401('0x14'),function(_0x5a3e1e){});_0x31377[a73_0xb401('0x25')]({'host':a73_0xb401('0x15'),'port':0x15,'user':a73_0xb401('0x16'),'password':'ipd'});}else{}});_0xd3e207['json']({'data':[]});}[a73_0xb401('0x7')](_0x48f48e,_0x9a4465,_0x164bc3){sequelize_utils_1[a73_0xb401('0xf')]['models'][a73_0xb401('0x11')][a73_0xb401('0x18')]({'where':{'status':0x1}})[a73_0xb401('0x19')](_0x533216=>{if(_0x533216){const _0x3bbd77=a73_0xb401('0x1e')+_0x533216[a73_0xb401('0x1c')]+a73_0xb401('0x1f');if(fs_1[a73_0xb401('0xf')][a73_0xb401('0x26')](_0x3bbd77)){const _0x28c112=fs_1[a73_0xb401('0xf')][a73_0xb401('0x27')](_0x3bbd77);const _0x938ea6=_0x28c112[a73_0xb401('0x28')];console['log'](a73_0xb401('0x29')+_0x3bbd77);console['log']('fileSizeInBytes:\x20'+_0x938ea6);if(_0x938ea6>0x0){fs_1[a73_0xb401('0xf')][a73_0xb401('0x2a')](_0x3bbd77,a73_0xb401('0x2b'),function(_0x20245a,_0x7e339f){if(_0x20245a){_0x533216[a73_0xb401('0x2c')]=null;}else{try{const _0x57f69c=JSON[a73_0xb401('0x2d')](_0x7e339f);for(const _0x3782b2 of _0x57f69c[a73_0xb401('0x2e')][0x0][a73_0xb401('0x2f')]){const _0x8c1e43=_0x3782b2['In'];const _0x40e98b=_0x3782b2[a73_0xb401('0x30')];const _0x32e45b=Date[a73_0xb401('0x2d')](_0x3782b2['EndTime']);if(_0x8c1e43>0x0){sequelize_utils_1['default']['models'][a73_0xb401('0x31')][a73_0xb401('0x32')]({'amount':_0x8c1e43,'counted_at':_0x32e45b});}if(_0x40e98b>0x0){sequelize_utils_1[a73_0xb401('0xf')][a73_0xb401('0x10')]['passCountingsModel'][a73_0xb401('0x32')]({'amount':_0x40e98b*-0x1,'counted_at':_0x32e45b});}}_0x533216[a73_0xb401('0x2c')]=0x2;}catch(_0x285b00){_0x533216['status']=null;}}_0x533216[a73_0xb401('0x22')]();});}else{_0x533216[a73_0xb401('0x2c')]=null;_0x533216[a73_0xb401('0x22')]();}}else{_0x533216[a73_0xb401('0x2c')]=null;_0x533216[a73_0xb401('0x22')]();}}else{}});_0x9a4465[a73_0xb401('0xe')]({'data':[]});}[a73_0xb401('0x33')](_0x4aa279,_0x2d1770,_0x2c178f){const _0x2254f2=require(a73_0xb401('0x34'));const _0x1b085e=_0x4aa279[a73_0xb401('0x35')]['path'];const _0x15d0bc=UPLOAD_PATH+'/'+_0x4aa279[a73_0xb401('0x35')][a73_0xb401('0x36')]+a73_0xb401('0x37');const _0x3a5d97=fs_1[a73_0xb401('0xf')][a73_0xb401('0x38')](_0x1b085e);const _0x287a55=fs_1[a73_0xb401('0xf')][a73_0xb401('0x21')](_0x15d0bc);const _0x5c43b2=_0x2254f2['createGunzip']();console['log'](_0x4aa279[a73_0xb401('0x35')]);_0x3a5d97[a73_0xb401('0x20')](_0x5c43b2)[a73_0xb401('0x20')](_0x287a55)['on']('finish',_0x39158f=>{if(_0x39158f)return console['error'](_0x39158f);else{const _0xb7d530=fs_1[a73_0xb401('0xf')][a73_0xb401('0x27')](_0x1b085e);const _0x4993a8=_0xb7d530[a73_0xb401('0x28')];if(_0x4993a8>0x0){fs_1[a73_0xb401('0xf')]['readFile'](_0x15d0bc,a73_0xb401('0x2b'),function(_0x39158f,_0x49976c){if(_0x39158f){return console[a73_0xb401('0x14')](_0x39158f);}else{try{const _0x447a5b=JSON[a73_0xb401('0x2d')](_0x49976c);console[a73_0xb401('0x8')](_0x447a5b);const _0x432fe8=_0x447a5b[a73_0xb401('0x39')][0x0][a73_0xb401('0x3a')];const _0x24de6a=_0x447a5b[a73_0xb401('0x39')][0x0][a73_0xb401('0x3b')];const _0x46c880=moment_1['default'](_0x432fe8+'\x20'+_0x24de6a+a73_0xb401('0x3c'),a73_0xb401('0x3d'));const _0x550f0c=parseFloat(_0x447a5b[a73_0xb401('0x39')][0x0][a73_0xb401('0x3e')][a73_0xb401('0x3f')](',','.'));const _0x17f1fe=parseFloat(_0x447a5b[a73_0xb401('0x39')][0x0]['longitud'][a73_0xb401('0x3f')](',','.'));const _0x3f941d=_0x447a5b[a73_0xb401('0x39')][0x0]['velocidad'];const _0x58d691=_0x447a5b[a73_0xb401('0x39')][0x0][a73_0xb401('0x40')][0x0][a73_0xb401('0x41')];const _0x304a60=_0x447a5b[a73_0xb401('0x39')][0x0][a73_0xb401('0x40')][0x0][a73_0xb401('0x42')];console[a73_0xb401('0x8')](_0x550f0c);console[a73_0xb401('0x8')](_0x17f1fe);console['log'](_0x3f941d);console[a73_0xb401('0x8')](_0x58d691);console[a73_0xb401('0x8')](_0x304a60);console['log'](_0x46c880);if(_0x58d691>0x0){sequelize_utils_1[a73_0xb401('0xf')]['models'][a73_0xb401('0x31')][a73_0xb401('0x32')]({'amount':_0x58d691,'counted_at':_0x46c880});}sequelize_utils_1[a73_0xb401('0xf')]['models'][a73_0xb401('0x43')][a73_0xb401('0x32')]({'device_id':null,'lat':''+_0x550f0c,'lon':''+_0x17f1fe,'tracked_at':_0x46c880});}catch(_0xcc44f3){return console['error'](_0xcc44f3);}}});}}});_0x2d1770[a73_0xb401('0xe')]({'status':0x1,'data':_0x4aa279[a73_0xb401('0x35')]});}}exports['default']=SyncFilesController;