var a72_0x5446=['pipe','statSync','parse','eventos','fecha','hora','\x20-05:00','latitud','replace','longitud','velocidad','puerta','salidas','locationPointsModel','__importDefault','defineProperty','__esModule','../../infrastructure/sequelize-utils','moment','media','syncFtp','downloadFtp','processFtp','log','default','connected','list','name','json','size','syncFilesModel','findOrCreate','spread','push','connect','ipd','findOne','then','ready','connected:','get','colombia/','file_name','media/','status','Downloaded:\x20','fileName','error','ftp.vivotek.com','models','.txt','existsSync','fileName:\x20','readFile','utf8','Data','CountingInfo','Out','EndTime','create','passCountingsModel','save','zlib','file','path','filename','createReadStream','createWriteStream','createGunzip'];(function(_0x3f242c,_0x37e31d){var _0x5709cd=function(_0x3ca9b9){while(--_0x3ca9b9){_0x3f242c['push'](_0x3f242c['shift']());}};_0x5709cd(++_0x37e31d);}(a72_0x5446,0xdd));var a72_0x3127=function(_0x2e4948,_0x2dc779){_0x2e4948=_0x2e4948-0x0;var _0x39e552=a72_0x5446[_0x2e4948];return _0x39e552;};'use strict';var __importDefault=this&&this[a72_0x3127('0x0')]||function(_0x49f650){return _0x49f650&&_0x49f650['__esModule']?_0x49f650:{'default':_0x49f650};};Object[a72_0x3127('0x1')](exports,a72_0x3127('0x2'),{'value':!![]});const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require('../../infrastructure/controller-utils'));const sequelize_utils_1=__importDefault(require(a72_0x3127('0x3')));const moment_1=__importDefault(require(a72_0x3127('0x4')));const UPLOAD_PATH=a72_0x3127('0x5');class SyncFilesController extends controller_utils_1['default']{constructor(_0x950807){super(_0x950807,null);this[a72_0x3127('0x6')]=this['syncFtp']['bind'](this);this['downloadFtp']=this[a72_0x3127('0x7')]['bind'](this);this[a72_0x3127('0x8')]=this[a72_0x3127('0x8')]['bind'](this);}['syncFtp'](_0x33a031,_0x5f05b7,_0x11f0ff){console[a72_0x3127('0x9')]('connecting');const _0x3ccd7a=[];const _0x4d1ba6=new ftp_1[(a72_0x3127('0xa'))]();_0x4d1ba6['on']('ready',function(){console[a72_0x3127('0x9')](a72_0x3127('0xb'));_0x4d1ba6[a72_0x3127('0xc')]('colombia',![],function(_0x3c2220,_0x14bb9d){if(_0x3c2220){console['log'](_0x3c2220);}else{for(const _0x5d77f4 of _0x14bb9d){if(_0x5d77f4[a72_0x3127('0xd')]['endsWith'](a72_0x3127('0xe'))&&_0x5d77f4[a72_0x3127('0xf')]>0x0){sequelize_utils_1[a72_0x3127('0xa')]['models'][a72_0x3127('0x10')][a72_0x3127('0x11')]({'where':{'file_name':_0x5d77f4[a72_0x3127('0xd')]}})[a72_0x3127('0x12')]((_0x50277a,_0x474ca9)=>{if(_0x474ca9){_0x3ccd7a[a72_0x3127('0x13')](_0x50277a);}});}}}});});_0x4d1ba6['on']('error',function(_0x55794b){});_0x4d1ba6[a72_0x3127('0x14')]({'host':'ftp.vivotek.com','port':0x15,'user':a72_0x3127('0x15'),'password':a72_0x3127('0x15')});_0x5f05b7['json']({'data':[]});}['downloadFtp'](_0x4832d7,_0xade1e,_0x3dcf41){sequelize_utils_1[a72_0x3127('0xa')]['models'][a72_0x3127('0x10')][a72_0x3127('0x16')]({'where':{'status':null}})[a72_0x3127('0x17')](_0x8522e0=>{if(_0x8522e0){const _0x374395=new ftp_1[(a72_0x3127('0xa'))]();_0x374395['on'](a72_0x3127('0x18'),function(){console[a72_0x3127('0x9')](a72_0x3127('0x19')+_0x8522e0['file_name']);_0x374395[a72_0x3127('0x1a')](a72_0x3127('0x1b')+_0x8522e0[a72_0x3127('0x1c')],function(_0x155b2c,_0x52131f){_0x374395['end']();if(_0x155b2c){}else{const _0x244541=a72_0x3127('0x1d')+_0x8522e0[a72_0x3127('0x1c')]+'.txt';_0x52131f['pipe'](fs_1[a72_0x3127('0xa')]['createWriteStream'](_0x244541));_0x8522e0[a72_0x3127('0x1e')]=0x1;_0x8522e0['save']();console[a72_0x3127('0x9')](a72_0x3127('0x1f')+_0x8522e0[a72_0x3127('0x20')]);}});});_0x374395['on'](a72_0x3127('0x21'),function(_0x4b1dab){});_0x374395['connect']({'host':a72_0x3127('0x22'),'port':0x15,'user':a72_0x3127('0x15'),'password':a72_0x3127('0x15')});}else{}});_0xade1e[a72_0x3127('0xe')]({'data':[]});}[a72_0x3127('0x8')](_0x3f063c,_0x51076f,_0x4d53bf){sequelize_utils_1[a72_0x3127('0xa')][a72_0x3127('0x23')][a72_0x3127('0x10')][a72_0x3127('0x16')]({'where':{'status':0x1}})[a72_0x3127('0x17')](_0x4c4b39=>{if(_0x4c4b39){const _0x58e0c4=a72_0x3127('0x1d')+_0x4c4b39[a72_0x3127('0x1c')]+a72_0x3127('0x24');if(fs_1[a72_0x3127('0xa')][a72_0x3127('0x25')](_0x58e0c4)){const _0x190c39=fs_1['default']['statSync'](_0x58e0c4);const _0x3387c2=_0x190c39[a72_0x3127('0xf')];console[a72_0x3127('0x9')](a72_0x3127('0x26')+_0x58e0c4);console['log']('fileSizeInBytes:\x20'+_0x3387c2);if(_0x3387c2>0x0){fs_1['default'][a72_0x3127('0x27')](_0x58e0c4,a72_0x3127('0x28'),function(_0x3eb447,_0x227453){if(_0x3eb447){_0x4c4b39[a72_0x3127('0x1e')]=null;}else{try{const _0x3fb1f7=JSON['parse'](_0x227453);for(const _0x58bea5 of _0x3fb1f7[a72_0x3127('0x29')][0x0][a72_0x3127('0x2a')]){const _0x5c1f0b=_0x58bea5['In'];const _0x223a1e=_0x58bea5[a72_0x3127('0x2b')];const _0x3a74a9=Date['parse'](_0x58bea5[a72_0x3127('0x2c')]);if(_0x5c1f0b>0x0){sequelize_utils_1[a72_0x3127('0xa')][a72_0x3127('0x23')]['passCountingsModel'][a72_0x3127('0x2d')]({'amount':_0x5c1f0b,'counted_at':_0x3a74a9});}if(_0x223a1e>0x0){sequelize_utils_1['default'][a72_0x3127('0x23')][a72_0x3127('0x2e')][a72_0x3127('0x2d')]({'amount':_0x223a1e*-0x1,'counted_at':_0x3a74a9});}}_0x4c4b39[a72_0x3127('0x1e')]=0x2;}catch(_0x357afa){_0x4c4b39['status']=null;}}_0x4c4b39[a72_0x3127('0x2f')]();});}else{_0x4c4b39[a72_0x3127('0x1e')]=null;_0x4c4b39[a72_0x3127('0x2f')]();}}else{_0x4c4b39['status']=null;_0x4c4b39[a72_0x3127('0x2f')]();}}else{}});_0x51076f[a72_0x3127('0xe')]({'data':[]});}['uploadEvent'](_0x408c46,_0x29a38a,_0x5080bc){const _0x223694=require(a72_0x3127('0x30'));const _0xf9b6bf=_0x408c46[a72_0x3127('0x31')][a72_0x3127('0x32')];const _0x4aef90=UPLOAD_PATH+'/'+_0x408c46[a72_0x3127('0x31')][a72_0x3127('0x33')]+'.json';const _0x4e8a14=fs_1[a72_0x3127('0xa')][a72_0x3127('0x34')](_0xf9b6bf);const _0x5dc1e4=fs_1['default'][a72_0x3127('0x35')](_0x4aef90);const _0x1a928d=_0x223694[a72_0x3127('0x36')]();console['log'](_0x408c46[a72_0x3127('0x31')]);_0x4e8a14['pipe'](_0x1a928d)[a72_0x3127('0x37')](_0x5dc1e4)['on']('finish',_0x333961=>{if(_0x333961)return console[a72_0x3127('0x21')](_0x333961);else{const _0x59bf5b=fs_1[a72_0x3127('0xa')][a72_0x3127('0x38')](_0xf9b6bf);const _0x31faca=_0x59bf5b[a72_0x3127('0xf')];if(_0x31faca>0x0){fs_1[a72_0x3127('0xa')]['readFile'](_0x4aef90,a72_0x3127('0x28'),function(_0x333961,_0x29d876){if(_0x333961){return console[a72_0x3127('0x21')](_0x333961);}else{try{const _0x2b1307=JSON[a72_0x3127('0x39')](_0x29d876);console['log'](_0x2b1307);const _0x4d3649=_0x2b1307[a72_0x3127('0x3a')][0x0][a72_0x3127('0x3b')];const _0xef84b9=_0x2b1307[a72_0x3127('0x3a')][0x0][a72_0x3127('0x3c')];const _0x245349=moment_1[a72_0x3127('0xa')](_0x4d3649+'\x20'+_0xef84b9+a72_0x3127('0x3d'),'YYYYMMDD\x20HHmmss\x20Z');const _0x33d272=parseFloat(_0x2b1307[a72_0x3127('0x3a')][0x0][a72_0x3127('0x3e')][a72_0x3127('0x3f')](',','.'));const _0x5345a1=parseFloat(_0x2b1307[a72_0x3127('0x3a')][0x0][a72_0x3127('0x40')][a72_0x3127('0x3f')](',','.'));const _0x37d71d=_0x2b1307[a72_0x3127('0x3a')][0x0][a72_0x3127('0x41')];const _0x305465=_0x2b1307[a72_0x3127('0x3a')][0x0][a72_0x3127('0x42')][0x0]['ingresos'];const _0x1ead95=_0x2b1307[a72_0x3127('0x3a')][0x0][a72_0x3127('0x42')][0x0][a72_0x3127('0x43')];console[a72_0x3127('0x9')](_0x33d272);console[a72_0x3127('0x9')](_0x5345a1);console[a72_0x3127('0x9')](_0x37d71d);console[a72_0x3127('0x9')](_0x305465);console['log'](_0x1ead95);console[a72_0x3127('0x9')](_0x245349);if(_0x305465>0x0){sequelize_utils_1[a72_0x3127('0xa')][a72_0x3127('0x23')][a72_0x3127('0x2e')]['create']({'amount':_0x305465,'counted_at':_0x245349});}sequelize_utils_1[a72_0x3127('0xa')][a72_0x3127('0x23')][a72_0x3127('0x44')]['create']({'device_id':null,'lat':''+_0x33d272,'lon':''+_0x5345a1,'tracked_at':_0x245349});}catch(_0x4c41aa){return console[a72_0x3127('0x21')](_0x4c41aa);}}});}}});_0x29a38a[a72_0x3127('0xe')]({'status':0x1,'data':_0x408c46[a72_0x3127('0x31')]});}}exports[a72_0x3127('0xa')]=SyncFilesController;