var a73_0x1f4d=['json','findOne','connected:','file_name','get','end','pipe','createWriteStream','status','save','Downloaded:\x20','fileName','error','syncFilesModel','then','media/','statSync','size','fileSizeInBytes:\x20','readFile','Data','CountingInfo','parse','EndTime','passCountingsModel','create','uploadEvent','zlib','path','file','filename','.json','createReadStream','createGunzip','finish','eventos','hora','YYYYMMDD\x20HHmmss\x20Z','replace','longitud','velocidad','puerta','ingresos','salidas','__importDefault','__esModule','defineProperty','ftp','../../infrastructure/controller-utils','../../infrastructure/sequelize-utils','moment','media','default','syncFtp','bind','downloadFtp','processFtp','log','connecting','ready','list','colombia','name','models','findOrCreate','push','connect','ftp.vivotek.com','ipd'];(function(_0x30f676,_0x585ed0){var _0x5f26c8=function(_0x4d38a6){while(--_0x4d38a6){_0x30f676['push'](_0x30f676['shift']());}};_0x5f26c8(++_0x585ed0);}(a73_0x1f4d,0x71));var a73_0x5030=function(_0x261f36,_0x3a1c06){_0x261f36=_0x261f36-0x0;var _0x2e192e=a73_0x1f4d[_0x261f36];return _0x2e192e;};'use strict';var __importDefault=this&&this[a73_0x5030('0x0')]||function(_0x43c3f4){return _0x43c3f4&&_0x43c3f4[a73_0x5030('0x1')]?_0x43c3f4:{'default':_0x43c3f4};};Object[a73_0x5030('0x2')](exports,'__esModule',{'value':!![]});const ftp_1=__importDefault(require(a73_0x5030('0x3')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a73_0x5030('0x4')));const sequelize_utils_1=__importDefault(require(a73_0x5030('0x5')));const moment_1=__importDefault(require(a73_0x5030('0x6')));const UPLOAD_PATH=a73_0x5030('0x7');class SyncFilesController extends controller_utils_1[a73_0x5030('0x8')]{constructor(_0x420663){super(_0x420663,null);this[a73_0x5030('0x9')]=this[a73_0x5030('0x9')][a73_0x5030('0xa')](this);this[a73_0x5030('0xb')]=this['downloadFtp']['bind'](this);this['processFtp']=this[a73_0x5030('0xc')][a73_0x5030('0xa')](this);}['syncFtp'](_0x4cce55,_0x3db9f6,_0x5c0b92){console[a73_0x5030('0xd')](a73_0x5030('0xe'));const _0x13fb5d=[];const _0x211962=new ftp_1[(a73_0x5030('0x8'))]();_0x211962['on'](a73_0x5030('0xf'),function(){console[a73_0x5030('0xd')]('connected');_0x211962[a73_0x5030('0x10')](a73_0x5030('0x11'),![],function(_0x304e7a,_0x246fc5){if(_0x304e7a){console['log'](_0x304e7a);}else{for(const _0x39c3e1 of _0x246fc5){if(_0x39c3e1[a73_0x5030('0x12')]['endsWith']('json')&&_0x39c3e1['size']>0x0){sequelize_utils_1[a73_0x5030('0x8')][a73_0x5030('0x13')]['syncFilesModel'][a73_0x5030('0x14')]({'where':{'file_name':_0x39c3e1[a73_0x5030('0x12')]}})['spread']((_0x466e91,_0x11b2a6)=>{if(_0x11b2a6){_0x13fb5d[a73_0x5030('0x15')](_0x466e91);}});}}}});});_0x211962['on']('error',function(_0x2ce612){});_0x211962[a73_0x5030('0x16')]({'host':a73_0x5030('0x17'),'port':0x15,'user':a73_0x5030('0x18'),'password':'ipd'});_0x3db9f6[a73_0x5030('0x19')]({'data':[]});}['downloadFtp'](_0x39f2d4,_0x34afa8,_0x8ccf5b){sequelize_utils_1[a73_0x5030('0x8')][a73_0x5030('0x13')]['syncFilesModel'][a73_0x5030('0x1a')]({'where':{'status':null}})['then'](_0xb157cc=>{if(_0xb157cc){const _0x42378b=new ftp_1[(a73_0x5030('0x8'))]();_0x42378b['on'](a73_0x5030('0xf'),function(){console[a73_0x5030('0xd')](a73_0x5030('0x1b')+_0xb157cc[a73_0x5030('0x1c')]);_0x42378b[a73_0x5030('0x1d')]('colombia/'+_0xb157cc[a73_0x5030('0x1c')],function(_0x10d855,_0x6fa072){_0x42378b[a73_0x5030('0x1e')]();if(_0x10d855){}else{const _0xeb5fa4='media/'+_0xb157cc[a73_0x5030('0x1c')]+'.txt';_0x6fa072[a73_0x5030('0x1f')](fs_1[a73_0x5030('0x8')][a73_0x5030('0x20')](_0xeb5fa4));_0xb157cc[a73_0x5030('0x21')]=0x1;_0xb157cc[a73_0x5030('0x22')]();console[a73_0x5030('0xd')](a73_0x5030('0x23')+_0xb157cc[a73_0x5030('0x24')]);}});});_0x42378b['on'](a73_0x5030('0x25'),function(_0x5bf884){});_0x42378b[a73_0x5030('0x16')]({'host':a73_0x5030('0x17'),'port':0x15,'user':'ipd','password':'ipd'});}else{}});_0x34afa8['json']({'data':[]});}['processFtp'](_0x2f0343,_0x5a57ab,_0x975d8a){sequelize_utils_1[a73_0x5030('0x8')][a73_0x5030('0x13')][a73_0x5030('0x26')][a73_0x5030('0x1a')]({'where':{'status':0x1}})[a73_0x5030('0x27')](_0x554da4=>{if(_0x554da4){const _0x39da3c=a73_0x5030('0x28')+_0x554da4['file_name']+'.txt';if(fs_1['default']['existsSync'](_0x39da3c)){const _0x5dec22=fs_1[a73_0x5030('0x8')][a73_0x5030('0x29')](_0x39da3c);const _0x8b19a=_0x5dec22[a73_0x5030('0x2a')];console[a73_0x5030('0xd')]('fileName:\x20'+_0x39da3c);console[a73_0x5030('0xd')](a73_0x5030('0x2b')+_0x8b19a);if(_0x8b19a>0x0){fs_1[a73_0x5030('0x8')][a73_0x5030('0x2c')](_0x39da3c,'utf8',function(_0x529225,_0x259fa3){if(_0x529225){_0x554da4[a73_0x5030('0x21')]=null;}else{try{const _0x3ca5c8=JSON['parse'](_0x259fa3);for(const _0x4d7311 of _0x3ca5c8[a73_0x5030('0x2d')][0x0][a73_0x5030('0x2e')]){const _0x3b1058=_0x4d7311['In'];const _0xc9162=_0x4d7311['Out'];const _0x4f0709=Date[a73_0x5030('0x2f')](_0x4d7311[a73_0x5030('0x30')]);if(_0x3b1058>0x0){sequelize_utils_1[a73_0x5030('0x8')][a73_0x5030('0x13')][a73_0x5030('0x31')][a73_0x5030('0x32')]({'amount':_0x3b1058,'counted_at':_0x4f0709});}if(_0xc9162>0x0){sequelize_utils_1[a73_0x5030('0x8')][a73_0x5030('0x13')]['passCountingsModel']['create']({'amount':_0xc9162*-0x1,'counted_at':_0x4f0709});}}_0x554da4[a73_0x5030('0x21')]=0x2;}catch(_0x29e716){_0x554da4[a73_0x5030('0x21')]=null;}}_0x554da4[a73_0x5030('0x22')]();});}else{_0x554da4[a73_0x5030('0x21')]=null;_0x554da4[a73_0x5030('0x22')]();}}else{_0x554da4[a73_0x5030('0x21')]=null;_0x554da4[a73_0x5030('0x22')]();}}else{}});_0x5a57ab[a73_0x5030('0x19')]({'data':[]});}[a73_0x5030('0x33')](_0x585b98,_0x2f1183,_0x14c6b7){const _0x5d0bdd=require(a73_0x5030('0x34'));const _0x511e77=_0x585b98['file'][a73_0x5030('0x35')];const _0x47e881=UPLOAD_PATH+'/'+_0x585b98[a73_0x5030('0x36')][a73_0x5030('0x37')]+a73_0x5030('0x38');const _0x2d1b9d=fs_1[a73_0x5030('0x8')][a73_0x5030('0x39')](_0x511e77);const _0x332d3b=fs_1[a73_0x5030('0x8')][a73_0x5030('0x20')](_0x47e881);const _0x3d75d7=_0x5d0bdd[a73_0x5030('0x3a')]();console['log'](_0x585b98[a73_0x5030('0x36')]);_0x2d1b9d[a73_0x5030('0x1f')](_0x3d75d7)[a73_0x5030('0x1f')](_0x332d3b)['on'](a73_0x5030('0x3b'),_0x538101=>{if(_0x538101)return console[a73_0x5030('0x25')](_0x538101);else{const _0x19a64e=fs_1[a73_0x5030('0x8')][a73_0x5030('0x29')](_0x511e77);const _0x323ec8=_0x19a64e[a73_0x5030('0x2a')];if(_0x323ec8>0x0){fs_1[a73_0x5030('0x8')][a73_0x5030('0x2c')](_0x47e881,'utf8',function(_0x538101,_0x446a2e){if(_0x538101){return console['error'](_0x538101);}else{try{const _0x5bf053=JSON[a73_0x5030('0x2f')](_0x446a2e);console['log'](_0x5bf053);const _0xaff769=_0x5bf053[a73_0x5030('0x3c')][0x0]['fecha'];const _0x22f656=_0x5bf053[a73_0x5030('0x3c')][0x0][a73_0x5030('0x3d')];const _0x57296c=moment_1[a73_0x5030('0x8')](_0xaff769+'\x20'+_0x22f656+'\x20-05:00',a73_0x5030('0x3e'));const _0x87bdf0=parseFloat(_0x5bf053['eventos'][0x0]['latitud'][a73_0x5030('0x3f')](',','.'));const _0x55c437=parseFloat(_0x5bf053[a73_0x5030('0x3c')][0x0][a73_0x5030('0x40')][a73_0x5030('0x3f')](',','.'));const _0x2810bc=_0x5bf053[a73_0x5030('0x3c')][0x0][a73_0x5030('0x41')];const _0x398369=_0x5bf053[a73_0x5030('0x3c')][0x0][a73_0x5030('0x42')][0x0][a73_0x5030('0x43')];const _0x2f3d3c=_0x5bf053[a73_0x5030('0x3c')][0x0][a73_0x5030('0x42')][0x0][a73_0x5030('0x44')];console[a73_0x5030('0xd')](_0x87bdf0);console['log'](_0x55c437);console[a73_0x5030('0xd')](_0x2810bc);console[a73_0x5030('0xd')](_0x398369);console['log'](_0x2f3d3c);console[a73_0x5030('0xd')](_0x57296c);if(_0x398369>0x0){sequelize_utils_1[a73_0x5030('0x8')][a73_0x5030('0x13')][a73_0x5030('0x31')][a73_0x5030('0x32')]({'amount':_0x398369,'counted_at':_0x57296c});}sequelize_utils_1[a73_0x5030('0x8')][a73_0x5030('0x13')]['locationPointsModel'][a73_0x5030('0x32')]({'device_id':null,'lat':''+_0x87bdf0,'lon':''+_0x55c437,'tracked_at':_0x57296c});}catch(_0x3cf37d){return console[a73_0x5030('0x25')](_0x3cf37d);}}});}}});_0x2f1183['json']({'status':0x1,'data':_0x585b98[a73_0x5030('0x36')]});}}exports[a73_0x5030('0x8')]=SyncFilesController;