var a79_0x358a=['endsWith','json','size','models','syncFilesModel','findOrCreate','spread','error','connect','ftp.vivotek.com','ipd','file_name','get','colombia/','end','media/','.txt','createWriteStream','save','Downloaded:\x20','findOne','then','existsSync','statSync','fileSizeInBytes:\x20','readFile','status','CountingInfo','Out','parse','EndTime','create','passCountingsModel','zlib','file','path','filename','.json','createReadStream','pipe','finish','utf8','eventos','hora','YYYYMMDD\x20HHmmss\x20Z','latitud','replace','longitud','velocidad','ingresos','salidas','locationPointsModel','__importDefault','__esModule','defineProperty','ftp','../../infrastructure/controller-utils','../../infrastructure/sequelize-utils','moment','media','default','syncFtp','downloadFtp','bind','processFtp','log','connecting','ready','connected','colombia','name'];(function(_0x23d509,_0x534104){var _0x54d752=function(_0x47561d){while(--_0x47561d){_0x23d509['push'](_0x23d509['shift']());}};_0x54d752(++_0x534104);}(a79_0x358a,0x197));var a79_0x4784=function(_0x5a1e97,_0x4aecc6){_0x5a1e97=_0x5a1e97-0x0;var _0x39e1ff=a79_0x358a[_0x5a1e97];return _0x39e1ff;};'use strict';var __importDefault=this&&this[a79_0x4784('0x0')]||function(_0x5a2955){return _0x5a2955&&_0x5a2955[a79_0x4784('0x1')]?_0x5a2955:{'default':_0x5a2955};};Object[a79_0x4784('0x2')](exports,a79_0x4784('0x1'),{'value':!![]});const ftp_1=__importDefault(require(a79_0x4784('0x3')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a79_0x4784('0x4')));const sequelize_utils_1=__importDefault(require(a79_0x4784('0x5')));const moment_1=__importDefault(require(a79_0x4784('0x6')));const UPLOAD_PATH=a79_0x4784('0x7');class SyncFilesController extends controller_utils_1[a79_0x4784('0x8')]{constructor(_0x50c4cc){super(_0x50c4cc,null);this[a79_0x4784('0x9')]=this['syncFtp']['bind'](this);this[a79_0x4784('0xa')]=this[a79_0x4784('0xa')][a79_0x4784('0xb')](this);this[a79_0x4784('0xc')]=this[a79_0x4784('0xc')][a79_0x4784('0xb')](this);}[a79_0x4784('0x9')](_0x16eb0c,_0x3a8e0b,_0xa990d4){console[a79_0x4784('0xd')](a79_0x4784('0xe'));const _0xd33740=[];const _0x42f735=new ftp_1['default']();_0x42f735['on'](a79_0x4784('0xf'),function(){console[a79_0x4784('0xd')](a79_0x4784('0x10'));_0x42f735['list'](a79_0x4784('0x11'),![],function(_0x3696d9,_0x22f4d3){if(_0x3696d9){console[a79_0x4784('0xd')](_0x3696d9);}else{for(const _0x5b26ba of _0x22f4d3){if(_0x5b26ba[a79_0x4784('0x12')][a79_0x4784('0x13')](a79_0x4784('0x14'))&&_0x5b26ba[a79_0x4784('0x15')]>0x0){sequelize_utils_1['default'][a79_0x4784('0x16')][a79_0x4784('0x17')][a79_0x4784('0x18')]({'where':{'file_name':_0x5b26ba[a79_0x4784('0x12')]}})[a79_0x4784('0x19')]((_0x35fed3,_0x38c46d)=>{if(_0x38c46d){_0xd33740['push'](_0x35fed3);}});}}}});});_0x42f735['on'](a79_0x4784('0x1a'),function(_0xc84f98){});_0x42f735[a79_0x4784('0x1b')]({'host':a79_0x4784('0x1c'),'port':0x15,'user':a79_0x4784('0x1d'),'password':a79_0x4784('0x1d')});_0x3a8e0b['json']({'data':[]});}['downloadFtp'](_0x1480e3,_0x35c1c6,_0x22fb29){sequelize_utils_1[a79_0x4784('0x8')][a79_0x4784('0x16')][a79_0x4784('0x17')]['findOne']({'where':{'status':null}})['then'](_0x23adb8=>{if(_0x23adb8){const _0xc8fdcd=new ftp_1[(a79_0x4784('0x8'))]();_0xc8fdcd['on'](a79_0x4784('0xf'),function(){console[a79_0x4784('0xd')]('connected:'+_0x23adb8[a79_0x4784('0x1e')]);_0xc8fdcd[a79_0x4784('0x1f')](a79_0x4784('0x20')+_0x23adb8[a79_0x4784('0x1e')],function(_0x19c345,_0x97a5f2){_0xc8fdcd[a79_0x4784('0x21')]();if(_0x19c345){}else{const _0x4d44a4=a79_0x4784('0x22')+_0x23adb8[a79_0x4784('0x1e')]+a79_0x4784('0x23');_0x97a5f2['pipe'](fs_1[a79_0x4784('0x8')][a79_0x4784('0x24')](_0x4d44a4));_0x23adb8['status']=0x1;_0x23adb8[a79_0x4784('0x25')]();console[a79_0x4784('0xd')](a79_0x4784('0x26')+_0x23adb8['fileName']);}});});_0xc8fdcd['on'](a79_0x4784('0x1a'),function(_0x88aff3){});_0xc8fdcd[a79_0x4784('0x1b')]({'host':a79_0x4784('0x1c'),'port':0x15,'user':a79_0x4784('0x1d'),'password':a79_0x4784('0x1d')});}else{}});_0x35c1c6['json']({'data':[]});}['processFtp'](_0x31a43f,_0x43e315,_0x1dd605){sequelize_utils_1['default'][a79_0x4784('0x16')][a79_0x4784('0x17')][a79_0x4784('0x27')]({'where':{'status':0x1}})[a79_0x4784('0x28')](_0x319254=>{if(_0x319254){const _0x58dbdb=a79_0x4784('0x22')+_0x319254[a79_0x4784('0x1e')]+'.txt';if(fs_1[a79_0x4784('0x8')][a79_0x4784('0x29')](_0x58dbdb)){const _0x1e8ffe=fs_1[a79_0x4784('0x8')][a79_0x4784('0x2a')](_0x58dbdb);const _0x5cd993=_0x1e8ffe[a79_0x4784('0x15')];console[a79_0x4784('0xd')]('fileName:\x20'+_0x58dbdb);console[a79_0x4784('0xd')](a79_0x4784('0x2b')+_0x5cd993);if(_0x5cd993>0x0){fs_1['default'][a79_0x4784('0x2c')](_0x58dbdb,'utf8',function(_0x10b71f,_0x2f2c9e){if(_0x10b71f){_0x319254[a79_0x4784('0x2d')]=null;}else{try{const _0x4751da=JSON['parse'](_0x2f2c9e);for(const _0x2f6dfe of _0x4751da['Data'][0x0][a79_0x4784('0x2e')]){const _0xdf0dd4=_0x2f6dfe['In'];const _0x47f014=_0x2f6dfe[a79_0x4784('0x2f')];const _0x2838af=Date[a79_0x4784('0x30')](_0x2f6dfe[a79_0x4784('0x31')]);if(_0xdf0dd4>0x0){sequelize_utils_1[a79_0x4784('0x8')][a79_0x4784('0x16')]['passCountingsModel'][a79_0x4784('0x32')]({'amount':_0xdf0dd4,'counted_at':_0x2838af});}if(_0x47f014>0x0){sequelize_utils_1[a79_0x4784('0x8')]['models'][a79_0x4784('0x33')][a79_0x4784('0x32')]({'amount':_0x47f014*-0x1,'counted_at':_0x2838af});}}_0x319254['status']=0x2;}catch(_0xf8938){_0x319254['status']=null;}}_0x319254['save']();});}else{_0x319254[a79_0x4784('0x2d')]=null;_0x319254['save']();}}else{_0x319254[a79_0x4784('0x2d')]=null;_0x319254[a79_0x4784('0x25')]();}}else{}});_0x43e315[a79_0x4784('0x14')]({'data':[]});}['uploadEvent'](_0x5b4f64,_0x460b75,_0x2ce3f3){const _0x5570a9=require(a79_0x4784('0x34'));const _0x1227d5=_0x5b4f64[a79_0x4784('0x35')][a79_0x4784('0x36')];const _0xbf1aca=UPLOAD_PATH+'/'+_0x5b4f64['file'][a79_0x4784('0x37')]+a79_0x4784('0x38');const _0x985889=fs_1[a79_0x4784('0x8')][a79_0x4784('0x39')](_0x1227d5);const _0x1e531b=fs_1['default'][a79_0x4784('0x24')](_0xbf1aca);const _0x4ac6e9=_0x5570a9['createGunzip']();console['log'](_0x5b4f64[a79_0x4784('0x35')]);_0x985889[a79_0x4784('0x3a')](_0x4ac6e9)['pipe'](_0x1e531b)['on'](a79_0x4784('0x3b'),_0x2bc2c7=>{if(_0x2bc2c7)return console[a79_0x4784('0x1a')](_0x2bc2c7);else{const _0x4a6842=fs_1[a79_0x4784('0x8')][a79_0x4784('0x2a')](_0x1227d5);const _0x11be46=_0x4a6842[a79_0x4784('0x15')];if(_0x11be46>0x0){fs_1[a79_0x4784('0x8')][a79_0x4784('0x2c')](_0xbf1aca,a79_0x4784('0x3c'),function(_0x2bc2c7,_0x4b2546){if(_0x2bc2c7){return console[a79_0x4784('0x1a')](_0x2bc2c7);}else{try{const _0x11cf25=JSON['parse'](_0x4b2546);console['log'](_0x11cf25);const _0x529a49=_0x11cf25[a79_0x4784('0x3d')][0x0]['fecha'];const _0x52ab1c=_0x11cf25[a79_0x4784('0x3d')][0x0][a79_0x4784('0x3e')];const _0x501923=moment_1[a79_0x4784('0x8')](_0x529a49+'\x20'+_0x52ab1c+'\x20-05:00',a79_0x4784('0x3f'));const _0x47ecdf=parseFloat(_0x11cf25[a79_0x4784('0x3d')][0x0][a79_0x4784('0x40')][a79_0x4784('0x41')](',','.'));const _0xfedb1f=parseFloat(_0x11cf25[a79_0x4784('0x3d')][0x0][a79_0x4784('0x42')][a79_0x4784('0x41')](',','.'));const _0xa8ac90=_0x11cf25['eventos'][0x0][a79_0x4784('0x43')];const _0x264155=_0x11cf25[a79_0x4784('0x3d')][0x0]['puerta'][0x0][a79_0x4784('0x44')];const _0x7843c0=_0x11cf25[a79_0x4784('0x3d')][0x0]['puerta'][0x0][a79_0x4784('0x45')];console[a79_0x4784('0xd')](_0x47ecdf);console[a79_0x4784('0xd')](_0xfedb1f);console['log'](_0xa8ac90);console['log'](_0x264155);console[a79_0x4784('0xd')](_0x7843c0);console[a79_0x4784('0xd')](_0x501923);if(_0x264155>0x0){sequelize_utils_1[a79_0x4784('0x8')][a79_0x4784('0x16')]['passCountingsModel']['create']({'amount':_0x264155,'counted_at':_0x501923});}sequelize_utils_1[a79_0x4784('0x8')][a79_0x4784('0x16')][a79_0x4784('0x46')][a79_0x4784('0x32')]({'device_id':null,'lat':''+_0x47ecdf,'lon':''+_0xfedb1f,'tracked_at':_0x501923});}catch(_0x9c4e5f){return console[a79_0x4784('0x1a')](_0x9c4e5f);}}});}}});_0x460b75[a79_0x4784('0x14')]({'status':0x1,'data':_0x5b4f64[a79_0x4784('0x35')]});}}exports[a79_0x4784('0x8')]=SyncFilesController;