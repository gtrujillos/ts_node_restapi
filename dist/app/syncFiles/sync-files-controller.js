var a72_0x2101=['downloadFtp','processFtp','ready','log','connected','list','colombia','name','endsWith','syncFilesModel','spread','push','error','connect','ftp.vivotek.com','ipd','models','then','connected:','file_name','get','colombia/','end','media/','.txt','pipe','status','Downloaded:\x20','fileName','json','findOne','existsSync','statSync','size','fileName:\x20','fileSizeInBytes:\x20','readFile','utf8','parse','Data','Out','EndTime','passCountingsModel','create','save','uploadEvent','zlib','path','file','filename','createWriteStream','createGunzip','finish','eventos','fecha','hora','latitud','replace','longitud','velocidad','ingresos','puerta','locationPointsModel','__importDefault','__esModule','defineProperty','ftp','../../infrastructure/sequelize-utils','media','default','syncFtp','bind'];(function(_0x4722a2,_0x2c688b){var _0x5331a2=function(_0x2325b5){while(--_0x2325b5){_0x4722a2['push'](_0x4722a2['shift']());}};_0x5331a2(++_0x2c688b);}(a72_0x2101,0x1ef));var a72_0x5614=function(_0x4717ec,_0xa73f73){_0x4717ec=_0x4717ec-0x0;var _0x21386d=a72_0x2101[_0x4717ec];return _0x21386d;};'use strict';var __importDefault=this&&this[a72_0x5614('0x0')]||function(_0x5d32d4){return _0x5d32d4&&_0x5d32d4[a72_0x5614('0x1')]?_0x5d32d4:{'default':_0x5d32d4};};Object[a72_0x5614('0x2')](exports,'__esModule',{'value':!![]});const ftp_1=__importDefault(require(a72_0x5614('0x3')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require('../../infrastructure/controller-utils'));const sequelize_utils_1=__importDefault(require(a72_0x5614('0x4')));const moment_1=__importDefault(require('moment'));const UPLOAD_PATH=a72_0x5614('0x5');class SyncFilesController extends controller_utils_1[a72_0x5614('0x6')]{constructor(_0xb685fa){super(_0xb685fa,null);this[a72_0x5614('0x7')]=this[a72_0x5614('0x7')][a72_0x5614('0x8')](this);this['downloadFtp']=this[a72_0x5614('0x9')][a72_0x5614('0x8')](this);this[a72_0x5614('0xa')]=this['processFtp']['bind'](this);}[a72_0x5614('0x7')](_0x294193,_0xcb6973,_0x38131e){console['log']('connecting');const _0x3d24fe=[];const _0x1dede7=new ftp_1[(a72_0x5614('0x6'))]();_0x1dede7['on'](a72_0x5614('0xb'),function(){console[a72_0x5614('0xc')](a72_0x5614('0xd'));_0x1dede7[a72_0x5614('0xe')](a72_0x5614('0xf'),![],function(_0x5e640c,_0x1cf452){if(_0x5e640c){console[a72_0x5614('0xc')](_0x5e640c);}else{for(const _0x87fe94 of _0x1cf452){if(_0x87fe94[a72_0x5614('0x10')][a72_0x5614('0x11')]('json')&&_0x87fe94['size']>0x0){sequelize_utils_1['default']['models'][a72_0x5614('0x12')]['findOrCreate']({'where':{'file_name':_0x87fe94['name']}})[a72_0x5614('0x13')]((_0x125581,_0x19ed5d)=>{if(_0x19ed5d){_0x3d24fe[a72_0x5614('0x14')](_0x125581);}});}}}});});_0x1dede7['on'](a72_0x5614('0x15'),function(_0x2e2eda){});_0x1dede7[a72_0x5614('0x16')]({'host':a72_0x5614('0x17'),'port':0x15,'user':a72_0x5614('0x18'),'password':a72_0x5614('0x18')});_0xcb6973['json']({'data':[]});}['downloadFtp'](_0x21d669,_0x15a5f1,_0x31fe88){sequelize_utils_1[a72_0x5614('0x6')][a72_0x5614('0x19')][a72_0x5614('0x12')]['findOne']({'where':{'status':null}})[a72_0x5614('0x1a')](_0x303326=>{if(_0x303326){const _0x4be49c=new ftp_1[(a72_0x5614('0x6'))]();_0x4be49c['on'](a72_0x5614('0xb'),function(){console['log'](a72_0x5614('0x1b')+_0x303326[a72_0x5614('0x1c')]);_0x4be49c[a72_0x5614('0x1d')](a72_0x5614('0x1e')+_0x303326[a72_0x5614('0x1c')],function(_0x5bc54c,_0x324334){_0x4be49c[a72_0x5614('0x1f')]();if(_0x5bc54c){}else{const _0x5cf73f=a72_0x5614('0x20')+_0x303326[a72_0x5614('0x1c')]+a72_0x5614('0x21');_0x324334[a72_0x5614('0x22')](fs_1['default']['createWriteStream'](_0x5cf73f));_0x303326[a72_0x5614('0x23')]=0x1;_0x303326['save']();console[a72_0x5614('0xc')](a72_0x5614('0x24')+_0x303326[a72_0x5614('0x25')]);}});});_0x4be49c['on']('error',function(_0x351939){});_0x4be49c[a72_0x5614('0x16')]({'host':'ftp.vivotek.com','port':0x15,'user':'ipd','password':a72_0x5614('0x18')});}else{}});_0x15a5f1[a72_0x5614('0x26')]({'data':[]});}[a72_0x5614('0xa')](_0x604942,_0x2b744e,_0x3214eb){sequelize_utils_1['default'][a72_0x5614('0x19')][a72_0x5614('0x12')][a72_0x5614('0x27')]({'where':{'status':0x1}})[a72_0x5614('0x1a')](_0x59ee47=>{if(_0x59ee47){const _0x527e82=a72_0x5614('0x20')+_0x59ee47[a72_0x5614('0x1c')]+a72_0x5614('0x21');if(fs_1[a72_0x5614('0x6')][a72_0x5614('0x28')](_0x527e82)){const _0x41f7be=fs_1[a72_0x5614('0x6')][a72_0x5614('0x29')](_0x527e82);const _0x5ecc39=_0x41f7be[a72_0x5614('0x2a')];console[a72_0x5614('0xc')](a72_0x5614('0x2b')+_0x527e82);console[a72_0x5614('0xc')](a72_0x5614('0x2c')+_0x5ecc39);if(_0x5ecc39>0x0){fs_1[a72_0x5614('0x6')][a72_0x5614('0x2d')](_0x527e82,a72_0x5614('0x2e'),function(_0x26ee39,_0x52afaf){if(_0x26ee39){_0x59ee47[a72_0x5614('0x23')]=null;}else{try{const _0x1a39cf=JSON[a72_0x5614('0x2f')](_0x52afaf);for(const _0x5873b7 of _0x1a39cf[a72_0x5614('0x30')][0x0]['CountingInfo']){const _0x15dd8f=_0x5873b7['In'];const _0x489a77=_0x5873b7[a72_0x5614('0x31')];const _0x47485a=Date[a72_0x5614('0x2f')](_0x5873b7[a72_0x5614('0x32')]);if(_0x15dd8f>0x0){sequelize_utils_1['default'][a72_0x5614('0x19')][a72_0x5614('0x33')][a72_0x5614('0x34')]({'amount':_0x15dd8f,'counted_at':_0x47485a});}if(_0x489a77>0x0){sequelize_utils_1[a72_0x5614('0x6')][a72_0x5614('0x19')]['passCountingsModel']['create']({'amount':_0x489a77*-0x1,'counted_at':_0x47485a});}}_0x59ee47[a72_0x5614('0x23')]=0x2;}catch(_0x21d2ff){_0x59ee47[a72_0x5614('0x23')]=null;}}_0x59ee47['save']();});}else{_0x59ee47[a72_0x5614('0x23')]=null;_0x59ee47[a72_0x5614('0x35')]();}}else{_0x59ee47[a72_0x5614('0x23')]=null;_0x59ee47['save']();}}else{}});_0x2b744e[a72_0x5614('0x26')]({'data':[]});}[a72_0x5614('0x36')](_0x206f0e,_0x278e0,_0x4c1b67){const _0x3562e0=require(a72_0x5614('0x37'));const _0x1e448b=_0x206f0e['file'][a72_0x5614('0x38')];const _0x2ba322=UPLOAD_PATH+'/'+_0x206f0e[a72_0x5614('0x39')][a72_0x5614('0x3a')]+'.json';const _0x4f1c51=fs_1[a72_0x5614('0x6')]['createReadStream'](_0x1e448b);const _0x25ea33=fs_1[a72_0x5614('0x6')][a72_0x5614('0x3b')](_0x2ba322);const _0x385b78=_0x3562e0[a72_0x5614('0x3c')]();console[a72_0x5614('0xc')](_0x206f0e[a72_0x5614('0x39')]);_0x4f1c51[a72_0x5614('0x22')](_0x385b78)[a72_0x5614('0x22')](_0x25ea33)['on'](a72_0x5614('0x3d'),_0x4481bc=>{if(_0x4481bc)return console[a72_0x5614('0x15')](_0x4481bc);else{const _0x14dfca=fs_1[a72_0x5614('0x6')]['statSync'](_0x1e448b);const _0x2be756=_0x14dfca[a72_0x5614('0x2a')];if(_0x2be756>0x0){fs_1[a72_0x5614('0x6')][a72_0x5614('0x2d')](_0x2ba322,a72_0x5614('0x2e'),function(_0x4481bc,_0x364ff8){if(_0x4481bc){return console[a72_0x5614('0x15')](_0x4481bc);}else{try{const _0x512949=JSON['parse'](_0x364ff8);console[a72_0x5614('0xc')](_0x512949);const _0xfbf67=_0x512949[a72_0x5614('0x3e')][0x0][a72_0x5614('0x3f')];const _0x90ee1f=_0x512949[a72_0x5614('0x3e')][0x0][a72_0x5614('0x40')];const _0x38a10b=moment_1['default'](_0xfbf67+'\x20'+_0x90ee1f+'\x20-05:00','YYYYMMDD\x20HHmmss\x20Z');const _0x2167e8=parseFloat(_0x512949[a72_0x5614('0x3e')][0x0][a72_0x5614('0x41')][a72_0x5614('0x42')](',','.'));const _0x165f3e=parseFloat(_0x512949[a72_0x5614('0x3e')][0x0][a72_0x5614('0x43')]['replace'](',','.'));const _0x5e0e5e=_0x512949[a72_0x5614('0x3e')][0x0][a72_0x5614('0x44')];const _0x447d12=_0x512949[a72_0x5614('0x3e')][0x0]['puerta'][0x0][a72_0x5614('0x45')];const _0x4c1e43=_0x512949[a72_0x5614('0x3e')][0x0][a72_0x5614('0x46')][0x0]['salidas'];console[a72_0x5614('0xc')](_0x2167e8);console[a72_0x5614('0xc')](_0x165f3e);console[a72_0x5614('0xc')](_0x5e0e5e);console[a72_0x5614('0xc')](_0x447d12);console[a72_0x5614('0xc')](_0x4c1e43);console[a72_0x5614('0xc')](_0x38a10b);if(_0x447d12>0x0){sequelize_utils_1[a72_0x5614('0x6')][a72_0x5614('0x19')][a72_0x5614('0x33')]['create']({'amount':_0x447d12,'counted_at':_0x38a10b});}sequelize_utils_1['default'][a72_0x5614('0x19')][a72_0x5614('0x47')][a72_0x5614('0x34')]({'device_id':null,'lat':''+_0x2167e8,'lon':''+_0x165f3e,'tracked_at':_0x38a10b});}catch(_0x52b1a9){return console[a72_0x5614('0x15')](_0x52b1a9);}}});}}});_0x278e0[a72_0x5614('0x26')]({'status':0x1,'data':_0x206f0e[a72_0x5614('0x39')]});}}exports['default']=SyncFilesController;