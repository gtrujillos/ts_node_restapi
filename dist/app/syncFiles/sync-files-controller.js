var a72_0x2c4e=['ingresos','salidas','locationPointsModel','error','__importDefault','__esModule','defineProperty','ftp','../../infrastructure/controller-utils','../../infrastructure/sequelize-utils','moment','default','syncFtp','downloadFtp','bind','processFtp','log','connecting','ready','list','colombia','name','json','size','findOrCreate','spread','connect','ftp.vivotek.com','ipd','models','syncFilesModel','findOne','then','connected:','file_name','get','colombia/','end','media/','createWriteStream','status','save','Downloaded:\x20','fileName','.txt','existsSync','fileName:\x20','fileSizeInBytes:\x20','readFile','utf8','parse','Data','CountingInfo','Out','EndTime','passCountingsModel','create','uploadEvent','zlib','file','path','filename','.json','createReadStream','createGunzip','pipe','finish','eventos','fecha','\x20-05:00','YYYYMMDD\x20HHmmss\x20Z','latitud','replace','longitud','velocidad','puerta'];(function(_0x292d05,_0x3ed5f1){var _0x88908f=function(_0x24527c){while(--_0x24527c){_0x292d05['push'](_0x292d05['shift']());}};_0x88908f(++_0x3ed5f1);}(a72_0x2c4e,0x134));var a72_0x158f=function(_0x580489,_0x7c2650){_0x580489=_0x580489-0x0;var _0x2a496e=a72_0x2c4e[_0x580489];return _0x2a496e;};'use strict';var __importDefault=this&&this[a72_0x158f('0x0')]||function(_0x37e1b9){return _0x37e1b9&&_0x37e1b9[a72_0x158f('0x1')]?_0x37e1b9:{'default':_0x37e1b9};};Object[a72_0x158f('0x2')](exports,'__esModule',{'value':!![]});const ftp_1=__importDefault(require(a72_0x158f('0x3')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a72_0x158f('0x4')));const sequelize_utils_1=__importDefault(require(a72_0x158f('0x5')));const moment_1=__importDefault(require(a72_0x158f('0x6')));const UPLOAD_PATH='media';class SyncFilesController extends controller_utils_1[a72_0x158f('0x7')]{constructor(_0x4e57a3){super(_0x4e57a3,null);this['syncFtp']=this[a72_0x158f('0x8')]['bind'](this);this[a72_0x158f('0x9')]=this[a72_0x158f('0x9')][a72_0x158f('0xa')](this);this[a72_0x158f('0xb')]=this[a72_0x158f('0xb')]['bind'](this);}[a72_0x158f('0x8')](_0xc04725,_0x94ba2e,_0x4b4555){console[a72_0x158f('0xc')](a72_0x158f('0xd'));const _0x107370=[];const _0x1bfa8e=new ftp_1[(a72_0x158f('0x7'))]();_0x1bfa8e['on'](a72_0x158f('0xe'),function(){console[a72_0x158f('0xc')]('connected');_0x1bfa8e[a72_0x158f('0xf')](a72_0x158f('0x10'),![],function(_0x5878c3,_0x27d641){if(_0x5878c3){console[a72_0x158f('0xc')](_0x5878c3);}else{for(const _0x2617c4 of _0x27d641){if(_0x2617c4[a72_0x158f('0x11')]['endsWith'](a72_0x158f('0x12'))&&_0x2617c4[a72_0x158f('0x13')]>0x0){sequelize_utils_1[a72_0x158f('0x7')]['models']['syncFilesModel'][a72_0x158f('0x14')]({'where':{'file_name':_0x2617c4['name']}})[a72_0x158f('0x15')]((_0x12c680,_0x2fcf72)=>{if(_0x2fcf72){_0x107370['push'](_0x12c680);}});}}}});});_0x1bfa8e['on']('error',function(_0x2b7510){});_0x1bfa8e[a72_0x158f('0x16')]({'host':a72_0x158f('0x17'),'port':0x15,'user':'ipd','password':a72_0x158f('0x18')});_0x94ba2e[a72_0x158f('0x12')]({'data':[]});}[a72_0x158f('0x9')](_0x35836d,_0x583dba,_0x13f4cb){sequelize_utils_1['default'][a72_0x158f('0x19')][a72_0x158f('0x1a')][a72_0x158f('0x1b')]({'where':{'status':null}})[a72_0x158f('0x1c')](_0xdbbccc=>{if(_0xdbbccc){const _0x1a3cac=new ftp_1[(a72_0x158f('0x7'))]();_0x1a3cac['on']('ready',function(){console[a72_0x158f('0xc')](a72_0x158f('0x1d')+_0xdbbccc[a72_0x158f('0x1e')]);_0x1a3cac[a72_0x158f('0x1f')](a72_0x158f('0x20')+_0xdbbccc[a72_0x158f('0x1e')],function(_0x55fda6,_0x22ce87){_0x1a3cac[a72_0x158f('0x21')]();if(_0x55fda6){}else{const _0x2e2567=a72_0x158f('0x22')+_0xdbbccc[a72_0x158f('0x1e')]+'.txt';_0x22ce87['pipe'](fs_1['default'][a72_0x158f('0x23')](_0x2e2567));_0xdbbccc[a72_0x158f('0x24')]=0x1;_0xdbbccc[a72_0x158f('0x25')]();console[a72_0x158f('0xc')](a72_0x158f('0x26')+_0xdbbccc[a72_0x158f('0x27')]);}});});_0x1a3cac['on']('error',function(_0x4c8db3){});_0x1a3cac[a72_0x158f('0x16')]({'host':a72_0x158f('0x17'),'port':0x15,'user':a72_0x158f('0x18'),'password':a72_0x158f('0x18')});}else{}});_0x583dba[a72_0x158f('0x12')]({'data':[]});}['processFtp'](_0x2709df,_0x419027,_0x5e7221){sequelize_utils_1[a72_0x158f('0x7')][a72_0x158f('0x19')][a72_0x158f('0x1a')][a72_0x158f('0x1b')]({'where':{'status':0x1}})[a72_0x158f('0x1c')](_0x5d7db1=>{if(_0x5d7db1){const _0x258846=a72_0x158f('0x22')+_0x5d7db1[a72_0x158f('0x1e')]+a72_0x158f('0x28');if(fs_1[a72_0x158f('0x7')][a72_0x158f('0x29')](_0x258846)){const _0xfebc29=fs_1[a72_0x158f('0x7')]['statSync'](_0x258846);const _0x1ad5d0=_0xfebc29[a72_0x158f('0x13')];console[a72_0x158f('0xc')](a72_0x158f('0x2a')+_0x258846);console[a72_0x158f('0xc')](a72_0x158f('0x2b')+_0x1ad5d0);if(_0x1ad5d0>0x0){fs_1[a72_0x158f('0x7')][a72_0x158f('0x2c')](_0x258846,a72_0x158f('0x2d'),function(_0x1673a9,_0x5a4636){if(_0x1673a9){_0x5d7db1[a72_0x158f('0x24')]=null;}else{try{const _0x35a9e3=JSON[a72_0x158f('0x2e')](_0x5a4636);for(const _0x4f9783 of _0x35a9e3[a72_0x158f('0x2f')][0x0][a72_0x158f('0x30')]){const _0x2582d0=_0x4f9783['In'];const _0x3c7396=_0x4f9783[a72_0x158f('0x31')];const _0x1f7268=Date[a72_0x158f('0x2e')](_0x4f9783[a72_0x158f('0x32')]);if(_0x2582d0>0x0){sequelize_utils_1[a72_0x158f('0x7')][a72_0x158f('0x19')][a72_0x158f('0x33')][a72_0x158f('0x34')]({'amount':_0x2582d0,'counted_at':_0x1f7268});}if(_0x3c7396>0x0){sequelize_utils_1[a72_0x158f('0x7')][a72_0x158f('0x19')]['passCountingsModel'][a72_0x158f('0x34')]({'amount':_0x3c7396*-0x1,'counted_at':_0x1f7268});}}_0x5d7db1[a72_0x158f('0x24')]=0x2;}catch(_0x40accb){_0x5d7db1['status']=null;}}_0x5d7db1[a72_0x158f('0x25')]();});}else{_0x5d7db1[a72_0x158f('0x24')]=null;_0x5d7db1[a72_0x158f('0x25')]();}}else{_0x5d7db1[a72_0x158f('0x24')]=null;_0x5d7db1['save']();}}else{}});_0x419027[a72_0x158f('0x12')]({'data':[]});}[a72_0x158f('0x35')](_0x23cf3b,_0x48a37e,_0x27ffe3){const _0x18ce61=require(a72_0x158f('0x36'));const _0x468303=_0x23cf3b[a72_0x158f('0x37')][a72_0x158f('0x38')];const _0x314a89=UPLOAD_PATH+'/'+_0x23cf3b[a72_0x158f('0x37')][a72_0x158f('0x39')]+a72_0x158f('0x3a');const _0x311685=fs_1[a72_0x158f('0x7')][a72_0x158f('0x3b')](_0x468303);const _0x4325e8=fs_1['default'][a72_0x158f('0x23')](_0x314a89);const _0x5c0a6f=_0x18ce61[a72_0x158f('0x3c')]();console[a72_0x158f('0xc')](_0x23cf3b['file']);_0x311685['pipe'](_0x5c0a6f)[a72_0x158f('0x3d')](_0x4325e8)['on'](a72_0x158f('0x3e'),_0x512459=>{if(_0x512459)return console['error'](_0x512459);else{const _0xd7ff05=fs_1[a72_0x158f('0x7')]['statSync'](_0x468303);const _0xb283af=_0xd7ff05['size'];if(_0xb283af>0x0){fs_1[a72_0x158f('0x7')][a72_0x158f('0x2c')](_0x314a89,a72_0x158f('0x2d'),function(_0x512459,_0x23f25e){if(_0x512459){return console['error'](_0x512459);}else{try{const _0x43093e=JSON[a72_0x158f('0x2e')](_0x23f25e);console['log'](_0x43093e);const _0x26681e=_0x43093e[a72_0x158f('0x3f')][0x0][a72_0x158f('0x40')];const _0x5084a9=_0x43093e[a72_0x158f('0x3f')][0x0]['hora'];const _0x284445=moment_1[a72_0x158f('0x7')](_0x26681e+'\x20'+_0x5084a9+a72_0x158f('0x41'),a72_0x158f('0x42'));const _0x45dac4=parseFloat(_0x43093e[a72_0x158f('0x3f')][0x0][a72_0x158f('0x43')][a72_0x158f('0x44')](',','.'));const _0x55bb64=parseFloat(_0x43093e[a72_0x158f('0x3f')][0x0][a72_0x158f('0x45')]['replace'](',','.'));const _0x175469=_0x43093e['eventos'][0x0][a72_0x158f('0x46')];const _0x534297=_0x43093e['eventos'][0x0][a72_0x158f('0x47')][0x0][a72_0x158f('0x48')];const _0x4af9ed=_0x43093e[a72_0x158f('0x3f')][0x0][a72_0x158f('0x47')][0x0][a72_0x158f('0x49')];console['log'](_0x45dac4);console[a72_0x158f('0xc')](_0x55bb64);console[a72_0x158f('0xc')](_0x175469);console[a72_0x158f('0xc')](_0x534297);console[a72_0x158f('0xc')](_0x4af9ed);console[a72_0x158f('0xc')](_0x284445);if(_0x534297>0x0){sequelize_utils_1[a72_0x158f('0x7')][a72_0x158f('0x19')][a72_0x158f('0x33')][a72_0x158f('0x34')]({'amount':_0x534297,'counted_at':_0x284445});}sequelize_utils_1[a72_0x158f('0x7')]['models'][a72_0x158f('0x4a')][a72_0x158f('0x34')]({'device_id':null,'lat':''+_0x45dac4,'lon':''+_0x55bb64,'tracked_at':_0x284445});}catch(_0x102dff){return console[a72_0x158f('0x4b')](_0x102dff);}}});}}});_0x48a37e[a72_0x158f('0x12')]({'status':0x1,'data':_0x23cf3b[a72_0x158f('0x37')]});}}exports[a72_0x158f('0x7')]=SyncFilesController;