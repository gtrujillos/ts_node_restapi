var a73_0x6629=['downloadFtp','processFtp','log','connecting','ready','connected','list','name','endsWith','json','size','syncFilesModel','findOrCreate','ftp.vivotek.com','ipd','models','findOne','then','connected:','file_name','media/','.txt','pipe','createWriteStream','status','Downloaded:\x20','error','connect','existsSync','statSync','fileName:\x20','readFile','utf8','parse','Data','CountingInfo','Out','EndTime','create','passCountingsModel','save','uploadEvent','file','filename','.json','createReadStream','fecha','eventos','hora','\x20-05:00','latitud','velocidad','puerta','salidas','locationPointsModel','defineProperty','__esModule','ftp','../../infrastructure/controller-utils','../../infrastructure/sequelize-utils','moment','media','default','syncFtp','bind'];(function(_0x57d953,_0x393aa7){var _0x58c468=function(_0xb24d3){while(--_0xb24d3){_0x57d953['push'](_0x57d953['shift']());}};_0x58c468(++_0x393aa7);}(a73_0x6629,0x78));var a73_0xcb20=function(_0xe22b99,_0x2406c5){_0xe22b99=_0xe22b99-0x0;var _0x21d53d=a73_0x6629[_0xe22b99];return _0x21d53d;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x5f6937){return _0x5f6937&&_0x5f6937['__esModule']?_0x5f6937:{'default':_0x5f6937};};Object[a73_0xcb20('0x0')](exports,a73_0xcb20('0x1'),{'value':!![]});const ftp_1=__importDefault(require(a73_0xcb20('0x2')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a73_0xcb20('0x3')));const sequelize_utils_1=__importDefault(require(a73_0xcb20('0x4')));const moment_1=__importDefault(require(a73_0xcb20('0x5')));const UPLOAD_PATH=a73_0xcb20('0x6');class SyncFilesController extends controller_utils_1[a73_0xcb20('0x7')]{constructor(_0x4e5bf5){super(_0x4e5bf5,null);this[a73_0xcb20('0x8')]=this[a73_0xcb20('0x8')][a73_0xcb20('0x9')](this);this[a73_0xcb20('0xa')]=this[a73_0xcb20('0xa')][a73_0xcb20('0x9')](this);this[a73_0xcb20('0xb')]=this['processFtp']['bind'](this);}[a73_0xcb20('0x8')](_0x5de1a8,_0x599b3d,_0x1475eb){console[a73_0xcb20('0xc')](a73_0xcb20('0xd'));const _0x5355b1=[];const _0x432693=new ftp_1[(a73_0xcb20('0x7'))]();_0x432693['on'](a73_0xcb20('0xe'),function(){console['log'](a73_0xcb20('0xf'));_0x432693[a73_0xcb20('0x10')]('colombia',![],function(_0x3fbff2,_0x477a4f){if(_0x3fbff2){console[a73_0xcb20('0xc')](_0x3fbff2);}else{for(const _0x368f46 of _0x477a4f){if(_0x368f46[a73_0xcb20('0x11')][a73_0xcb20('0x12')](a73_0xcb20('0x13'))&&_0x368f46[a73_0xcb20('0x14')]>0x0){sequelize_utils_1['default']['models'][a73_0xcb20('0x15')][a73_0xcb20('0x16')]({'where':{'file_name':_0x368f46[a73_0xcb20('0x11')]}})['spread']((_0x51b305,_0x1e05ba)=>{if(_0x1e05ba){_0x5355b1['push'](_0x51b305);}});}}}});});_0x432693['on']('error',function(_0xfd7c9){});_0x432693['connect']({'host':a73_0xcb20('0x17'),'port':0x15,'user':a73_0xcb20('0x18'),'password':'ipd'});_0x599b3d[a73_0xcb20('0x13')]({'data':[]});}[a73_0xcb20('0xa')](_0x830909,_0x5dc580,_0x221be3){sequelize_utils_1[a73_0xcb20('0x7')][a73_0xcb20('0x19')][a73_0xcb20('0x15')][a73_0xcb20('0x1a')]({'where':{'status':null}})[a73_0xcb20('0x1b')](_0x1e99c9=>{if(_0x1e99c9){const _0x1fd2d9=new ftp_1['default']();_0x1fd2d9['on'](a73_0xcb20('0xe'),function(){console[a73_0xcb20('0xc')](a73_0xcb20('0x1c')+_0x1e99c9[a73_0xcb20('0x1d')]);_0x1fd2d9['get']('colombia/'+_0x1e99c9[a73_0xcb20('0x1d')],function(_0x29ba0b,_0x282469){_0x1fd2d9['end']();if(_0x29ba0b){}else{const _0x3d90fc=a73_0xcb20('0x1e')+_0x1e99c9['file_name']+a73_0xcb20('0x1f');_0x282469[a73_0xcb20('0x20')](fs_1[a73_0xcb20('0x7')][a73_0xcb20('0x21')](_0x3d90fc));_0x1e99c9[a73_0xcb20('0x22')]=0x1;_0x1e99c9['save']();console[a73_0xcb20('0xc')](a73_0xcb20('0x23')+_0x1e99c9['fileName']);}});});_0x1fd2d9['on'](a73_0xcb20('0x24'),function(_0xb64d71){});_0x1fd2d9[a73_0xcb20('0x25')]({'host':a73_0xcb20('0x17'),'port':0x15,'user':a73_0xcb20('0x18'),'password':a73_0xcb20('0x18')});}else{}});_0x5dc580['json']({'data':[]});}[a73_0xcb20('0xb')](_0x1d7720,_0x400c6d,_0x17107b){sequelize_utils_1[a73_0xcb20('0x7')][a73_0xcb20('0x19')]['syncFilesModel'][a73_0xcb20('0x1a')]({'where':{'status':0x1}})[a73_0xcb20('0x1b')](_0x5afa59=>{if(_0x5afa59){const _0x3a87ed=a73_0xcb20('0x1e')+_0x5afa59[a73_0xcb20('0x1d')]+a73_0xcb20('0x1f');if(fs_1['default'][a73_0xcb20('0x26')](_0x3a87ed)){const _0x3483a1=fs_1['default'][a73_0xcb20('0x27')](_0x3a87ed);const _0x34d8f8=_0x3483a1['size'];console['log'](a73_0xcb20('0x28')+_0x3a87ed);console[a73_0xcb20('0xc')]('fileSizeInBytes:\x20'+_0x34d8f8);if(_0x34d8f8>0x0){fs_1['default'][a73_0xcb20('0x29')](_0x3a87ed,a73_0xcb20('0x2a'),function(_0x3d1017,_0x4f800c){if(_0x3d1017){_0x5afa59[a73_0xcb20('0x22')]=null;}else{try{const _0x4784a5=JSON[a73_0xcb20('0x2b')](_0x4f800c);for(const _0x360a99 of _0x4784a5[a73_0xcb20('0x2c')][0x0][a73_0xcb20('0x2d')]){const _0x39e3cc=_0x360a99['In'];const _0x349389=_0x360a99[a73_0xcb20('0x2e')];const _0x565d86=Date[a73_0xcb20('0x2b')](_0x360a99[a73_0xcb20('0x2f')]);if(_0x39e3cc>0x0){sequelize_utils_1['default'][a73_0xcb20('0x19')]['passCountingsModel'][a73_0xcb20('0x30')]({'amount':_0x39e3cc,'counted_at':_0x565d86});}if(_0x349389>0x0){sequelize_utils_1['default'][a73_0xcb20('0x19')][a73_0xcb20('0x31')]['create']({'amount':_0x349389*-0x1,'counted_at':_0x565d86});}}_0x5afa59[a73_0xcb20('0x22')]=0x2;}catch(_0x57a0f3){_0x5afa59[a73_0xcb20('0x22')]=null;}}_0x5afa59['save']();});}else{_0x5afa59[a73_0xcb20('0x22')]=null;_0x5afa59[a73_0xcb20('0x32')]();}}else{_0x5afa59['status']=null;_0x5afa59[a73_0xcb20('0x32')]();}}else{}});_0x400c6d[a73_0xcb20('0x13')]({'data':[]});}[a73_0xcb20('0x33')](_0x5a178c,_0x2ab1ee,_0xd60149){const _0x1c34f7=require('zlib');const _0x59e94a=_0x5a178c['file']['path'];const _0x539d61=UPLOAD_PATH+'/'+_0x5a178c[a73_0xcb20('0x34')][a73_0xcb20('0x35')]+a73_0xcb20('0x36');const _0x183ea6=fs_1['default'][a73_0xcb20('0x37')](_0x59e94a);const _0x15a5dc=fs_1[a73_0xcb20('0x7')][a73_0xcb20('0x21')](_0x539d61);const _0x1ddcbf=_0x1c34f7['createGunzip']();console[a73_0xcb20('0xc')](_0x5a178c[a73_0xcb20('0x34')]);_0x183ea6['pipe'](_0x1ddcbf)[a73_0xcb20('0x20')](_0x15a5dc)['on']('finish',_0x3355fb=>{if(_0x3355fb)return console[a73_0xcb20('0x24')](_0x3355fb);else{const _0x42dec8=fs_1[a73_0xcb20('0x7')]['statSync'](_0x59e94a);const _0x38f268=_0x42dec8['size'];if(_0x38f268>0x0){fs_1[a73_0xcb20('0x7')][a73_0xcb20('0x29')](_0x539d61,a73_0xcb20('0x2a'),function(_0x3355fb,_0x5526f3){if(_0x3355fb){return console[a73_0xcb20('0x24')](_0x3355fb);}else{try{const _0x4a4355=JSON[a73_0xcb20('0x2b')](_0x5526f3);console['log'](_0x4a4355);const _0x5829bf=_0x4a4355['eventos'][0x0][a73_0xcb20('0x38')];const _0x3e2010=_0x4a4355[a73_0xcb20('0x39')][0x0][a73_0xcb20('0x3a')];const _0x4486df=moment_1['default'](_0x5829bf+'\x20'+_0x3e2010+a73_0xcb20('0x3b'),'YYYYMMDD\x20HHmmss\x20Z');const _0x2119a1=parseFloat(_0x4a4355[a73_0xcb20('0x39')][0x0][a73_0xcb20('0x3c')]['replace'](',','.'));const _0x222f2b=parseFloat(_0x4a4355[a73_0xcb20('0x39')][0x0]['longitud']['replace'](',','.'));const _0x21e864=_0x4a4355[a73_0xcb20('0x39')][0x0][a73_0xcb20('0x3d')];const _0x2925b6=_0x4a4355[a73_0xcb20('0x39')][0x0][a73_0xcb20('0x3e')][0x0]['ingresos'];const _0x1a5c79=_0x4a4355[a73_0xcb20('0x39')][0x0][a73_0xcb20('0x3e')][0x0][a73_0xcb20('0x3f')];console[a73_0xcb20('0xc')](_0x2119a1);console[a73_0xcb20('0xc')](_0x222f2b);console['log'](_0x21e864);console[a73_0xcb20('0xc')](_0x2925b6);console['log'](_0x1a5c79);console[a73_0xcb20('0xc')](_0x4486df);if(_0x2925b6>0x0){sequelize_utils_1[a73_0xcb20('0x7')][a73_0xcb20('0x19')]['passCountingsModel'][a73_0xcb20('0x30')]({'amount':_0x2925b6,'counted_at':_0x4486df});}sequelize_utils_1['default'][a73_0xcb20('0x19')][a73_0xcb20('0x40')][a73_0xcb20('0x30')]({'device_id':null,'lat':''+_0x2119a1,'lon':''+_0x222f2b,'tracked_at':_0x4486df});}catch(_0x4de16e){return console['error'](_0x4de16e);}}});}}});_0x2ab1ee[a73_0xcb20('0x13')]({'status':0x1,'data':_0x5a178c['file']});}}exports[a73_0xcb20('0x7')]=SyncFilesController;