var a162_0x3e75=['eventos','fecha','hora','YYYYMMDD\x20HHmmss\x20Z','replace','velocidad','ingresos','puerta','salidas','locationPointsModel','__importDefault','__esModule','defineProperty','ftp','../../infrastructure/controller-utils','../../infrastructure/sequelize-utils','moment','media','default','syncFtp','bind','downloadFtp','processFtp','log','connecting','ready','connected','colombia','name','endsWith','json','size','spread','error','connect','ftp.vivotek.com','ipd','models','syncFilesModel','findOne','then','connected:','file_name','get','end','media/','pipe','createWriteStream','save','Downloaded:\x20','fileName','.txt','statSync','fileName:\x20','utf8','status','Data','CountingInfo','Out','parse','EndTime','passCountingsModel','create','uploadEvent','file','path','filename','.json','createReadStream','createGunzip','finish','readFile'];(function(_0x4226ed,_0x427bf1){var _0x30729f=function(_0x3be47f){while(--_0x3be47f){_0x4226ed['push'](_0x4226ed['shift']());}};_0x30729f(++_0x427bf1);}(a162_0x3e75,0x1ba));var a162_0x84ab=function(_0x476f10,_0x2ec130){_0x476f10=_0x476f10-0x0;var _0x178ce7=a162_0x3e75[_0x476f10];return _0x178ce7;};'use strict';var __importDefault=this&&this[a162_0x84ab('0x0')]||function(_0x34428f){return _0x34428f&&_0x34428f[a162_0x84ab('0x1')]?_0x34428f:{'default':_0x34428f};};Object[a162_0x84ab('0x2')](exports,a162_0x84ab('0x1'),{'value':!![]});const ftp_1=__importDefault(require(a162_0x84ab('0x3')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a162_0x84ab('0x4')));const sequelize_utils_1=__importDefault(require(a162_0x84ab('0x5')));const moment_1=__importDefault(require(a162_0x84ab('0x6')));const UPLOAD_PATH=a162_0x84ab('0x7');class SyncFilesController extends controller_utils_1[a162_0x84ab('0x8')]{constructor(_0xdce6bd){super(_0xdce6bd,null);this['syncFtp']=this[a162_0x84ab('0x9')][a162_0x84ab('0xa')](this);this['downloadFtp']=this[a162_0x84ab('0xb')][a162_0x84ab('0xa')](this);this[a162_0x84ab('0xc')]=this[a162_0x84ab('0xc')][a162_0x84ab('0xa')](this);}[a162_0x84ab('0x9')](_0x48166c,_0x326b12,_0x38b0b9){console[a162_0x84ab('0xd')](a162_0x84ab('0xe'));const _0x536d7b=[];const _0x5a19be=new ftp_1[(a162_0x84ab('0x8'))]();_0x5a19be['on'](a162_0x84ab('0xf'),function(){console[a162_0x84ab('0xd')](a162_0x84ab('0x10'));_0x5a19be['list'](a162_0x84ab('0x11'),![],function(_0x5095d8,_0x512274){if(_0x5095d8){console[a162_0x84ab('0xd')](_0x5095d8);}else{for(const _0x161cee of _0x512274){if(_0x161cee[a162_0x84ab('0x12')][a162_0x84ab('0x13')](a162_0x84ab('0x14'))&&_0x161cee[a162_0x84ab('0x15')]>0x0){sequelize_utils_1[a162_0x84ab('0x8')]['models']['syncFilesModel']['findOrCreate']({'where':{'file_name':_0x161cee[a162_0x84ab('0x12')]}})[a162_0x84ab('0x16')]((_0x37b8d6,_0x3a48c0)=>{if(_0x3a48c0){_0x536d7b['push'](_0x37b8d6);}});}}}});});_0x5a19be['on'](a162_0x84ab('0x17'),function(_0x396121){});_0x5a19be[a162_0x84ab('0x18')]({'host':a162_0x84ab('0x19'),'port':0x15,'user':'ipd','password':a162_0x84ab('0x1a')});_0x326b12[a162_0x84ab('0x14')]({'data':[]});}[a162_0x84ab('0xb')](_0x5d340f,_0xe92681,_0x4ccad3){sequelize_utils_1[a162_0x84ab('0x8')][a162_0x84ab('0x1b')][a162_0x84ab('0x1c')][a162_0x84ab('0x1d')]({'where':{'status':null}})[a162_0x84ab('0x1e')](_0x48e15d=>{if(_0x48e15d){const _0x301724=new ftp_1[(a162_0x84ab('0x8'))]();_0x301724['on']('ready',function(){console['log'](a162_0x84ab('0x1f')+_0x48e15d[a162_0x84ab('0x20')]);_0x301724[a162_0x84ab('0x21')]('colombia/'+_0x48e15d['file_name'],function(_0x3f7392,_0x3a08c1){_0x301724[a162_0x84ab('0x22')]();if(_0x3f7392){}else{const _0x322425=a162_0x84ab('0x23')+_0x48e15d[a162_0x84ab('0x20')]+'.txt';_0x3a08c1[a162_0x84ab('0x24')](fs_1[a162_0x84ab('0x8')][a162_0x84ab('0x25')](_0x322425));_0x48e15d['status']=0x1;_0x48e15d[a162_0x84ab('0x26')]();console[a162_0x84ab('0xd')](a162_0x84ab('0x27')+_0x48e15d[a162_0x84ab('0x28')]);}});});_0x301724['on'](a162_0x84ab('0x17'),function(_0x3883b7){});_0x301724[a162_0x84ab('0x18')]({'host':'ftp.vivotek.com','port':0x15,'user':'ipd','password':a162_0x84ab('0x1a')});}else{}});_0xe92681[a162_0x84ab('0x14')]({'data':[]});}[a162_0x84ab('0xc')](_0x59910d,_0x4daa43,_0x5f545b){sequelize_utils_1[a162_0x84ab('0x8')][a162_0x84ab('0x1b')][a162_0x84ab('0x1c')][a162_0x84ab('0x1d')]({'where':{'status':0x1}})[a162_0x84ab('0x1e')](_0xee3e85=>{if(_0xee3e85){const _0x50472d=a162_0x84ab('0x23')+_0xee3e85[a162_0x84ab('0x20')]+a162_0x84ab('0x29');if(fs_1[a162_0x84ab('0x8')]['existsSync'](_0x50472d)){const _0x3ceeb8=fs_1['default'][a162_0x84ab('0x2a')](_0x50472d);const _0x5d0275=_0x3ceeb8[a162_0x84ab('0x15')];console[a162_0x84ab('0xd')](a162_0x84ab('0x2b')+_0x50472d);console['log']('fileSizeInBytes:\x20'+_0x5d0275);if(_0x5d0275>0x0){fs_1[a162_0x84ab('0x8')]['readFile'](_0x50472d,a162_0x84ab('0x2c'),function(_0x41d168,_0x3dd238){if(_0x41d168){_0xee3e85[a162_0x84ab('0x2d')]=null;}else{try{const _0x428125=JSON['parse'](_0x3dd238);for(const _0x2a121b of _0x428125[a162_0x84ab('0x2e')][0x0][a162_0x84ab('0x2f')]){const _0xccd126=_0x2a121b['In'];const _0x546251=_0x2a121b[a162_0x84ab('0x30')];const _0xfb88bc=Date[a162_0x84ab('0x31')](_0x2a121b[a162_0x84ab('0x32')]);if(_0xccd126>0x0){sequelize_utils_1[a162_0x84ab('0x8')][a162_0x84ab('0x1b')][a162_0x84ab('0x33')][a162_0x84ab('0x34')]({'amount':_0xccd126,'counted_at':_0xfb88bc});}if(_0x546251>0x0){sequelize_utils_1[a162_0x84ab('0x8')][a162_0x84ab('0x1b')][a162_0x84ab('0x33')][a162_0x84ab('0x34')]({'amount':_0x546251*-0x1,'counted_at':_0xfb88bc});}}_0xee3e85[a162_0x84ab('0x2d')]=0x2;}catch(_0x33f785){_0xee3e85[a162_0x84ab('0x2d')]=null;}}_0xee3e85[a162_0x84ab('0x26')]();});}else{_0xee3e85[a162_0x84ab('0x2d')]=null;_0xee3e85[a162_0x84ab('0x26')]();}}else{_0xee3e85[a162_0x84ab('0x2d')]=null;_0xee3e85[a162_0x84ab('0x26')]();}}else{}});_0x4daa43[a162_0x84ab('0x14')]({'data':[]});}[a162_0x84ab('0x35')](_0x30c05f,_0x9bf462,_0x2b4ee8){const _0x3a6319=require('zlib');const _0x2f760e=_0x30c05f[a162_0x84ab('0x36')][a162_0x84ab('0x37')];const _0xdb8db8=UPLOAD_PATH+'/'+_0x30c05f[a162_0x84ab('0x36')][a162_0x84ab('0x38')]+a162_0x84ab('0x39');const _0x40b4e1=fs_1[a162_0x84ab('0x8')][a162_0x84ab('0x3a')](_0x2f760e);const _0x5c7546=fs_1[a162_0x84ab('0x8')][a162_0x84ab('0x25')](_0xdb8db8);const _0x25cd63=_0x3a6319[a162_0x84ab('0x3b')]();console[a162_0x84ab('0xd')](_0x30c05f[a162_0x84ab('0x36')]);_0x40b4e1[a162_0x84ab('0x24')](_0x25cd63)['pipe'](_0x5c7546)['on'](a162_0x84ab('0x3c'),_0x542232=>{if(_0x542232)return console[a162_0x84ab('0x17')](_0x542232);else{const _0x3e23da=fs_1[a162_0x84ab('0x8')][a162_0x84ab('0x2a')](_0x2f760e);const _0x3d3cb0=_0x3e23da['size'];if(_0x3d3cb0>0x0){fs_1[a162_0x84ab('0x8')][a162_0x84ab('0x3d')](_0xdb8db8,a162_0x84ab('0x2c'),function(_0x542232,_0x27be5e){if(_0x542232){return console[a162_0x84ab('0x17')](_0x542232);}else{try{const _0x40b8c9=JSON['parse'](_0x27be5e);console[a162_0x84ab('0xd')](_0x40b8c9);const _0x107a88=_0x40b8c9[a162_0x84ab('0x3e')][0x0][a162_0x84ab('0x3f')];const _0xe9b9d3=_0x40b8c9[a162_0x84ab('0x3e')][0x0][a162_0x84ab('0x40')];const _0x5454b2=moment_1[a162_0x84ab('0x8')](_0x107a88+'\x20'+_0xe9b9d3+'\x20-05:00',a162_0x84ab('0x41'));const _0x1511ef=parseFloat(_0x40b8c9['eventos'][0x0]['latitud'][a162_0x84ab('0x42')](',','.'));const _0xc13a0d=parseFloat(_0x40b8c9[a162_0x84ab('0x3e')][0x0]['longitud'][a162_0x84ab('0x42')](',','.'));const _0x55276e=_0x40b8c9[a162_0x84ab('0x3e')][0x0][a162_0x84ab('0x43')];const _0x26043f=_0x40b8c9[a162_0x84ab('0x3e')][0x0]['puerta'][0x0][a162_0x84ab('0x44')];const _0x196b84=_0x40b8c9['eventos'][0x0][a162_0x84ab('0x45')][0x0][a162_0x84ab('0x46')];console['log'](_0x1511ef);console[a162_0x84ab('0xd')](_0xc13a0d);console[a162_0x84ab('0xd')](_0x55276e);console[a162_0x84ab('0xd')](_0x26043f);console[a162_0x84ab('0xd')](_0x196b84);console[a162_0x84ab('0xd')](_0x5454b2);if(_0x26043f>0x0){sequelize_utils_1['default'][a162_0x84ab('0x1b')]['passCountingsModel'][a162_0x84ab('0x34')]({'amount':_0x26043f,'counted_at':_0x5454b2});}sequelize_utils_1['default']['models'][a162_0x84ab('0x47')][a162_0x84ab('0x34')]({'device_id':null,'lat':''+_0x1511ef,'lon':''+_0xc13a0d,'tracked_at':_0x5454b2});}catch(_0x2bcb77){return console['error'](_0x2bcb77);}}});}}});_0x9bf462[a162_0x84ab('0x14')]({'status':0x1,'data':_0x30c05f[a162_0x84ab('0x36')]});}}exports[a162_0x84ab('0x8')]=SyncFilesController;