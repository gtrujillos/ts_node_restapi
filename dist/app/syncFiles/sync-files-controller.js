var a73_0x364c=['__importDefault','__esModule','defineProperty','ftp','../../infrastructure/controller-utils','media','default','syncFtp','bind','downloadFtp','processFtp','log','ready','connected','list','colombia','name','endsWith','json','models','syncFilesModel','findOrCreate','push','error','ftp.vivotek.com','ipd','findOne','then','connected:','file_name','get','end','.txt','pipe','createWriteStream','Downloaded:\x20','connect','media/','existsSync','statSync','fileName:\x20','fileSizeInBytes:\x20','readFile','utf8','status','Data','CountingInfo','Out','parse','EndTime','passCountingsModel','create','save','uploadEvent','zlib','path','filename','createReadStream','createGunzip','finish','size','eventos','hora','YYYYMMDD\x20HHmmss\x20Z','latitud','longitud','puerta','ingresos','salidas','file'];(function(_0x20d61c,_0x2edccf){var _0x33721a=function(_0xe85745){while(--_0xe85745){_0x20d61c['push'](_0x20d61c['shift']());}};_0x33721a(++_0x2edccf);}(a73_0x364c,0x15e));var a73_0x4ec2=function(_0x5eba3f,_0x4d9bef){_0x5eba3f=_0x5eba3f-0x0;var _0x949ea7=a73_0x364c[_0x5eba3f];return _0x949ea7;};'use strict';var __importDefault=this&&this[a73_0x4ec2('0x0')]||function(_0x1fea00){return _0x1fea00&&_0x1fea00[a73_0x4ec2('0x1')]?_0x1fea00:{'default':_0x1fea00};};Object[a73_0x4ec2('0x2')](exports,a73_0x4ec2('0x1'),{'value':!![]});const ftp_1=__importDefault(require(a73_0x4ec2('0x3')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a73_0x4ec2('0x4')));const sequelize_utils_1=__importDefault(require('../../infrastructure/sequelize-utils'));const moment_1=__importDefault(require('moment'));const UPLOAD_PATH=a73_0x4ec2('0x5');class SyncFilesController extends controller_utils_1[a73_0x4ec2('0x6')]{constructor(_0x32cd17){super(_0x32cd17,null);this[a73_0x4ec2('0x7')]=this['syncFtp'][a73_0x4ec2('0x8')](this);this[a73_0x4ec2('0x9')]=this[a73_0x4ec2('0x9')][a73_0x4ec2('0x8')](this);this[a73_0x4ec2('0xa')]=this[a73_0x4ec2('0xa')][a73_0x4ec2('0x8')](this);}[a73_0x4ec2('0x7')](_0x3b9a7c,_0x278e35,_0x5515d0){console[a73_0x4ec2('0xb')]('connecting');const _0x352847=[];const _0x22622b=new ftp_1['default']();_0x22622b['on'](a73_0x4ec2('0xc'),function(){console[a73_0x4ec2('0xb')](a73_0x4ec2('0xd'));_0x22622b[a73_0x4ec2('0xe')](a73_0x4ec2('0xf'),![],function(_0x23654e,_0x2e94b0){if(_0x23654e){console[a73_0x4ec2('0xb')](_0x23654e);}else{for(const _0x218029 of _0x2e94b0){if(_0x218029[a73_0x4ec2('0x10')][a73_0x4ec2('0x11')](a73_0x4ec2('0x12'))&&_0x218029['size']>0x0){sequelize_utils_1[a73_0x4ec2('0x6')][a73_0x4ec2('0x13')][a73_0x4ec2('0x14')][a73_0x4ec2('0x15')]({'where':{'file_name':_0x218029[a73_0x4ec2('0x10')]}})['spread']((_0x278af0,_0x2576f7)=>{if(_0x2576f7){_0x352847[a73_0x4ec2('0x16')](_0x278af0);}});}}}});});_0x22622b['on'](a73_0x4ec2('0x17'),function(_0x27f7d2){});_0x22622b['connect']({'host':a73_0x4ec2('0x18'),'port':0x15,'user':a73_0x4ec2('0x19'),'password':a73_0x4ec2('0x19')});_0x278e35[a73_0x4ec2('0x12')]({'data':[]});}[a73_0x4ec2('0x9')](_0x268441,_0x35c576,_0x224f67){sequelize_utils_1['default'][a73_0x4ec2('0x13')][a73_0x4ec2('0x14')][a73_0x4ec2('0x1a')]({'where':{'status':null}})[a73_0x4ec2('0x1b')](_0x52d690=>{if(_0x52d690){const _0x1e4229=new ftp_1[(a73_0x4ec2('0x6'))]();_0x1e4229['on'](a73_0x4ec2('0xc'),function(){console[a73_0x4ec2('0xb')](a73_0x4ec2('0x1c')+_0x52d690[a73_0x4ec2('0x1d')]);_0x1e4229[a73_0x4ec2('0x1e')]('colombia/'+_0x52d690[a73_0x4ec2('0x1d')],function(_0x58bbdb,_0x5e8305){_0x1e4229[a73_0x4ec2('0x1f')]();if(_0x58bbdb){}else{const _0x36305b='media/'+_0x52d690['file_name']+a73_0x4ec2('0x20');_0x5e8305[a73_0x4ec2('0x21')](fs_1[a73_0x4ec2('0x6')][a73_0x4ec2('0x22')](_0x36305b));_0x52d690['status']=0x1;_0x52d690['save']();console[a73_0x4ec2('0xb')](a73_0x4ec2('0x23')+_0x52d690['fileName']);}});});_0x1e4229['on'](a73_0x4ec2('0x17'),function(_0x16cfb9){});_0x1e4229[a73_0x4ec2('0x24')]({'host':a73_0x4ec2('0x18'),'port':0x15,'user':'ipd','password':a73_0x4ec2('0x19')});}else{}});_0x35c576[a73_0x4ec2('0x12')]({'data':[]});}[a73_0x4ec2('0xa')](_0x187e1d,_0x3f7d8a,_0x2aad76){sequelize_utils_1['default']['models']['syncFilesModel'][a73_0x4ec2('0x1a')]({'where':{'status':0x1}})[a73_0x4ec2('0x1b')](_0x3cd53a=>{if(_0x3cd53a){const _0x111582=a73_0x4ec2('0x25')+_0x3cd53a[a73_0x4ec2('0x1d')]+a73_0x4ec2('0x20');if(fs_1[a73_0x4ec2('0x6')][a73_0x4ec2('0x26')](_0x111582)){const _0x57baa8=fs_1['default'][a73_0x4ec2('0x27')](_0x111582);const _0x3cef6a=_0x57baa8['size'];console['log'](a73_0x4ec2('0x28')+_0x111582);console[a73_0x4ec2('0xb')](a73_0x4ec2('0x29')+_0x3cef6a);if(_0x3cef6a>0x0){fs_1[a73_0x4ec2('0x6')][a73_0x4ec2('0x2a')](_0x111582,a73_0x4ec2('0x2b'),function(_0x254fd2,_0x46615b){if(_0x254fd2){_0x3cd53a[a73_0x4ec2('0x2c')]=null;}else{try{const _0x5b5aff=JSON['parse'](_0x46615b);for(const _0x2e71db of _0x5b5aff[a73_0x4ec2('0x2d')][0x0][a73_0x4ec2('0x2e')]){const _0x47a775=_0x2e71db['In'];const _0x368c46=_0x2e71db[a73_0x4ec2('0x2f')];const _0xa5cef2=Date[a73_0x4ec2('0x30')](_0x2e71db[a73_0x4ec2('0x31')]);if(_0x47a775>0x0){sequelize_utils_1[a73_0x4ec2('0x6')][a73_0x4ec2('0x13')][a73_0x4ec2('0x32')]['create']({'amount':_0x47a775,'counted_at':_0xa5cef2});}if(_0x368c46>0x0){sequelize_utils_1[a73_0x4ec2('0x6')]['models'][a73_0x4ec2('0x32')][a73_0x4ec2('0x33')]({'amount':_0x368c46*-0x1,'counted_at':_0xa5cef2});}}_0x3cd53a[a73_0x4ec2('0x2c')]=0x2;}catch(_0x2757a0){_0x3cd53a[a73_0x4ec2('0x2c')]=null;}}_0x3cd53a[a73_0x4ec2('0x34')]();});}else{_0x3cd53a[a73_0x4ec2('0x2c')]=null;_0x3cd53a[a73_0x4ec2('0x34')]();}}else{_0x3cd53a[a73_0x4ec2('0x2c')]=null;_0x3cd53a[a73_0x4ec2('0x34')]();}}else{}});_0x3f7d8a[a73_0x4ec2('0x12')]({'data':[]});}[a73_0x4ec2('0x35')](_0x29dbce,_0x3e9b8c,_0x52023b){const _0x43ad83=require(a73_0x4ec2('0x36'));const _0x27d2eb=_0x29dbce['file'][a73_0x4ec2('0x37')];const _0x4f14c6=UPLOAD_PATH+'/'+_0x29dbce['file'][a73_0x4ec2('0x38')]+'.json';const _0x527502=fs_1[a73_0x4ec2('0x6')][a73_0x4ec2('0x39')](_0x27d2eb);const _0xfefb16=fs_1['default'][a73_0x4ec2('0x22')](_0x4f14c6);const _0x1f8eb4=_0x43ad83[a73_0x4ec2('0x3a')]();console[a73_0x4ec2('0xb')](_0x29dbce['file']);_0x527502[a73_0x4ec2('0x21')](_0x1f8eb4)[a73_0x4ec2('0x21')](_0xfefb16)['on'](a73_0x4ec2('0x3b'),_0x33fb58=>{if(_0x33fb58)return console[a73_0x4ec2('0x17')](_0x33fb58);else{const _0x42268e=fs_1[a73_0x4ec2('0x6')][a73_0x4ec2('0x27')](_0x27d2eb);const _0x6e0200=_0x42268e[a73_0x4ec2('0x3c')];if(_0x6e0200>0x0){fs_1[a73_0x4ec2('0x6')][a73_0x4ec2('0x2a')](_0x4f14c6,a73_0x4ec2('0x2b'),function(_0x33fb58,_0x1a5aab){if(_0x33fb58){return console[a73_0x4ec2('0x17')](_0x33fb58);}else{try{const _0x366bcd=JSON['parse'](_0x1a5aab);console['log'](_0x366bcd);const _0x4c581b=_0x366bcd[a73_0x4ec2('0x3d')][0x0]['fecha'];const _0x494355=_0x366bcd[a73_0x4ec2('0x3d')][0x0][a73_0x4ec2('0x3e')];const _0x27f077=moment_1[a73_0x4ec2('0x6')](_0x4c581b+'\x20'+_0x494355+'\x20-05:00',a73_0x4ec2('0x3f'));const _0x355ca5=parseFloat(_0x366bcd[a73_0x4ec2('0x3d')][0x0][a73_0x4ec2('0x40')]['replace'](',','.'));const _0x332ce9=parseFloat(_0x366bcd[a73_0x4ec2('0x3d')][0x0][a73_0x4ec2('0x41')]['replace'](',','.'));const _0x335de2=_0x366bcd[a73_0x4ec2('0x3d')][0x0]['velocidad'];const _0x33f473=_0x366bcd['eventos'][0x0][a73_0x4ec2('0x42')][0x0][a73_0x4ec2('0x43')];const _0x41b490=_0x366bcd[a73_0x4ec2('0x3d')][0x0]['puerta'][0x0][a73_0x4ec2('0x44')];console[a73_0x4ec2('0xb')](_0x355ca5);console[a73_0x4ec2('0xb')](_0x332ce9);console[a73_0x4ec2('0xb')](_0x335de2);console[a73_0x4ec2('0xb')](_0x33f473);console[a73_0x4ec2('0xb')](_0x41b490);console[a73_0x4ec2('0xb')](_0x27f077);if(_0x33f473>0x0){sequelize_utils_1[a73_0x4ec2('0x6')][a73_0x4ec2('0x13')][a73_0x4ec2('0x32')][a73_0x4ec2('0x33')]({'amount':_0x33f473,'counted_at':_0x27f077});}sequelize_utils_1[a73_0x4ec2('0x6')][a73_0x4ec2('0x13')]['locationPointsModel'][a73_0x4ec2('0x33')]({'device_id':null,'lat':''+_0x355ca5,'lon':''+_0x332ce9,'tracked_at':_0x27f077});}catch(_0x257690){return console[a73_0x4ec2('0x17')](_0x257690);}}});}}});_0x3e9b8c[a73_0x4ec2('0x12')]({'status':0x1,'data':_0x29dbce[a73_0x4ec2('0x45')]});}}exports[a73_0x4ec2('0x6')]=SyncFilesController;