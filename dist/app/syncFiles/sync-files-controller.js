var a73_0x3cf9=['error','connect','ftp.vivotek.com','ipd','findOne','then','connected:','file_name','get','colombia/','end','media/','createWriteStream','status','save','Downloaded:\x20','fileName','.txt','existsSync','fileSizeInBytes:\x20','readFile','utf8','parse','Data','CountingInfo','Out','passCountingsModel','create','uploadEvent','file','path','filename','.json','createReadStream','createGunzip','pipe','finish','fecha','eventos','hora','YYYYMMDD\x20HHmmss\x20Z','latitud','replace','longitud','velocidad','ingresos','salidas','locationPointsModel','__importDefault','__esModule','defineProperty','../../infrastructure/controller-utils','../../infrastructure/sequelize-utils','moment','media','syncFtp','bind','downloadFtp','processFtp','log','connecting','default','ready','connected','list','colombia','name','endsWith','json','size','models','syncFilesModel','findOrCreate','spread','push'];(function(_0x57df41,_0xec5193){var _0x29fb40=function(_0x4b41f8){while(--_0x4b41f8){_0x57df41['push'](_0x57df41['shift']());}};_0x29fb40(++_0xec5193);}(a73_0x3cf9,0x7b));var a73_0x2cb5=function(_0x32928c,_0x371584){_0x32928c=_0x32928c-0x0;var _0x40a417=a73_0x3cf9[_0x32928c];return _0x40a417;};'use strict';var __importDefault=this&&this[a73_0x2cb5('0x0')]||function(_0x540e96){return _0x540e96&&_0x540e96[a73_0x2cb5('0x1')]?_0x540e96:{'default':_0x540e96};};Object[a73_0x2cb5('0x2')](exports,a73_0x2cb5('0x1'),{'value':!![]});const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a73_0x2cb5('0x3')));const sequelize_utils_1=__importDefault(require(a73_0x2cb5('0x4')));const moment_1=__importDefault(require(a73_0x2cb5('0x5')));const UPLOAD_PATH=a73_0x2cb5('0x6');class SyncFilesController extends controller_utils_1['default']{constructor(_0x470703){super(_0x470703,null);this[a73_0x2cb5('0x7')]=this[a73_0x2cb5('0x7')][a73_0x2cb5('0x8')](this);this[a73_0x2cb5('0x9')]=this[a73_0x2cb5('0x9')][a73_0x2cb5('0x8')](this);this[a73_0x2cb5('0xa')]=this[a73_0x2cb5('0xa')][a73_0x2cb5('0x8')](this);}[a73_0x2cb5('0x7')](_0x467776,_0x48fef9,_0x3d9cc8){console[a73_0x2cb5('0xb')](a73_0x2cb5('0xc'));const _0x4bd382=[];const _0x361eb0=new ftp_1[(a73_0x2cb5('0xd'))]();_0x361eb0['on'](a73_0x2cb5('0xe'),function(){console[a73_0x2cb5('0xb')](a73_0x2cb5('0xf'));_0x361eb0[a73_0x2cb5('0x10')](a73_0x2cb5('0x11'),![],function(_0x5d7ae7,_0xb9fefb){if(_0x5d7ae7){console[a73_0x2cb5('0xb')](_0x5d7ae7);}else{for(const _0x1a9561 of _0xb9fefb){if(_0x1a9561[a73_0x2cb5('0x12')][a73_0x2cb5('0x13')](a73_0x2cb5('0x14'))&&_0x1a9561[a73_0x2cb5('0x15')]>0x0){sequelize_utils_1['default'][a73_0x2cb5('0x16')][a73_0x2cb5('0x17')][a73_0x2cb5('0x18')]({'where':{'file_name':_0x1a9561[a73_0x2cb5('0x12')]}})[a73_0x2cb5('0x19')]((_0x3deb4c,_0x169851)=>{if(_0x169851){_0x4bd382[a73_0x2cb5('0x1a')](_0x3deb4c);}});}}}});});_0x361eb0['on'](a73_0x2cb5('0x1b'),function(_0x47a999){});_0x361eb0[a73_0x2cb5('0x1c')]({'host':a73_0x2cb5('0x1d'),'port':0x15,'user':a73_0x2cb5('0x1e'),'password':a73_0x2cb5('0x1e')});_0x48fef9['json']({'data':[]});}[a73_0x2cb5('0x9')](_0x41701d,_0x5ba60e,_0x401899){sequelize_utils_1[a73_0x2cb5('0xd')]['models']['syncFilesModel'][a73_0x2cb5('0x1f')]({'where':{'status':null}})[a73_0x2cb5('0x20')](_0x3b3df1=>{if(_0x3b3df1){const _0x174815=new ftp_1[(a73_0x2cb5('0xd'))]();_0x174815['on'](a73_0x2cb5('0xe'),function(){console[a73_0x2cb5('0xb')](a73_0x2cb5('0x21')+_0x3b3df1[a73_0x2cb5('0x22')]);_0x174815[a73_0x2cb5('0x23')](a73_0x2cb5('0x24')+_0x3b3df1[a73_0x2cb5('0x22')],function(_0x12159c,_0x3edb10){_0x174815[a73_0x2cb5('0x25')]();if(_0x12159c){}else{const _0x3565ed=a73_0x2cb5('0x26')+_0x3b3df1[a73_0x2cb5('0x22')]+'.txt';_0x3edb10['pipe'](fs_1['default'][a73_0x2cb5('0x27')](_0x3565ed));_0x3b3df1[a73_0x2cb5('0x28')]=0x1;_0x3b3df1[a73_0x2cb5('0x29')]();console[a73_0x2cb5('0xb')](a73_0x2cb5('0x2a')+_0x3b3df1[a73_0x2cb5('0x2b')]);}});});_0x174815['on']('error',function(_0x2ce855){});_0x174815['connect']({'host':a73_0x2cb5('0x1d'),'port':0x15,'user':a73_0x2cb5('0x1e'),'password':'ipd'});}else{}});_0x5ba60e[a73_0x2cb5('0x14')]({'data':[]});}['processFtp'](_0x15a5fd,_0x4201fe,_0xcf313e){sequelize_utils_1['default']['models'][a73_0x2cb5('0x17')][a73_0x2cb5('0x1f')]({'where':{'status':0x1}})[a73_0x2cb5('0x20')](_0x36a758=>{if(_0x36a758){const _0x39ca73=a73_0x2cb5('0x26')+_0x36a758[a73_0x2cb5('0x22')]+a73_0x2cb5('0x2c');if(fs_1['default'][a73_0x2cb5('0x2d')](_0x39ca73)){const _0x464730=fs_1['default']['statSync'](_0x39ca73);const _0x2087f0=_0x464730[a73_0x2cb5('0x15')];console['log']('fileName:\x20'+_0x39ca73);console[a73_0x2cb5('0xb')](a73_0x2cb5('0x2e')+_0x2087f0);if(_0x2087f0>0x0){fs_1[a73_0x2cb5('0xd')][a73_0x2cb5('0x2f')](_0x39ca73,a73_0x2cb5('0x30'),function(_0x42d8b2,_0x248a41){if(_0x42d8b2){_0x36a758[a73_0x2cb5('0x28')]=null;}else{try{const _0x55c875=JSON[a73_0x2cb5('0x31')](_0x248a41);for(const _0xf1d3a8 of _0x55c875[a73_0x2cb5('0x32')][0x0][a73_0x2cb5('0x33')]){const _0x5d695a=_0xf1d3a8['In'];const _0xf4662b=_0xf1d3a8[a73_0x2cb5('0x34')];const _0x55a6ab=Date[a73_0x2cb5('0x31')](_0xf1d3a8['EndTime']);if(_0x5d695a>0x0){sequelize_utils_1[a73_0x2cb5('0xd')][a73_0x2cb5('0x16')][a73_0x2cb5('0x35')]['create']({'amount':_0x5d695a,'counted_at':_0x55a6ab});}if(_0xf4662b>0x0){sequelize_utils_1[a73_0x2cb5('0xd')][a73_0x2cb5('0x16')][a73_0x2cb5('0x35')][a73_0x2cb5('0x36')]({'amount':_0xf4662b*-0x1,'counted_at':_0x55a6ab});}}_0x36a758[a73_0x2cb5('0x28')]=0x2;}catch(_0x2d841b){_0x36a758[a73_0x2cb5('0x28')]=null;}}_0x36a758[a73_0x2cb5('0x29')]();});}else{_0x36a758[a73_0x2cb5('0x28')]=null;_0x36a758[a73_0x2cb5('0x29')]();}}else{_0x36a758[a73_0x2cb5('0x28')]=null;_0x36a758[a73_0x2cb5('0x29')]();}}else{}});_0x4201fe[a73_0x2cb5('0x14')]({'data':[]});}[a73_0x2cb5('0x37')](_0xcb597,_0x264d2f,_0x231a92){const _0x2f2fa6=require('zlib');const _0x33b77e=_0xcb597[a73_0x2cb5('0x38')][a73_0x2cb5('0x39')];const _0x49e5e0=UPLOAD_PATH+'/'+_0xcb597[a73_0x2cb5('0x38')][a73_0x2cb5('0x3a')]+a73_0x2cb5('0x3b');const _0x200c24=fs_1['default'][a73_0x2cb5('0x3c')](_0x33b77e);const _0x274326=fs_1[a73_0x2cb5('0xd')][a73_0x2cb5('0x27')](_0x49e5e0);const _0x3fe3b7=_0x2f2fa6[a73_0x2cb5('0x3d')]();console[a73_0x2cb5('0xb')](_0xcb597[a73_0x2cb5('0x38')]);_0x200c24[a73_0x2cb5('0x3e')](_0x3fe3b7)[a73_0x2cb5('0x3e')](_0x274326)['on'](a73_0x2cb5('0x3f'),_0x3524e0=>{if(_0x3524e0)return console['error'](_0x3524e0);else{const _0x183ec6=fs_1[a73_0x2cb5('0xd')]['statSync'](_0x33b77e);const _0x273e55=_0x183ec6['size'];if(_0x273e55>0x0){fs_1[a73_0x2cb5('0xd')][a73_0x2cb5('0x2f')](_0x49e5e0,a73_0x2cb5('0x30'),function(_0x3524e0,_0x3ef084){if(_0x3524e0){return console[a73_0x2cb5('0x1b')](_0x3524e0);}else{try{const _0x1a2128=JSON[a73_0x2cb5('0x31')](_0x3ef084);console['log'](_0x1a2128);const _0x2a2137=_0x1a2128['eventos'][0x0][a73_0x2cb5('0x40')];const _0x45ddc4=_0x1a2128[a73_0x2cb5('0x41')][0x0][a73_0x2cb5('0x42')];const _0x47f861=moment_1[a73_0x2cb5('0xd')](_0x2a2137+'\x20'+_0x45ddc4+'\x20-05:00',a73_0x2cb5('0x43'));const _0x58f809=parseFloat(_0x1a2128['eventos'][0x0][a73_0x2cb5('0x44')][a73_0x2cb5('0x45')](',','.'));const _0xb37d6f=parseFloat(_0x1a2128[a73_0x2cb5('0x41')][0x0][a73_0x2cb5('0x46')][a73_0x2cb5('0x45')](',','.'));const _0x49c493=_0x1a2128[a73_0x2cb5('0x41')][0x0][a73_0x2cb5('0x47')];const _0xec8763=_0x1a2128['eventos'][0x0]['puerta'][0x0][a73_0x2cb5('0x48')];const _0x23ed71=_0x1a2128[a73_0x2cb5('0x41')][0x0]['puerta'][0x0][a73_0x2cb5('0x49')];console[a73_0x2cb5('0xb')](_0x58f809);console['log'](_0xb37d6f);console['log'](_0x49c493);console[a73_0x2cb5('0xb')](_0xec8763);console[a73_0x2cb5('0xb')](_0x23ed71);console[a73_0x2cb5('0xb')](_0x47f861);if(_0xec8763>0x0){sequelize_utils_1[a73_0x2cb5('0xd')][a73_0x2cb5('0x16')][a73_0x2cb5('0x35')][a73_0x2cb5('0x36')]({'amount':_0xec8763,'counted_at':_0x47f861});}sequelize_utils_1[a73_0x2cb5('0xd')][a73_0x2cb5('0x16')][a73_0x2cb5('0x4a')][a73_0x2cb5('0x36')]({'device_id':null,'lat':''+_0x58f809,'lon':''+_0xb37d6f,'tracked_at':_0x47f861});}catch(_0x4873e3){return console[a73_0x2cb5('0x1b')](_0x4873e3);}}});}}});_0x264d2f['json']({'status':0x1,'data':_0xcb597[a73_0x2cb5('0x38')]});}}exports[a73_0x2cb5('0xd')]=SyncFilesController;