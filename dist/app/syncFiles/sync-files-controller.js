var a162_0x2ada=['ftp.vivotek.com','ipd','syncFilesModel','findOne','then','file_name','get','end','media/','.txt','createWriteStream','status','Downloaded:\x20','fileName','statSync','fileName:\x20','fileSizeInBytes:\x20','parse','CountingInfo','Out','passCountingsModel','save','uploadEvent','zlib','file','path','filename','.json','createReadStream','createGunzip','pipe','finish','readFile','utf8','eventos','fecha','hora','\x20-05:00','YYYYMMDD\x20HHmmss\x20Z','latitud','replace','velocidad','puerta','ingresos','salidas','create','locationPointsModel','__importDefault','__esModule','ftp','../../infrastructure/controller-utils','moment','syncFtp','downloadFtp','processFtp','bind','log','connecting','default','ready','connected','colombia','name','endsWith','json','size','models','findOrCreate','push','error','connect'];(function(_0x534f10,_0x52bbfa){var _0x14a924=function(_0x199542){while(--_0x199542){_0x534f10['push'](_0x534f10['shift']());}};_0x14a924(++_0x52bbfa);}(a162_0x2ada,0xbd));var a162_0x4ae1=function(_0x4856cf,_0x359bc4){_0x4856cf=_0x4856cf-0x0;var _0x26a373=a162_0x2ada[_0x4856cf];return _0x26a373;};'use strict';var __importDefault=this&&this[a162_0x4ae1('0x0')]||function(_0x4819e0){return _0x4819e0&&_0x4819e0[a162_0x4ae1('0x1')]?_0x4819e0:{'default':_0x4819e0};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const ftp_1=__importDefault(require(a162_0x4ae1('0x2')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a162_0x4ae1('0x3')));const sequelize_utils_1=__importDefault(require('../../infrastructure/sequelize-utils'));const moment_1=__importDefault(require(a162_0x4ae1('0x4')));const UPLOAD_PATH='media';class SyncFilesController extends controller_utils_1['default']{constructor(_0x32521e){super(_0x32521e,null);this[a162_0x4ae1('0x5')]=this[a162_0x4ae1('0x5')]['bind'](this);this[a162_0x4ae1('0x6')]=this['downloadFtp']['bind'](this);this[a162_0x4ae1('0x7')]=this[a162_0x4ae1('0x7')][a162_0x4ae1('0x8')](this);}[a162_0x4ae1('0x5')](_0x304455,_0x25cca0,_0x25cb32){console[a162_0x4ae1('0x9')](a162_0x4ae1('0xa'));const _0x253c72=[];const _0x459677=new ftp_1[(a162_0x4ae1('0xb'))]();_0x459677['on'](a162_0x4ae1('0xc'),function(){console[a162_0x4ae1('0x9')](a162_0x4ae1('0xd'));_0x459677['list'](a162_0x4ae1('0xe'),![],function(_0x36599c,_0x55fa1a){if(_0x36599c){console[a162_0x4ae1('0x9')](_0x36599c);}else{for(const _0x19ecb5 of _0x55fa1a){if(_0x19ecb5[a162_0x4ae1('0xf')][a162_0x4ae1('0x10')](a162_0x4ae1('0x11'))&&_0x19ecb5[a162_0x4ae1('0x12')]>0x0){sequelize_utils_1['default'][a162_0x4ae1('0x13')]['syncFilesModel'][a162_0x4ae1('0x14')]({'where':{'file_name':_0x19ecb5[a162_0x4ae1('0xf')]}})['spread']((_0x233e06,_0x3b1995)=>{if(_0x3b1995){_0x253c72[a162_0x4ae1('0x15')](_0x233e06);}});}}}});});_0x459677['on'](a162_0x4ae1('0x16'),function(_0x2d5692){});_0x459677[a162_0x4ae1('0x17')]({'host':a162_0x4ae1('0x18'),'port':0x15,'user':a162_0x4ae1('0x19'),'password':a162_0x4ae1('0x19')});_0x25cca0[a162_0x4ae1('0x11')]({'data':[]});}[a162_0x4ae1('0x6')](_0x3fb934,_0x5edaef,_0x43dfc2){sequelize_utils_1[a162_0x4ae1('0xb')]['models'][a162_0x4ae1('0x1a')][a162_0x4ae1('0x1b')]({'where':{'status':null}})[a162_0x4ae1('0x1c')](_0x5178b6=>{if(_0x5178b6){const _0x4e082e=new ftp_1['default']();_0x4e082e['on']('ready',function(){console[a162_0x4ae1('0x9')]('connected:'+_0x5178b6[a162_0x4ae1('0x1d')]);_0x4e082e[a162_0x4ae1('0x1e')]('colombia/'+_0x5178b6[a162_0x4ae1('0x1d')],function(_0x1dc19b,_0x320fdb){_0x4e082e[a162_0x4ae1('0x1f')]();if(_0x1dc19b){}else{const _0x59ef57=a162_0x4ae1('0x20')+_0x5178b6[a162_0x4ae1('0x1d')]+a162_0x4ae1('0x21');_0x320fdb['pipe'](fs_1['default'][a162_0x4ae1('0x22')](_0x59ef57));_0x5178b6[a162_0x4ae1('0x23')]=0x1;_0x5178b6['save']();console[a162_0x4ae1('0x9')](a162_0x4ae1('0x24')+_0x5178b6[a162_0x4ae1('0x25')]);}});});_0x4e082e['on'](a162_0x4ae1('0x16'),function(_0x3315e4){});_0x4e082e['connect']({'host':'ftp.vivotek.com','port':0x15,'user':a162_0x4ae1('0x19'),'password':'ipd'});}else{}});_0x5edaef[a162_0x4ae1('0x11')]({'data':[]});}['processFtp'](_0x5ba017,_0x2b7eb1,_0x437afe){sequelize_utils_1[a162_0x4ae1('0xb')]['models']['syncFilesModel'][a162_0x4ae1('0x1b')]({'where':{'status':0x1}})[a162_0x4ae1('0x1c')](_0xac3828=>{if(_0xac3828){const _0x58e5d0=a162_0x4ae1('0x20')+_0xac3828[a162_0x4ae1('0x1d')]+a162_0x4ae1('0x21');if(fs_1['default']['existsSync'](_0x58e5d0)){const _0x3c08f2=fs_1[a162_0x4ae1('0xb')][a162_0x4ae1('0x26')](_0x58e5d0);const _0xb76eb5=_0x3c08f2[a162_0x4ae1('0x12')];console[a162_0x4ae1('0x9')](a162_0x4ae1('0x27')+_0x58e5d0);console[a162_0x4ae1('0x9')](a162_0x4ae1('0x28')+_0xb76eb5);if(_0xb76eb5>0x0){fs_1[a162_0x4ae1('0xb')]['readFile'](_0x58e5d0,'utf8',function(_0x147266,_0x2af796){if(_0x147266){_0xac3828[a162_0x4ae1('0x23')]=null;}else{try{const _0x1cadb9=JSON[a162_0x4ae1('0x29')](_0x2af796);for(const _0x19a491 of _0x1cadb9['Data'][0x0][a162_0x4ae1('0x2a')]){const _0x1fa6e2=_0x19a491['In'];const _0x43af69=_0x19a491[a162_0x4ae1('0x2b')];const _0x5cc29b=Date[a162_0x4ae1('0x29')](_0x19a491['EndTime']);if(_0x1fa6e2>0x0){sequelize_utils_1[a162_0x4ae1('0xb')][a162_0x4ae1('0x13')]['passCountingsModel']['create']({'amount':_0x1fa6e2,'counted_at':_0x5cc29b});}if(_0x43af69>0x0){sequelize_utils_1[a162_0x4ae1('0xb')][a162_0x4ae1('0x13')][a162_0x4ae1('0x2c')]['create']({'amount':_0x43af69*-0x1,'counted_at':_0x5cc29b});}}_0xac3828['status']=0x2;}catch(_0x55b2b3){_0xac3828[a162_0x4ae1('0x23')]=null;}}_0xac3828[a162_0x4ae1('0x2d')]();});}else{_0xac3828[a162_0x4ae1('0x23')]=null;_0xac3828['save']();}}else{_0xac3828[a162_0x4ae1('0x23')]=null;_0xac3828[a162_0x4ae1('0x2d')]();}}else{}});_0x2b7eb1[a162_0x4ae1('0x11')]({'data':[]});}[a162_0x4ae1('0x2e')](_0x2f59cf,_0x9f457,_0x372dce){const _0x143601=require(a162_0x4ae1('0x2f'));const _0x33c568=_0x2f59cf[a162_0x4ae1('0x30')][a162_0x4ae1('0x31')];const _0x1ae15=UPLOAD_PATH+'/'+_0x2f59cf[a162_0x4ae1('0x30')][a162_0x4ae1('0x32')]+a162_0x4ae1('0x33');const _0x433c96=fs_1['default'][a162_0x4ae1('0x34')](_0x33c568);const _0x2f41cf=fs_1[a162_0x4ae1('0xb')][a162_0x4ae1('0x22')](_0x1ae15);const _0x50a39b=_0x143601[a162_0x4ae1('0x35')]();console[a162_0x4ae1('0x9')](_0x2f59cf[a162_0x4ae1('0x30')]);_0x433c96[a162_0x4ae1('0x36')](_0x50a39b)['pipe'](_0x2f41cf)['on'](a162_0x4ae1('0x37'),_0x18272b=>{if(_0x18272b)return console['error'](_0x18272b);else{const _0x46c052=fs_1['default']['statSync'](_0x33c568);const _0x46664a=_0x46c052[a162_0x4ae1('0x12')];if(_0x46664a>0x0){fs_1[a162_0x4ae1('0xb')][a162_0x4ae1('0x38')](_0x1ae15,a162_0x4ae1('0x39'),function(_0x18272b,_0x2929fb){if(_0x18272b){return console[a162_0x4ae1('0x16')](_0x18272b);}else{try{const _0xa289cc=JSON[a162_0x4ae1('0x29')](_0x2929fb);console[a162_0x4ae1('0x9')](_0xa289cc);const _0x576aeb=_0xa289cc[a162_0x4ae1('0x3a')][0x0][a162_0x4ae1('0x3b')];const _0x2921df=_0xa289cc[a162_0x4ae1('0x3a')][0x0][a162_0x4ae1('0x3c')];const _0xb2710b=moment_1['default'](_0x576aeb+'\x20'+_0x2921df+a162_0x4ae1('0x3d'),a162_0x4ae1('0x3e'));const _0x3a2815=parseFloat(_0xa289cc['eventos'][0x0][a162_0x4ae1('0x3f')][a162_0x4ae1('0x40')](',','.'));const _0x6dfd3a=parseFloat(_0xa289cc[a162_0x4ae1('0x3a')][0x0]['longitud'][a162_0x4ae1('0x40')](',','.'));const _0x7a36f=_0xa289cc[a162_0x4ae1('0x3a')][0x0][a162_0x4ae1('0x41')];const _0x56d3aa=_0xa289cc[a162_0x4ae1('0x3a')][0x0][a162_0x4ae1('0x42')][0x0][a162_0x4ae1('0x43')];const _0x3a7b8c=_0xa289cc['eventos'][0x0]['puerta'][0x0][a162_0x4ae1('0x44')];console[a162_0x4ae1('0x9')](_0x3a2815);console['log'](_0x6dfd3a);console[a162_0x4ae1('0x9')](_0x7a36f);console[a162_0x4ae1('0x9')](_0x56d3aa);console['log'](_0x3a7b8c);console[a162_0x4ae1('0x9')](_0xb2710b);if(_0x56d3aa>0x0){sequelize_utils_1[a162_0x4ae1('0xb')][a162_0x4ae1('0x13')]['passCountingsModel'][a162_0x4ae1('0x45')]({'amount':_0x56d3aa,'counted_at':_0xb2710b});}sequelize_utils_1['default'][a162_0x4ae1('0x13')][a162_0x4ae1('0x46')][a162_0x4ae1('0x45')]({'device_id':null,'lat':''+_0x3a2815,'lon':''+_0x6dfd3a,'tracked_at':_0xb2710b});}catch(_0x429995){return console[a162_0x4ae1('0x16')](_0x429995);}}});}}});_0x9f457[a162_0x4ae1('0x11')]({'status':0x1,'data':_0x2f59cf[a162_0x4ae1('0x30')]});}}exports[a162_0x4ae1('0xb')]=SyncFilesController;