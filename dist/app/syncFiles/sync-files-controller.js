var a73_0xde0a=['push','error','connect','ftp.vivotek.com','ipd','then','connected:','file_name','colombia/','end','.txt','pipe','createWriteStream','status','save','Downloaded:\x20','fileName','findOne','fileSizeInBytes:\x20','readFile','utf8','Data','CountingInfo','parse','EndTime','passCountingsModel','create','uploadEvent','zlib','file','filename','.json','createReadStream','createGunzip','statSync','eventos','hora','\x20-05:00','YYYYMMDD\x20HHmmss\x20Z','latitud','replace','longitud','velocidad','puerta','locationPointsModel','__importDefault','__esModule','defineProperty','../../infrastructure/controller-utils','../../infrastructure/sequelize-utils','moment','media','syncFtp','bind','downloadFtp','processFtp','log','connecting','ready','list','name','endsWith','json','size','default','models','syncFilesModel','findOrCreate','spread'];(function(_0x291a15,_0x46007b){var _0x56d189=function(_0xbec5c7){while(--_0xbec5c7){_0x291a15['push'](_0x291a15['shift']());}};_0x56d189(++_0x46007b);}(a73_0xde0a,0x1cb));var a73_0x6ae3=function(_0x31273a,_0x283058){_0x31273a=_0x31273a-0x0;var _0x2f7c42=a73_0xde0a[_0x31273a];return _0x2f7c42;};'use strict';var __importDefault=this&&this[a73_0x6ae3('0x0')]||function(_0x219487){return _0x219487&&_0x219487[a73_0x6ae3('0x1')]?_0x219487:{'default':_0x219487};};Object[a73_0x6ae3('0x2')](exports,a73_0x6ae3('0x1'),{'value':!![]});const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a73_0x6ae3('0x3')));const sequelize_utils_1=__importDefault(require(a73_0x6ae3('0x4')));const moment_1=__importDefault(require(a73_0x6ae3('0x5')));const UPLOAD_PATH=a73_0x6ae3('0x6');class SyncFilesController extends controller_utils_1['default']{constructor(_0x52b43b){super(_0x52b43b,null);this[a73_0x6ae3('0x7')]=this[a73_0x6ae3('0x7')][a73_0x6ae3('0x8')](this);this[a73_0x6ae3('0x9')]=this[a73_0x6ae3('0x9')]['bind'](this);this[a73_0x6ae3('0xa')]=this[a73_0x6ae3('0xa')]['bind'](this);}[a73_0x6ae3('0x7')](_0x78adca,_0x47cb55,_0x10382f){console[a73_0x6ae3('0xb')](a73_0x6ae3('0xc'));const _0x3971b0=[];const _0x9121dc=new ftp_1['default']();_0x9121dc['on'](a73_0x6ae3('0xd'),function(){console[a73_0x6ae3('0xb')]('connected');_0x9121dc[a73_0x6ae3('0xe')]('colombia',![],function(_0x3b6a53,_0xbb265f){if(_0x3b6a53){console[a73_0x6ae3('0xb')](_0x3b6a53);}else{for(const _0x1d8316 of _0xbb265f){if(_0x1d8316[a73_0x6ae3('0xf')][a73_0x6ae3('0x10')](a73_0x6ae3('0x11'))&&_0x1d8316[a73_0x6ae3('0x12')]>0x0){sequelize_utils_1[a73_0x6ae3('0x13')][a73_0x6ae3('0x14')][a73_0x6ae3('0x15')][a73_0x6ae3('0x16')]({'where':{'file_name':_0x1d8316['name']}})[a73_0x6ae3('0x17')]((_0x116d0b,_0x15fc23)=>{if(_0x15fc23){_0x3971b0[a73_0x6ae3('0x18')](_0x116d0b);}});}}}});});_0x9121dc['on'](a73_0x6ae3('0x19'),function(_0x3e10b1){});_0x9121dc[a73_0x6ae3('0x1a')]({'host':a73_0x6ae3('0x1b'),'port':0x15,'user':a73_0x6ae3('0x1c'),'password':a73_0x6ae3('0x1c')});_0x47cb55[a73_0x6ae3('0x11')]({'data':[]});}[a73_0x6ae3('0x9')](_0x26b462,_0x4435f,_0x4fd88f){sequelize_utils_1[a73_0x6ae3('0x13')][a73_0x6ae3('0x14')]['syncFilesModel']['findOne']({'where':{'status':null}})[a73_0x6ae3('0x1d')](_0xde642=>{if(_0xde642){const _0x1529f4=new ftp_1[(a73_0x6ae3('0x13'))]();_0x1529f4['on'](a73_0x6ae3('0xd'),function(){console[a73_0x6ae3('0xb')](a73_0x6ae3('0x1e')+_0xde642[a73_0x6ae3('0x1f')]);_0x1529f4['get'](a73_0x6ae3('0x20')+_0xde642[a73_0x6ae3('0x1f')],function(_0x140321,_0x7cdb25){_0x1529f4[a73_0x6ae3('0x21')]();if(_0x140321){}else{const _0x5da25b='media/'+_0xde642[a73_0x6ae3('0x1f')]+a73_0x6ae3('0x22');_0x7cdb25[a73_0x6ae3('0x23')](fs_1['default'][a73_0x6ae3('0x24')](_0x5da25b));_0xde642[a73_0x6ae3('0x25')]=0x1;_0xde642[a73_0x6ae3('0x26')]();console['log'](a73_0x6ae3('0x27')+_0xde642[a73_0x6ae3('0x28')]);}});});_0x1529f4['on'](a73_0x6ae3('0x19'),function(_0x6d36e8){});_0x1529f4[a73_0x6ae3('0x1a')]({'host':a73_0x6ae3('0x1b'),'port':0x15,'user':a73_0x6ae3('0x1c'),'password':a73_0x6ae3('0x1c')});}else{}});_0x4435f['json']({'data':[]});}[a73_0x6ae3('0xa')](_0x1741cf,_0x20d7ba,_0x24810b){sequelize_utils_1['default']['models']['syncFilesModel'][a73_0x6ae3('0x29')]({'where':{'status':0x1}})[a73_0x6ae3('0x1d')](_0x42dc7e=>{if(_0x42dc7e){const _0x1d5f81='media/'+_0x42dc7e['file_name']+a73_0x6ae3('0x22');if(fs_1[a73_0x6ae3('0x13')]['existsSync'](_0x1d5f81)){const _0x11f7d5=fs_1[a73_0x6ae3('0x13')]['statSync'](_0x1d5f81);const _0x13b25d=_0x11f7d5[a73_0x6ae3('0x12')];console['log']('fileName:\x20'+_0x1d5f81);console[a73_0x6ae3('0xb')](a73_0x6ae3('0x2a')+_0x13b25d);if(_0x13b25d>0x0){fs_1[a73_0x6ae3('0x13')][a73_0x6ae3('0x2b')](_0x1d5f81,a73_0x6ae3('0x2c'),function(_0x3f2b06,_0x62e693){if(_0x3f2b06){_0x42dc7e[a73_0x6ae3('0x25')]=null;}else{try{const _0x29c3ad=JSON['parse'](_0x62e693);for(const _0x11949b of _0x29c3ad[a73_0x6ae3('0x2d')][0x0][a73_0x6ae3('0x2e')]){const _0x12423c=_0x11949b['In'];const _0x5715a8=_0x11949b['Out'];const _0x194e34=Date[a73_0x6ae3('0x2f')](_0x11949b[a73_0x6ae3('0x30')]);if(_0x12423c>0x0){sequelize_utils_1[a73_0x6ae3('0x13')][a73_0x6ae3('0x14')][a73_0x6ae3('0x31')]['create']({'amount':_0x12423c,'counted_at':_0x194e34});}if(_0x5715a8>0x0){sequelize_utils_1[a73_0x6ae3('0x13')][a73_0x6ae3('0x14')][a73_0x6ae3('0x31')][a73_0x6ae3('0x32')]({'amount':_0x5715a8*-0x1,'counted_at':_0x194e34});}}_0x42dc7e[a73_0x6ae3('0x25')]=0x2;}catch(_0x23c0f8){_0x42dc7e['status']=null;}}_0x42dc7e[a73_0x6ae3('0x26')]();});}else{_0x42dc7e[a73_0x6ae3('0x25')]=null;_0x42dc7e['save']();}}else{_0x42dc7e[a73_0x6ae3('0x25')]=null;_0x42dc7e[a73_0x6ae3('0x26')]();}}else{}});_0x20d7ba['json']({'data':[]});}[a73_0x6ae3('0x33')](_0x51d85f,_0x470846,_0x5a785c){const _0x1b4077=require(a73_0x6ae3('0x34'));const _0x1d98f3=_0x51d85f[a73_0x6ae3('0x35')]['path'];const _0x5a1b7f=UPLOAD_PATH+'/'+_0x51d85f['file'][a73_0x6ae3('0x36')]+a73_0x6ae3('0x37');const _0x50bf7=fs_1[a73_0x6ae3('0x13')][a73_0x6ae3('0x38')](_0x1d98f3);const _0x5bb828=fs_1[a73_0x6ae3('0x13')][a73_0x6ae3('0x24')](_0x5a1b7f);const _0x61bf03=_0x1b4077[a73_0x6ae3('0x39')]();console[a73_0x6ae3('0xb')](_0x51d85f[a73_0x6ae3('0x35')]);_0x50bf7[a73_0x6ae3('0x23')](_0x61bf03)['pipe'](_0x5bb828)['on']('finish',_0x3fe3b7=>{if(_0x3fe3b7)return console[a73_0x6ae3('0x19')](_0x3fe3b7);else{const _0x5bbb5f=fs_1[a73_0x6ae3('0x13')][a73_0x6ae3('0x3a')](_0x1d98f3);const _0x3b2a0d=_0x5bbb5f[a73_0x6ae3('0x12')];if(_0x3b2a0d>0x0){fs_1[a73_0x6ae3('0x13')]['readFile'](_0x5a1b7f,a73_0x6ae3('0x2c'),function(_0x3fe3b7,_0x15b985){if(_0x3fe3b7){return console['error'](_0x3fe3b7);}else{try{const _0x31628d=JSON[a73_0x6ae3('0x2f')](_0x15b985);console[a73_0x6ae3('0xb')](_0x31628d);const _0x36a56e=_0x31628d[a73_0x6ae3('0x3b')][0x0]['fecha'];const _0x3ecb3b=_0x31628d[a73_0x6ae3('0x3b')][0x0][a73_0x6ae3('0x3c')];const _0x3cae70=moment_1[a73_0x6ae3('0x13')](_0x36a56e+'\x20'+_0x3ecb3b+a73_0x6ae3('0x3d'),a73_0x6ae3('0x3e'));const _0x208de4=parseFloat(_0x31628d['eventos'][0x0][a73_0x6ae3('0x3f')][a73_0x6ae3('0x40')](',','.'));const _0x2505d5=parseFloat(_0x31628d['eventos'][0x0][a73_0x6ae3('0x41')][a73_0x6ae3('0x40')](',','.'));const _0x41bf1b=_0x31628d[a73_0x6ae3('0x3b')][0x0][a73_0x6ae3('0x42')];const _0xb2aa6a=_0x31628d[a73_0x6ae3('0x3b')][0x0][a73_0x6ae3('0x43')][0x0]['ingresos'];const _0xedad77=_0x31628d[a73_0x6ae3('0x3b')][0x0][a73_0x6ae3('0x43')][0x0]['salidas'];console['log'](_0x208de4);console['log'](_0x2505d5);console['log'](_0x41bf1b);console[a73_0x6ae3('0xb')](_0xb2aa6a);console['log'](_0xedad77);console[a73_0x6ae3('0xb')](_0x3cae70);if(_0xb2aa6a>0x0){sequelize_utils_1[a73_0x6ae3('0x13')][a73_0x6ae3('0x14')][a73_0x6ae3('0x31')][a73_0x6ae3('0x32')]({'amount':_0xb2aa6a,'counted_at':_0x3cae70});}sequelize_utils_1[a73_0x6ae3('0x13')]['models'][a73_0x6ae3('0x44')][a73_0x6ae3('0x32')]({'device_id':null,'lat':''+_0x208de4,'lon':''+_0x2505d5,'tracked_at':_0x3cae70});}catch(_0x35b543){return console['error'](_0x35b543);}}});}}});_0x470846[a73_0x6ae3('0x11')]({'status':0x1,'data':_0x51d85f[a73_0x6ae3('0x35')]});}}exports[a73_0x6ae3('0x13')]=SyncFilesController;