var a79_0x69ba=['filename','.json','createGunzip','finish','statSync','parse','eventos','fecha','hora','YYYYMMDD\x20HHmmss\x20Z','latitud','replace','longitud','velocidad','puerta','salidas','__esModule','defineProperty','ftp','../../infrastructure/controller-utils','../../infrastructure/sequelize-utils','moment','media','default','syncFtp','downloadFtp','bind','processFtp','log','connecting','ready','connected','list','name','json','size','models','syncFilesModel','findOrCreate','spread','error','connect','ftp.vivotek.com','findOne','then','connected:','file_name','get','colombia/','media/','.txt','pipe','createWriteStream','status','save','Downloaded:\x20','fileName','existsSync','fileName:\x20','fileSizeInBytes:\x20','readFile','utf8','Data','CountingInfo','Out','EndTime','passCountingsModel','create','zlib','path','file'];(function(_0x262eed,_0x389edc){var _0x3ce3bf=function(_0xbe4277){while(--_0xbe4277){_0x262eed['push'](_0x262eed['shift']());}};_0x3ce3bf(++_0x389edc);}(a79_0x69ba,0x12c));var a79_0xb61b=function(_0x3d5978,_0x1e22a0){_0x3d5978=_0x3d5978-0x0;var _0x31c0a2=a79_0x69ba[_0x3d5978];return _0x31c0a2;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x104aba){return _0x104aba&&_0x104aba[a79_0xb61b('0x0')]?_0x104aba:{'default':_0x104aba};};Object[a79_0xb61b('0x1')](exports,'__esModule',{'value':!![]});const ftp_1=__importDefault(require(a79_0xb61b('0x2')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a79_0xb61b('0x3')));const sequelize_utils_1=__importDefault(require(a79_0xb61b('0x4')));const moment_1=__importDefault(require(a79_0xb61b('0x5')));const UPLOAD_PATH=a79_0xb61b('0x6');class SyncFilesController extends controller_utils_1[a79_0xb61b('0x7')]{constructor(_0x17b851){super(_0x17b851,null);this[a79_0xb61b('0x8')]=this[a79_0xb61b('0x8')]['bind'](this);this[a79_0xb61b('0x9')]=this[a79_0xb61b('0x9')][a79_0xb61b('0xa')](this);this['processFtp']=this[a79_0xb61b('0xb')][a79_0xb61b('0xa')](this);}[a79_0xb61b('0x8')](_0x337d49,_0x316539,_0x3898d8){console[a79_0xb61b('0xc')](a79_0xb61b('0xd'));const _0x17266b=[];const _0x296e19=new ftp_1[(a79_0xb61b('0x7'))]();_0x296e19['on'](a79_0xb61b('0xe'),function(){console[a79_0xb61b('0xc')](a79_0xb61b('0xf'));_0x296e19[a79_0xb61b('0x10')]('colombia',![],function(_0x20f788,_0x174c77){if(_0x20f788){console['log'](_0x20f788);}else{for(const _0x3ed62e of _0x174c77){if(_0x3ed62e[a79_0xb61b('0x11')]['endsWith'](a79_0xb61b('0x12'))&&_0x3ed62e[a79_0xb61b('0x13')]>0x0){sequelize_utils_1['default'][a79_0xb61b('0x14')][a79_0xb61b('0x15')][a79_0xb61b('0x16')]({'where':{'file_name':_0x3ed62e[a79_0xb61b('0x11')]}})[a79_0xb61b('0x17')]((_0x149faf,_0x14e98a)=>{if(_0x14e98a){_0x17266b['push'](_0x149faf);}});}}}});});_0x296e19['on'](a79_0xb61b('0x18'),function(_0x4f19ad){});_0x296e19[a79_0xb61b('0x19')]({'host':a79_0xb61b('0x1a'),'port':0x15,'user':'ipd','password':'ipd'});_0x316539[a79_0xb61b('0x12')]({'data':[]});}[a79_0xb61b('0x9')](_0x21d562,_0x3ebf07,_0x3919dc){sequelize_utils_1['default'][a79_0xb61b('0x14')]['syncFilesModel'][a79_0xb61b('0x1b')]({'where':{'status':null}})[a79_0xb61b('0x1c')](_0x3828a2=>{if(_0x3828a2){const _0x3c7f0f=new ftp_1[(a79_0xb61b('0x7'))]();_0x3c7f0f['on'](a79_0xb61b('0xe'),function(){console[a79_0xb61b('0xc')](a79_0xb61b('0x1d')+_0x3828a2[a79_0xb61b('0x1e')]);_0x3c7f0f[a79_0xb61b('0x1f')](a79_0xb61b('0x20')+_0x3828a2[a79_0xb61b('0x1e')],function(_0x3a5a09,_0x3045bb){_0x3c7f0f['end']();if(_0x3a5a09){}else{const _0x20ee38=a79_0xb61b('0x21')+_0x3828a2[a79_0xb61b('0x1e')]+a79_0xb61b('0x22');_0x3045bb[a79_0xb61b('0x23')](fs_1[a79_0xb61b('0x7')][a79_0xb61b('0x24')](_0x20ee38));_0x3828a2[a79_0xb61b('0x25')]=0x1;_0x3828a2[a79_0xb61b('0x26')]();console[a79_0xb61b('0xc')](a79_0xb61b('0x27')+_0x3828a2[a79_0xb61b('0x28')]);}});});_0x3c7f0f['on'](a79_0xb61b('0x18'),function(_0x2fced8){});_0x3c7f0f[a79_0xb61b('0x19')]({'host':a79_0xb61b('0x1a'),'port':0x15,'user':'ipd','password':'ipd'});}else{}});_0x3ebf07['json']({'data':[]});}['processFtp'](_0x40fa9e,_0x3a5184,_0x1b14ff){sequelize_utils_1['default']['models'][a79_0xb61b('0x15')][a79_0xb61b('0x1b')]({'where':{'status':0x1}})['then'](_0x27a370=>{if(_0x27a370){const _0x246374=a79_0xb61b('0x21')+_0x27a370[a79_0xb61b('0x1e')]+'.txt';if(fs_1[a79_0xb61b('0x7')][a79_0xb61b('0x29')](_0x246374)){const _0x1ea5c0=fs_1['default']['statSync'](_0x246374);const _0x2c2461=_0x1ea5c0[a79_0xb61b('0x13')];console[a79_0xb61b('0xc')](a79_0xb61b('0x2a')+_0x246374);console[a79_0xb61b('0xc')](a79_0xb61b('0x2b')+_0x2c2461);if(_0x2c2461>0x0){fs_1[a79_0xb61b('0x7')][a79_0xb61b('0x2c')](_0x246374,a79_0xb61b('0x2d'),function(_0x5cd6be,_0x7c3553){if(_0x5cd6be){_0x27a370['status']=null;}else{try{const _0xaccb1c=JSON['parse'](_0x7c3553);for(const _0x7b052a of _0xaccb1c[a79_0xb61b('0x2e')][0x0][a79_0xb61b('0x2f')]){const _0xbee706=_0x7b052a['In'];const _0x1ab86b=_0x7b052a[a79_0xb61b('0x30')];const _0x3b5ac2=Date['parse'](_0x7b052a[a79_0xb61b('0x31')]);if(_0xbee706>0x0){sequelize_utils_1[a79_0xb61b('0x7')][a79_0xb61b('0x14')][a79_0xb61b('0x32')][a79_0xb61b('0x33')]({'amount':_0xbee706,'counted_at':_0x3b5ac2});}if(_0x1ab86b>0x0){sequelize_utils_1[a79_0xb61b('0x7')]['models'][a79_0xb61b('0x32')][a79_0xb61b('0x33')]({'amount':_0x1ab86b*-0x1,'counted_at':_0x3b5ac2});}}_0x27a370[a79_0xb61b('0x25')]=0x2;}catch(_0x210fe2){_0x27a370[a79_0xb61b('0x25')]=null;}}_0x27a370['save']();});}else{_0x27a370[a79_0xb61b('0x25')]=null;_0x27a370[a79_0xb61b('0x26')]();}}else{_0x27a370[a79_0xb61b('0x25')]=null;_0x27a370[a79_0xb61b('0x26')]();}}else{}});_0x3a5184[a79_0xb61b('0x12')]({'data':[]});}['uploadEvent'](_0x385ee7,_0x1022aa,_0x166b2c){const _0xa7c3d5=require(a79_0xb61b('0x34'));const _0x3adac7=_0x385ee7['file'][a79_0xb61b('0x35')];const _0x1e2ff3=UPLOAD_PATH+'/'+_0x385ee7[a79_0xb61b('0x36')][a79_0xb61b('0x37')]+a79_0xb61b('0x38');const _0x2db4fa=fs_1[a79_0xb61b('0x7')]['createReadStream'](_0x3adac7);const _0x45874b=fs_1[a79_0xb61b('0x7')][a79_0xb61b('0x24')](_0x1e2ff3);const _0xa969fe=_0xa7c3d5[a79_0xb61b('0x39')]();console[a79_0xb61b('0xc')](_0x385ee7[a79_0xb61b('0x36')]);_0x2db4fa[a79_0xb61b('0x23')](_0xa969fe)[a79_0xb61b('0x23')](_0x45874b)['on'](a79_0xb61b('0x3a'),_0x3cb6e8=>{if(_0x3cb6e8)return console[a79_0xb61b('0x18')](_0x3cb6e8);else{const _0x1fdd01=fs_1[a79_0xb61b('0x7')][a79_0xb61b('0x3b')](_0x3adac7);const _0x4a251a=_0x1fdd01[a79_0xb61b('0x13')];if(_0x4a251a>0x0){fs_1[a79_0xb61b('0x7')][a79_0xb61b('0x2c')](_0x1e2ff3,a79_0xb61b('0x2d'),function(_0x3cb6e8,_0x23ce4d){if(_0x3cb6e8){return console[a79_0xb61b('0x18')](_0x3cb6e8);}else{try{const _0x3b4f83=JSON[a79_0xb61b('0x3c')](_0x23ce4d);console[a79_0xb61b('0xc')](_0x3b4f83);const _0x180a8c=_0x3b4f83[a79_0xb61b('0x3d')][0x0][a79_0xb61b('0x3e')];const _0x318ca8=_0x3b4f83[a79_0xb61b('0x3d')][0x0][a79_0xb61b('0x3f')];const _0x4846a6=moment_1[a79_0xb61b('0x7')](_0x180a8c+'\x20'+_0x318ca8+'\x20-05:00',a79_0xb61b('0x40'));const _0x1e6304=parseFloat(_0x3b4f83['eventos'][0x0][a79_0xb61b('0x41')][a79_0xb61b('0x42')](',','.'));const _0x17300b=parseFloat(_0x3b4f83['eventos'][0x0][a79_0xb61b('0x43')][a79_0xb61b('0x42')](',','.'));const _0x290172=_0x3b4f83[a79_0xb61b('0x3d')][0x0][a79_0xb61b('0x44')];const _0x1835a5=_0x3b4f83[a79_0xb61b('0x3d')][0x0]['puerta'][0x0]['ingresos'];const _0x434c31=_0x3b4f83['eventos'][0x0][a79_0xb61b('0x45')][0x0][a79_0xb61b('0x46')];console['log'](_0x1e6304);console[a79_0xb61b('0xc')](_0x17300b);console[a79_0xb61b('0xc')](_0x290172);console['log'](_0x1835a5);console[a79_0xb61b('0xc')](_0x434c31);console[a79_0xb61b('0xc')](_0x4846a6);if(_0x1835a5>0x0){sequelize_utils_1[a79_0xb61b('0x7')][a79_0xb61b('0x14')][a79_0xb61b('0x32')][a79_0xb61b('0x33')]({'amount':_0x1835a5,'counted_at':_0x4846a6});}sequelize_utils_1[a79_0xb61b('0x7')][a79_0xb61b('0x14')]['locationPointsModel']['create']({'device_id':null,'lat':''+_0x1e6304,'lon':''+_0x17300b,'tracked_at':_0x4846a6});}catch(_0x20e196){return console['error'](_0x20e196);}}});}}});_0x1022aa[a79_0xb61b('0x12')]({'status':0x1,'data':_0x385ee7[a79_0xb61b('0x36')]});}}exports[a79_0xb61b('0x7')]=SyncFilesController;