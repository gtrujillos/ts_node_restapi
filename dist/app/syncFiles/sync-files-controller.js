var a73_0x1047=['Out','parse','EndTime','passCountingsModel','create','uploadEvent','zlib','file','path','.json','createGunzip','finish','eventos','hora','YYYYMMDD\x20HHmmss\x20Z','latitud','replace','puerta','salidas','locationPointsModel','__importDefault','defineProperty','__esModule','../../infrastructure/sequelize-utils','media','syncFtp','bind','downloadFtp','processFtp','default','ready','log','connected','colombia','name','json','size','models','syncFilesModel','findOrCreate','spread','push','connect','ftp.vivotek.com','ipd','then','connected:','file_name','get','colombia/','end','media/','pipe','createWriteStream','save','Downloaded:\x20','fileName','error','findOne','.txt','existsSync','statSync','fileName:\x20','fileSizeInBytes:\x20','readFile','utf8','status','Data','CountingInfo'];(function(_0x2d37e7,_0x597276){var _0xab6a24=function(_0x4747ad){while(--_0x4747ad){_0x2d37e7['push'](_0x2d37e7['shift']());}};_0xab6a24(++_0x597276);}(a73_0x1047,0x9e));var a73_0x50d2=function(_0x12e18f,_0x23e7e8){_0x12e18f=_0x12e18f-0x0;var _0x58d645=a73_0x1047[_0x12e18f];return _0x58d645;};'use strict';var __importDefault=this&&this[a73_0x50d2('0x0')]||function(_0x493257){return _0x493257&&_0x493257['__esModule']?_0x493257:{'default':_0x493257};};Object[a73_0x50d2('0x1')](exports,a73_0x50d2('0x2'),{'value':!![]});const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require('../../infrastructure/controller-utils'));const sequelize_utils_1=__importDefault(require(a73_0x50d2('0x3')));const moment_1=__importDefault(require('moment'));const UPLOAD_PATH=a73_0x50d2('0x4');class SyncFilesController extends controller_utils_1['default']{constructor(_0x4f4804){super(_0x4f4804,null);this['syncFtp']=this[a73_0x50d2('0x5')][a73_0x50d2('0x6')](this);this[a73_0x50d2('0x7')]=this[a73_0x50d2('0x7')][a73_0x50d2('0x6')](this);this[a73_0x50d2('0x8')]=this[a73_0x50d2('0x8')][a73_0x50d2('0x6')](this);}[a73_0x50d2('0x5')](_0x16d040,_0x18d752,_0x411355){console['log']('connecting');const _0x1c5ca3=[];const _0x12b73f=new ftp_1[(a73_0x50d2('0x9'))]();_0x12b73f['on'](a73_0x50d2('0xa'),function(){console[a73_0x50d2('0xb')](a73_0x50d2('0xc'));_0x12b73f['list'](a73_0x50d2('0xd'),![],function(_0x215371,_0x5865fc){if(_0x215371){console[a73_0x50d2('0xb')](_0x215371);}else{for(const _0x4fdfea of _0x5865fc){if(_0x4fdfea[a73_0x50d2('0xe')]['endsWith'](a73_0x50d2('0xf'))&&_0x4fdfea[a73_0x50d2('0x10')]>0x0){sequelize_utils_1[a73_0x50d2('0x9')][a73_0x50d2('0x11')][a73_0x50d2('0x12')][a73_0x50d2('0x13')]({'where':{'file_name':_0x4fdfea[a73_0x50d2('0xe')]}})[a73_0x50d2('0x14')]((_0xaf7dab,_0x4ab6c0)=>{if(_0x4ab6c0){_0x1c5ca3[a73_0x50d2('0x15')](_0xaf7dab);}});}}}});});_0x12b73f['on']('error',function(_0xaaa33c){});_0x12b73f[a73_0x50d2('0x16')]({'host':a73_0x50d2('0x17'),'port':0x15,'user':a73_0x50d2('0x18'),'password':'ipd'});_0x18d752[a73_0x50d2('0xf')]({'data':[]});}['downloadFtp'](_0x288257,_0x26e05b,_0xd8d74b){sequelize_utils_1[a73_0x50d2('0x9')]['models'][a73_0x50d2('0x12')]['findOne']({'where':{'status':null}})[a73_0x50d2('0x19')](_0x69c241=>{if(_0x69c241){const _0x25ecb1=new ftp_1['default']();_0x25ecb1['on']('ready',function(){console[a73_0x50d2('0xb')](a73_0x50d2('0x1a')+_0x69c241[a73_0x50d2('0x1b')]);_0x25ecb1[a73_0x50d2('0x1c')](a73_0x50d2('0x1d')+_0x69c241[a73_0x50d2('0x1b')],function(_0x30899e,_0x16059d){_0x25ecb1[a73_0x50d2('0x1e')]();if(_0x30899e){}else{const _0x32ae3b=a73_0x50d2('0x1f')+_0x69c241[a73_0x50d2('0x1b')]+'.txt';_0x16059d[a73_0x50d2('0x20')](fs_1[a73_0x50d2('0x9')][a73_0x50d2('0x21')](_0x32ae3b));_0x69c241['status']=0x1;_0x69c241[a73_0x50d2('0x22')]();console[a73_0x50d2('0xb')](a73_0x50d2('0x23')+_0x69c241[a73_0x50d2('0x24')]);}});});_0x25ecb1['on'](a73_0x50d2('0x25'),function(_0x484b0b){});_0x25ecb1['connect']({'host':a73_0x50d2('0x17'),'port':0x15,'user':a73_0x50d2('0x18'),'password':a73_0x50d2('0x18')});}else{}});_0x26e05b[a73_0x50d2('0xf')]({'data':[]});}[a73_0x50d2('0x8')](_0x487b15,_0x57b676,_0x4cb397){sequelize_utils_1[a73_0x50d2('0x9')][a73_0x50d2('0x11')][a73_0x50d2('0x12')][a73_0x50d2('0x26')]({'where':{'status':0x1}})[a73_0x50d2('0x19')](_0x5cb8f4=>{if(_0x5cb8f4){const _0x35fa09=a73_0x50d2('0x1f')+_0x5cb8f4[a73_0x50d2('0x1b')]+a73_0x50d2('0x27');if(fs_1[a73_0x50d2('0x9')][a73_0x50d2('0x28')](_0x35fa09)){const _0xb8da77=fs_1['default'][a73_0x50d2('0x29')](_0x35fa09);const _0x5535bd=_0xb8da77[a73_0x50d2('0x10')];console['log'](a73_0x50d2('0x2a')+_0x35fa09);console[a73_0x50d2('0xb')](a73_0x50d2('0x2b')+_0x5535bd);if(_0x5535bd>0x0){fs_1[a73_0x50d2('0x9')][a73_0x50d2('0x2c')](_0x35fa09,a73_0x50d2('0x2d'),function(_0x45962f,_0x5d7426){if(_0x45962f){_0x5cb8f4[a73_0x50d2('0x2e')]=null;}else{try{const _0x2f369f=JSON['parse'](_0x5d7426);for(const _0x4fc1a9 of _0x2f369f[a73_0x50d2('0x2f')][0x0][a73_0x50d2('0x30')]){const _0xcc24b6=_0x4fc1a9['In'];const _0x320e69=_0x4fc1a9[a73_0x50d2('0x31')];const _0x1a0be0=Date[a73_0x50d2('0x32')](_0x4fc1a9[a73_0x50d2('0x33')]);if(_0xcc24b6>0x0){sequelize_utils_1[a73_0x50d2('0x9')][a73_0x50d2('0x11')][a73_0x50d2('0x34')][a73_0x50d2('0x35')]({'amount':_0xcc24b6,'counted_at':_0x1a0be0});}if(_0x320e69>0x0){sequelize_utils_1['default'][a73_0x50d2('0x11')][a73_0x50d2('0x34')][a73_0x50d2('0x35')]({'amount':_0x320e69*-0x1,'counted_at':_0x1a0be0});}}_0x5cb8f4[a73_0x50d2('0x2e')]=0x2;}catch(_0x103d60){_0x5cb8f4[a73_0x50d2('0x2e')]=null;}}_0x5cb8f4[a73_0x50d2('0x22')]();});}else{_0x5cb8f4[a73_0x50d2('0x2e')]=null;_0x5cb8f4[a73_0x50d2('0x22')]();}}else{_0x5cb8f4['status']=null;_0x5cb8f4['save']();}}else{}});_0x57b676[a73_0x50d2('0xf')]({'data':[]});}[a73_0x50d2('0x36')](_0x2a6d77,_0x4b326d,_0x2593c5){const _0x596f44=require(a73_0x50d2('0x37'));const _0x4a5fe9=_0x2a6d77[a73_0x50d2('0x38')][a73_0x50d2('0x39')];const _0x286728=UPLOAD_PATH+'/'+_0x2a6d77[a73_0x50d2('0x38')]['filename']+a73_0x50d2('0x3a');const _0x24b914=fs_1[a73_0x50d2('0x9')]['createReadStream'](_0x4a5fe9);const _0x24ca86=fs_1[a73_0x50d2('0x9')][a73_0x50d2('0x21')](_0x286728);const _0xab4e2=_0x596f44[a73_0x50d2('0x3b')]();console['log'](_0x2a6d77[a73_0x50d2('0x38')]);_0x24b914['pipe'](_0xab4e2)['pipe'](_0x24ca86)['on'](a73_0x50d2('0x3c'),_0x51d155=>{if(_0x51d155)return console[a73_0x50d2('0x25')](_0x51d155);else{const _0x5707fc=fs_1['default']['statSync'](_0x4a5fe9);const _0x11d037=_0x5707fc[a73_0x50d2('0x10')];if(_0x11d037>0x0){fs_1[a73_0x50d2('0x9')][a73_0x50d2('0x2c')](_0x286728,'utf8',function(_0x51d155,_0x23ea52){if(_0x51d155){return console['error'](_0x51d155);}else{try{const _0x47c0d2=JSON['parse'](_0x23ea52);console[a73_0x50d2('0xb')](_0x47c0d2);const _0xe37582=_0x47c0d2[a73_0x50d2('0x3d')][0x0]['fecha'];const _0x53b35d=_0x47c0d2[a73_0x50d2('0x3d')][0x0][a73_0x50d2('0x3e')];const _0x4ae6fe=moment_1[a73_0x50d2('0x9')](_0xe37582+'\x20'+_0x53b35d+'\x20-05:00',a73_0x50d2('0x3f'));const _0x3ea176=parseFloat(_0x47c0d2[a73_0x50d2('0x3d')][0x0][a73_0x50d2('0x40')][a73_0x50d2('0x41')](',','.'));const _0x3c7fee=parseFloat(_0x47c0d2[a73_0x50d2('0x3d')][0x0]['longitud'][a73_0x50d2('0x41')](',','.'));const _0xdf294b=_0x47c0d2[a73_0x50d2('0x3d')][0x0]['velocidad'];const _0x45e9e2=_0x47c0d2[a73_0x50d2('0x3d')][0x0][a73_0x50d2('0x42')][0x0]['ingresos'];const _0x5162e2=_0x47c0d2[a73_0x50d2('0x3d')][0x0][a73_0x50d2('0x42')][0x0][a73_0x50d2('0x43')];console[a73_0x50d2('0xb')](_0x3ea176);console['log'](_0x3c7fee);console['log'](_0xdf294b);console['log'](_0x45e9e2);console[a73_0x50d2('0xb')](_0x5162e2);console['log'](_0x4ae6fe);if(_0x45e9e2>0x0){sequelize_utils_1[a73_0x50d2('0x9')][a73_0x50d2('0x11')][a73_0x50d2('0x34')][a73_0x50d2('0x35')]({'amount':_0x45e9e2,'counted_at':_0x4ae6fe});}sequelize_utils_1[a73_0x50d2('0x9')][a73_0x50d2('0x11')][a73_0x50d2('0x44')][a73_0x50d2('0x35')]({'device_id':null,'lat':''+_0x3ea176,'lon':''+_0x3c7fee,'tracked_at':_0x4ae6fe});}catch(_0x40da77){return console['error'](_0x40da77);}}});}}});_0x4b326d[a73_0x50d2('0xf')]({'status':0x1,'data':_0x2a6d77[a73_0x50d2('0x38')]});}}exports[a73_0x50d2('0x9')]=SyncFilesController;