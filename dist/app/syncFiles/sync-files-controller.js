var a162_0x4597=['statSync','utf8','eventos','fecha','hora','YYYYMMDD\x20HHmmss\x20Z','latitud','longitud','replace','puerta','ingresos','salidas','locationPointsModel','__importDefault','__esModule','ftp','../../infrastructure/controller-utils','../../infrastructure/sequelize-utils','moment','media','default','syncFtp','bind','downloadFtp','processFtp','log','connected','list','colombia','endsWith','models','syncFilesModel','findOrCreate','spread','push','connect','ftp.vivotek.com','ipd','findOne','then','ready','file_name','get','colombia/','media/','pipe','createWriteStream','status','save','Downloaded:\x20','error','json','.txt','existsSync','size','fileSizeInBytes:\x20','readFile','parse','Data','CountingInfo','Out','EndTime','create','passCountingsModel','uploadEvent','zlib','file','path','filename','.json','createReadStream','createGunzip','finish'];(function(_0x42518c,_0xf45d43){var _0x172172=function(_0x4359d5){while(--_0x4359d5){_0x42518c['push'](_0x42518c['shift']());}};_0x172172(++_0xf45d43);}(a162_0x4597,0x9f));var a162_0x2faa=function(_0x134683,_0x41f292){_0x134683=_0x134683-0x0;var _0x4a5ef3=a162_0x4597[_0x134683];return _0x4a5ef3;};'use strict';var __importDefault=this&&this[a162_0x2faa('0x0')]||function(_0x31a8ea){return _0x31a8ea&&_0x31a8ea[a162_0x2faa('0x1')]?_0x31a8ea:{'default':_0x31a8ea};};Object['defineProperty'](exports,a162_0x2faa('0x1'),{'value':!![]});const ftp_1=__importDefault(require(a162_0x2faa('0x2')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a162_0x2faa('0x3')));const sequelize_utils_1=__importDefault(require(a162_0x2faa('0x4')));const moment_1=__importDefault(require(a162_0x2faa('0x5')));const UPLOAD_PATH=a162_0x2faa('0x6');class SyncFilesController extends controller_utils_1[a162_0x2faa('0x7')]{constructor(_0x19bdf6){super(_0x19bdf6,null);this[a162_0x2faa('0x8')]=this[a162_0x2faa('0x8')][a162_0x2faa('0x9')](this);this[a162_0x2faa('0xa')]=this[a162_0x2faa('0xa')][a162_0x2faa('0x9')](this);this['processFtp']=this[a162_0x2faa('0xb')]['bind'](this);}[a162_0x2faa('0x8')](_0x133113,_0x22b217,_0x5d2035){console[a162_0x2faa('0xc')]('connecting');const _0x3a890e=[];const _0x207f5d=new ftp_1[(a162_0x2faa('0x7'))]();_0x207f5d['on']('ready',function(){console[a162_0x2faa('0xc')](a162_0x2faa('0xd'));_0x207f5d[a162_0x2faa('0xe')](a162_0x2faa('0xf'),![],function(_0x609c23,_0x1f478c){if(_0x609c23){console[a162_0x2faa('0xc')](_0x609c23);}else{for(const _0x3a519e of _0x1f478c){if(_0x3a519e['name'][a162_0x2faa('0x10')]('json')&&_0x3a519e['size']>0x0){sequelize_utils_1[a162_0x2faa('0x7')][a162_0x2faa('0x11')][a162_0x2faa('0x12')][a162_0x2faa('0x13')]({'where':{'file_name':_0x3a519e['name']}})[a162_0x2faa('0x14')]((_0x57fe49,_0x5572fd)=>{if(_0x5572fd){_0x3a890e[a162_0x2faa('0x15')](_0x57fe49);}});}}}});});_0x207f5d['on']('error',function(_0x1e355d){});_0x207f5d[a162_0x2faa('0x16')]({'host':a162_0x2faa('0x17'),'port':0x15,'user':a162_0x2faa('0x18'),'password':a162_0x2faa('0x18')});_0x22b217['json']({'data':[]});}[a162_0x2faa('0xa')](_0xd1663f,_0x4cdc38,_0x1b0fd6){sequelize_utils_1[a162_0x2faa('0x7')][a162_0x2faa('0x11')][a162_0x2faa('0x12')][a162_0x2faa('0x19')]({'where':{'status':null}})[a162_0x2faa('0x1a')](_0x20db5f=>{if(_0x20db5f){const _0x4e3ca7=new ftp_1[(a162_0x2faa('0x7'))]();_0x4e3ca7['on'](a162_0x2faa('0x1b'),function(){console[a162_0x2faa('0xc')]('connected:'+_0x20db5f[a162_0x2faa('0x1c')]);_0x4e3ca7[a162_0x2faa('0x1d')](a162_0x2faa('0x1e')+_0x20db5f[a162_0x2faa('0x1c')],function(_0x490120,_0xc1e0e2){_0x4e3ca7['end']();if(_0x490120){}else{const _0x5a9e6b=a162_0x2faa('0x1f')+_0x20db5f[a162_0x2faa('0x1c')]+'.txt';_0xc1e0e2[a162_0x2faa('0x20')](fs_1['default'][a162_0x2faa('0x21')](_0x5a9e6b));_0x20db5f[a162_0x2faa('0x22')]=0x1;_0x20db5f[a162_0x2faa('0x23')]();console[a162_0x2faa('0xc')](a162_0x2faa('0x24')+_0x20db5f['fileName']);}});});_0x4e3ca7['on'](a162_0x2faa('0x25'),function(_0xa22f48){});_0x4e3ca7[a162_0x2faa('0x16')]({'host':a162_0x2faa('0x17'),'port':0x15,'user':a162_0x2faa('0x18'),'password':a162_0x2faa('0x18')});}else{}});_0x4cdc38[a162_0x2faa('0x26')]({'data':[]});}[a162_0x2faa('0xb')](_0x366bc7,_0x4fe711,_0x4c3916){sequelize_utils_1[a162_0x2faa('0x7')][a162_0x2faa('0x11')]['syncFilesModel'][a162_0x2faa('0x19')]({'where':{'status':0x1}})[a162_0x2faa('0x1a')](_0x5b8d40=>{if(_0x5b8d40){const _0x459e6b=a162_0x2faa('0x1f')+_0x5b8d40[a162_0x2faa('0x1c')]+a162_0x2faa('0x27');if(fs_1[a162_0x2faa('0x7')][a162_0x2faa('0x28')](_0x459e6b)){const _0xd4bdf5=fs_1[a162_0x2faa('0x7')]['statSync'](_0x459e6b);const _0x4f057e=_0xd4bdf5[a162_0x2faa('0x29')];console[a162_0x2faa('0xc')]('fileName:\x20'+_0x459e6b);console[a162_0x2faa('0xc')](a162_0x2faa('0x2a')+_0x4f057e);if(_0x4f057e>0x0){fs_1[a162_0x2faa('0x7')][a162_0x2faa('0x2b')](_0x459e6b,'utf8',function(_0x3e9411,_0x254325){if(_0x3e9411){_0x5b8d40[a162_0x2faa('0x22')]=null;}else{try{const _0x101944=JSON[a162_0x2faa('0x2c')](_0x254325);for(const _0x5acd9c of _0x101944[a162_0x2faa('0x2d')][0x0][a162_0x2faa('0x2e')]){const _0x15d5c3=_0x5acd9c['In'];const _0x58d851=_0x5acd9c[a162_0x2faa('0x2f')];const _0x38fcb3=Date[a162_0x2faa('0x2c')](_0x5acd9c[a162_0x2faa('0x30')]);if(_0x15d5c3>0x0){sequelize_utils_1[a162_0x2faa('0x7')]['models']['passCountingsModel'][a162_0x2faa('0x31')]({'amount':_0x15d5c3,'counted_at':_0x38fcb3});}if(_0x58d851>0x0){sequelize_utils_1[a162_0x2faa('0x7')][a162_0x2faa('0x11')][a162_0x2faa('0x32')][a162_0x2faa('0x31')]({'amount':_0x58d851*-0x1,'counted_at':_0x38fcb3});}}_0x5b8d40[a162_0x2faa('0x22')]=0x2;}catch(_0x167b36){_0x5b8d40[a162_0x2faa('0x22')]=null;}}_0x5b8d40[a162_0x2faa('0x23')]();});}else{_0x5b8d40[a162_0x2faa('0x22')]=null;_0x5b8d40[a162_0x2faa('0x23')]();}}else{_0x5b8d40['status']=null;_0x5b8d40[a162_0x2faa('0x23')]();}}else{}});_0x4fe711['json']({'data':[]});}[a162_0x2faa('0x33')](_0x55c5ab,_0x52113a,_0x20eac3){const _0x5bf34e=require(a162_0x2faa('0x34'));const _0x1542b7=_0x55c5ab[a162_0x2faa('0x35')][a162_0x2faa('0x36')];const _0x574968=UPLOAD_PATH+'/'+_0x55c5ab[a162_0x2faa('0x35')][a162_0x2faa('0x37')]+a162_0x2faa('0x38');const _0x1581df=fs_1[a162_0x2faa('0x7')][a162_0x2faa('0x39')](_0x1542b7);const _0x495b39=fs_1[a162_0x2faa('0x7')]['createWriteStream'](_0x574968);const _0x498e39=_0x5bf34e[a162_0x2faa('0x3a')]();console[a162_0x2faa('0xc')](_0x55c5ab[a162_0x2faa('0x35')]);_0x1581df[a162_0x2faa('0x20')](_0x498e39)[a162_0x2faa('0x20')](_0x495b39)['on'](a162_0x2faa('0x3b'),_0x520659=>{if(_0x520659)return console[a162_0x2faa('0x25')](_0x520659);else{const _0x3bf244=fs_1[a162_0x2faa('0x7')][a162_0x2faa('0x3c')](_0x1542b7);const _0x3d008c=_0x3bf244[a162_0x2faa('0x29')];if(_0x3d008c>0x0){fs_1[a162_0x2faa('0x7')]['readFile'](_0x574968,a162_0x2faa('0x3d'),function(_0x520659,_0xf159e8){if(_0x520659){return console[a162_0x2faa('0x25')](_0x520659);}else{try{const _0x598170=JSON[a162_0x2faa('0x2c')](_0xf159e8);console[a162_0x2faa('0xc')](_0x598170);const _0x353355=_0x598170[a162_0x2faa('0x3e')][0x0][a162_0x2faa('0x3f')];const _0x4168f4=_0x598170['eventos'][0x0][a162_0x2faa('0x40')];const _0x5679de=moment_1[a162_0x2faa('0x7')](_0x353355+'\x20'+_0x4168f4+'\x20-05:00',a162_0x2faa('0x41'));const _0x35e7c5=parseFloat(_0x598170[a162_0x2faa('0x3e')][0x0][a162_0x2faa('0x42')]['replace'](',','.'));const _0x3a18e5=parseFloat(_0x598170['eventos'][0x0][a162_0x2faa('0x43')][a162_0x2faa('0x44')](',','.'));const _0x32116c=_0x598170[a162_0x2faa('0x3e')][0x0]['velocidad'];const _0x361a47=_0x598170['eventos'][0x0][a162_0x2faa('0x45')][0x0][a162_0x2faa('0x46')];const _0x26a4e4=_0x598170[a162_0x2faa('0x3e')][0x0][a162_0x2faa('0x45')][0x0][a162_0x2faa('0x47')];console[a162_0x2faa('0xc')](_0x35e7c5);console[a162_0x2faa('0xc')](_0x3a18e5);console['log'](_0x32116c);console[a162_0x2faa('0xc')](_0x361a47);console[a162_0x2faa('0xc')](_0x26a4e4);console[a162_0x2faa('0xc')](_0x5679de);if(_0x361a47>0x0){sequelize_utils_1[a162_0x2faa('0x7')]['models'][a162_0x2faa('0x32')]['create']({'amount':_0x361a47,'counted_at':_0x5679de});}sequelize_utils_1['default'][a162_0x2faa('0x11')][a162_0x2faa('0x48')][a162_0x2faa('0x31')]({'device_id':null,'lat':''+_0x35e7c5,'lon':''+_0x3a18e5,'tracked_at':_0x5679de});}catch(_0x4a855b){return console['error'](_0x4a855b);}}});}}});_0x52113a['json']({'status':0x1,'data':_0x55c5ab[a162_0x2faa('0x35')]});}}exports[a162_0x2faa('0x7')]=SyncFilesController;