var a73_0x3baf=['fecha','hora','YYYYMMDD\x20HHmmss\x20Z','latitud','replace','longitud','velocidad','puerta','salidas','locationPointsModel','__importDefault','__esModule','ftp','../../infrastructure/controller-utils','../../infrastructure/sequelize-utils','moment','syncFtp','bind','processFtp','log','default','ready','list','colombia','name','endsWith','json','size','models','findOrCreate','push','error','connect','downloadFtp','syncFilesModel','findOne','then','file_name','get','colombia/','media/','pipe','save','Downloaded:\x20','fileName','ftp.vivotek.com','ipd','.txt','fileName:\x20','fileSizeInBytes:\x20','readFile','utf8','parse','Data','Out','passCountingsModel','create','status','uploadEvent','path','file','filename','createWriteStream','createGunzip','finish','statSync','eventos'];(function(_0x5a49f6,_0x5de104){var _0x53b924=function(_0x4815bb){while(--_0x4815bb){_0x5a49f6['push'](_0x5a49f6['shift']());}};_0x53b924(++_0x5de104);}(a73_0x3baf,0x159));var a73_0x5241=function(_0x3e228c,_0x596767){_0x3e228c=_0x3e228c-0x0;var _0x35e8de=a73_0x3baf[_0x3e228c];return _0x35e8de;};'use strict';var __importDefault=this&&this[a73_0x5241('0x0')]||function(_0x123429){return _0x123429&&_0x123429[a73_0x5241('0x1')]?_0x123429:{'default':_0x123429};};Object['defineProperty'](exports,a73_0x5241('0x1'),{'value':!![]});const ftp_1=__importDefault(require(a73_0x5241('0x2')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a73_0x5241('0x3')));const sequelize_utils_1=__importDefault(require(a73_0x5241('0x4')));const moment_1=__importDefault(require(a73_0x5241('0x5')));const UPLOAD_PATH='media';class SyncFilesController extends controller_utils_1['default']{constructor(_0x1e6364){super(_0x1e6364,null);this[a73_0x5241('0x6')]=this[a73_0x5241('0x6')]['bind'](this);this['downloadFtp']=this['downloadFtp'][a73_0x5241('0x7')](this);this['processFtp']=this[a73_0x5241('0x8')][a73_0x5241('0x7')](this);}[a73_0x5241('0x6')](_0x2c7ba3,_0x33bcee,_0x514f4c){console[a73_0x5241('0x9')]('connecting');const _0x1e06ba=[];const _0x45dcbf=new ftp_1[(a73_0x5241('0xa'))]();_0x45dcbf['on'](a73_0x5241('0xb'),function(){console['log']('connected');_0x45dcbf[a73_0x5241('0xc')](a73_0x5241('0xd'),![],function(_0x1e5d9d,_0x164b6d){if(_0x1e5d9d){console[a73_0x5241('0x9')](_0x1e5d9d);}else{for(const _0x2e3a20 of _0x164b6d){if(_0x2e3a20[a73_0x5241('0xe')][a73_0x5241('0xf')](a73_0x5241('0x10'))&&_0x2e3a20[a73_0x5241('0x11')]>0x0){sequelize_utils_1[a73_0x5241('0xa')][a73_0x5241('0x12')]['syncFilesModel'][a73_0x5241('0x13')]({'where':{'file_name':_0x2e3a20[a73_0x5241('0xe')]}})['spread']((_0x104b9b,_0x1990f9)=>{if(_0x1990f9){_0x1e06ba[a73_0x5241('0x14')](_0x104b9b);}});}}}});});_0x45dcbf['on'](a73_0x5241('0x15'),function(_0x389a55){});_0x45dcbf[a73_0x5241('0x16')]({'host':'ftp.vivotek.com','port':0x15,'user':'ipd','password':'ipd'});_0x33bcee[a73_0x5241('0x10')]({'data':[]});}[a73_0x5241('0x17')](_0x47541b,_0x44d7d0,_0x354da2){sequelize_utils_1[a73_0x5241('0xa')]['models'][a73_0x5241('0x18')][a73_0x5241('0x19')]({'where':{'status':null}})[a73_0x5241('0x1a')](_0x38aef9=>{if(_0x38aef9){const _0x3016fa=new ftp_1[(a73_0x5241('0xa'))]();_0x3016fa['on']('ready',function(){console['log']('connected:'+_0x38aef9[a73_0x5241('0x1b')]);_0x3016fa[a73_0x5241('0x1c')](a73_0x5241('0x1d')+_0x38aef9[a73_0x5241('0x1b')],function(_0x4efae5,_0x4ffb2f){_0x3016fa['end']();if(_0x4efae5){}else{const _0x27b53a=a73_0x5241('0x1e')+_0x38aef9['file_name']+'.txt';_0x4ffb2f[a73_0x5241('0x1f')](fs_1[a73_0x5241('0xa')]['createWriteStream'](_0x27b53a));_0x38aef9['status']=0x1;_0x38aef9[a73_0x5241('0x20')]();console[a73_0x5241('0x9')](a73_0x5241('0x21')+_0x38aef9[a73_0x5241('0x22')]);}});});_0x3016fa['on']('error',function(_0x5b1f12){});_0x3016fa[a73_0x5241('0x16')]({'host':a73_0x5241('0x23'),'port':0x15,'user':a73_0x5241('0x24'),'password':a73_0x5241('0x24')});}else{}});_0x44d7d0[a73_0x5241('0x10')]({'data':[]});}[a73_0x5241('0x8')](_0x540432,_0x45809a,_0xeb85ba){sequelize_utils_1[a73_0x5241('0xa')][a73_0x5241('0x12')]['syncFilesModel'][a73_0x5241('0x19')]({'where':{'status':0x1}})[a73_0x5241('0x1a')](_0x226d3a=>{if(_0x226d3a){const _0x6be0c3=a73_0x5241('0x1e')+_0x226d3a[a73_0x5241('0x1b')]+a73_0x5241('0x25');if(fs_1['default']['existsSync'](_0x6be0c3)){const _0x59f7b2=fs_1[a73_0x5241('0xa')]['statSync'](_0x6be0c3);const _0x3bf447=_0x59f7b2[a73_0x5241('0x11')];console[a73_0x5241('0x9')](a73_0x5241('0x26')+_0x6be0c3);console[a73_0x5241('0x9')](a73_0x5241('0x27')+_0x3bf447);if(_0x3bf447>0x0){fs_1[a73_0x5241('0xa')][a73_0x5241('0x28')](_0x6be0c3,a73_0x5241('0x29'),function(_0x8c1990,_0x47073a){if(_0x8c1990){_0x226d3a['status']=null;}else{try{const _0x4392a6=JSON[a73_0x5241('0x2a')](_0x47073a);for(const _0x68c48a of _0x4392a6[a73_0x5241('0x2b')][0x0]['CountingInfo']){const _0x5ca067=_0x68c48a['In'];const _0x19708e=_0x68c48a[a73_0x5241('0x2c')];const _0x582545=Date[a73_0x5241('0x2a')](_0x68c48a['EndTime']);if(_0x5ca067>0x0){sequelize_utils_1[a73_0x5241('0xa')][a73_0x5241('0x12')][a73_0x5241('0x2d')]['create']({'amount':_0x5ca067,'counted_at':_0x582545});}if(_0x19708e>0x0){sequelize_utils_1[a73_0x5241('0xa')][a73_0x5241('0x12')]['passCountingsModel'][a73_0x5241('0x2e')]({'amount':_0x19708e*-0x1,'counted_at':_0x582545});}}_0x226d3a[a73_0x5241('0x2f')]=0x2;}catch(_0x11edd7){_0x226d3a['status']=null;}}_0x226d3a[a73_0x5241('0x20')]();});}else{_0x226d3a[a73_0x5241('0x2f')]=null;_0x226d3a[a73_0x5241('0x20')]();}}else{_0x226d3a[a73_0x5241('0x2f')]=null;_0x226d3a[a73_0x5241('0x20')]();}}else{}});_0x45809a[a73_0x5241('0x10')]({'data':[]});}[a73_0x5241('0x30')](_0x37aa4e,_0x51f47f,_0x522d3f){const _0x141335=require('zlib');const _0x16c882=_0x37aa4e['file'][a73_0x5241('0x31')];const _0x2d3b25=UPLOAD_PATH+'/'+_0x37aa4e[a73_0x5241('0x32')][a73_0x5241('0x33')]+'.json';const _0xa34107=fs_1[a73_0x5241('0xa')]['createReadStream'](_0x16c882);const _0x25dbd5=fs_1['default'][a73_0x5241('0x34')](_0x2d3b25);const _0x1657da=_0x141335[a73_0x5241('0x35')]();console[a73_0x5241('0x9')](_0x37aa4e['file']);_0xa34107[a73_0x5241('0x1f')](_0x1657da)['pipe'](_0x25dbd5)['on'](a73_0x5241('0x36'),_0x170e3c=>{if(_0x170e3c)return console['error'](_0x170e3c);else{const _0x2eb6ff=fs_1[a73_0x5241('0xa')][a73_0x5241('0x37')](_0x16c882);const _0x2740e7=_0x2eb6ff['size'];if(_0x2740e7>0x0){fs_1[a73_0x5241('0xa')][a73_0x5241('0x28')](_0x2d3b25,a73_0x5241('0x29'),function(_0x170e3c,_0x6ade59){if(_0x170e3c){return console[a73_0x5241('0x15')](_0x170e3c);}else{try{const _0x1e00b4=JSON['parse'](_0x6ade59);console[a73_0x5241('0x9')](_0x1e00b4);const _0xbbb3bc=_0x1e00b4[a73_0x5241('0x38')][0x0][a73_0x5241('0x39')];const _0x2d1403=_0x1e00b4[a73_0x5241('0x38')][0x0][a73_0x5241('0x3a')];const _0x2b8add=moment_1['default'](_0xbbb3bc+'\x20'+_0x2d1403+'\x20-05:00',a73_0x5241('0x3b'));const _0x2f2732=parseFloat(_0x1e00b4[a73_0x5241('0x38')][0x0][a73_0x5241('0x3c')][a73_0x5241('0x3d')](',','.'));const _0x3ee8be=parseFloat(_0x1e00b4[a73_0x5241('0x38')][0x0][a73_0x5241('0x3e')][a73_0x5241('0x3d')](',','.'));const _0x4aa20d=_0x1e00b4[a73_0x5241('0x38')][0x0][a73_0x5241('0x3f')];const _0x36d531=_0x1e00b4[a73_0x5241('0x38')][0x0][a73_0x5241('0x40')][0x0]['ingresos'];const _0x4a7c79=_0x1e00b4['eventos'][0x0][a73_0x5241('0x40')][0x0][a73_0x5241('0x41')];console[a73_0x5241('0x9')](_0x2f2732);console[a73_0x5241('0x9')](_0x3ee8be);console[a73_0x5241('0x9')](_0x4aa20d);console['log'](_0x36d531);console[a73_0x5241('0x9')](_0x4a7c79);console[a73_0x5241('0x9')](_0x2b8add);if(_0x36d531>0x0){sequelize_utils_1[a73_0x5241('0xa')][a73_0x5241('0x12')][a73_0x5241('0x2d')][a73_0x5241('0x2e')]({'amount':_0x36d531,'counted_at':_0x2b8add});}sequelize_utils_1[a73_0x5241('0xa')][a73_0x5241('0x12')][a73_0x5241('0x42')][a73_0x5241('0x2e')]({'device_id':null,'lat':''+_0x2f2732,'lon':''+_0x3ee8be,'tracked_at':_0x2b8add});}catch(_0x36262f){return console['error'](_0x36262f);}}});}}});_0x51f47f[a73_0x5241('0x10')]({'status':0x1,'data':_0x37aa4e[a73_0x5241('0x32')]});}}exports['default']=SyncFilesController;