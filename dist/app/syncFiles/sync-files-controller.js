var a162_0x4755=['then','connected:','get','colombia/','file_name','media/','.txt','createWriteStream','status','Downloaded:\x20','existsSync','statSync','fileName:\x20','readFile','utf8','parse','Data','CountingInfo','Out','EndTime','passCountingsModel','save','uploadEvent','zlib','path','file','filename','.json','createReadStream','createGunzip','pipe','finish','eventos','fecha','hora','\x20-05:00','YYYYMMDD\x20HHmmss\x20Z','latitud','replace','longitud','puerta','create','locationPointsModel','__importDefault','__esModule','../../infrastructure/controller-utils','../../infrastructure/sequelize-utils','default','syncFtp','bind','downloadFtp','processFtp','log','connecting','ready','connected','list','name','endsWith','json','size','syncFilesModel','findOrCreate','spread','push','error','connect','ftp.vivotek.com','ipd','models','findOne'];(function(_0x293a9a,_0x5255b1){var _0x3fa73b=function(_0x4f6f52){while(--_0x4f6f52){_0x293a9a['push'](_0x293a9a['shift']());}};_0x3fa73b(++_0x5255b1);}(a162_0x4755,0x147));var a162_0x2c76=function(_0x51bd8b,_0x23d8db){_0x51bd8b=_0x51bd8b-0x0;var _0x235f7d=a162_0x4755[_0x51bd8b];return _0x235f7d;};'use strict';var __importDefault=this&&this[a162_0x2c76('0x0')]||function(_0x3eaa2c){return _0x3eaa2c&&_0x3eaa2c[a162_0x2c76('0x1')]?_0x3eaa2c:{'default':_0x3eaa2c};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a162_0x2c76('0x2')));const sequelize_utils_1=__importDefault(require(a162_0x2c76('0x3')));const moment_1=__importDefault(require('moment'));const UPLOAD_PATH='media';class SyncFilesController extends controller_utils_1[a162_0x2c76('0x4')]{constructor(_0x5bd953){super(_0x5bd953,null);this[a162_0x2c76('0x5')]=this[a162_0x2c76('0x5')][a162_0x2c76('0x6')](this);this[a162_0x2c76('0x7')]=this[a162_0x2c76('0x7')][a162_0x2c76('0x6')](this);this['processFtp']=this[a162_0x2c76('0x8')]['bind'](this);}['syncFtp'](_0x565091,_0x15ede7,_0x3c3c45){console[a162_0x2c76('0x9')](a162_0x2c76('0xa'));const _0x19c297=[];const _0x5dac85=new ftp_1[(a162_0x2c76('0x4'))]();_0x5dac85['on'](a162_0x2c76('0xb'),function(){console['log'](a162_0x2c76('0xc'));_0x5dac85[a162_0x2c76('0xd')]('colombia',![],function(_0x2dea81,_0x389964){if(_0x2dea81){console[a162_0x2c76('0x9')](_0x2dea81);}else{for(const _0x194b3d of _0x389964){if(_0x194b3d[a162_0x2c76('0xe')][a162_0x2c76('0xf')](a162_0x2c76('0x10'))&&_0x194b3d[a162_0x2c76('0x11')]>0x0){sequelize_utils_1[a162_0x2c76('0x4')]['models'][a162_0x2c76('0x12')][a162_0x2c76('0x13')]({'where':{'file_name':_0x194b3d['name']}})[a162_0x2c76('0x14')]((_0x1fa206,_0x3dd531)=>{if(_0x3dd531){_0x19c297[a162_0x2c76('0x15')](_0x1fa206);}});}}}});});_0x5dac85['on'](a162_0x2c76('0x16'),function(_0x4f82d5){});_0x5dac85[a162_0x2c76('0x17')]({'host':a162_0x2c76('0x18'),'port':0x15,'user':a162_0x2c76('0x19'),'password':a162_0x2c76('0x19')});_0x15ede7['json']({'data':[]});}[a162_0x2c76('0x7')](_0x1b42f2,_0x55f3d4,_0x3b16b5){sequelize_utils_1[a162_0x2c76('0x4')][a162_0x2c76('0x1a')]['syncFilesModel'][a162_0x2c76('0x1b')]({'where':{'status':null}})[a162_0x2c76('0x1c')](_0x2dd65e=>{if(_0x2dd65e){const _0x79a08=new ftp_1[(a162_0x2c76('0x4'))]();_0x79a08['on']('ready',function(){console['log'](a162_0x2c76('0x1d')+_0x2dd65e['file_name']);_0x79a08[a162_0x2c76('0x1e')](a162_0x2c76('0x1f')+_0x2dd65e[a162_0x2c76('0x20')],function(_0x342daf,_0x25723e){_0x79a08['end']();if(_0x342daf){}else{const _0x2c6b63=a162_0x2c76('0x21')+_0x2dd65e['file_name']+a162_0x2c76('0x22');_0x25723e['pipe'](fs_1[a162_0x2c76('0x4')][a162_0x2c76('0x23')](_0x2c6b63));_0x2dd65e[a162_0x2c76('0x24')]=0x1;_0x2dd65e['save']();console['log'](a162_0x2c76('0x25')+_0x2dd65e['fileName']);}});});_0x79a08['on'](a162_0x2c76('0x16'),function(_0x53014e){});_0x79a08['connect']({'host':a162_0x2c76('0x18'),'port':0x15,'user':'ipd','password':a162_0x2c76('0x19')});}else{}});_0x55f3d4[a162_0x2c76('0x10')]({'data':[]});}[a162_0x2c76('0x8')](_0x19d58f,_0x18f01e,_0x52074a){sequelize_utils_1[a162_0x2c76('0x4')][a162_0x2c76('0x1a')][a162_0x2c76('0x12')][a162_0x2c76('0x1b')]({'where':{'status':0x1}})[a162_0x2c76('0x1c')](_0x14834c=>{if(_0x14834c){const _0x7e157f=a162_0x2c76('0x21')+_0x14834c[a162_0x2c76('0x20')]+a162_0x2c76('0x22');if(fs_1['default'][a162_0x2c76('0x26')](_0x7e157f)){const _0x5d449a=fs_1[a162_0x2c76('0x4')][a162_0x2c76('0x27')](_0x7e157f);const _0x364807=_0x5d449a[a162_0x2c76('0x11')];console[a162_0x2c76('0x9')](a162_0x2c76('0x28')+_0x7e157f);console[a162_0x2c76('0x9')]('fileSizeInBytes:\x20'+_0x364807);if(_0x364807>0x0){fs_1[a162_0x2c76('0x4')][a162_0x2c76('0x29')](_0x7e157f,a162_0x2c76('0x2a'),function(_0x2a70e8,_0x4314ea){if(_0x2a70e8){_0x14834c[a162_0x2c76('0x24')]=null;}else{try{const _0x3b5c79=JSON[a162_0x2c76('0x2b')](_0x4314ea);for(const _0x23d1e9 of _0x3b5c79[a162_0x2c76('0x2c')][0x0][a162_0x2c76('0x2d')]){const _0x5b1027=_0x23d1e9['In'];const _0x3ac849=_0x23d1e9[a162_0x2c76('0x2e')];const _0x35ead8=Date[a162_0x2c76('0x2b')](_0x23d1e9[a162_0x2c76('0x2f')]);if(_0x5b1027>0x0){sequelize_utils_1[a162_0x2c76('0x4')][a162_0x2c76('0x1a')][a162_0x2c76('0x30')]['create']({'amount':_0x5b1027,'counted_at':_0x35ead8});}if(_0x3ac849>0x0){sequelize_utils_1[a162_0x2c76('0x4')]['models'][a162_0x2c76('0x30')]['create']({'amount':_0x3ac849*-0x1,'counted_at':_0x35ead8});}}_0x14834c[a162_0x2c76('0x24')]=0x2;}catch(_0x2e7a6e){_0x14834c[a162_0x2c76('0x24')]=null;}}_0x14834c[a162_0x2c76('0x31')]();});}else{_0x14834c[a162_0x2c76('0x24')]=null;_0x14834c[a162_0x2c76('0x31')]();}}else{_0x14834c[a162_0x2c76('0x24')]=null;_0x14834c[a162_0x2c76('0x31')]();}}else{}});_0x18f01e[a162_0x2c76('0x10')]({'data':[]});}[a162_0x2c76('0x32')](_0x45d037,_0x4e39ae,_0xc808f6){const _0x346ec8=require(a162_0x2c76('0x33'));const _0x20a2bd=_0x45d037['file'][a162_0x2c76('0x34')];const _0x3773ea=UPLOAD_PATH+'/'+_0x45d037[a162_0x2c76('0x35')][a162_0x2c76('0x36')]+a162_0x2c76('0x37');const _0x1a7a49=fs_1[a162_0x2c76('0x4')][a162_0x2c76('0x38')](_0x20a2bd);const _0x2f16c4=fs_1[a162_0x2c76('0x4')]['createWriteStream'](_0x3773ea);const _0x1ae450=_0x346ec8[a162_0x2c76('0x39')]();console[a162_0x2c76('0x9')](_0x45d037['file']);_0x1a7a49['pipe'](_0x1ae450)[a162_0x2c76('0x3a')](_0x2f16c4)['on'](a162_0x2c76('0x3b'),_0x2e16d0=>{if(_0x2e16d0)return console[a162_0x2c76('0x16')](_0x2e16d0);else{const _0x1bb871=fs_1[a162_0x2c76('0x4')][a162_0x2c76('0x27')](_0x20a2bd);const _0x39a870=_0x1bb871[a162_0x2c76('0x11')];if(_0x39a870>0x0){fs_1['default'][a162_0x2c76('0x29')](_0x3773ea,a162_0x2c76('0x2a'),function(_0x2e16d0,_0xf1248a){if(_0x2e16d0){return console[a162_0x2c76('0x16')](_0x2e16d0);}else{try{const _0x173adb=JSON[a162_0x2c76('0x2b')](_0xf1248a);console[a162_0x2c76('0x9')](_0x173adb);const _0x1d5887=_0x173adb[a162_0x2c76('0x3c')][0x0][a162_0x2c76('0x3d')];const _0x11c13d=_0x173adb[a162_0x2c76('0x3c')][0x0][a162_0x2c76('0x3e')];const _0x106892=moment_1[a162_0x2c76('0x4')](_0x1d5887+'\x20'+_0x11c13d+a162_0x2c76('0x3f'),a162_0x2c76('0x40'));const _0x12b938=parseFloat(_0x173adb[a162_0x2c76('0x3c')][0x0][a162_0x2c76('0x41')][a162_0x2c76('0x42')](',','.'));const _0x2edda6=parseFloat(_0x173adb[a162_0x2c76('0x3c')][0x0][a162_0x2c76('0x43')][a162_0x2c76('0x42')](',','.'));const _0xb8d499=_0x173adb['eventos'][0x0]['velocidad'];const _0x588573=_0x173adb[a162_0x2c76('0x3c')][0x0]['puerta'][0x0]['ingresos'];const _0x45419d=_0x173adb['eventos'][0x0][a162_0x2c76('0x44')][0x0]['salidas'];console[a162_0x2c76('0x9')](_0x12b938);console[a162_0x2c76('0x9')](_0x2edda6);console[a162_0x2c76('0x9')](_0xb8d499);console[a162_0x2c76('0x9')](_0x588573);console[a162_0x2c76('0x9')](_0x45419d);console[a162_0x2c76('0x9')](_0x106892);if(_0x588573>0x0){sequelize_utils_1[a162_0x2c76('0x4')][a162_0x2c76('0x1a')][a162_0x2c76('0x30')][a162_0x2c76('0x45')]({'amount':_0x588573,'counted_at':_0x106892});}sequelize_utils_1[a162_0x2c76('0x4')][a162_0x2c76('0x1a')][a162_0x2c76('0x46')][a162_0x2c76('0x45')]({'device_id':null,'lat':''+_0x12b938,'lon':''+_0x2edda6,'tracked_at':_0x106892});}catch(_0x584e2b){return console['error'](_0x584e2b);}}});}}});_0x4e39ae[a162_0x2c76('0x10')]({'status':0x1,'data':_0x45d037[a162_0x2c76('0x35')]});}}exports[a162_0x2c76('0x4')]=SyncFilesController;