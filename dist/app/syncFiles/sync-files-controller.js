var a126_0x2f22=['createReadStream','utf8','eventos','fecha','hora','YYYYMMDD\x20HHmmss\x20Z','replace','longitud','puerta','salidas','create','locationPointsModel','__importDefault','__esModule','../../infrastructure/base-controller','media','syncFtp','bind','downloadFtp','processFtp','log','connecting','default','ready','connected','list','colombia','name','endsWith','size','models','syncFilesModel','findOrCreate','spread','push','error','connect','ftp.vivotek.com','ipd','json','findOne','then','connected:','get','colombia/','end','media/','file_name','.txt','pipe','createWriteStream','status','save','Downloaded:\x20','fileName','existsSync','statSync','fileName:\x20','fileSizeInBytes:\x20','readFile','parse','Data','Out','passCountingsModel','uploadEvent','zlib','file','filename'];(function(_0x22fc1a,_0x8c8fa4){var _0x54ae6f=function(_0x1c4b96){while(--_0x1c4b96){_0x22fc1a['push'](_0x22fc1a['shift']());}};_0x54ae6f(++_0x8c8fa4);}(a126_0x2f22,0xd8));var a126_0xa3e9=function(_0x1296dc,_0x210001){_0x1296dc=_0x1296dc-0x0;var _0x1b2706=a126_0x2f22[_0x1296dc];return _0x1b2706;};'use strict';var __importDefault=this&&this[a126_0xa3e9('0x0')]||function(_0x393499){return _0x393499&&_0x393499['__esModule']?_0x393499:{'default':_0x393499};};Object['defineProperty'](exports,a126_0xa3e9('0x1'),{'value':!![]});const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));const base_controller_1=__importDefault(require(a126_0xa3e9('0x2')));const sequelize_utils_1=__importDefault(require('../../infrastructure/sequelize-utils'));const moment_1=__importDefault(require('moment'));const UPLOAD_PATH=a126_0xa3e9('0x3');class SyncFilesController extends base_controller_1['default']{constructor(_0x514586){super(_0x514586,null);this['syncFtp']=this[a126_0xa3e9('0x4')][a126_0xa3e9('0x5')](this);this[a126_0xa3e9('0x6')]=this['downloadFtp'][a126_0xa3e9('0x5')](this);this[a126_0xa3e9('0x7')]=this[a126_0xa3e9('0x7')][a126_0xa3e9('0x5')](this);}[a126_0xa3e9('0x4')](_0x50ee79,_0x5a1359,_0x354363){console[a126_0xa3e9('0x8')](a126_0xa3e9('0x9'));const _0x58b287=[];const _0x1c6f64=new ftp_1[(a126_0xa3e9('0xa'))]();_0x1c6f64['on'](a126_0xa3e9('0xb'),function(){console[a126_0xa3e9('0x8')](a126_0xa3e9('0xc'));_0x1c6f64[a126_0xa3e9('0xd')](a126_0xa3e9('0xe'),![],function(_0x28cf13,_0x886adc){if(_0x28cf13){console['log'](_0x28cf13);}else{for(const _0x2295cd of _0x886adc){if(_0x2295cd[a126_0xa3e9('0xf')][a126_0xa3e9('0x10')]('json')&&_0x2295cd[a126_0xa3e9('0x11')]>0x0){sequelize_utils_1['default'][a126_0xa3e9('0x12')][a126_0xa3e9('0x13')][a126_0xa3e9('0x14')]({'where':{'file_name':_0x2295cd[a126_0xa3e9('0xf')]}})[a126_0xa3e9('0x15')]((_0x3c320c,_0x16d197)=>{if(_0x16d197){_0x58b287[a126_0xa3e9('0x16')](_0x3c320c);}});}}}});});_0x1c6f64['on'](a126_0xa3e9('0x17'),function(_0x2cf3df){});_0x1c6f64[a126_0xa3e9('0x18')]({'host':a126_0xa3e9('0x19'),'port':0x15,'user':a126_0xa3e9('0x1a'),'password':'ipd'});_0x5a1359[a126_0xa3e9('0x1b')]({'data':[]});}[a126_0xa3e9('0x6')](_0x185719,_0x80980c,_0xa27ffc){sequelize_utils_1['default'][a126_0xa3e9('0x12')][a126_0xa3e9('0x13')][a126_0xa3e9('0x1c')]({'where':{'status':null}})[a126_0xa3e9('0x1d')](_0x199486=>{if(_0x199486){const _0x448811=new ftp_1[(a126_0xa3e9('0xa'))]();_0x448811['on'](a126_0xa3e9('0xb'),function(){console[a126_0xa3e9('0x8')](a126_0xa3e9('0x1e')+_0x199486['file_name']);_0x448811[a126_0xa3e9('0x1f')](a126_0xa3e9('0x20')+_0x199486['file_name'],function(_0x2be58e,_0x3e712e){_0x448811[a126_0xa3e9('0x21')]();if(_0x2be58e){}else{const _0x42613a=a126_0xa3e9('0x22')+_0x199486[a126_0xa3e9('0x23')]+a126_0xa3e9('0x24');_0x3e712e[a126_0xa3e9('0x25')](fs_1['default'][a126_0xa3e9('0x26')](_0x42613a));_0x199486[a126_0xa3e9('0x27')]=0x1;_0x199486[a126_0xa3e9('0x28')]();console['log'](a126_0xa3e9('0x29')+_0x199486[a126_0xa3e9('0x2a')]);}});});_0x448811['on']('error',function(_0x5772ec){});_0x448811['connect']({'host':a126_0xa3e9('0x19'),'port':0x15,'user':a126_0xa3e9('0x1a'),'password':a126_0xa3e9('0x1a')});}else{}});_0x80980c[a126_0xa3e9('0x1b')]({'data':[]});}['processFtp'](_0x394909,_0x41ac78,_0x2edbcd){sequelize_utils_1[a126_0xa3e9('0xa')][a126_0xa3e9('0x12')][a126_0xa3e9('0x13')][a126_0xa3e9('0x1c')]({'where':{'status':0x1}})['then'](_0x4829fe=>{if(_0x4829fe){const _0x307365=a126_0xa3e9('0x22')+_0x4829fe[a126_0xa3e9('0x23')]+a126_0xa3e9('0x24');if(fs_1[a126_0xa3e9('0xa')][a126_0xa3e9('0x2b')](_0x307365)){const _0x1174ec=fs_1[a126_0xa3e9('0xa')][a126_0xa3e9('0x2c')](_0x307365);const _0x533f9e=_0x1174ec[a126_0xa3e9('0x11')];console[a126_0xa3e9('0x8')](a126_0xa3e9('0x2d')+_0x307365);console['log'](a126_0xa3e9('0x2e')+_0x533f9e);if(_0x533f9e>0x0){fs_1[a126_0xa3e9('0xa')][a126_0xa3e9('0x2f')](_0x307365,'utf8',function(_0x89ec74,_0x999b49){if(_0x89ec74){_0x4829fe[a126_0xa3e9('0x27')]=null;}else{try{const _0x35093f=JSON[a126_0xa3e9('0x30')](_0x999b49);for(const _0x1f0383 of _0x35093f[a126_0xa3e9('0x31')][0x0]['CountingInfo']){const _0x22949f=_0x1f0383['In'];const _0x4a0043=_0x1f0383[a126_0xa3e9('0x32')];const _0x103e7f=Date[a126_0xa3e9('0x30')](_0x1f0383['EndTime']);if(_0x22949f>0x0){sequelize_utils_1[a126_0xa3e9('0xa')]['models'][a126_0xa3e9('0x33')]['create']({'amount':_0x22949f,'counted_at':_0x103e7f});}if(_0x4a0043>0x0){sequelize_utils_1[a126_0xa3e9('0xa')]['models'][a126_0xa3e9('0x33')]['create']({'amount':_0x4a0043*-0x1,'counted_at':_0x103e7f});}}_0x4829fe['status']=0x2;}catch(_0x587c3e){_0x4829fe[a126_0xa3e9('0x27')]=null;}}_0x4829fe[a126_0xa3e9('0x28')]();});}else{_0x4829fe[a126_0xa3e9('0x27')]=null;_0x4829fe[a126_0xa3e9('0x28')]();}}else{_0x4829fe[a126_0xa3e9('0x27')]=null;_0x4829fe[a126_0xa3e9('0x28')]();}}else{}});_0x41ac78[a126_0xa3e9('0x1b')]({'data':[]});}[a126_0xa3e9('0x34')](_0x7d97d4,_0xf98c44,_0x59b642){const _0x4cdc23=require(a126_0xa3e9('0x35'));const _0x4f685b=_0x7d97d4['file']['path'];const _0x3a6497=UPLOAD_PATH+'/'+_0x7d97d4[a126_0xa3e9('0x36')][a126_0xa3e9('0x37')]+'.json';const _0x528f59=fs_1[a126_0xa3e9('0xa')][a126_0xa3e9('0x38')](_0x4f685b);const _0x4294db=fs_1['default'][a126_0xa3e9('0x26')](_0x3a6497);const _0x1ccce4=_0x4cdc23['createGunzip']();console[a126_0xa3e9('0x8')](_0x7d97d4['file']);_0x528f59[a126_0xa3e9('0x25')](_0x1ccce4)[a126_0xa3e9('0x25')](_0x4294db)['on']('finish',_0x479324=>{if(_0x479324)return console['error'](_0x479324);else{const _0x1996ad=fs_1['default'][a126_0xa3e9('0x2c')](_0x4f685b);const _0x3d5982=_0x1996ad[a126_0xa3e9('0x11')];if(_0x3d5982>0x0){fs_1[a126_0xa3e9('0xa')]['readFile'](_0x3a6497,a126_0xa3e9('0x39'),function(_0x479324,_0x261afd){if(_0x479324){return console[a126_0xa3e9('0x17')](_0x479324);}else{try{const _0x34d2c0=JSON[a126_0xa3e9('0x30')](_0x261afd);console['log'](_0x34d2c0);const _0x47ecb5=_0x34d2c0[a126_0xa3e9('0x3a')][0x0][a126_0xa3e9('0x3b')];const _0x52d4f2=_0x34d2c0[a126_0xa3e9('0x3a')][0x0][a126_0xa3e9('0x3c')];const _0x5245d9=moment_1[a126_0xa3e9('0xa')](_0x47ecb5+'\x20'+_0x52d4f2+'\x20-05:00',a126_0xa3e9('0x3d'));const _0x4e2ad4=parseFloat(_0x34d2c0[a126_0xa3e9('0x3a')][0x0]['latitud'][a126_0xa3e9('0x3e')](',','.'));const _0x4d2c7b=parseFloat(_0x34d2c0[a126_0xa3e9('0x3a')][0x0][a126_0xa3e9('0x3f')][a126_0xa3e9('0x3e')](',','.'));const _0x17ab26=_0x34d2c0[a126_0xa3e9('0x3a')][0x0]['velocidad'];const _0x461cbd=_0x34d2c0[a126_0xa3e9('0x3a')][0x0]['puerta'][0x0]['ingresos'];const _0x476503=_0x34d2c0[a126_0xa3e9('0x3a')][0x0][a126_0xa3e9('0x40')][0x0][a126_0xa3e9('0x41')];console[a126_0xa3e9('0x8')](_0x4e2ad4);console['log'](_0x4d2c7b);console[a126_0xa3e9('0x8')](_0x17ab26);console[a126_0xa3e9('0x8')](_0x461cbd);console[a126_0xa3e9('0x8')](_0x476503);console[a126_0xa3e9('0x8')](_0x5245d9);if(_0x461cbd>0x0){sequelize_utils_1['default'][a126_0xa3e9('0x12')][a126_0xa3e9('0x33')][a126_0xa3e9('0x42')]({'amount':_0x461cbd,'counted_at':_0x5245d9});}sequelize_utils_1[a126_0xa3e9('0xa')][a126_0xa3e9('0x12')][a126_0xa3e9('0x43')]['create']({'device_id':null,'lat':''+_0x4e2ad4,'lon':''+_0x4d2c7b,'tracked_at':_0x5245d9});}catch(_0x3871df){return console[a126_0xa3e9('0x17')](_0x3871df);}}});}}});_0xf98c44['json']({'status':0x1,'data':_0x7d97d4[a126_0xa3e9('0x36')]});}}exports[a126_0xa3e9('0xa')]=SyncFilesController;