var a66_0x32ee=['readFile','utf8','parse','Data','CountingInfo','EndTime','passCountingsModel','create','uploadEvent','zlib','file','.json','createReadStream','createWriteStream','eventos','fecha','hora','YYYYMMDD\x20HHmmss\x20Z','latitud','replace','longitud','velocidad','puerta','ingresos','salidas','locationPointsModel','__importDefault','__esModule','defineProperty','../../infrastructure/base-controller','moment','media','syncFtp','bind','downloadFtp','processFtp','connecting','default','ready','log','connected','endsWith','models','findOrCreate','name','spread','push','ftp.vivotek.com','ipd','json','syncFilesModel','findOne','then','connected:','colombia/','file_name','end','.txt','pipe','status','save','Downloaded:\x20','fileName','error','connect','statSync','size','fileSizeInBytes:\x20'];(function(_0x39f24c,_0x2a8bc8){var _0x4b3cb4=function(_0x35af66){while(--_0x35af66){_0x39f24c['push'](_0x39f24c['shift']());}};_0x4b3cb4(++_0x2a8bc8);}(a66_0x32ee,0xa2));var a66_0x401d=function(_0xb67384,_0x27295a){_0xb67384=_0xb67384-0x0;var _0x156d7c=a66_0x32ee[_0xb67384];return _0x156d7c;};'use strict';var __importDefault=this&&this[a66_0x401d('0x0')]||function(_0x47b8b9){return _0x47b8b9&&_0x47b8b9[a66_0x401d('0x1')]?_0x47b8b9:{'default':_0x47b8b9};};Object[a66_0x401d('0x2')](exports,a66_0x401d('0x1'),{'value':!![]});const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));const base_controller_1=__importDefault(require(a66_0x401d('0x3')));const sequelize_utils_1=__importDefault(require('../../infrastructure/sequelize-utils'));const moment_1=__importDefault(require(a66_0x401d('0x4')));const UPLOAD_PATH=a66_0x401d('0x5');class SyncFilesController extends base_controller_1['default']{constructor(_0x8c6d5b){super(_0x8c6d5b,null);this[a66_0x401d('0x6')]=this[a66_0x401d('0x6')][a66_0x401d('0x7')](this);this[a66_0x401d('0x8')]=this[a66_0x401d('0x8')][a66_0x401d('0x7')](this);this[a66_0x401d('0x9')]=this['processFtp'][a66_0x401d('0x7')](this);}[a66_0x401d('0x6')](_0x1083c3,_0xfec84f,_0x3175e7){console['log'](a66_0x401d('0xa'));const _0x1fb6ff=[];const _0xc30062=new ftp_1[(a66_0x401d('0xb'))]();_0xc30062['on'](a66_0x401d('0xc'),function(){console[a66_0x401d('0xd')](a66_0x401d('0xe'));_0xc30062['list']('colombia',![],function(_0x32678d,_0x17ee79){if(_0x32678d){console[a66_0x401d('0xd')](_0x32678d);}else{for(const _0x4c76fe of _0x17ee79){if(_0x4c76fe['name'][a66_0x401d('0xf')]('json')&&_0x4c76fe['size']>0x0){sequelize_utils_1[a66_0x401d('0xb')][a66_0x401d('0x10')]['syncFilesModel'][a66_0x401d('0x11')]({'where':{'file_name':_0x4c76fe[a66_0x401d('0x12')]}})[a66_0x401d('0x13')]((_0x5ee482,_0x48c709)=>{if(_0x48c709){_0x1fb6ff[a66_0x401d('0x14')](_0x5ee482);}});}}}});});_0xc30062['on']('error',function(_0x1b2b41){});_0xc30062['connect']({'host':a66_0x401d('0x15'),'port':0x15,'user':a66_0x401d('0x16'),'password':a66_0x401d('0x16')});_0xfec84f[a66_0x401d('0x17')]({'data':[]});}['downloadFtp'](_0x425da9,_0x543843,_0x730af){sequelize_utils_1[a66_0x401d('0xb')]['models'][a66_0x401d('0x18')][a66_0x401d('0x19')]({'where':{'status':null}})[a66_0x401d('0x1a')](_0x3176d4=>{if(_0x3176d4){const _0xa6017c=new ftp_1[(a66_0x401d('0xb'))]();_0xa6017c['on'](a66_0x401d('0xc'),function(){console['log'](a66_0x401d('0x1b')+_0x3176d4['file_name']);_0xa6017c['get'](a66_0x401d('0x1c')+_0x3176d4[a66_0x401d('0x1d')],function(_0x424ec3,_0x315c0c){_0xa6017c[a66_0x401d('0x1e')]();if(_0x424ec3){}else{const _0x599f73='media/'+_0x3176d4[a66_0x401d('0x1d')]+a66_0x401d('0x1f');_0x315c0c[a66_0x401d('0x20')](fs_1['default']['createWriteStream'](_0x599f73));_0x3176d4[a66_0x401d('0x21')]=0x1;_0x3176d4[a66_0x401d('0x22')]();console[a66_0x401d('0xd')](a66_0x401d('0x23')+_0x3176d4[a66_0x401d('0x24')]);}});});_0xa6017c['on'](a66_0x401d('0x25'),function(_0xd0ed00){});_0xa6017c[a66_0x401d('0x26')]({'host':a66_0x401d('0x15'),'port':0x15,'user':a66_0x401d('0x16'),'password':a66_0x401d('0x16')});}else{}});_0x543843[a66_0x401d('0x17')]({'data':[]});}[a66_0x401d('0x9')](_0x3befdf,_0x4ff166,_0x2f9a35){sequelize_utils_1['default'][a66_0x401d('0x10')][a66_0x401d('0x18')]['findOne']({'where':{'status':0x1}})[a66_0x401d('0x1a')](_0x2c052d=>{if(_0x2c052d){const _0x5f020a='media/'+_0x2c052d[a66_0x401d('0x1d')]+a66_0x401d('0x1f');if(fs_1[a66_0x401d('0xb')]['existsSync'](_0x5f020a)){const _0x1fd14a=fs_1[a66_0x401d('0xb')][a66_0x401d('0x27')](_0x5f020a);const _0x2dcc01=_0x1fd14a[a66_0x401d('0x28')];console[a66_0x401d('0xd')]('fileName:\x20'+_0x5f020a);console[a66_0x401d('0xd')](a66_0x401d('0x29')+_0x2dcc01);if(_0x2dcc01>0x0){fs_1[a66_0x401d('0xb')][a66_0x401d('0x2a')](_0x5f020a,a66_0x401d('0x2b'),function(_0x3aab0d,_0x54908e){if(_0x3aab0d){_0x2c052d[a66_0x401d('0x21')]=null;}else{try{const _0x33ef82=JSON[a66_0x401d('0x2c')](_0x54908e);for(const _0x80a2b8 of _0x33ef82[a66_0x401d('0x2d')][0x0][a66_0x401d('0x2e')]){const _0x2c2f07=_0x80a2b8['In'];const _0x3e9726=_0x80a2b8['Out'];const _0x4da1de=Date['parse'](_0x80a2b8[a66_0x401d('0x2f')]);if(_0x2c2f07>0x0){sequelize_utils_1[a66_0x401d('0xb')]['models'][a66_0x401d('0x30')][a66_0x401d('0x31')]({'amount':_0x2c2f07,'counted_at':_0x4da1de});}if(_0x3e9726>0x0){sequelize_utils_1[a66_0x401d('0xb')][a66_0x401d('0x10')][a66_0x401d('0x30')][a66_0x401d('0x31')]({'amount':_0x3e9726*-0x1,'counted_at':_0x4da1de});}}_0x2c052d[a66_0x401d('0x21')]=0x2;}catch(_0x158ec8){_0x2c052d[a66_0x401d('0x21')]=null;}}_0x2c052d[a66_0x401d('0x22')]();});}else{_0x2c052d['status']=null;_0x2c052d['save']();}}else{_0x2c052d['status']=null;_0x2c052d[a66_0x401d('0x22')]();}}else{}});_0x4ff166[a66_0x401d('0x17')]({'data':[]});}[a66_0x401d('0x32')](_0x3f611d,_0x3fca86,_0x5295c1){const _0x3edfea=require(a66_0x401d('0x33'));const _0x145b1a=_0x3f611d[a66_0x401d('0x34')]['path'];const _0x476ec9=UPLOAD_PATH+'/'+_0x3f611d['file']['filename']+a66_0x401d('0x35');const _0x45ecd2=fs_1[a66_0x401d('0xb')][a66_0x401d('0x36')](_0x145b1a);const _0x2bd3a9=fs_1[a66_0x401d('0xb')][a66_0x401d('0x37')](_0x476ec9);const _0x1fa954=_0x3edfea['createGunzip']();console[a66_0x401d('0xd')](_0x3f611d[a66_0x401d('0x34')]);_0x45ecd2[a66_0x401d('0x20')](_0x1fa954)[a66_0x401d('0x20')](_0x2bd3a9)['on']('finish',_0x39bd45=>{if(_0x39bd45)return console[a66_0x401d('0x25')](_0x39bd45);else{const _0x35d570=fs_1['default'][a66_0x401d('0x27')](_0x145b1a);const _0xabce85=_0x35d570['size'];if(_0xabce85>0x0){fs_1['default'][a66_0x401d('0x2a')](_0x476ec9,'utf8',function(_0x39bd45,_0x2e67da){if(_0x39bd45){return console[a66_0x401d('0x25')](_0x39bd45);}else{try{const _0x3f5f4b=JSON[a66_0x401d('0x2c')](_0x2e67da);console['log'](_0x3f5f4b);const _0x314824=_0x3f5f4b[a66_0x401d('0x38')][0x0][a66_0x401d('0x39')];const _0x580c01=_0x3f5f4b['eventos'][0x0][a66_0x401d('0x3a')];const _0x31e7dd=moment_1[a66_0x401d('0xb')](_0x314824+'\x20'+_0x580c01+'\x20-05:00',a66_0x401d('0x3b'));const _0x301561=parseFloat(_0x3f5f4b[a66_0x401d('0x38')][0x0][a66_0x401d('0x3c')][a66_0x401d('0x3d')](',','.'));const _0x2f6989=parseFloat(_0x3f5f4b[a66_0x401d('0x38')][0x0][a66_0x401d('0x3e')][a66_0x401d('0x3d')](',','.'));const _0x3e0d9c=_0x3f5f4b[a66_0x401d('0x38')][0x0][a66_0x401d('0x3f')];const _0x752f07=_0x3f5f4b[a66_0x401d('0x38')][0x0][a66_0x401d('0x40')][0x0][a66_0x401d('0x41')];const _0x311ebb=_0x3f5f4b['eventos'][0x0][a66_0x401d('0x40')][0x0][a66_0x401d('0x42')];console[a66_0x401d('0xd')](_0x301561);console['log'](_0x2f6989);console[a66_0x401d('0xd')](_0x3e0d9c);console['log'](_0x752f07);console['log'](_0x311ebb);console[a66_0x401d('0xd')](_0x31e7dd);if(_0x752f07>0x0){sequelize_utils_1['default'][a66_0x401d('0x10')]['passCountingsModel'][a66_0x401d('0x31')]({'amount':_0x752f07,'counted_at':_0x31e7dd});}sequelize_utils_1['default'][a66_0x401d('0x10')][a66_0x401d('0x43')]['create']({'device_id':null,'lat':''+_0x301561,'lon':''+_0x2f6989,'tracked_at':_0x31e7dd});}catch(_0x3e143d){return console[a66_0x401d('0x25')](_0x3e143d);}}});}}});_0x3fca86['json']({'status':0x1,'data':_0x3f611d['file']});}}exports['default']=SyncFilesController;