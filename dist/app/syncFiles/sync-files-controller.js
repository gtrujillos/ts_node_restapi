var a73_0x24aa=['list','colombia','name','endsWith','json','size','models','findOrCreate','spread','push','error','connect','ftp.vivotek.com','ipd','syncFilesModel','findOne','then','connected:','file_name','get','colombia/','end','media/','.txt','pipe','createWriteStream','status','save','Downloaded:\x20','fileName','existsSync','statSync','fileName:\x20','readFile','utf8','parse','CountingInfo','Out','EndTime','passCountingsModel','create','uploadEvent','zlib','file','filename','.json','createGunzip','finish','eventos','hora','YYYYMMDD\x20HHmmss\x20Z','replace','longitud','velocidad','ingresos','puerta','salidas','locationPointsModel','__importDefault','__esModule','defineProperty','ftp','../../infrastructure/controller-utils','../../infrastructure/sequelize-utils','moment','media','default','syncFtp','downloadFtp','bind','processFtp','ready','log'];(function(_0x4de49b,_0x204189){var _0x2d7281=function(_0x698412){while(--_0x698412){_0x4de49b['push'](_0x4de49b['shift']());}};_0x2d7281(++_0x204189);}(a73_0x24aa,0x83));var a73_0x1930=function(_0x536404,_0x5cd490){_0x536404=_0x536404-0x0;var _0xb68598=a73_0x24aa[_0x536404];return _0xb68598;};'use strict';var __importDefault=this&&this[a73_0x1930('0x0')]||function(_0x3dd59f){return _0x3dd59f&&_0x3dd59f[a73_0x1930('0x1')]?_0x3dd59f:{'default':_0x3dd59f};};Object[a73_0x1930('0x2')](exports,'__esModule',{'value':!![]});const ftp_1=__importDefault(require(a73_0x1930('0x3')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a73_0x1930('0x4')));const sequelize_utils_1=__importDefault(require(a73_0x1930('0x5')));const moment_1=__importDefault(require(a73_0x1930('0x6')));const UPLOAD_PATH=a73_0x1930('0x7');class SyncFilesController extends controller_utils_1[a73_0x1930('0x8')]{constructor(_0x1e6702){super(_0x1e6702,null);this[a73_0x1930('0x9')]=this[a73_0x1930('0x9')]['bind'](this);this['downloadFtp']=this[a73_0x1930('0xa')][a73_0x1930('0xb')](this);this[a73_0x1930('0xc')]=this['processFtp'][a73_0x1930('0xb')](this);}[a73_0x1930('0x9')](_0x19a44c,_0xf19b53,_0x3ca19c){console['log']('connecting');const _0x4c1b54=[];const _0x2285e5=new ftp_1[(a73_0x1930('0x8'))]();_0x2285e5['on'](a73_0x1930('0xd'),function(){console[a73_0x1930('0xe')]('connected');_0x2285e5[a73_0x1930('0xf')](a73_0x1930('0x10'),![],function(_0x1445de,_0x3c30eb){if(_0x1445de){console[a73_0x1930('0xe')](_0x1445de);}else{for(const _0x53cfcb of _0x3c30eb){if(_0x53cfcb[a73_0x1930('0x11')][a73_0x1930('0x12')](a73_0x1930('0x13'))&&_0x53cfcb[a73_0x1930('0x14')]>0x0){sequelize_utils_1[a73_0x1930('0x8')][a73_0x1930('0x15')]['syncFilesModel'][a73_0x1930('0x16')]({'where':{'file_name':_0x53cfcb[a73_0x1930('0x11')]}})[a73_0x1930('0x17')]((_0x382901,_0x3b5adb)=>{if(_0x3b5adb){_0x4c1b54[a73_0x1930('0x18')](_0x382901);}});}}}});});_0x2285e5['on'](a73_0x1930('0x19'),function(_0x445068){});_0x2285e5[a73_0x1930('0x1a')]({'host':a73_0x1930('0x1b'),'port':0x15,'user':a73_0x1930('0x1c'),'password':a73_0x1930('0x1c')});_0xf19b53[a73_0x1930('0x13')]({'data':[]});}[a73_0x1930('0xa')](_0x3d1bb3,_0x4a0ae4,_0x77cd8d){sequelize_utils_1[a73_0x1930('0x8')]['models'][a73_0x1930('0x1d')][a73_0x1930('0x1e')]({'where':{'status':null}})[a73_0x1930('0x1f')](_0x166140=>{if(_0x166140){const _0xfcd9e2=new ftp_1[(a73_0x1930('0x8'))]();_0xfcd9e2['on'](a73_0x1930('0xd'),function(){console['log'](a73_0x1930('0x20')+_0x166140[a73_0x1930('0x21')]);_0xfcd9e2[a73_0x1930('0x22')](a73_0x1930('0x23')+_0x166140[a73_0x1930('0x21')],function(_0xbe0a07,_0x86b73f){_0xfcd9e2[a73_0x1930('0x24')]();if(_0xbe0a07){}else{const _0x3c2b12=a73_0x1930('0x25')+_0x166140[a73_0x1930('0x21')]+a73_0x1930('0x26');_0x86b73f[a73_0x1930('0x27')](fs_1[a73_0x1930('0x8')][a73_0x1930('0x28')](_0x3c2b12));_0x166140[a73_0x1930('0x29')]=0x1;_0x166140[a73_0x1930('0x2a')]();console['log'](a73_0x1930('0x2b')+_0x166140[a73_0x1930('0x2c')]);}});});_0xfcd9e2['on'](a73_0x1930('0x19'),function(_0x4babd2){});_0xfcd9e2[a73_0x1930('0x1a')]({'host':a73_0x1930('0x1b'),'port':0x15,'user':'ipd','password':a73_0x1930('0x1c')});}else{}});_0x4a0ae4['json']({'data':[]});}[a73_0x1930('0xc')](_0x3769b1,_0x54acc0,_0x5b9dc1){sequelize_utils_1[a73_0x1930('0x8')][a73_0x1930('0x15')][a73_0x1930('0x1d')][a73_0x1930('0x1e')]({'where':{'status':0x1}})['then'](_0x106b88=>{if(_0x106b88){const _0x32971c=a73_0x1930('0x25')+_0x106b88[a73_0x1930('0x21')]+a73_0x1930('0x26');if(fs_1[a73_0x1930('0x8')][a73_0x1930('0x2d')](_0x32971c)){const _0x585b07=fs_1[a73_0x1930('0x8')][a73_0x1930('0x2e')](_0x32971c);const _0x2f1af7=_0x585b07[a73_0x1930('0x14')];console['log'](a73_0x1930('0x2f')+_0x32971c);console['log']('fileSizeInBytes:\x20'+_0x2f1af7);if(_0x2f1af7>0x0){fs_1['default'][a73_0x1930('0x30')](_0x32971c,a73_0x1930('0x31'),function(_0x469b0a,_0x2d598d){if(_0x469b0a){_0x106b88[a73_0x1930('0x29')]=null;}else{try{const _0x4d8966=JSON[a73_0x1930('0x32')](_0x2d598d);for(const _0x519cfb of _0x4d8966['Data'][0x0][a73_0x1930('0x33')]){const _0x2e19a7=_0x519cfb['In'];const _0x3fcc25=_0x519cfb[a73_0x1930('0x34')];const _0x4eae6f=Date[a73_0x1930('0x32')](_0x519cfb[a73_0x1930('0x35')]);if(_0x2e19a7>0x0){sequelize_utils_1[a73_0x1930('0x8')][a73_0x1930('0x15')][a73_0x1930('0x36')][a73_0x1930('0x37')]({'amount':_0x2e19a7,'counted_at':_0x4eae6f});}if(_0x3fcc25>0x0){sequelize_utils_1[a73_0x1930('0x8')][a73_0x1930('0x15')][a73_0x1930('0x36')][a73_0x1930('0x37')]({'amount':_0x3fcc25*-0x1,'counted_at':_0x4eae6f});}}_0x106b88['status']=0x2;}catch(_0x494009){_0x106b88[a73_0x1930('0x29')]=null;}}_0x106b88[a73_0x1930('0x2a')]();});}else{_0x106b88[a73_0x1930('0x29')]=null;_0x106b88['save']();}}else{_0x106b88['status']=null;_0x106b88[a73_0x1930('0x2a')]();}}else{}});_0x54acc0[a73_0x1930('0x13')]({'data':[]});}[a73_0x1930('0x38')](_0x274dc1,_0xde6551,_0x3deb49){const _0x38527d=require(a73_0x1930('0x39'));const _0x4dfa31=_0x274dc1[a73_0x1930('0x3a')]['path'];const _0x1189ab=UPLOAD_PATH+'/'+_0x274dc1['file'][a73_0x1930('0x3b')]+a73_0x1930('0x3c');const _0x18bff4=fs_1[a73_0x1930('0x8')]['createReadStream'](_0x4dfa31);const _0x3d5825=fs_1['default']['createWriteStream'](_0x1189ab);const _0x5ca9cb=_0x38527d[a73_0x1930('0x3d')]();console['log'](_0x274dc1[a73_0x1930('0x3a')]);_0x18bff4['pipe'](_0x5ca9cb)[a73_0x1930('0x27')](_0x3d5825)['on'](a73_0x1930('0x3e'),_0x431d2c=>{if(_0x431d2c)return console[a73_0x1930('0x19')](_0x431d2c);else{const _0x436e2e=fs_1[a73_0x1930('0x8')][a73_0x1930('0x2e')](_0x4dfa31);const _0xe6519e=_0x436e2e[a73_0x1930('0x14')];if(_0xe6519e>0x0){fs_1[a73_0x1930('0x8')][a73_0x1930('0x30')](_0x1189ab,'utf8',function(_0x431d2c,_0xb36b71){if(_0x431d2c){return console[a73_0x1930('0x19')](_0x431d2c);}else{try{const _0x421c07=JSON[a73_0x1930('0x32')](_0xb36b71);console[a73_0x1930('0xe')](_0x421c07);const _0x4fc3da=_0x421c07[a73_0x1930('0x3f')][0x0]['fecha'];const _0x3c7770=_0x421c07[a73_0x1930('0x3f')][0x0][a73_0x1930('0x40')];const _0x527253=moment_1[a73_0x1930('0x8')](_0x4fc3da+'\x20'+_0x3c7770+'\x20-05:00',a73_0x1930('0x41'));const _0x3c5f76=parseFloat(_0x421c07[a73_0x1930('0x3f')][0x0]['latitud'][a73_0x1930('0x42')](',','.'));const _0x1dbc61=parseFloat(_0x421c07['eventos'][0x0][a73_0x1930('0x43')]['replace'](',','.'));const _0x18326e=_0x421c07[a73_0x1930('0x3f')][0x0][a73_0x1930('0x44')];const _0x2c8eda=_0x421c07[a73_0x1930('0x3f')][0x0]['puerta'][0x0][a73_0x1930('0x45')];const _0x21c45d=_0x421c07['eventos'][0x0][a73_0x1930('0x46')][0x0][a73_0x1930('0x47')];console[a73_0x1930('0xe')](_0x3c5f76);console[a73_0x1930('0xe')](_0x1dbc61);console[a73_0x1930('0xe')](_0x18326e);console['log'](_0x2c8eda);console['log'](_0x21c45d);console[a73_0x1930('0xe')](_0x527253);if(_0x2c8eda>0x0){sequelize_utils_1[a73_0x1930('0x8')][a73_0x1930('0x15')][a73_0x1930('0x36')][a73_0x1930('0x37')]({'amount':_0x2c8eda,'counted_at':_0x527253});}sequelize_utils_1['default'][a73_0x1930('0x15')][a73_0x1930('0x48')][a73_0x1930('0x37')]({'device_id':null,'lat':''+_0x3c5f76,'lon':''+_0x1dbc61,'tracked_at':_0x527253});}catch(_0x57db26){return console[a73_0x1930('0x19')](_0x57db26);}}});}}});_0xde6551[a73_0x1930('0x13')]({'status':0x1,'data':_0x274dc1['file']});}}exports[a73_0x1930('0x8')]=SyncFilesController;