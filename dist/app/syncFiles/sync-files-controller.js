var a162_0x12c6=['parse','CountingInfo','Out','EndTime','models','passCountingsModel','create','uploadEvent','zlib','.json','createReadStream','createGunzip','file','finish','eventos','fecha','hora','\x20-05:00','latitud','replace','puerta','ingresos','salidas','locationPointsModel','__importDefault','__esModule','defineProperty','ftp','../../infrastructure/controller-utils','../../infrastructure/sequelize-utils','moment','media','default','syncFtp','downloadFtp','processFtp','bind','log','connecting','ready','connected','list','colombia','name','endsWith','json','size','syncFilesModel','findOrCreate','spread','push','connect','ftp.vivotek.com','ipd','findOne','connected:','file_name','get','end','media/','.txt','pipe','createWriteStream','status','save','Downloaded:\x20','error','then','existsSync','statSync','fileName:\x20','fileSizeInBytes:\x20','readFile','utf8'];(function(_0xdd5523,_0x63cc14){var _0x3de006=function(_0x58afbb){while(--_0x58afbb){_0xdd5523['push'](_0xdd5523['shift']());}};_0x3de006(++_0x63cc14);}(a162_0x12c6,0x140));var a162_0x68b3=function(_0x55458b,_0x5ec619){_0x55458b=_0x55458b-0x0;var _0x2e7595=a162_0x12c6[_0x55458b];return _0x2e7595;};'use strict';var __importDefault=this&&this[a162_0x68b3('0x0')]||function(_0x2aa057){return _0x2aa057&&_0x2aa057[a162_0x68b3('0x1')]?_0x2aa057:{'default':_0x2aa057};};Object[a162_0x68b3('0x2')](exports,a162_0x68b3('0x1'),{'value':!![]});const ftp_1=__importDefault(require(a162_0x68b3('0x3')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a162_0x68b3('0x4')));const sequelize_utils_1=__importDefault(require(a162_0x68b3('0x5')));const moment_1=__importDefault(require(a162_0x68b3('0x6')));const UPLOAD_PATH=a162_0x68b3('0x7');class SyncFilesController extends controller_utils_1[a162_0x68b3('0x8')]{constructor(_0x47c64a){super(_0x47c64a,null);this[a162_0x68b3('0x9')]=this[a162_0x68b3('0x9')]['bind'](this);this['downloadFtp']=this[a162_0x68b3('0xa')]['bind'](this);this[a162_0x68b3('0xb')]=this['processFtp'][a162_0x68b3('0xc')](this);}[a162_0x68b3('0x9')](_0x372a47,_0x4cb366,_0x47fc88){console[a162_0x68b3('0xd')](a162_0x68b3('0xe'));const _0x3e0b6b=[];const _0x475b04=new ftp_1[(a162_0x68b3('0x8'))]();_0x475b04['on'](a162_0x68b3('0xf'),function(){console[a162_0x68b3('0xd')](a162_0x68b3('0x10'));_0x475b04[a162_0x68b3('0x11')](a162_0x68b3('0x12'),![],function(_0x42d476,_0x5491ed){if(_0x42d476){console[a162_0x68b3('0xd')](_0x42d476);}else{for(const _0x3e1a03 of _0x5491ed){if(_0x3e1a03[a162_0x68b3('0x13')][a162_0x68b3('0x14')](a162_0x68b3('0x15'))&&_0x3e1a03[a162_0x68b3('0x16')]>0x0){sequelize_utils_1[a162_0x68b3('0x8')]['models'][a162_0x68b3('0x17')][a162_0x68b3('0x18')]({'where':{'file_name':_0x3e1a03['name']}})[a162_0x68b3('0x19')]((_0x19da7a,_0x3e3ff7)=>{if(_0x3e3ff7){_0x3e0b6b[a162_0x68b3('0x1a')](_0x19da7a);}});}}}});});_0x475b04['on']('error',function(_0x5d089d){});_0x475b04[a162_0x68b3('0x1b')]({'host':a162_0x68b3('0x1c'),'port':0x15,'user':a162_0x68b3('0x1d'),'password':a162_0x68b3('0x1d')});_0x4cb366[a162_0x68b3('0x15')]({'data':[]});}[a162_0x68b3('0xa')](_0x461bba,_0x458dbf,_0x2d1bfd){sequelize_utils_1[a162_0x68b3('0x8')]['models'][a162_0x68b3('0x17')][a162_0x68b3('0x1e')]({'where':{'status':null}})['then'](_0x40872d=>{if(_0x40872d){const _0x42a145=new ftp_1['default']();_0x42a145['on']('ready',function(){console[a162_0x68b3('0xd')](a162_0x68b3('0x1f')+_0x40872d[a162_0x68b3('0x20')]);_0x42a145[a162_0x68b3('0x21')]('colombia/'+_0x40872d[a162_0x68b3('0x20')],function(_0x1c4406,_0x42f909){_0x42a145[a162_0x68b3('0x22')]();if(_0x1c4406){}else{const _0x57247c=a162_0x68b3('0x23')+_0x40872d[a162_0x68b3('0x20')]+a162_0x68b3('0x24');_0x42f909[a162_0x68b3('0x25')](fs_1[a162_0x68b3('0x8')][a162_0x68b3('0x26')](_0x57247c));_0x40872d[a162_0x68b3('0x27')]=0x1;_0x40872d[a162_0x68b3('0x28')]();console['log'](a162_0x68b3('0x29')+_0x40872d['fileName']);}});});_0x42a145['on'](a162_0x68b3('0x2a'),function(_0x4e9b8c){});_0x42a145[a162_0x68b3('0x1b')]({'host':a162_0x68b3('0x1c'),'port':0x15,'user':a162_0x68b3('0x1d'),'password':'ipd'});}else{}});_0x458dbf[a162_0x68b3('0x15')]({'data':[]});}[a162_0x68b3('0xb')](_0x1ba73f,_0x175788,_0x4b2ff9){sequelize_utils_1[a162_0x68b3('0x8')]['models'][a162_0x68b3('0x17')][a162_0x68b3('0x1e')]({'where':{'status':0x1}})[a162_0x68b3('0x2b')](_0x267b50=>{if(_0x267b50){const _0x5c5f77=a162_0x68b3('0x23')+_0x267b50[a162_0x68b3('0x20')]+'.txt';if(fs_1['default'][a162_0x68b3('0x2c')](_0x5c5f77)){const _0x416b08=fs_1[a162_0x68b3('0x8')][a162_0x68b3('0x2d')](_0x5c5f77);const _0x21633c=_0x416b08[a162_0x68b3('0x16')];console['log'](a162_0x68b3('0x2e')+_0x5c5f77);console[a162_0x68b3('0xd')](a162_0x68b3('0x2f')+_0x21633c);if(_0x21633c>0x0){fs_1[a162_0x68b3('0x8')][a162_0x68b3('0x30')](_0x5c5f77,a162_0x68b3('0x31'),function(_0x50c179,_0x18980a){if(_0x50c179){_0x267b50[a162_0x68b3('0x27')]=null;}else{try{const _0x38fe8c=JSON[a162_0x68b3('0x32')](_0x18980a);for(const _0x4ed8ae of _0x38fe8c['Data'][0x0][a162_0x68b3('0x33')]){const _0x46e872=_0x4ed8ae['In'];const _0x572c97=_0x4ed8ae[a162_0x68b3('0x34')];const _0x6d74a0=Date[a162_0x68b3('0x32')](_0x4ed8ae[a162_0x68b3('0x35')]);if(_0x46e872>0x0){sequelize_utils_1[a162_0x68b3('0x8')][a162_0x68b3('0x36')][a162_0x68b3('0x37')][a162_0x68b3('0x38')]({'amount':_0x46e872,'counted_at':_0x6d74a0});}if(_0x572c97>0x0){sequelize_utils_1[a162_0x68b3('0x8')][a162_0x68b3('0x36')][a162_0x68b3('0x37')][a162_0x68b3('0x38')]({'amount':_0x572c97*-0x1,'counted_at':_0x6d74a0});}}_0x267b50[a162_0x68b3('0x27')]=0x2;}catch(_0x55a144){_0x267b50[a162_0x68b3('0x27')]=null;}}_0x267b50[a162_0x68b3('0x28')]();});}else{_0x267b50[a162_0x68b3('0x27')]=null;_0x267b50[a162_0x68b3('0x28')]();}}else{_0x267b50['status']=null;_0x267b50['save']();}}else{}});_0x175788['json']({'data':[]});}[a162_0x68b3('0x39')](_0x3889ba,_0x192205,_0x3b2b01){const _0x11c5fd=require(a162_0x68b3('0x3a'));const _0x3b5e57=_0x3889ba['file']['path'];const _0x590773=UPLOAD_PATH+'/'+_0x3889ba['file']['filename']+a162_0x68b3('0x3b');const _0xc0aec4=fs_1[a162_0x68b3('0x8')][a162_0x68b3('0x3c')](_0x3b5e57);const _0x59c134=fs_1['default'][a162_0x68b3('0x26')](_0x590773);const _0x409659=_0x11c5fd[a162_0x68b3('0x3d')]();console['log'](_0x3889ba[a162_0x68b3('0x3e')]);_0xc0aec4['pipe'](_0x409659)[a162_0x68b3('0x25')](_0x59c134)['on'](a162_0x68b3('0x3f'),_0x542311=>{if(_0x542311)return console[a162_0x68b3('0x2a')](_0x542311);else{const _0x1febcb=fs_1['default'][a162_0x68b3('0x2d')](_0x3b5e57);const _0x181a66=_0x1febcb[a162_0x68b3('0x16')];if(_0x181a66>0x0){fs_1['default'][a162_0x68b3('0x30')](_0x590773,a162_0x68b3('0x31'),function(_0x542311,_0xba6c21){if(_0x542311){return console[a162_0x68b3('0x2a')](_0x542311);}else{try{const _0x1910a3=JSON['parse'](_0xba6c21);console[a162_0x68b3('0xd')](_0x1910a3);const _0x947645=_0x1910a3[a162_0x68b3('0x40')][0x0][a162_0x68b3('0x41')];const _0x3c9d70=_0x1910a3['eventos'][0x0][a162_0x68b3('0x42')];const _0x42a772=moment_1[a162_0x68b3('0x8')](_0x947645+'\x20'+_0x3c9d70+a162_0x68b3('0x43'),'YYYYMMDD\x20HHmmss\x20Z');const _0x40a6fd=parseFloat(_0x1910a3['eventos'][0x0][a162_0x68b3('0x44')][a162_0x68b3('0x45')](',','.'));const _0x2dd6c3=parseFloat(_0x1910a3[a162_0x68b3('0x40')][0x0]['longitud'][a162_0x68b3('0x45')](',','.'));const _0x29ef4b=_0x1910a3[a162_0x68b3('0x40')][0x0]['velocidad'];const _0xdd9514=_0x1910a3[a162_0x68b3('0x40')][0x0][a162_0x68b3('0x46')][0x0][a162_0x68b3('0x47')];const _0x309581=_0x1910a3[a162_0x68b3('0x40')][0x0]['puerta'][0x0][a162_0x68b3('0x48')];console['log'](_0x40a6fd);console['log'](_0x2dd6c3);console[a162_0x68b3('0xd')](_0x29ef4b);console[a162_0x68b3('0xd')](_0xdd9514);console[a162_0x68b3('0xd')](_0x309581);console[a162_0x68b3('0xd')](_0x42a772);if(_0xdd9514>0x0){sequelize_utils_1[a162_0x68b3('0x8')][a162_0x68b3('0x36')]['passCountingsModel'][a162_0x68b3('0x38')]({'amount':_0xdd9514,'counted_at':_0x42a772});}sequelize_utils_1['default']['models'][a162_0x68b3('0x49')]['create']({'device_id':null,'lat':''+_0x40a6fd,'lon':''+_0x2dd6c3,'tracked_at':_0x42a772});}catch(_0x339a81){return console[a162_0x68b3('0x2a')](_0x339a81);}}});}}});_0x192205[a162_0x68b3('0x15')]({'status':0x1,'data':_0x3889ba[a162_0x68b3('0x3e')]});}}exports[a162_0x68b3('0x8')]=SyncFilesController;