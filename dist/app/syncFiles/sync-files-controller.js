var a162_0x2b47=['velocidad','puerta','locationPointsModel','__importDefault','__esModule','defineProperty','ftp','../../infrastructure/controller-utils','../../infrastructure/sequelize-utils','moment','default','syncFtp','bind','downloadFtp','processFtp','log','connecting','ready','connected','list','colombia','name','endsWith','json','size','models','syncFilesModel','spread','push','error','ftp.vivotek.com','ipd','findOne','then','connected:','file_name','colombia/','end','.txt','pipe','createWriteStream','status','Downloaded:\x20','fileName','connect','media/','statSync','fileName:\x20','fileSizeInBytes:\x20','readFile','utf8','parse','Data','Out','passCountingsModel','create','save','uploadEvent','path','file','filename','.json','createReadStream','createGunzip','finish','eventos','fecha','hora','YYYYMMDD\x20HHmmss\x20Z','latitud'];(function(_0x461e1e,_0xdbe1d3){var _0x2d3252=function(_0xa4837a){while(--_0xa4837a){_0x461e1e['push'](_0x461e1e['shift']());}};_0x2d3252(++_0xdbe1d3);}(a162_0x2b47,0x8f));var a162_0x1681=function(_0x197f73,_0x62b00d){_0x197f73=_0x197f73-0x0;var _0x1dbaf4=a162_0x2b47[_0x197f73];return _0x1dbaf4;};'use strict';var __importDefault=this&&this[a162_0x1681('0x0')]||function(_0x511872){return _0x511872&&_0x511872[a162_0x1681('0x1')]?_0x511872:{'default':_0x511872};};Object[a162_0x1681('0x2')](exports,a162_0x1681('0x1'),{'value':!![]});const ftp_1=__importDefault(require(a162_0x1681('0x3')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a162_0x1681('0x4')));const sequelize_utils_1=__importDefault(require(a162_0x1681('0x5')));const moment_1=__importDefault(require(a162_0x1681('0x6')));const UPLOAD_PATH='media';class SyncFilesController extends controller_utils_1[a162_0x1681('0x7')]{constructor(_0x45e64e){super(_0x45e64e,null);this[a162_0x1681('0x8')]=this['syncFtp'][a162_0x1681('0x9')](this);this[a162_0x1681('0xa')]=this[a162_0x1681('0xa')][a162_0x1681('0x9')](this);this['processFtp']=this[a162_0x1681('0xb')][a162_0x1681('0x9')](this);}[a162_0x1681('0x8')](_0x39ab03,_0x5be65c,_0x44419f){console[a162_0x1681('0xc')](a162_0x1681('0xd'));const _0x5a576e=[];const _0x27259a=new ftp_1['default']();_0x27259a['on'](a162_0x1681('0xe'),function(){console[a162_0x1681('0xc')](a162_0x1681('0xf'));_0x27259a[a162_0x1681('0x10')](a162_0x1681('0x11'),![],function(_0x5c5280,_0x1e1bd9){if(_0x5c5280){console[a162_0x1681('0xc')](_0x5c5280);}else{for(const _0x61c196 of _0x1e1bd9){if(_0x61c196[a162_0x1681('0x12')][a162_0x1681('0x13')](a162_0x1681('0x14'))&&_0x61c196[a162_0x1681('0x15')]>0x0){sequelize_utils_1[a162_0x1681('0x7')][a162_0x1681('0x16')][a162_0x1681('0x17')]['findOrCreate']({'where':{'file_name':_0x61c196['name']}})[a162_0x1681('0x18')]((_0x12dc87,_0x5002ce)=>{if(_0x5002ce){_0x5a576e[a162_0x1681('0x19')](_0x12dc87);}});}}}});});_0x27259a['on'](a162_0x1681('0x1a'),function(_0x3a9c2d){});_0x27259a['connect']({'host':a162_0x1681('0x1b'),'port':0x15,'user':a162_0x1681('0x1c'),'password':'ipd'});_0x5be65c[a162_0x1681('0x14')]({'data':[]});}[a162_0x1681('0xa')](_0x127efd,_0xc88e8,_0x338417){sequelize_utils_1[a162_0x1681('0x7')][a162_0x1681('0x16')][a162_0x1681('0x17')][a162_0x1681('0x1d')]({'where':{'status':null}})[a162_0x1681('0x1e')](_0x1ce914=>{if(_0x1ce914){const _0xb73223=new ftp_1['default']();_0xb73223['on'](a162_0x1681('0xe'),function(){console['log'](a162_0x1681('0x1f')+_0x1ce914[a162_0x1681('0x20')]);_0xb73223['get'](a162_0x1681('0x21')+_0x1ce914[a162_0x1681('0x20')],function(_0x68e93b,_0x39a975){_0xb73223[a162_0x1681('0x22')]();if(_0x68e93b){}else{const _0x2bc992='media/'+_0x1ce914[a162_0x1681('0x20')]+a162_0x1681('0x23');_0x39a975[a162_0x1681('0x24')](fs_1[a162_0x1681('0x7')][a162_0x1681('0x25')](_0x2bc992));_0x1ce914[a162_0x1681('0x26')]=0x1;_0x1ce914['save']();console[a162_0x1681('0xc')](a162_0x1681('0x27')+_0x1ce914[a162_0x1681('0x28')]);}});});_0xb73223['on']('error',function(_0xb7c4a3){});_0xb73223[a162_0x1681('0x29')]({'host':'ftp.vivotek.com','port':0x15,'user':'ipd','password':a162_0x1681('0x1c')});}else{}});_0xc88e8[a162_0x1681('0x14')]({'data':[]});}[a162_0x1681('0xb')](_0x589b67,_0x5c214a,_0x5cef72){sequelize_utils_1['default']['models']['syncFilesModel'][a162_0x1681('0x1d')]({'where':{'status':0x1}})[a162_0x1681('0x1e')](_0x1bd097=>{if(_0x1bd097){const _0x3840b9=a162_0x1681('0x2a')+_0x1bd097['file_name']+'.txt';if(fs_1[a162_0x1681('0x7')]['existsSync'](_0x3840b9)){const _0x3bef2a=fs_1['default'][a162_0x1681('0x2b')](_0x3840b9);const _0x57c251=_0x3bef2a[a162_0x1681('0x15')];console[a162_0x1681('0xc')](a162_0x1681('0x2c')+_0x3840b9);console[a162_0x1681('0xc')](a162_0x1681('0x2d')+_0x57c251);if(_0x57c251>0x0){fs_1[a162_0x1681('0x7')][a162_0x1681('0x2e')](_0x3840b9,a162_0x1681('0x2f'),function(_0xbaf9a,_0x21a3a2){if(_0xbaf9a){_0x1bd097[a162_0x1681('0x26')]=null;}else{try{const _0x36dd6a=JSON[a162_0x1681('0x30')](_0x21a3a2);for(const _0xfd695c of _0x36dd6a[a162_0x1681('0x31')][0x0]['CountingInfo']){const _0x1765fe=_0xfd695c['In'];const _0x54b0c0=_0xfd695c[a162_0x1681('0x32')];const _0x1d5a81=Date[a162_0x1681('0x30')](_0xfd695c['EndTime']);if(_0x1765fe>0x0){sequelize_utils_1[a162_0x1681('0x7')][a162_0x1681('0x16')][a162_0x1681('0x33')][a162_0x1681('0x34')]({'amount':_0x1765fe,'counted_at':_0x1d5a81});}if(_0x54b0c0>0x0){sequelize_utils_1['default'][a162_0x1681('0x16')][a162_0x1681('0x33')][a162_0x1681('0x34')]({'amount':_0x54b0c0*-0x1,'counted_at':_0x1d5a81});}}_0x1bd097[a162_0x1681('0x26')]=0x2;}catch(_0x13a1e4){_0x1bd097['status']=null;}}_0x1bd097['save']();});}else{_0x1bd097['status']=null;_0x1bd097[a162_0x1681('0x35')]();}}else{_0x1bd097[a162_0x1681('0x26')]=null;_0x1bd097['save']();}}else{}});_0x5c214a[a162_0x1681('0x14')]({'data':[]});}[a162_0x1681('0x36')](_0x5342d2,_0x4a5cdb,_0x1cb694){const _0x579361=require('zlib');const _0x4404dd=_0x5342d2['file'][a162_0x1681('0x37')];const _0x2bf032=UPLOAD_PATH+'/'+_0x5342d2[a162_0x1681('0x38')][a162_0x1681('0x39')]+a162_0x1681('0x3a');const _0x35200c=fs_1[a162_0x1681('0x7')][a162_0x1681('0x3b')](_0x4404dd);const _0x563f05=fs_1[a162_0x1681('0x7')][a162_0x1681('0x25')](_0x2bf032);const _0x2f8b47=_0x579361[a162_0x1681('0x3c')]();console[a162_0x1681('0xc')](_0x5342d2[a162_0x1681('0x38')]);_0x35200c[a162_0x1681('0x24')](_0x2f8b47)['pipe'](_0x563f05)['on'](a162_0x1681('0x3d'),_0x3bd522=>{if(_0x3bd522)return console[a162_0x1681('0x1a')](_0x3bd522);else{const _0x44ca8e=fs_1['default'][a162_0x1681('0x2b')](_0x4404dd);const _0x5f1238=_0x44ca8e[a162_0x1681('0x15')];if(_0x5f1238>0x0){fs_1['default'][a162_0x1681('0x2e')](_0x2bf032,a162_0x1681('0x2f'),function(_0x3bd522,_0x5cc2ff){if(_0x3bd522){return console['error'](_0x3bd522);}else{try{const _0x474ed0=JSON[a162_0x1681('0x30')](_0x5cc2ff);console[a162_0x1681('0xc')](_0x474ed0);const _0x395485=_0x474ed0[a162_0x1681('0x3e')][0x0][a162_0x1681('0x3f')];const _0x57e133=_0x474ed0[a162_0x1681('0x3e')][0x0][a162_0x1681('0x40')];const _0x202792=moment_1[a162_0x1681('0x7')](_0x395485+'\x20'+_0x57e133+'\x20-05:00',a162_0x1681('0x41'));const _0x15611e=parseFloat(_0x474ed0[a162_0x1681('0x3e')][0x0][a162_0x1681('0x42')]['replace'](',','.'));const _0x27cfd3=parseFloat(_0x474ed0['eventos'][0x0]['longitud']['replace'](',','.'));const _0x44a7ca=_0x474ed0['eventos'][0x0][a162_0x1681('0x43')];const _0x584879=_0x474ed0[a162_0x1681('0x3e')][0x0][a162_0x1681('0x44')][0x0]['ingresos'];const _0x11f517=_0x474ed0[a162_0x1681('0x3e')][0x0]['puerta'][0x0]['salidas'];console[a162_0x1681('0xc')](_0x15611e);console['log'](_0x27cfd3);console[a162_0x1681('0xc')](_0x44a7ca);console[a162_0x1681('0xc')](_0x584879);console[a162_0x1681('0xc')](_0x11f517);console[a162_0x1681('0xc')](_0x202792);if(_0x584879>0x0){sequelize_utils_1[a162_0x1681('0x7')]['models']['passCountingsModel'][a162_0x1681('0x34')]({'amount':_0x584879,'counted_at':_0x202792});}sequelize_utils_1[a162_0x1681('0x7')][a162_0x1681('0x16')][a162_0x1681('0x45')]['create']({'device_id':null,'lat':''+_0x15611e,'lon':''+_0x27cfd3,'tracked_at':_0x202792});}catch(_0x5e8a3e){return console['error'](_0x5e8a3e);}}});}}});_0x4a5cdb['json']({'status':0x1,'data':_0x5342d2[a162_0x1681('0x38')]});}}exports['default']=SyncFilesController;