var a162_0x3db3=['latitud','longitud','replace','velocidad','puerta','ingresos','salidas','locationPointsModel','__importDefault','__esModule','../../infrastructure/controller-utils','../../infrastructure/sequelize-utils','default','syncFtp','downloadFtp','bind','processFtp','connecting','ready','connected','list','colombia','log','name','endsWith','json','size','syncFilesModel','findOrCreate','spread','push','error','connect','ftp.vivotek.com','ipd','models','findOne','then','connected:','file_name','get','colombia/','end','media/','.txt','pipe','createWriteStream','status','save','Downloaded:\x20','fileName','existsSync','statSync','fileName:\x20','fileSizeInBytes:\x20','utf8','parse','Data','Out','create','passCountingsModel','uploadEvent','zlib','path','file','filename','.json','createReadStream','createGunzip','readFile','fecha','eventos','\x20-05:00','YYYYMMDD\x20HHmmss\x20Z'];(function(_0x2f3e31,_0x3a89c9){var _0x2c6db2=function(_0x1fa352){while(--_0x1fa352){_0x2f3e31['push'](_0x2f3e31['shift']());}};_0x2c6db2(++_0x3a89c9);}(a162_0x3db3,0x9c));var a162_0x30b9=function(_0x404e7e,_0x3565ab){_0x404e7e=_0x404e7e-0x0;var _0x4e8890=a162_0x3db3[_0x404e7e];return _0x4e8890;};'use strict';var __importDefault=this&&this[a162_0x30b9('0x0')]||function(_0x5f4c04){return _0x5f4c04&&_0x5f4c04[a162_0x30b9('0x1')]?_0x5f4c04:{'default':_0x5f4c04};};Object['defineProperty'](exports,a162_0x30b9('0x1'),{'value':!![]});const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a162_0x30b9('0x2')));const sequelize_utils_1=__importDefault(require(a162_0x30b9('0x3')));const moment_1=__importDefault(require('moment'));const UPLOAD_PATH='media';class SyncFilesController extends controller_utils_1[a162_0x30b9('0x4')]{constructor(_0x58754c){super(_0x58754c,null);this[a162_0x30b9('0x5')]=this['syncFtp']['bind'](this);this[a162_0x30b9('0x6')]=this[a162_0x30b9('0x6')][a162_0x30b9('0x7')](this);this[a162_0x30b9('0x8')]=this[a162_0x30b9('0x8')][a162_0x30b9('0x7')](this);}[a162_0x30b9('0x5')](_0x2729c6,_0x2ef968,_0x41e505){console['log'](a162_0x30b9('0x9'));const _0x4c74c4=[];const _0x3cc02c=new ftp_1[(a162_0x30b9('0x4'))]();_0x3cc02c['on'](a162_0x30b9('0xa'),function(){console['log'](a162_0x30b9('0xb'));_0x3cc02c[a162_0x30b9('0xc')](a162_0x30b9('0xd'),![],function(_0x54c3fa,_0x1a23bb){if(_0x54c3fa){console[a162_0x30b9('0xe')](_0x54c3fa);}else{for(const _0x1feef4 of _0x1a23bb){if(_0x1feef4[a162_0x30b9('0xf')][a162_0x30b9('0x10')](a162_0x30b9('0x11'))&&_0x1feef4[a162_0x30b9('0x12')]>0x0){sequelize_utils_1[a162_0x30b9('0x4')]['models'][a162_0x30b9('0x13')][a162_0x30b9('0x14')]({'where':{'file_name':_0x1feef4[a162_0x30b9('0xf')]}})[a162_0x30b9('0x15')]((_0x1a357e,_0x36971f)=>{if(_0x36971f){_0x4c74c4[a162_0x30b9('0x16')](_0x1a357e);}});}}}});});_0x3cc02c['on'](a162_0x30b9('0x17'),function(_0x339262){});_0x3cc02c[a162_0x30b9('0x18')]({'host':a162_0x30b9('0x19'),'port':0x15,'user':a162_0x30b9('0x1a'),'password':'ipd'});_0x2ef968[a162_0x30b9('0x11')]({'data':[]});}['downloadFtp'](_0x42adc7,_0x423ee1,_0xcd0d61){sequelize_utils_1[a162_0x30b9('0x4')][a162_0x30b9('0x1b')][a162_0x30b9('0x13')][a162_0x30b9('0x1c')]({'where':{'status':null}})[a162_0x30b9('0x1d')](_0x61a690=>{if(_0x61a690){const _0x104f13=new ftp_1['default']();_0x104f13['on'](a162_0x30b9('0xa'),function(){console['log'](a162_0x30b9('0x1e')+_0x61a690[a162_0x30b9('0x1f')]);_0x104f13[a162_0x30b9('0x20')](a162_0x30b9('0x21')+_0x61a690[a162_0x30b9('0x1f')],function(_0x58f496,_0x191c7d){_0x104f13[a162_0x30b9('0x22')]();if(_0x58f496){}else{const _0x5dea8b=a162_0x30b9('0x23')+_0x61a690['file_name']+a162_0x30b9('0x24');_0x191c7d[a162_0x30b9('0x25')](fs_1[a162_0x30b9('0x4')][a162_0x30b9('0x26')](_0x5dea8b));_0x61a690[a162_0x30b9('0x27')]=0x1;_0x61a690[a162_0x30b9('0x28')]();console['log'](a162_0x30b9('0x29')+_0x61a690[a162_0x30b9('0x2a')]);}});});_0x104f13['on'](a162_0x30b9('0x17'),function(_0x44d678){});_0x104f13[a162_0x30b9('0x18')]({'host':'ftp.vivotek.com','port':0x15,'user':a162_0x30b9('0x1a'),'password':a162_0x30b9('0x1a')});}else{}});_0x423ee1[a162_0x30b9('0x11')]({'data':[]});}['processFtp'](_0x48f1e3,_0x562b78,_0x5a6ce6){sequelize_utils_1['default'][a162_0x30b9('0x1b')][a162_0x30b9('0x13')][a162_0x30b9('0x1c')]({'where':{'status':0x1}})[a162_0x30b9('0x1d')](_0x473849=>{if(_0x473849){const _0x2b3fa7=a162_0x30b9('0x23')+_0x473849['file_name']+a162_0x30b9('0x24');if(fs_1[a162_0x30b9('0x4')][a162_0x30b9('0x2b')](_0x2b3fa7)){const _0x438810=fs_1[a162_0x30b9('0x4')][a162_0x30b9('0x2c')](_0x2b3fa7);const _0xa85963=_0x438810[a162_0x30b9('0x12')];console[a162_0x30b9('0xe')](a162_0x30b9('0x2d')+_0x2b3fa7);console['log'](a162_0x30b9('0x2e')+_0xa85963);if(_0xa85963>0x0){fs_1[a162_0x30b9('0x4')]['readFile'](_0x2b3fa7,a162_0x30b9('0x2f'),function(_0x184c0c,_0x330d04){if(_0x184c0c){_0x473849[a162_0x30b9('0x27')]=null;}else{try{const _0x2a5bab=JSON[a162_0x30b9('0x30')](_0x330d04);for(const _0x1b4c21 of _0x2a5bab[a162_0x30b9('0x31')][0x0]['CountingInfo']){const _0x26e082=_0x1b4c21['In'];const _0x4ac016=_0x1b4c21[a162_0x30b9('0x32')];const _0x1eea56=Date[a162_0x30b9('0x30')](_0x1b4c21['EndTime']);if(_0x26e082>0x0){sequelize_utils_1[a162_0x30b9('0x4')][a162_0x30b9('0x1b')]['passCountingsModel'][a162_0x30b9('0x33')]({'amount':_0x26e082,'counted_at':_0x1eea56});}if(_0x4ac016>0x0){sequelize_utils_1[a162_0x30b9('0x4')]['models'][a162_0x30b9('0x34')]['create']({'amount':_0x4ac016*-0x1,'counted_at':_0x1eea56});}}_0x473849['status']=0x2;}catch(_0x1de2fb){_0x473849[a162_0x30b9('0x27')]=null;}}_0x473849[a162_0x30b9('0x28')]();});}else{_0x473849[a162_0x30b9('0x27')]=null;_0x473849[a162_0x30b9('0x28')]();}}else{_0x473849['status']=null;_0x473849[a162_0x30b9('0x28')]();}}else{}});_0x562b78[a162_0x30b9('0x11')]({'data':[]});}[a162_0x30b9('0x35')](_0x46ce1b,_0x51735e,_0x532453){const _0x2c5dc2=require(a162_0x30b9('0x36'));const _0xafe93e=_0x46ce1b['file'][a162_0x30b9('0x37')];const _0x4c00e8=UPLOAD_PATH+'/'+_0x46ce1b[a162_0x30b9('0x38')][a162_0x30b9('0x39')]+a162_0x30b9('0x3a');const _0x34e1cc=fs_1[a162_0x30b9('0x4')][a162_0x30b9('0x3b')](_0xafe93e);const _0x4ef9b9=fs_1['default'][a162_0x30b9('0x26')](_0x4c00e8);const _0x543576=_0x2c5dc2[a162_0x30b9('0x3c')]();console[a162_0x30b9('0xe')](_0x46ce1b[a162_0x30b9('0x38')]);_0x34e1cc[a162_0x30b9('0x25')](_0x543576)[a162_0x30b9('0x25')](_0x4ef9b9)['on']('finish',_0x432502=>{if(_0x432502)return console[a162_0x30b9('0x17')](_0x432502);else{const _0xfa2e6f=fs_1[a162_0x30b9('0x4')][a162_0x30b9('0x2c')](_0xafe93e);const _0x4a93a0=_0xfa2e6f[a162_0x30b9('0x12')];if(_0x4a93a0>0x0){fs_1['default'][a162_0x30b9('0x3d')](_0x4c00e8,a162_0x30b9('0x2f'),function(_0x432502,_0xf74464){if(_0x432502){return console[a162_0x30b9('0x17')](_0x432502);}else{try{const _0x2dbb64=JSON[a162_0x30b9('0x30')](_0xf74464);console['log'](_0x2dbb64);const _0x912f82=_0x2dbb64['eventos'][0x0][a162_0x30b9('0x3e')];const _0xbaecb3=_0x2dbb64[a162_0x30b9('0x3f')][0x0]['hora'];const _0x1fbb66=moment_1[a162_0x30b9('0x4')](_0x912f82+'\x20'+_0xbaecb3+a162_0x30b9('0x40'),a162_0x30b9('0x41'));const _0xc21ece=parseFloat(_0x2dbb64['eventos'][0x0][a162_0x30b9('0x42')]['replace'](',','.'));const _0x57a45f=parseFloat(_0x2dbb64[a162_0x30b9('0x3f')][0x0][a162_0x30b9('0x43')][a162_0x30b9('0x44')](',','.'));const _0x4be32a=_0x2dbb64[a162_0x30b9('0x3f')][0x0][a162_0x30b9('0x45')];const _0x2473ad=_0x2dbb64['eventos'][0x0][a162_0x30b9('0x46')][0x0][a162_0x30b9('0x47')];const _0x480854=_0x2dbb64[a162_0x30b9('0x3f')][0x0][a162_0x30b9('0x46')][0x0][a162_0x30b9('0x48')];console[a162_0x30b9('0xe')](_0xc21ece);console[a162_0x30b9('0xe')](_0x57a45f);console[a162_0x30b9('0xe')](_0x4be32a);console['log'](_0x2473ad);console[a162_0x30b9('0xe')](_0x480854);console[a162_0x30b9('0xe')](_0x1fbb66);if(_0x2473ad>0x0){sequelize_utils_1[a162_0x30b9('0x4')]['models'][a162_0x30b9('0x34')][a162_0x30b9('0x33')]({'amount':_0x2473ad,'counted_at':_0x1fbb66});}sequelize_utils_1[a162_0x30b9('0x4')][a162_0x30b9('0x1b')][a162_0x30b9('0x49')][a162_0x30b9('0x33')]({'device_id':null,'lat':''+_0xc21ece,'lon':''+_0x57a45f,'tracked_at':_0x1fbb66});}catch(_0x44c17e){return console[a162_0x30b9('0x17')](_0x44c17e);}}});}}});_0x51735e[a162_0x30b9('0x11')]({'status':0x1,'data':_0x46ce1b[a162_0x30b9('0x38')]});}}exports[a162_0x30b9('0x4')]=SyncFilesController;