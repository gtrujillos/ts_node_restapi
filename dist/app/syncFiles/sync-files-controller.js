var a73_0x2cd9=['ready','connected:','get','colombia/','file_name','media/','.txt','pipe','createWriteStream','status','save','Downloaded:\x20','fileName','existsSync','statSync','fileName:\x20','fileSizeInBytes:\x20','readFile','utf8','parse','Data','CountingInfo','Out','EndTime','passCountingsModel','create','zlib','file','path','createReadStream','finish','eventos','fecha','hora','\x20-05:00','YYYYMMDD\x20HHmmss\x20Z','latitud','replace','longitud','velocidad','puerta','salidas','locationPointsModel','__importDefault','__esModule','defineProperty','ftp','../../infrastructure/controller-utils','../../infrastructure/sequelize-utils','media','default','syncFtp','bind','downloadFtp','processFtp','log','connecting','list','colombia','name','endsWith','json','size','syncFilesModel','findOrCreate','spread','push','error','connect','ftp.vivotek.com','ipd','models','findOne'];(function(_0x397c17,_0x59963e){var _0x226dca=function(_0x52c19c){while(--_0x52c19c){_0x397c17['push'](_0x397c17['shift']());}};_0x226dca(++_0x59963e);}(a73_0x2cd9,0x74));var a73_0x2a29=function(_0x1fce3d,_0x2ba1ac){_0x1fce3d=_0x1fce3d-0x0;var _0x504fc0=a73_0x2cd9[_0x1fce3d];return _0x504fc0;};'use strict';var __importDefault=this&&this[a73_0x2a29('0x0')]||function(_0x331aa1){return _0x331aa1&&_0x331aa1[a73_0x2a29('0x1')]?_0x331aa1:{'default':_0x331aa1};};Object[a73_0x2a29('0x2')](exports,'__esModule',{'value':!![]});const ftp_1=__importDefault(require(a73_0x2a29('0x3')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a73_0x2a29('0x4')));const sequelize_utils_1=__importDefault(require(a73_0x2a29('0x5')));const moment_1=__importDefault(require('moment'));const UPLOAD_PATH=a73_0x2a29('0x6');class SyncFilesController extends controller_utils_1[a73_0x2a29('0x7')]{constructor(_0x3c2f08){super(_0x3c2f08,null);this[a73_0x2a29('0x8')]=this[a73_0x2a29('0x8')][a73_0x2a29('0x9')](this);this[a73_0x2a29('0xa')]=this[a73_0x2a29('0xa')]['bind'](this);this[a73_0x2a29('0xb')]=this[a73_0x2a29('0xb')][a73_0x2a29('0x9')](this);}['syncFtp'](_0xc1fe01,_0x59b13a,_0x2bf4d6){console[a73_0x2a29('0xc')](a73_0x2a29('0xd'));const _0x43c2bc=[];const _0xc07daf=new ftp_1[(a73_0x2a29('0x7'))]();_0xc07daf['on']('ready',function(){console[a73_0x2a29('0xc')]('connected');_0xc07daf[a73_0x2a29('0xe')](a73_0x2a29('0xf'),![],function(_0x2d4602,_0x4d7959){if(_0x2d4602){console['log'](_0x2d4602);}else{for(const _0x5966c0 of _0x4d7959){if(_0x5966c0[a73_0x2a29('0x10')][a73_0x2a29('0x11')](a73_0x2a29('0x12'))&&_0x5966c0[a73_0x2a29('0x13')]>0x0){sequelize_utils_1[a73_0x2a29('0x7')]['models'][a73_0x2a29('0x14')][a73_0x2a29('0x15')]({'where':{'file_name':_0x5966c0[a73_0x2a29('0x10')]}})[a73_0x2a29('0x16')]((_0x3c24f9,_0x414361)=>{if(_0x414361){_0x43c2bc[a73_0x2a29('0x17')](_0x3c24f9);}});}}}});});_0xc07daf['on'](a73_0x2a29('0x18'),function(_0x5e322f){});_0xc07daf[a73_0x2a29('0x19')]({'host':a73_0x2a29('0x1a'),'port':0x15,'user':a73_0x2a29('0x1b'),'password':a73_0x2a29('0x1b')});_0x59b13a['json']({'data':[]});}['downloadFtp'](_0x2a2b30,_0x49dd1d,_0x3fcdd5){sequelize_utils_1['default'][a73_0x2a29('0x1c')]['syncFilesModel'][a73_0x2a29('0x1d')]({'where':{'status':null}})['then'](_0x54adb8=>{if(_0x54adb8){const _0x589121=new ftp_1[(a73_0x2a29('0x7'))]();_0x589121['on'](a73_0x2a29('0x1e'),function(){console['log'](a73_0x2a29('0x1f')+_0x54adb8['file_name']);_0x589121[a73_0x2a29('0x20')](a73_0x2a29('0x21')+_0x54adb8[a73_0x2a29('0x22')],function(_0x1bbdb2,_0xcfa83a){_0x589121['end']();if(_0x1bbdb2){}else{const _0x1ede92=a73_0x2a29('0x23')+_0x54adb8[a73_0x2a29('0x22')]+a73_0x2a29('0x24');_0xcfa83a[a73_0x2a29('0x25')](fs_1[a73_0x2a29('0x7')][a73_0x2a29('0x26')](_0x1ede92));_0x54adb8[a73_0x2a29('0x27')]=0x1;_0x54adb8[a73_0x2a29('0x28')]();console[a73_0x2a29('0xc')](a73_0x2a29('0x29')+_0x54adb8[a73_0x2a29('0x2a')]);}});});_0x589121['on']('error',function(_0x2dae6e){});_0x589121['connect']({'host':a73_0x2a29('0x1a'),'port':0x15,'user':a73_0x2a29('0x1b'),'password':a73_0x2a29('0x1b')});}else{}});_0x49dd1d['json']({'data':[]});}[a73_0x2a29('0xb')](_0x477cff,_0x450c2c,_0x3f160b){sequelize_utils_1['default']['models'][a73_0x2a29('0x14')][a73_0x2a29('0x1d')]({'where':{'status':0x1}})['then'](_0xb03680=>{if(_0xb03680){const _0x3c5348=a73_0x2a29('0x23')+_0xb03680[a73_0x2a29('0x22')]+a73_0x2a29('0x24');if(fs_1[a73_0x2a29('0x7')][a73_0x2a29('0x2b')](_0x3c5348)){const _0x32a665=fs_1[a73_0x2a29('0x7')][a73_0x2a29('0x2c')](_0x3c5348);const _0x202e4c=_0x32a665[a73_0x2a29('0x13')];console['log'](a73_0x2a29('0x2d')+_0x3c5348);console[a73_0x2a29('0xc')](a73_0x2a29('0x2e')+_0x202e4c);if(_0x202e4c>0x0){fs_1['default'][a73_0x2a29('0x2f')](_0x3c5348,a73_0x2a29('0x30'),function(_0x53a55a,_0xb95ec7){if(_0x53a55a){_0xb03680['status']=null;}else{try{const _0x577139=JSON[a73_0x2a29('0x31')](_0xb95ec7);for(const _0x262b93 of _0x577139[a73_0x2a29('0x32')][0x0][a73_0x2a29('0x33')]){const _0x58eca8=_0x262b93['In'];const _0x464490=_0x262b93[a73_0x2a29('0x34')];const _0x4b525a=Date[a73_0x2a29('0x31')](_0x262b93[a73_0x2a29('0x35')]);if(_0x58eca8>0x0){sequelize_utils_1[a73_0x2a29('0x7')]['models'][a73_0x2a29('0x36')][a73_0x2a29('0x37')]({'amount':_0x58eca8,'counted_at':_0x4b525a});}if(_0x464490>0x0){sequelize_utils_1['default']['models'][a73_0x2a29('0x36')][a73_0x2a29('0x37')]({'amount':_0x464490*-0x1,'counted_at':_0x4b525a});}}_0xb03680[a73_0x2a29('0x27')]=0x2;}catch(_0x1a3cf7){_0xb03680[a73_0x2a29('0x27')]=null;}}_0xb03680[a73_0x2a29('0x28')]();});}else{_0xb03680[a73_0x2a29('0x27')]=null;_0xb03680[a73_0x2a29('0x28')]();}}else{_0xb03680['status']=null;_0xb03680[a73_0x2a29('0x28')]();}}else{}});_0x450c2c[a73_0x2a29('0x12')]({'data':[]});}['uploadEvent'](_0x145d06,_0x347c34,_0x13254f){const _0x38a429=require(a73_0x2a29('0x38'));const _0x4b6871=_0x145d06[a73_0x2a29('0x39')][a73_0x2a29('0x3a')];const _0x5b6f53=UPLOAD_PATH+'/'+_0x145d06['file']['filename']+'.json';const _0x502634=fs_1[a73_0x2a29('0x7')][a73_0x2a29('0x3b')](_0x4b6871);const _0x2eb1eb=fs_1[a73_0x2a29('0x7')][a73_0x2a29('0x26')](_0x5b6f53);const _0x404de9=_0x38a429['createGunzip']();console['log'](_0x145d06['file']);_0x502634['pipe'](_0x404de9)[a73_0x2a29('0x25')](_0x2eb1eb)['on'](a73_0x2a29('0x3c'),_0x10e991=>{if(_0x10e991)return console['error'](_0x10e991);else{const _0x51930e=fs_1['default'][a73_0x2a29('0x2c')](_0x4b6871);const _0x468d1d=_0x51930e['size'];if(_0x468d1d>0x0){fs_1[a73_0x2a29('0x7')][a73_0x2a29('0x2f')](_0x5b6f53,a73_0x2a29('0x30'),function(_0x10e991,_0x3e015b){if(_0x10e991){return console[a73_0x2a29('0x18')](_0x10e991);}else{try{const _0x2a77f8=JSON[a73_0x2a29('0x31')](_0x3e015b);console[a73_0x2a29('0xc')](_0x2a77f8);const _0x125a1b=_0x2a77f8[a73_0x2a29('0x3d')][0x0][a73_0x2a29('0x3e')];const _0x2d3af3=_0x2a77f8[a73_0x2a29('0x3d')][0x0][a73_0x2a29('0x3f')];const _0x835170=moment_1['default'](_0x125a1b+'\x20'+_0x2d3af3+a73_0x2a29('0x40'),a73_0x2a29('0x41'));const _0x1a1bb7=parseFloat(_0x2a77f8[a73_0x2a29('0x3d')][0x0][a73_0x2a29('0x42')][a73_0x2a29('0x43')](',','.'));const _0x49c4c2=parseFloat(_0x2a77f8[a73_0x2a29('0x3d')][0x0][a73_0x2a29('0x44')]['replace'](',','.'));const _0x1e6a43=_0x2a77f8[a73_0x2a29('0x3d')][0x0][a73_0x2a29('0x45')];const _0x124a70=_0x2a77f8[a73_0x2a29('0x3d')][0x0][a73_0x2a29('0x46')][0x0]['ingresos'];const _0x49ba3a=_0x2a77f8['eventos'][0x0][a73_0x2a29('0x46')][0x0][a73_0x2a29('0x47')];console[a73_0x2a29('0xc')](_0x1a1bb7);console[a73_0x2a29('0xc')](_0x49c4c2);console[a73_0x2a29('0xc')](_0x1e6a43);console[a73_0x2a29('0xc')](_0x124a70);console[a73_0x2a29('0xc')](_0x49ba3a);console[a73_0x2a29('0xc')](_0x835170);if(_0x124a70>0x0){sequelize_utils_1['default'][a73_0x2a29('0x1c')]['passCountingsModel'][a73_0x2a29('0x37')]({'amount':_0x124a70,'counted_at':_0x835170});}sequelize_utils_1[a73_0x2a29('0x7')]['models'][a73_0x2a29('0x48')][a73_0x2a29('0x37')]({'device_id':null,'lat':''+_0x1a1bb7,'lon':''+_0x49c4c2,'tracked_at':_0x835170});}catch(_0x56b730){return console['error'](_0x56b730);}}});}}});_0x347c34[a73_0x2a29('0x12')]({'status':0x1,'data':_0x145d06[a73_0x2a29('0x39')]});}}exports[a73_0x2a29('0x7')]=SyncFilesController;