var a73_0x5274=['puerta','ingresos','salidas','locationPointsModel','__importDefault','__esModule','defineProperty','ftp','../../infrastructure/sequelize-utils','media','default','syncFtp','bind','downloadFtp','processFtp','connecting','ready','log','connected','list','colombia','name','endsWith','json','size','models','syncFilesModel','findOrCreate','push','ftp.vivotek.com','ipd','findOne','then','connected:','get','colombia/','file_name','media/','.txt','pipe','createWriteStream','status','save','Downloaded:\x20','fileName','connect','existsSync','statSync','fileName:\x20','fileSizeInBytes:\x20','utf8','parse','CountingInfo','Out','EndTime','create','passCountingsModel','uploadEvent','zlib','file','path','.json','createReadStream','createGunzip','finish','readFile','error','eventos','hora','\x20-05:00','YYYYMMDD\x20HHmmss\x20Z','latitud','longitud','replace','velocidad'];(function(_0x196fd5,_0xfd93f9){var _0x1470db=function(_0x4d2ccb){while(--_0x4d2ccb){_0x196fd5['push'](_0x196fd5['shift']());}};_0x1470db(++_0xfd93f9);}(a73_0x5274,0x9a));var a73_0xea61=function(_0x6d5e52,_0xda03ae){_0x6d5e52=_0x6d5e52-0x0;var _0xe6ed4a=a73_0x5274[_0x6d5e52];return _0xe6ed4a;};'use strict';var __importDefault=this&&this[a73_0xea61('0x0')]||function(_0x368d00){return _0x368d00&&_0x368d00[a73_0xea61('0x1')]?_0x368d00:{'default':_0x368d00};};Object[a73_0xea61('0x2')](exports,'__esModule',{'value':!![]});const ftp_1=__importDefault(require(a73_0xea61('0x3')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require('../../infrastructure/controller-utils'));const sequelize_utils_1=__importDefault(require(a73_0xea61('0x4')));const moment_1=__importDefault(require('moment'));const UPLOAD_PATH=a73_0xea61('0x5');class SyncFilesController extends controller_utils_1[a73_0xea61('0x6')]{constructor(_0x1a899f){super(_0x1a899f,null);this[a73_0xea61('0x7')]=this['syncFtp'][a73_0xea61('0x8')](this);this[a73_0xea61('0x9')]=this[a73_0xea61('0x9')][a73_0xea61('0x8')](this);this[a73_0xea61('0xa')]=this['processFtp'][a73_0xea61('0x8')](this);}[a73_0xea61('0x7')](_0x49877d,_0x4e491a,_0x9f8962){console['log'](a73_0xea61('0xb'));const _0x4e8cae=[];const _0x3c9e23=new ftp_1[(a73_0xea61('0x6'))]();_0x3c9e23['on'](a73_0xea61('0xc'),function(){console[a73_0xea61('0xd')](a73_0xea61('0xe'));_0x3c9e23[a73_0xea61('0xf')](a73_0xea61('0x10'),![],function(_0x2710d2,_0x416393){if(_0x2710d2){console[a73_0xea61('0xd')](_0x2710d2);}else{for(const _0x5cff39 of _0x416393){if(_0x5cff39[a73_0xea61('0x11')][a73_0xea61('0x12')](a73_0xea61('0x13'))&&_0x5cff39[a73_0xea61('0x14')]>0x0){sequelize_utils_1['default'][a73_0xea61('0x15')][a73_0xea61('0x16')][a73_0xea61('0x17')]({'where':{'file_name':_0x5cff39[a73_0xea61('0x11')]}})['spread']((_0x2bb036,_0x40c828)=>{if(_0x40c828){_0x4e8cae[a73_0xea61('0x18')](_0x2bb036);}});}}}});});_0x3c9e23['on']('error',function(_0x2f54be){});_0x3c9e23['connect']({'host':a73_0xea61('0x19'),'port':0x15,'user':'ipd','password':a73_0xea61('0x1a')});_0x4e491a[a73_0xea61('0x13')]({'data':[]});}['downloadFtp'](_0x13cdc7,_0x550284,_0x1b0393){sequelize_utils_1[a73_0xea61('0x6')][a73_0xea61('0x15')][a73_0xea61('0x16')][a73_0xea61('0x1b')]({'where':{'status':null}})[a73_0xea61('0x1c')](_0x2c74e6=>{if(_0x2c74e6){const _0x466ab1=new ftp_1[(a73_0xea61('0x6'))]();_0x466ab1['on'](a73_0xea61('0xc'),function(){console[a73_0xea61('0xd')](a73_0xea61('0x1d')+_0x2c74e6['file_name']);_0x466ab1[a73_0xea61('0x1e')](a73_0xea61('0x1f')+_0x2c74e6[a73_0xea61('0x20')],function(_0xd228f9,_0xe31afe){_0x466ab1['end']();if(_0xd228f9){}else{const _0x391011=a73_0xea61('0x21')+_0x2c74e6[a73_0xea61('0x20')]+a73_0xea61('0x22');_0xe31afe[a73_0xea61('0x23')](fs_1[a73_0xea61('0x6')][a73_0xea61('0x24')](_0x391011));_0x2c74e6[a73_0xea61('0x25')]=0x1;_0x2c74e6[a73_0xea61('0x26')]();console[a73_0xea61('0xd')](a73_0xea61('0x27')+_0x2c74e6[a73_0xea61('0x28')]);}});});_0x466ab1['on']('error',function(_0x3c6bf3){});_0x466ab1[a73_0xea61('0x29')]({'host':a73_0xea61('0x19'),'port':0x15,'user':a73_0xea61('0x1a'),'password':a73_0xea61('0x1a')});}else{}});_0x550284['json']({'data':[]});}['processFtp'](_0x1057bb,_0x2b1317,_0x28480e){sequelize_utils_1['default'][a73_0xea61('0x15')][a73_0xea61('0x16')][a73_0xea61('0x1b')]({'where':{'status':0x1}})[a73_0xea61('0x1c')](_0x437a15=>{if(_0x437a15){const _0x50ac7e=a73_0xea61('0x21')+_0x437a15[a73_0xea61('0x20')]+a73_0xea61('0x22');if(fs_1[a73_0xea61('0x6')][a73_0xea61('0x2a')](_0x50ac7e)){const _0x41b22d=fs_1[a73_0xea61('0x6')][a73_0xea61('0x2b')](_0x50ac7e);const _0xb622d9=_0x41b22d['size'];console[a73_0xea61('0xd')](a73_0xea61('0x2c')+_0x50ac7e);console[a73_0xea61('0xd')](a73_0xea61('0x2d')+_0xb622d9);if(_0xb622d9>0x0){fs_1[a73_0xea61('0x6')]['readFile'](_0x50ac7e,a73_0xea61('0x2e'),function(_0x3b14d9,_0x107f39){if(_0x3b14d9){_0x437a15[a73_0xea61('0x25')]=null;}else{try{const _0x4158b4=JSON[a73_0xea61('0x2f')](_0x107f39);for(const _0x52414 of _0x4158b4['Data'][0x0][a73_0xea61('0x30')]){const _0x2f28e9=_0x52414['In'];const _0x57a9d8=_0x52414[a73_0xea61('0x31')];const _0x2262eb=Date['parse'](_0x52414[a73_0xea61('0x32')]);if(_0x2f28e9>0x0){sequelize_utils_1[a73_0xea61('0x6')][a73_0xea61('0x15')]['passCountingsModel'][a73_0xea61('0x33')]({'amount':_0x2f28e9,'counted_at':_0x2262eb});}if(_0x57a9d8>0x0){sequelize_utils_1['default'][a73_0xea61('0x15')][a73_0xea61('0x34')][a73_0xea61('0x33')]({'amount':_0x57a9d8*-0x1,'counted_at':_0x2262eb});}}_0x437a15[a73_0xea61('0x25')]=0x2;}catch(_0x527ba0){_0x437a15['status']=null;}}_0x437a15[a73_0xea61('0x26')]();});}else{_0x437a15[a73_0xea61('0x25')]=null;_0x437a15[a73_0xea61('0x26')]();}}else{_0x437a15[a73_0xea61('0x25')]=null;_0x437a15['save']();}}else{}});_0x2b1317[a73_0xea61('0x13')]({'data':[]});}[a73_0xea61('0x35')](_0x403928,_0x368fb7,_0x3a21f7){const _0x1db1f5=require(a73_0xea61('0x36'));const _0x422645=_0x403928[a73_0xea61('0x37')][a73_0xea61('0x38')];const _0x1d588a=UPLOAD_PATH+'/'+_0x403928[a73_0xea61('0x37')]['filename']+a73_0xea61('0x39');const _0x170beb=fs_1['default'][a73_0xea61('0x3a')](_0x422645);const _0x529855=fs_1[a73_0xea61('0x6')]['createWriteStream'](_0x1d588a);const _0x19afd1=_0x1db1f5[a73_0xea61('0x3b')]();console[a73_0xea61('0xd')](_0x403928['file']);_0x170beb[a73_0xea61('0x23')](_0x19afd1)[a73_0xea61('0x23')](_0x529855)['on'](a73_0xea61('0x3c'),_0x3ce5ad=>{if(_0x3ce5ad)return console['error'](_0x3ce5ad);else{const _0x3790bc=fs_1[a73_0xea61('0x6')][a73_0xea61('0x2b')](_0x422645);const _0x4e480a=_0x3790bc[a73_0xea61('0x14')];if(_0x4e480a>0x0){fs_1[a73_0xea61('0x6')][a73_0xea61('0x3d')](_0x1d588a,a73_0xea61('0x2e'),function(_0x3ce5ad,_0x5d8f84){if(_0x3ce5ad){return console[a73_0xea61('0x3e')](_0x3ce5ad);}else{try{const _0x570b03=JSON[a73_0xea61('0x2f')](_0x5d8f84);console['log'](_0x570b03);const _0x5919e3=_0x570b03[a73_0xea61('0x3f')][0x0]['fecha'];const _0x3f8f36=_0x570b03[a73_0xea61('0x3f')][0x0][a73_0xea61('0x40')];const _0xb72905=moment_1[a73_0xea61('0x6')](_0x5919e3+'\x20'+_0x3f8f36+a73_0xea61('0x41'),a73_0xea61('0x42'));const _0x4939b0=parseFloat(_0x570b03[a73_0xea61('0x3f')][0x0][a73_0xea61('0x43')]['replace'](',','.'));const _0x176ee9=parseFloat(_0x570b03['eventos'][0x0][a73_0xea61('0x44')][a73_0xea61('0x45')](',','.'));const _0x196be6=_0x570b03[a73_0xea61('0x3f')][0x0][a73_0xea61('0x46')];const _0x262729=_0x570b03[a73_0xea61('0x3f')][0x0][a73_0xea61('0x47')][0x0][a73_0xea61('0x48')];const _0x11d33d=_0x570b03[a73_0xea61('0x3f')][0x0]['puerta'][0x0][a73_0xea61('0x49')];console['log'](_0x4939b0);console[a73_0xea61('0xd')](_0x176ee9);console[a73_0xea61('0xd')](_0x196be6);console['log'](_0x262729);console[a73_0xea61('0xd')](_0x11d33d);console[a73_0xea61('0xd')](_0xb72905);if(_0x262729>0x0){sequelize_utils_1[a73_0xea61('0x6')][a73_0xea61('0x15')][a73_0xea61('0x34')][a73_0xea61('0x33')]({'amount':_0x262729,'counted_at':_0xb72905});}sequelize_utils_1[a73_0xea61('0x6')]['models'][a73_0xea61('0x4a')]['create']({'device_id':null,'lat':''+_0x4939b0,'lon':''+_0x176ee9,'tracked_at':_0xb72905});}catch(_0x1beb66){return console[a73_0xea61('0x3e')](_0x1beb66);}}});}}});_0x368fb7[a73_0xea61('0x13')]({'status':0x1,'data':_0x403928['file']});}}exports[a73_0xea61('0x6')]=SyncFilesController;