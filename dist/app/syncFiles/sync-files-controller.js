var a162_0x1f03=['__importDefault','__esModule','ftp','../../infrastructure/controller-utils','../../infrastructure/sequelize-utils','default','syncFtp','downloadFtp','bind','processFtp','log','connecting','connected','name','endsWith','size','models','syncFilesModel','findOrCreate','spread','push','ftp.vivotek.com','ipd','json','findOne','then','ready','connected:','file_name','get','colombia/','end','pipe','Downloaded:\x20','fileName','error','connect','media/','existsSync','statSync','fileName:\x20','fileSizeInBytes:\x20','readFile','utf8','status','Data','CountingInfo','Out','passCountingsModel','create','save','zlib','file','path','filename','.json','createReadStream','createWriteStream','createGunzip','finish','eventos','fecha','hora','\x20-05:00','YYYYMMDD\x20HHmmss\x20Z','replace','longitud','velocidad','puerta','locationPointsModel'];(function(_0x487505,_0x46a1fd){var _0x444edd=function(_0x49cfc0){while(--_0x49cfc0){_0x487505['push'](_0x487505['shift']());}};_0x444edd(++_0x46a1fd);}(a162_0x1f03,0x8c));var a162_0x43c4=function(_0x3abdbc,_0x32fbcc){_0x3abdbc=_0x3abdbc-0x0;var _0x31e082=a162_0x1f03[_0x3abdbc];return _0x31e082;};'use strict';var __importDefault=this&&this[a162_0x43c4('0x0')]||function(_0x4f233a){return _0x4f233a&&_0x4f233a[a162_0x43c4('0x1')]?_0x4f233a:{'default':_0x4f233a};};Object['defineProperty'](exports,a162_0x43c4('0x1'),{'value':!![]});const ftp_1=__importDefault(require(a162_0x43c4('0x2')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a162_0x43c4('0x3')));const sequelize_utils_1=__importDefault(require(a162_0x43c4('0x4')));const moment_1=__importDefault(require('moment'));const UPLOAD_PATH='media';class SyncFilesController extends controller_utils_1[a162_0x43c4('0x5')]{constructor(_0x352803){super(_0x352803,null);this[a162_0x43c4('0x6')]=this[a162_0x43c4('0x6')]['bind'](this);this['downloadFtp']=this[a162_0x43c4('0x7')][a162_0x43c4('0x8')](this);this[a162_0x43c4('0x9')]=this['processFtp'][a162_0x43c4('0x8')](this);}[a162_0x43c4('0x6')](_0x8b4cd5,_0x41ca92,_0x479960){console[a162_0x43c4('0xa')](a162_0x43c4('0xb'));const _0x375998=[];const _0x1aade8=new ftp_1[(a162_0x43c4('0x5'))]();_0x1aade8['on']('ready',function(){console[a162_0x43c4('0xa')](a162_0x43c4('0xc'));_0x1aade8['list']('colombia',![],function(_0x150eeb,_0x16f80b){if(_0x150eeb){console[a162_0x43c4('0xa')](_0x150eeb);}else{for(const _0x313202 of _0x16f80b){if(_0x313202[a162_0x43c4('0xd')][a162_0x43c4('0xe')]('json')&&_0x313202[a162_0x43c4('0xf')]>0x0){sequelize_utils_1['default'][a162_0x43c4('0x10')][a162_0x43c4('0x11')][a162_0x43c4('0x12')]({'where':{'file_name':_0x313202[a162_0x43c4('0xd')]}})[a162_0x43c4('0x13')]((_0x3389ac,_0xc908f7)=>{if(_0xc908f7){_0x375998[a162_0x43c4('0x14')](_0x3389ac);}});}}}});});_0x1aade8['on']('error',function(_0x55746d){});_0x1aade8['connect']({'host':a162_0x43c4('0x15'),'port':0x15,'user':a162_0x43c4('0x16'),'password':a162_0x43c4('0x16')});_0x41ca92[a162_0x43c4('0x17')]({'data':[]});}[a162_0x43c4('0x7')](_0x29a89b,_0x24fb35,_0x53560d){sequelize_utils_1['default'][a162_0x43c4('0x10')][a162_0x43c4('0x11')][a162_0x43c4('0x18')]({'where':{'status':null}})[a162_0x43c4('0x19')](_0x516f41=>{if(_0x516f41){const _0x5aba45=new ftp_1[(a162_0x43c4('0x5'))]();_0x5aba45['on'](a162_0x43c4('0x1a'),function(){console[a162_0x43c4('0xa')](a162_0x43c4('0x1b')+_0x516f41[a162_0x43c4('0x1c')]);_0x5aba45[a162_0x43c4('0x1d')](a162_0x43c4('0x1e')+_0x516f41['file_name'],function(_0x3d5ad6,_0x329774){_0x5aba45[a162_0x43c4('0x1f')]();if(_0x3d5ad6){}else{const _0xc3dc30='media/'+_0x516f41[a162_0x43c4('0x1c')]+'.txt';_0x329774[a162_0x43c4('0x20')](fs_1[a162_0x43c4('0x5')]['createWriteStream'](_0xc3dc30));_0x516f41['status']=0x1;_0x516f41['save']();console[a162_0x43c4('0xa')](a162_0x43c4('0x21')+_0x516f41[a162_0x43c4('0x22')]);}});});_0x5aba45['on'](a162_0x43c4('0x23'),function(_0x4ad7b7){});_0x5aba45[a162_0x43c4('0x24')]({'host':a162_0x43c4('0x15'),'port':0x15,'user':a162_0x43c4('0x16'),'password':a162_0x43c4('0x16')});}else{}});_0x24fb35[a162_0x43c4('0x17')]({'data':[]});}['processFtp'](_0x4d6ce4,_0x213c2c,_0x37e5ed){sequelize_utils_1[a162_0x43c4('0x5')][a162_0x43c4('0x10')]['syncFilesModel'][a162_0x43c4('0x18')]({'where':{'status':0x1}})[a162_0x43c4('0x19')](_0x1af84e=>{if(_0x1af84e){const _0x5c04e3=a162_0x43c4('0x25')+_0x1af84e['file_name']+'.txt';if(fs_1['default'][a162_0x43c4('0x26')](_0x5c04e3)){const _0x1b3dfe=fs_1[a162_0x43c4('0x5')][a162_0x43c4('0x27')](_0x5c04e3);const _0x2b848e=_0x1b3dfe[a162_0x43c4('0xf')];console[a162_0x43c4('0xa')](a162_0x43c4('0x28')+_0x5c04e3);console['log'](a162_0x43c4('0x29')+_0x2b848e);if(_0x2b848e>0x0){fs_1[a162_0x43c4('0x5')][a162_0x43c4('0x2a')](_0x5c04e3,a162_0x43c4('0x2b'),function(_0x44f9e5,_0x2e26f2){if(_0x44f9e5){_0x1af84e[a162_0x43c4('0x2c')]=null;}else{try{const _0x29810f=JSON['parse'](_0x2e26f2);for(const _0x282af5 of _0x29810f[a162_0x43c4('0x2d')][0x0][a162_0x43c4('0x2e')]){const _0x1ace8b=_0x282af5['In'];const _0x3986af=_0x282af5[a162_0x43c4('0x2f')];const _0x4bd77d=Date['parse'](_0x282af5['EndTime']);if(_0x1ace8b>0x0){sequelize_utils_1[a162_0x43c4('0x5')][a162_0x43c4('0x10')][a162_0x43c4('0x30')][a162_0x43c4('0x31')]({'amount':_0x1ace8b,'counted_at':_0x4bd77d});}if(_0x3986af>0x0){sequelize_utils_1[a162_0x43c4('0x5')][a162_0x43c4('0x10')]['passCountingsModel'][a162_0x43c4('0x31')]({'amount':_0x3986af*-0x1,'counted_at':_0x4bd77d});}}_0x1af84e[a162_0x43c4('0x2c')]=0x2;}catch(_0x58e5df){_0x1af84e[a162_0x43c4('0x2c')]=null;}}_0x1af84e[a162_0x43c4('0x32')]();});}else{_0x1af84e['status']=null;_0x1af84e[a162_0x43c4('0x32')]();}}else{_0x1af84e[a162_0x43c4('0x2c')]=null;_0x1af84e[a162_0x43c4('0x32')]();}}else{}});_0x213c2c[a162_0x43c4('0x17')]({'data':[]});}['uploadEvent'](_0xeae0f3,_0x55a4dc,_0x5ab234){const _0x513f6b=require(a162_0x43c4('0x33'));const _0xe25431=_0xeae0f3[a162_0x43c4('0x34')][a162_0x43c4('0x35')];const _0x1ada38=UPLOAD_PATH+'/'+_0xeae0f3[a162_0x43c4('0x34')][a162_0x43c4('0x36')]+a162_0x43c4('0x37');const _0x187db9=fs_1['default'][a162_0x43c4('0x38')](_0xe25431);const _0x4fcf83=fs_1[a162_0x43c4('0x5')][a162_0x43c4('0x39')](_0x1ada38);const _0x2b1a00=_0x513f6b[a162_0x43c4('0x3a')]();console[a162_0x43c4('0xa')](_0xeae0f3[a162_0x43c4('0x34')]);_0x187db9[a162_0x43c4('0x20')](_0x2b1a00)['pipe'](_0x4fcf83)['on'](a162_0x43c4('0x3b'),_0xfe43b9=>{if(_0xfe43b9)return console[a162_0x43c4('0x23')](_0xfe43b9);else{const _0x3890ba=fs_1[a162_0x43c4('0x5')][a162_0x43c4('0x27')](_0xe25431);const _0x2d861b=_0x3890ba[a162_0x43c4('0xf')];if(_0x2d861b>0x0){fs_1[a162_0x43c4('0x5')][a162_0x43c4('0x2a')](_0x1ada38,a162_0x43c4('0x2b'),function(_0xfe43b9,_0x19a41f){if(_0xfe43b9){return console[a162_0x43c4('0x23')](_0xfe43b9);}else{try{const _0x382dcb=JSON['parse'](_0x19a41f);console[a162_0x43c4('0xa')](_0x382dcb);const _0x131610=_0x382dcb[a162_0x43c4('0x3c')][0x0][a162_0x43c4('0x3d')];const _0x537928=_0x382dcb[a162_0x43c4('0x3c')][0x0][a162_0x43c4('0x3e')];const _0x288219=moment_1[a162_0x43c4('0x5')](_0x131610+'\x20'+_0x537928+a162_0x43c4('0x3f'),a162_0x43c4('0x40'));const _0x3ee48c=parseFloat(_0x382dcb[a162_0x43c4('0x3c')][0x0]['latitud'][a162_0x43c4('0x41')](',','.'));const _0x43d9d8=parseFloat(_0x382dcb['eventos'][0x0][a162_0x43c4('0x42')]['replace'](',','.'));const _0x4e0dfb=_0x382dcb['eventos'][0x0][a162_0x43c4('0x43')];const _0x353183=_0x382dcb[a162_0x43c4('0x3c')][0x0][a162_0x43c4('0x44')][0x0]['ingresos'];const _0xad084f=_0x382dcb[a162_0x43c4('0x3c')][0x0][a162_0x43c4('0x44')][0x0]['salidas'];console['log'](_0x3ee48c);console[a162_0x43c4('0xa')](_0x43d9d8);console[a162_0x43c4('0xa')](_0x4e0dfb);console['log'](_0x353183);console[a162_0x43c4('0xa')](_0xad084f);console[a162_0x43c4('0xa')](_0x288219);if(_0x353183>0x0){sequelize_utils_1['default'][a162_0x43c4('0x10')][a162_0x43c4('0x30')]['create']({'amount':_0x353183,'counted_at':_0x288219});}sequelize_utils_1[a162_0x43c4('0x5')][a162_0x43c4('0x10')][a162_0x43c4('0x45')][a162_0x43c4('0x31')]({'device_id':null,'lat':''+_0x3ee48c,'lon':''+_0x43d9d8,'tracked_at':_0x288219});}catch(_0x307c06){return console[a162_0x43c4('0x23')](_0x307c06);}}});}}});_0x55a4dc[a162_0x43c4('0x17')]({'status':0x1,'data':_0xeae0f3[a162_0x43c4('0x34')]});}}exports[a162_0x43c4('0x5')]=SyncFilesController;