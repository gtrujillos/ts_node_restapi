var a205_0x2e3d=['moment','syncFtp','bind','downloadFtp','processFtp','log','ready','connected','colombia','name','endsWith','json','size','default','models','syncFilesModel','spread','push','error','connect','ftp.vivotek.com','ipd','findOne','then','connected:','file_name','colombia/','end','media/','.txt','pipe','createWriteStream','save','Downloaded:\x20','fileName','existsSync','fileName:\x20','fileSizeInBytes:\x20','utf8','status','parse','Data','CountingInfo','Out','EndTime','passCountingsModel','uploadEvent','zlib','file','path','createReadStream','finish','eventos','fecha','hora','\x20-05:00','replace','longitud','velocidad','puerta','salidas','create','locationPointsModel','__importDefault','defineProperty','__esModule','ftp','../../infrastructure/base-controller'];(function(_0x51b500,_0x37dfbc){var _0x2b0987=function(_0x29b6ba){while(--_0x29b6ba){_0x51b500['push'](_0x51b500['shift']());}};_0x2b0987(++_0x37dfbc);}(a205_0x2e3d,0x83));var a205_0x30f8=function(_0x3562b5,_0x22dabc){_0x3562b5=_0x3562b5-0x0;var _0x54d52d=a205_0x2e3d[_0x3562b5];return _0x54d52d;};'use strict';var __importDefault=this&&this[a205_0x30f8('0x0')]||function(_0x3f2d63){return _0x3f2d63&&_0x3f2d63['__esModule']?_0x3f2d63:{'default':_0x3f2d63};};Object[a205_0x30f8('0x1')](exports,a205_0x30f8('0x2'),{'value':!![]});const ftp_1=__importDefault(require(a205_0x30f8('0x3')));const fs_1=__importDefault(require('fs'));const base_controller_1=__importDefault(require(a205_0x30f8('0x4')));const sequelize_utils_1=__importDefault(require('../../infrastructure/sequelize-utils'));const moment_1=__importDefault(require(a205_0x30f8('0x5')));const UPLOAD_PATH='media';class SyncFilesController extends base_controller_1['default']{constructor(_0x2ccc0c){super(_0x2ccc0c,null);this[a205_0x30f8('0x6')]=this[a205_0x30f8('0x6')][a205_0x30f8('0x7')](this);this[a205_0x30f8('0x8')]=this['downloadFtp']['bind'](this);this[a205_0x30f8('0x9')]=this['processFtp'][a205_0x30f8('0x7')](this);}['syncFtp'](_0x59b515,_0x20811f,_0x5029d1){console[a205_0x30f8('0xa')]('connecting');const _0x264a5f=[];const _0x23af80=new ftp_1['default']();_0x23af80['on'](a205_0x30f8('0xb'),function(){console['log'](a205_0x30f8('0xc'));_0x23af80['list'](a205_0x30f8('0xd'),![],function(_0x5e3f52,_0x5740c9){if(_0x5e3f52){console[a205_0x30f8('0xa')](_0x5e3f52);}else{for(const _0x424242 of _0x5740c9){if(_0x424242[a205_0x30f8('0xe')][a205_0x30f8('0xf')](a205_0x30f8('0x10'))&&_0x424242[a205_0x30f8('0x11')]>0x0){sequelize_utils_1[a205_0x30f8('0x12')][a205_0x30f8('0x13')][a205_0x30f8('0x14')]['findOrCreate']({'where':{'file_name':_0x424242[a205_0x30f8('0xe')]}})[a205_0x30f8('0x15')]((_0x404c21,_0x479514)=>{if(_0x479514){_0x264a5f[a205_0x30f8('0x16')](_0x404c21);}});}}}});});_0x23af80['on'](a205_0x30f8('0x17'),function(_0x47067d){});_0x23af80[a205_0x30f8('0x18')]({'host':a205_0x30f8('0x19'),'port':0x15,'user':a205_0x30f8('0x1a'),'password':a205_0x30f8('0x1a')});_0x20811f[a205_0x30f8('0x10')]({'data':[]});}['downloadFtp'](_0x5ae8be,_0x3c932f,_0x1e8be1){sequelize_utils_1[a205_0x30f8('0x12')][a205_0x30f8('0x13')][a205_0x30f8('0x14')][a205_0x30f8('0x1b')]({'where':{'status':null}})[a205_0x30f8('0x1c')](_0x1c3267=>{if(_0x1c3267){const _0xaaed49=new ftp_1['default']();_0xaaed49['on'](a205_0x30f8('0xb'),function(){console[a205_0x30f8('0xa')](a205_0x30f8('0x1d')+_0x1c3267[a205_0x30f8('0x1e')]);_0xaaed49['get'](a205_0x30f8('0x1f')+_0x1c3267[a205_0x30f8('0x1e')],function(_0x2a669b,_0x100557){_0xaaed49[a205_0x30f8('0x20')]();if(_0x2a669b){}else{const _0x2d3761=a205_0x30f8('0x21')+_0x1c3267[a205_0x30f8('0x1e')]+a205_0x30f8('0x22');_0x100557[a205_0x30f8('0x23')](fs_1[a205_0x30f8('0x12')][a205_0x30f8('0x24')](_0x2d3761));_0x1c3267['status']=0x1;_0x1c3267[a205_0x30f8('0x25')]();console[a205_0x30f8('0xa')](a205_0x30f8('0x26')+_0x1c3267[a205_0x30f8('0x27')]);}});});_0xaaed49['on']('error',function(_0xcde18a){});_0xaaed49[a205_0x30f8('0x18')]({'host':a205_0x30f8('0x19'),'port':0x15,'user':a205_0x30f8('0x1a'),'password':a205_0x30f8('0x1a')});}else{}});_0x3c932f[a205_0x30f8('0x10')]({'data':[]});}[a205_0x30f8('0x9')](_0x1fcf73,_0x11ee5c,_0x2cc62f){sequelize_utils_1['default'][a205_0x30f8('0x13')][a205_0x30f8('0x14')][a205_0x30f8('0x1b')]({'where':{'status':0x1}})[a205_0x30f8('0x1c')](_0x583626=>{if(_0x583626){const _0x2bb295=a205_0x30f8('0x21')+_0x583626[a205_0x30f8('0x1e')]+'.txt';if(fs_1[a205_0x30f8('0x12')][a205_0x30f8('0x28')](_0x2bb295)){const _0x294925=fs_1[a205_0x30f8('0x12')]['statSync'](_0x2bb295);const _0x2cc46d=_0x294925[a205_0x30f8('0x11')];console[a205_0x30f8('0xa')](a205_0x30f8('0x29')+_0x2bb295);console[a205_0x30f8('0xa')](a205_0x30f8('0x2a')+_0x2cc46d);if(_0x2cc46d>0x0){fs_1[a205_0x30f8('0x12')]['readFile'](_0x2bb295,a205_0x30f8('0x2b'),function(_0x4ef203,_0x56d625){if(_0x4ef203){_0x583626[a205_0x30f8('0x2c')]=null;}else{try{const _0x3b4692=JSON[a205_0x30f8('0x2d')](_0x56d625);for(const _0xb41a55 of _0x3b4692[a205_0x30f8('0x2e')][0x0][a205_0x30f8('0x2f')]){const _0xfd6d8d=_0xb41a55['In'];const _0x46c7d2=_0xb41a55[a205_0x30f8('0x30')];const _0xffa1ba=Date['parse'](_0xb41a55[a205_0x30f8('0x31')]);if(_0xfd6d8d>0x0){sequelize_utils_1[a205_0x30f8('0x12')][a205_0x30f8('0x13')][a205_0x30f8('0x32')]['create']({'amount':_0xfd6d8d,'counted_at':_0xffa1ba});}if(_0x46c7d2>0x0){sequelize_utils_1[a205_0x30f8('0x12')][a205_0x30f8('0x13')][a205_0x30f8('0x32')]['create']({'amount':_0x46c7d2*-0x1,'counted_at':_0xffa1ba});}}_0x583626['status']=0x2;}catch(_0x23ba99){_0x583626['status']=null;}}_0x583626[a205_0x30f8('0x25')]();});}else{_0x583626[a205_0x30f8('0x2c')]=null;_0x583626[a205_0x30f8('0x25')]();}}else{_0x583626[a205_0x30f8('0x2c')]=null;_0x583626['save']();}}else{}});_0x11ee5c['json']({'data':[]});}[a205_0x30f8('0x33')](_0x47f366,_0x5dec72,_0x591aeb){const _0x2b9103=require(a205_0x30f8('0x34'));const _0x206004=_0x47f366[a205_0x30f8('0x35')][a205_0x30f8('0x36')];const _0x657827=UPLOAD_PATH+'/'+_0x47f366[a205_0x30f8('0x35')]['filename']+'.json';const _0x5efdeb=fs_1['default'][a205_0x30f8('0x37')](_0x206004);const _0x3101b3=fs_1[a205_0x30f8('0x12')][a205_0x30f8('0x24')](_0x657827);const _0x444abc=_0x2b9103['createGunzip']();console[a205_0x30f8('0xa')](_0x47f366[a205_0x30f8('0x35')]);_0x5efdeb['pipe'](_0x444abc)[a205_0x30f8('0x23')](_0x3101b3)['on'](a205_0x30f8('0x38'),_0x3a2f74=>{if(_0x3a2f74)return console['error'](_0x3a2f74);else{const _0x141b29=fs_1['default']['statSync'](_0x206004);const _0x3d5989=_0x141b29[a205_0x30f8('0x11')];if(_0x3d5989>0x0){fs_1[a205_0x30f8('0x12')]['readFile'](_0x657827,a205_0x30f8('0x2b'),function(_0x3a2f74,_0x142725){if(_0x3a2f74){return console[a205_0x30f8('0x17')](_0x3a2f74);}else{try{const _0xe47ae3=JSON[a205_0x30f8('0x2d')](_0x142725);console[a205_0x30f8('0xa')](_0xe47ae3);const _0x16ce49=_0xe47ae3[a205_0x30f8('0x39')][0x0][a205_0x30f8('0x3a')];const _0x1ddc43=_0xe47ae3[a205_0x30f8('0x39')][0x0][a205_0x30f8('0x3b')];const _0x5acb89=moment_1[a205_0x30f8('0x12')](_0x16ce49+'\x20'+_0x1ddc43+a205_0x30f8('0x3c'),'YYYYMMDD\x20HHmmss\x20Z');const _0x418e64=parseFloat(_0xe47ae3[a205_0x30f8('0x39')][0x0]['latitud'][a205_0x30f8('0x3d')](',','.'));const _0x279a42=parseFloat(_0xe47ae3[a205_0x30f8('0x39')][0x0][a205_0x30f8('0x3e')][a205_0x30f8('0x3d')](',','.'));const _0x542a24=_0xe47ae3[a205_0x30f8('0x39')][0x0][a205_0x30f8('0x3f')];const _0x34bcad=_0xe47ae3[a205_0x30f8('0x39')][0x0][a205_0x30f8('0x40')][0x0]['ingresos'];const _0x2daae5=_0xe47ae3[a205_0x30f8('0x39')][0x0]['puerta'][0x0][a205_0x30f8('0x41')];console[a205_0x30f8('0xa')](_0x418e64);console[a205_0x30f8('0xa')](_0x279a42);console['log'](_0x542a24);console['log'](_0x34bcad);console[a205_0x30f8('0xa')](_0x2daae5);console['log'](_0x5acb89);if(_0x34bcad>0x0){sequelize_utils_1[a205_0x30f8('0x12')][a205_0x30f8('0x13')][a205_0x30f8('0x32')][a205_0x30f8('0x42')]({'amount':_0x34bcad,'counted_at':_0x5acb89});}sequelize_utils_1['default']['models'][a205_0x30f8('0x43')][a205_0x30f8('0x42')]({'device_id':null,'lat':''+_0x418e64,'lon':''+_0x279a42,'tracked_at':_0x5acb89});}catch(_0xbf4afe){return console[a205_0x30f8('0x17')](_0xbf4afe);}}});}}});_0x5dec72[a205_0x30f8('0x10')]({'status':0x1,'data':_0x47f366[a205_0x30f8('0x35')]});}}exports['default']=SyncFilesController;