var a162_0x4764=['ftp.vivotek.com','ipd','downloadFtp','ready','file_name','get','colombia/','end','pipe','createWriteStream','status','save','Downloaded:\x20','error','connect','findOne','then','media/','existsSync','statSync','fileName:\x20','fileSizeInBytes:\x20','readFile','utf8','parse','Data','CountingInfo','EndTime','passCountingsModel','create','file','path','filename','.json','createReadStream','createGunzip','finish','eventos','fecha','YYYYMMDD\x20HHmmss\x20Z','latitud','replace','longitud','velocidad','puerta','ingresos','salidas','locationPointsModel','__importDefault','defineProperty','__esModule','ftp','../../infrastructure/controller-utils','../../infrastructure/sequelize-utils','default','syncFtp','bind','processFtp','log','connecting','connected','list','colombia','name','endsWith','json','size','models','syncFilesModel','findOrCreate','spread','push'];(function(_0x2d8f05,_0x4b81bb){var _0x4d74cb=function(_0x32719f){while(--_0x32719f){_0x2d8f05['push'](_0x2d8f05['shift']());}};_0x4d74cb(++_0x4b81bb);}(a162_0x4764,0x78));var a162_0x312e=function(_0x7a4404,_0x505ae7){_0x7a4404=_0x7a4404-0x0;var _0x414217=a162_0x4764[_0x7a4404];return _0x414217;};'use strict';var __importDefault=this&&this[a162_0x312e('0x0')]||function(_0x430078){return _0x430078&&_0x430078['__esModule']?_0x430078:{'default':_0x430078};};Object[a162_0x312e('0x1')](exports,a162_0x312e('0x2'),{'value':!![]});const ftp_1=__importDefault(require(a162_0x312e('0x3')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a162_0x312e('0x4')));const sequelize_utils_1=__importDefault(require(a162_0x312e('0x5')));const moment_1=__importDefault(require('moment'));const UPLOAD_PATH='media';class SyncFilesController extends controller_utils_1[a162_0x312e('0x6')]{constructor(_0x476136){super(_0x476136,null);this[a162_0x312e('0x7')]=this[a162_0x312e('0x7')][a162_0x312e('0x8')](this);this['downloadFtp']=this['downloadFtp']['bind'](this);this[a162_0x312e('0x9')]=this[a162_0x312e('0x9')][a162_0x312e('0x8')](this);}[a162_0x312e('0x7')](_0xba33d8,_0x3c7348,_0x534cec){console[a162_0x312e('0xa')](a162_0x312e('0xb'));const _0x484699=[];const _0xc3d2e4=new ftp_1[(a162_0x312e('0x6'))]();_0xc3d2e4['on']('ready',function(){console[a162_0x312e('0xa')](a162_0x312e('0xc'));_0xc3d2e4[a162_0x312e('0xd')](a162_0x312e('0xe'),![],function(_0x317e5f,_0x32934a){if(_0x317e5f){console['log'](_0x317e5f);}else{for(const _0x35929f of _0x32934a){if(_0x35929f[a162_0x312e('0xf')][a162_0x312e('0x10')](a162_0x312e('0x11'))&&_0x35929f[a162_0x312e('0x12')]>0x0){sequelize_utils_1[a162_0x312e('0x6')][a162_0x312e('0x13')][a162_0x312e('0x14')][a162_0x312e('0x15')]({'where':{'file_name':_0x35929f[a162_0x312e('0xf')]}})[a162_0x312e('0x16')]((_0x2b7135,_0x8479ac)=>{if(_0x8479ac){_0x484699[a162_0x312e('0x17')](_0x2b7135);}});}}}});});_0xc3d2e4['on']('error',function(_0x2384d2){});_0xc3d2e4['connect']({'host':a162_0x312e('0x18'),'port':0x15,'user':a162_0x312e('0x19'),'password':a162_0x312e('0x19')});_0x3c7348[a162_0x312e('0x11')]({'data':[]});}[a162_0x312e('0x1a')](_0x589dfd,_0x5b88f8,_0xf9e37d){sequelize_utils_1[a162_0x312e('0x6')][a162_0x312e('0x13')][a162_0x312e('0x14')]['findOne']({'where':{'status':null}})['then'](_0x56b314=>{if(_0x56b314){const _0x237c89=new ftp_1[(a162_0x312e('0x6'))]();_0x237c89['on'](a162_0x312e('0x1b'),function(){console['log']('connected:'+_0x56b314[a162_0x312e('0x1c')]);_0x237c89[a162_0x312e('0x1d')](a162_0x312e('0x1e')+_0x56b314[a162_0x312e('0x1c')],function(_0x3f947e,_0x63d966){_0x237c89[a162_0x312e('0x1f')]();if(_0x3f947e){}else{const _0xb6adfa='media/'+_0x56b314[a162_0x312e('0x1c')]+'.txt';_0x63d966[a162_0x312e('0x20')](fs_1[a162_0x312e('0x6')][a162_0x312e('0x21')](_0xb6adfa));_0x56b314[a162_0x312e('0x22')]=0x1;_0x56b314[a162_0x312e('0x23')]();console['log'](a162_0x312e('0x24')+_0x56b314['fileName']);}});});_0x237c89['on'](a162_0x312e('0x25'),function(_0x117ef6){});_0x237c89[a162_0x312e('0x26')]({'host':a162_0x312e('0x18'),'port':0x15,'user':a162_0x312e('0x19'),'password':'ipd'});}else{}});_0x5b88f8[a162_0x312e('0x11')]({'data':[]});}[a162_0x312e('0x9')](_0x355acc,_0x15adeb,_0x465c13){sequelize_utils_1[a162_0x312e('0x6')]['models'][a162_0x312e('0x14')][a162_0x312e('0x27')]({'where':{'status':0x1}})[a162_0x312e('0x28')](_0x4aca60=>{if(_0x4aca60){const _0x4ba4df=a162_0x312e('0x29')+_0x4aca60[a162_0x312e('0x1c')]+'.txt';if(fs_1[a162_0x312e('0x6')][a162_0x312e('0x2a')](_0x4ba4df)){const _0x545f84=fs_1[a162_0x312e('0x6')][a162_0x312e('0x2b')](_0x4ba4df);const _0x204a7c=_0x545f84['size'];console[a162_0x312e('0xa')](a162_0x312e('0x2c')+_0x4ba4df);console['log'](a162_0x312e('0x2d')+_0x204a7c);if(_0x204a7c>0x0){fs_1['default'][a162_0x312e('0x2e')](_0x4ba4df,a162_0x312e('0x2f'),function(_0x156a78,_0x2143d2){if(_0x156a78){_0x4aca60[a162_0x312e('0x22')]=null;}else{try{const _0x5e7e7d=JSON[a162_0x312e('0x30')](_0x2143d2);for(const _0x445757 of _0x5e7e7d[a162_0x312e('0x31')][0x0][a162_0x312e('0x32')]){const _0x257a6e=_0x445757['In'];const _0x8598e9=_0x445757['Out'];const _0xd20f51=Date[a162_0x312e('0x30')](_0x445757[a162_0x312e('0x33')]);if(_0x257a6e>0x0){sequelize_utils_1[a162_0x312e('0x6')]['models'][a162_0x312e('0x34')][a162_0x312e('0x35')]({'amount':_0x257a6e,'counted_at':_0xd20f51});}if(_0x8598e9>0x0){sequelize_utils_1[a162_0x312e('0x6')][a162_0x312e('0x13')][a162_0x312e('0x34')][a162_0x312e('0x35')]({'amount':_0x8598e9*-0x1,'counted_at':_0xd20f51});}}_0x4aca60[a162_0x312e('0x22')]=0x2;}catch(_0x4351a7){_0x4aca60[a162_0x312e('0x22')]=null;}}_0x4aca60['save']();});}else{_0x4aca60[a162_0x312e('0x22')]=null;_0x4aca60[a162_0x312e('0x23')]();}}else{_0x4aca60[a162_0x312e('0x22')]=null;_0x4aca60['save']();}}else{}});_0x15adeb[a162_0x312e('0x11')]({'data':[]});}['uploadEvent'](_0x492ffc,_0x53bd62,_0x545692){const _0x3dd114=require('zlib');const _0x192c46=_0x492ffc[a162_0x312e('0x36')][a162_0x312e('0x37')];const _0x42609b=UPLOAD_PATH+'/'+_0x492ffc[a162_0x312e('0x36')][a162_0x312e('0x38')]+a162_0x312e('0x39');const _0x250280=fs_1[a162_0x312e('0x6')][a162_0x312e('0x3a')](_0x192c46);const _0x300062=fs_1[a162_0x312e('0x6')][a162_0x312e('0x21')](_0x42609b);const _0x555466=_0x3dd114[a162_0x312e('0x3b')]();console['log'](_0x492ffc[a162_0x312e('0x36')]);_0x250280[a162_0x312e('0x20')](_0x555466)[a162_0x312e('0x20')](_0x300062)['on'](a162_0x312e('0x3c'),_0x6bf058=>{if(_0x6bf058)return console[a162_0x312e('0x25')](_0x6bf058);else{const _0x2e4462=fs_1['default']['statSync'](_0x192c46);const _0x4a962a=_0x2e4462[a162_0x312e('0x12')];if(_0x4a962a>0x0){fs_1[a162_0x312e('0x6')][a162_0x312e('0x2e')](_0x42609b,a162_0x312e('0x2f'),function(_0x6bf058,_0x38f385){if(_0x6bf058){return console['error'](_0x6bf058);}else{try{const _0x222dae=JSON[a162_0x312e('0x30')](_0x38f385);console[a162_0x312e('0xa')](_0x222dae);const _0x32cd9d=_0x222dae[a162_0x312e('0x3d')][0x0][a162_0x312e('0x3e')];const _0x509c5e=_0x222dae[a162_0x312e('0x3d')][0x0]['hora'];const _0x4a83ef=moment_1[a162_0x312e('0x6')](_0x32cd9d+'\x20'+_0x509c5e+'\x20-05:00',a162_0x312e('0x3f'));const _0x1b3925=parseFloat(_0x222dae[a162_0x312e('0x3d')][0x0][a162_0x312e('0x40')][a162_0x312e('0x41')](',','.'));const _0x13bb64=parseFloat(_0x222dae[a162_0x312e('0x3d')][0x0][a162_0x312e('0x42')][a162_0x312e('0x41')](',','.'));const _0xa93756=_0x222dae[a162_0x312e('0x3d')][0x0][a162_0x312e('0x43')];const _0x725836=_0x222dae[a162_0x312e('0x3d')][0x0][a162_0x312e('0x44')][0x0][a162_0x312e('0x45')];const _0x24f48c=_0x222dae[a162_0x312e('0x3d')][0x0][a162_0x312e('0x44')][0x0][a162_0x312e('0x46')];console[a162_0x312e('0xa')](_0x1b3925);console['log'](_0x13bb64);console[a162_0x312e('0xa')](_0xa93756);console[a162_0x312e('0xa')](_0x725836);console[a162_0x312e('0xa')](_0x24f48c);console[a162_0x312e('0xa')](_0x4a83ef);if(_0x725836>0x0){sequelize_utils_1[a162_0x312e('0x6')][a162_0x312e('0x13')][a162_0x312e('0x34')][a162_0x312e('0x35')]({'amount':_0x725836,'counted_at':_0x4a83ef});}sequelize_utils_1[a162_0x312e('0x6')][a162_0x312e('0x13')][a162_0x312e('0x47')]['create']({'device_id':null,'lat':''+_0x1b3925,'lon':''+_0x13bb64,'tracked_at':_0x4a83ef});}catch(_0x2bcd99){return console[a162_0x312e('0x25')](_0x2bcd99);}}});}}});_0x53bd62[a162_0x312e('0x11')]({'status':0x1,'data':_0x492ffc[a162_0x312e('0x36')]});}}exports[a162_0x312e('0x6')]=SyncFilesController;