var a162_0x626f=['spread','error','connect','ftp.vivotek.com','ipd','models','findOne','then','connected:','get','file_name','end','.txt','pipe','createWriteStream','status','save','fileName','media/','existsSync','statSync','size','fileSizeInBytes:\x20','readFile','utf8','parse','EndTime','create','passCountingsModel','uploadEvent','zlib','file','.json','createGunzip','finish','eventos','fecha','hora','\x20-05:00','YYYYMMDD\x20HHmmss\x20Z','latitud','replace','velocidad','puerta','locationPointsModel','__importDefault','defineProperty','__esModule','../../infrastructure/controller-utils','../../infrastructure/sequelize-utils','media','syncFtp','bind','downloadFtp','processFtp','log','connecting','ready','connected','list','colombia','name','endsWith','json','default','syncFilesModel','findOrCreate'];(function(_0x263c0e,_0x1dbe3f){var _0x38ffb5=function(_0x3adc69){while(--_0x3adc69){_0x263c0e['push'](_0x263c0e['shift']());}};_0x38ffb5(++_0x1dbe3f);}(a162_0x626f,0xb3));var a162_0xd3f5=function(_0x393514,_0x76bc5a){_0x393514=_0x393514-0x0;var _0x48284c=a162_0x626f[_0x393514];return _0x48284c;};'use strict';var __importDefault=this&&this[a162_0xd3f5('0x0')]||function(_0x51f243){return _0x51f243&&_0x51f243['__esModule']?_0x51f243:{'default':_0x51f243};};Object[a162_0xd3f5('0x1')](exports,a162_0xd3f5('0x2'),{'value':!![]});const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a162_0xd3f5('0x3')));const sequelize_utils_1=__importDefault(require(a162_0xd3f5('0x4')));const moment_1=__importDefault(require('moment'));const UPLOAD_PATH=a162_0xd3f5('0x5');class SyncFilesController extends controller_utils_1['default']{constructor(_0x50353a){super(_0x50353a,null);this['syncFtp']=this[a162_0xd3f5('0x6')][a162_0xd3f5('0x7')](this);this[a162_0xd3f5('0x8')]=this[a162_0xd3f5('0x8')][a162_0xd3f5('0x7')](this);this[a162_0xd3f5('0x9')]=this[a162_0xd3f5('0x9')][a162_0xd3f5('0x7')](this);}[a162_0xd3f5('0x6')](_0x28f159,_0x4a57fe,_0x33d5ae){console[a162_0xd3f5('0xa')](a162_0xd3f5('0xb'));const _0x3865d1=[];const _0x134cc4=new ftp_1['default']();_0x134cc4['on'](a162_0xd3f5('0xc'),function(){console[a162_0xd3f5('0xa')](a162_0xd3f5('0xd'));_0x134cc4[a162_0xd3f5('0xe')](a162_0xd3f5('0xf'),![],function(_0x3cbbeb,_0x39bbab){if(_0x3cbbeb){console[a162_0xd3f5('0xa')](_0x3cbbeb);}else{for(const _0x36ab5c of _0x39bbab){if(_0x36ab5c[a162_0xd3f5('0x10')][a162_0xd3f5('0x11')](a162_0xd3f5('0x12'))&&_0x36ab5c['size']>0x0){sequelize_utils_1[a162_0xd3f5('0x13')]['models'][a162_0xd3f5('0x14')][a162_0xd3f5('0x15')]({'where':{'file_name':_0x36ab5c[a162_0xd3f5('0x10')]}})[a162_0xd3f5('0x16')]((_0x5f1813,_0x112670)=>{if(_0x112670){_0x3865d1['push'](_0x5f1813);}});}}}});});_0x134cc4['on'](a162_0xd3f5('0x17'),function(_0x572012){});_0x134cc4[a162_0xd3f5('0x18')]({'host':a162_0xd3f5('0x19'),'port':0x15,'user':a162_0xd3f5('0x1a'),'password':'ipd'});_0x4a57fe[a162_0xd3f5('0x12')]({'data':[]});}[a162_0xd3f5('0x8')](_0x192313,_0x250aea,_0x7ee458){sequelize_utils_1[a162_0xd3f5('0x13')][a162_0xd3f5('0x1b')]['syncFilesModel'][a162_0xd3f5('0x1c')]({'where':{'status':null}})[a162_0xd3f5('0x1d')](_0x12c3f7=>{if(_0x12c3f7){const _0x1fa245=new ftp_1[(a162_0xd3f5('0x13'))]();_0x1fa245['on']('ready',function(){console[a162_0xd3f5('0xa')](a162_0xd3f5('0x1e')+_0x12c3f7['file_name']);_0x1fa245[a162_0xd3f5('0x1f')]('colombia/'+_0x12c3f7[a162_0xd3f5('0x20')],function(_0x19f08b,_0x46a2e6){_0x1fa245[a162_0xd3f5('0x21')]();if(_0x19f08b){}else{const _0x34e6a6='media/'+_0x12c3f7[a162_0xd3f5('0x20')]+a162_0xd3f5('0x22');_0x46a2e6[a162_0xd3f5('0x23')](fs_1[a162_0xd3f5('0x13')][a162_0xd3f5('0x24')](_0x34e6a6));_0x12c3f7[a162_0xd3f5('0x25')]=0x1;_0x12c3f7[a162_0xd3f5('0x26')]();console[a162_0xd3f5('0xa')]('Downloaded:\x20'+_0x12c3f7[a162_0xd3f5('0x27')]);}});});_0x1fa245['on'](a162_0xd3f5('0x17'),function(_0x1159d4){});_0x1fa245['connect']({'host':a162_0xd3f5('0x19'),'port':0x15,'user':a162_0xd3f5('0x1a'),'password':a162_0xd3f5('0x1a')});}else{}});_0x250aea[a162_0xd3f5('0x12')]({'data':[]});}[a162_0xd3f5('0x9')](_0x4d878e,_0x45b48b,_0x48a900){sequelize_utils_1['default'][a162_0xd3f5('0x1b')][a162_0xd3f5('0x14')][a162_0xd3f5('0x1c')]({'where':{'status':0x1}})[a162_0xd3f5('0x1d')](_0x28a8a5=>{if(_0x28a8a5){const _0x21b314=a162_0xd3f5('0x28')+_0x28a8a5[a162_0xd3f5('0x20')]+a162_0xd3f5('0x22');if(fs_1[a162_0xd3f5('0x13')][a162_0xd3f5('0x29')](_0x21b314)){const _0x5dea61=fs_1[a162_0xd3f5('0x13')][a162_0xd3f5('0x2a')](_0x21b314);const _0x1ef61b=_0x5dea61[a162_0xd3f5('0x2b')];console[a162_0xd3f5('0xa')]('fileName:\x20'+_0x21b314);console[a162_0xd3f5('0xa')](a162_0xd3f5('0x2c')+_0x1ef61b);if(_0x1ef61b>0x0){fs_1['default'][a162_0xd3f5('0x2d')](_0x21b314,a162_0xd3f5('0x2e'),function(_0x273dfa,_0x3c9c22){if(_0x273dfa){_0x28a8a5[a162_0xd3f5('0x25')]=null;}else{try{const _0x1cc018=JSON['parse'](_0x3c9c22);for(const _0x3bb020 of _0x1cc018['Data'][0x0]['CountingInfo']){const _0x57dfca=_0x3bb020['In'];const _0x31f218=_0x3bb020['Out'];const _0x8677f3=Date[a162_0xd3f5('0x2f')](_0x3bb020[a162_0xd3f5('0x30')]);if(_0x57dfca>0x0){sequelize_utils_1[a162_0xd3f5('0x13')][a162_0xd3f5('0x1b')]['passCountingsModel'][a162_0xd3f5('0x31')]({'amount':_0x57dfca,'counted_at':_0x8677f3});}if(_0x31f218>0x0){sequelize_utils_1[a162_0xd3f5('0x13')][a162_0xd3f5('0x1b')][a162_0xd3f5('0x32')][a162_0xd3f5('0x31')]({'amount':_0x31f218*-0x1,'counted_at':_0x8677f3});}}_0x28a8a5[a162_0xd3f5('0x25')]=0x2;}catch(_0xdc455d){_0x28a8a5[a162_0xd3f5('0x25')]=null;}}_0x28a8a5[a162_0xd3f5('0x26')]();});}else{_0x28a8a5[a162_0xd3f5('0x25')]=null;_0x28a8a5[a162_0xd3f5('0x26')]();}}else{_0x28a8a5[a162_0xd3f5('0x25')]=null;_0x28a8a5[a162_0xd3f5('0x26')]();}}else{}});_0x45b48b[a162_0xd3f5('0x12')]({'data':[]});}[a162_0xd3f5('0x33')](_0x3e568a,_0x58d14b,_0x20eb83){const _0x2899a3=require(a162_0xd3f5('0x34'));const _0x2ac390=_0x3e568a[a162_0xd3f5('0x35')]['path'];const _0x5e6d07=UPLOAD_PATH+'/'+_0x3e568a[a162_0xd3f5('0x35')]['filename']+a162_0xd3f5('0x36');const _0x278c1a=fs_1[a162_0xd3f5('0x13')]['createReadStream'](_0x2ac390);const _0x182099=fs_1['default']['createWriteStream'](_0x5e6d07);const _0x26241e=_0x2899a3[a162_0xd3f5('0x37')]();console[a162_0xd3f5('0xa')](_0x3e568a['file']);_0x278c1a['pipe'](_0x26241e)[a162_0xd3f5('0x23')](_0x182099)['on'](a162_0xd3f5('0x38'),_0x5249c3=>{if(_0x5249c3)return console['error'](_0x5249c3);else{const _0x352f12=fs_1['default'][a162_0xd3f5('0x2a')](_0x2ac390);const _0x184ad5=_0x352f12['size'];if(_0x184ad5>0x0){fs_1[a162_0xd3f5('0x13')][a162_0xd3f5('0x2d')](_0x5e6d07,a162_0xd3f5('0x2e'),function(_0x5249c3,_0x5515e6){if(_0x5249c3){return console['error'](_0x5249c3);}else{try{const _0x182f59=JSON[a162_0xd3f5('0x2f')](_0x5515e6);console[a162_0xd3f5('0xa')](_0x182f59);const _0x3d466f=_0x182f59[a162_0xd3f5('0x39')][0x0][a162_0xd3f5('0x3a')];const _0x39c7ce=_0x182f59[a162_0xd3f5('0x39')][0x0][a162_0xd3f5('0x3b')];const _0x78c48d=moment_1['default'](_0x3d466f+'\x20'+_0x39c7ce+a162_0xd3f5('0x3c'),a162_0xd3f5('0x3d'));const _0x4d3ed1=parseFloat(_0x182f59[a162_0xd3f5('0x39')][0x0][a162_0xd3f5('0x3e')][a162_0xd3f5('0x3f')](',','.'));const _0x2c7961=parseFloat(_0x182f59[a162_0xd3f5('0x39')][0x0]['longitud']['replace'](',','.'));const _0x51f8a8=_0x182f59[a162_0xd3f5('0x39')][0x0][a162_0xd3f5('0x40')];const _0x2ad534=_0x182f59[a162_0xd3f5('0x39')][0x0][a162_0xd3f5('0x41')][0x0]['ingresos'];const _0x3bb003=_0x182f59['eventos'][0x0]['puerta'][0x0]['salidas'];console[a162_0xd3f5('0xa')](_0x4d3ed1);console[a162_0xd3f5('0xa')](_0x2c7961);console[a162_0xd3f5('0xa')](_0x51f8a8);console['log'](_0x2ad534);console[a162_0xd3f5('0xa')](_0x3bb003);console[a162_0xd3f5('0xa')](_0x78c48d);if(_0x2ad534>0x0){sequelize_utils_1['default'][a162_0xd3f5('0x1b')][a162_0xd3f5('0x32')][a162_0xd3f5('0x31')]({'amount':_0x2ad534,'counted_at':_0x78c48d});}sequelize_utils_1[a162_0xd3f5('0x13')][a162_0xd3f5('0x1b')][a162_0xd3f5('0x42')][a162_0xd3f5('0x31')]({'device_id':null,'lat':''+_0x4d3ed1,'lon':''+_0x2c7961,'tracked_at':_0x78c48d});}catch(_0x330d53){return console[a162_0xd3f5('0x17')](_0x330d53);}}});}}});_0x58d14b[a162_0xd3f5('0x12')]({'status':0x1,'data':_0x3e568a[a162_0xd3f5('0x35')]});}}exports['default']=SyncFilesController;