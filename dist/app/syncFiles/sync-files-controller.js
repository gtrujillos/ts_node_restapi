var a73_0x149f=['connected','list','colombia','name','endsWith','json','size','models','syncFilesModel','findOrCreate','spread','push','error','connect','ftp.vivotek.com','ipd','findOne','then','connected:','file_name','get','colombia/','end','media/','.txt','status','save','Downloaded:\x20','fileName','statSync','fileName:\x20','fileSizeInBytes:\x20','readFile','utf8','parse','Data','Out','passCountingsModel','create','uploadEvent','zlib','file','path','.json','createReadStream','createWriteStream','createGunzip','finish','fecha','eventos','hora','latitud','replace','longitud','velocidad','puerta','ingresos','salidas','locationPointsModel','__esModule','defineProperty','ftp','../../infrastructure/controller-utils','moment','media','syncFtp','bind','downloadFtp','processFtp','log','connecting','default','ready'];(function(_0x27c473,_0x153822){var _0x574c1e=function(_0x50c8db){while(--_0x50c8db){_0x27c473['push'](_0x27c473['shift']());}};_0x574c1e(++_0x153822);}(a73_0x149f,0x84));var a73_0x25ed=function(_0x103dc6,_0x50076c){_0x103dc6=_0x103dc6-0x0;var _0x2251f0=a73_0x149f[_0x103dc6];return _0x2251f0;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x15012b){return _0x15012b&&_0x15012b[a73_0x25ed('0x0')]?_0x15012b:{'default':_0x15012b};};Object[a73_0x25ed('0x1')](exports,a73_0x25ed('0x0'),{'value':!![]});const ftp_1=__importDefault(require(a73_0x25ed('0x2')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a73_0x25ed('0x3')));const sequelize_utils_1=__importDefault(require('../../infrastructure/sequelize-utils'));const moment_1=__importDefault(require(a73_0x25ed('0x4')));const UPLOAD_PATH=a73_0x25ed('0x5');class SyncFilesController extends controller_utils_1['default']{constructor(_0x1f4d3a){super(_0x1f4d3a,null);this[a73_0x25ed('0x6')]=this[a73_0x25ed('0x6')][a73_0x25ed('0x7')](this);this[a73_0x25ed('0x8')]=this[a73_0x25ed('0x8')][a73_0x25ed('0x7')](this);this[a73_0x25ed('0x9')]=this[a73_0x25ed('0x9')][a73_0x25ed('0x7')](this);}['syncFtp'](_0x497e4b,_0x45c8be,_0x953e2c){console[a73_0x25ed('0xa')](a73_0x25ed('0xb'));const _0x2cff07=[];const _0x3223ea=new ftp_1[(a73_0x25ed('0xc'))]();_0x3223ea['on'](a73_0x25ed('0xd'),function(){console[a73_0x25ed('0xa')](a73_0x25ed('0xe'));_0x3223ea[a73_0x25ed('0xf')](a73_0x25ed('0x10'),![],function(_0x423422,_0x3c7705){if(_0x423422){console['log'](_0x423422);}else{for(const _0x33e557 of _0x3c7705){if(_0x33e557[a73_0x25ed('0x11')][a73_0x25ed('0x12')](a73_0x25ed('0x13'))&&_0x33e557[a73_0x25ed('0x14')]>0x0){sequelize_utils_1[a73_0x25ed('0xc')][a73_0x25ed('0x15')][a73_0x25ed('0x16')][a73_0x25ed('0x17')]({'where':{'file_name':_0x33e557['name']}})[a73_0x25ed('0x18')]((_0x47b868,_0x244abc)=>{if(_0x244abc){_0x2cff07[a73_0x25ed('0x19')](_0x47b868);}});}}}});});_0x3223ea['on'](a73_0x25ed('0x1a'),function(_0x1beda5){});_0x3223ea[a73_0x25ed('0x1b')]({'host':a73_0x25ed('0x1c'),'port':0x15,'user':a73_0x25ed('0x1d'),'password':'ipd'});_0x45c8be[a73_0x25ed('0x13')]({'data':[]});}[a73_0x25ed('0x8')](_0x456371,_0x40c74c,_0x2b6521){sequelize_utils_1[a73_0x25ed('0xc')][a73_0x25ed('0x15')][a73_0x25ed('0x16')][a73_0x25ed('0x1e')]({'where':{'status':null}})[a73_0x25ed('0x1f')](_0xb47e00=>{if(_0xb47e00){const _0x515812=new ftp_1[(a73_0x25ed('0xc'))]();_0x515812['on'](a73_0x25ed('0xd'),function(){console['log'](a73_0x25ed('0x20')+_0xb47e00[a73_0x25ed('0x21')]);_0x515812[a73_0x25ed('0x22')](a73_0x25ed('0x23')+_0xb47e00[a73_0x25ed('0x21')],function(_0x5a3a42,_0x499494){_0x515812[a73_0x25ed('0x24')]();if(_0x5a3a42){}else{const _0x30f9ea=a73_0x25ed('0x25')+_0xb47e00['file_name']+a73_0x25ed('0x26');_0x499494['pipe'](fs_1[a73_0x25ed('0xc')]['createWriteStream'](_0x30f9ea));_0xb47e00[a73_0x25ed('0x27')]=0x1;_0xb47e00[a73_0x25ed('0x28')]();console[a73_0x25ed('0xa')](a73_0x25ed('0x29')+_0xb47e00[a73_0x25ed('0x2a')]);}});});_0x515812['on']('error',function(_0x28c9f9){});_0x515812[a73_0x25ed('0x1b')]({'host':a73_0x25ed('0x1c'),'port':0x15,'user':a73_0x25ed('0x1d'),'password':a73_0x25ed('0x1d')});}else{}});_0x40c74c[a73_0x25ed('0x13')]({'data':[]});}[a73_0x25ed('0x9')](_0x198826,_0x2376ae,_0xfe015a){sequelize_utils_1['default'][a73_0x25ed('0x15')][a73_0x25ed('0x16')]['findOne']({'where':{'status':0x1}})[a73_0x25ed('0x1f')](_0x412772=>{if(_0x412772){const _0x241bdc=a73_0x25ed('0x25')+_0x412772[a73_0x25ed('0x21')]+a73_0x25ed('0x26');if(fs_1[a73_0x25ed('0xc')]['existsSync'](_0x241bdc)){const _0x1f846e=fs_1['default'][a73_0x25ed('0x2b')](_0x241bdc);const _0x425bdd=_0x1f846e['size'];console[a73_0x25ed('0xa')](a73_0x25ed('0x2c')+_0x241bdc);console[a73_0x25ed('0xa')](a73_0x25ed('0x2d')+_0x425bdd);if(_0x425bdd>0x0){fs_1['default'][a73_0x25ed('0x2e')](_0x241bdc,a73_0x25ed('0x2f'),function(_0xb83323,_0x5ba2fd){if(_0xb83323){_0x412772['status']=null;}else{try{const _0x385f29=JSON[a73_0x25ed('0x30')](_0x5ba2fd);for(const _0x23f983 of _0x385f29[a73_0x25ed('0x31')][0x0]['CountingInfo']){const _0x2a7d9d=_0x23f983['In'];const _0x1f4c39=_0x23f983[a73_0x25ed('0x32')];const _0x30edd2=Date['parse'](_0x23f983['EndTime']);if(_0x2a7d9d>0x0){sequelize_utils_1[a73_0x25ed('0xc')]['models'][a73_0x25ed('0x33')][a73_0x25ed('0x34')]({'amount':_0x2a7d9d,'counted_at':_0x30edd2});}if(_0x1f4c39>0x0){sequelize_utils_1['default'][a73_0x25ed('0x15')][a73_0x25ed('0x33')][a73_0x25ed('0x34')]({'amount':_0x1f4c39*-0x1,'counted_at':_0x30edd2});}}_0x412772[a73_0x25ed('0x27')]=0x2;}catch(_0xfc7ed7){_0x412772[a73_0x25ed('0x27')]=null;}}_0x412772[a73_0x25ed('0x28')]();});}else{_0x412772[a73_0x25ed('0x27')]=null;_0x412772['save']();}}else{_0x412772[a73_0x25ed('0x27')]=null;_0x412772[a73_0x25ed('0x28')]();}}else{}});_0x2376ae['json']({'data':[]});}[a73_0x25ed('0x35')](_0x154397,_0x3db4b4,_0x1ccfad){const _0x415171=require(a73_0x25ed('0x36'));const _0x365c1d=_0x154397[a73_0x25ed('0x37')][a73_0x25ed('0x38')];const _0x5d52e6=UPLOAD_PATH+'/'+_0x154397[a73_0x25ed('0x37')]['filename']+a73_0x25ed('0x39');const _0x5a58e9=fs_1[a73_0x25ed('0xc')][a73_0x25ed('0x3a')](_0x365c1d);const _0x181b66=fs_1['default'][a73_0x25ed('0x3b')](_0x5d52e6);const _0x5bd844=_0x415171[a73_0x25ed('0x3c')]();console['log'](_0x154397['file']);_0x5a58e9['pipe'](_0x5bd844)['pipe'](_0x181b66)['on'](a73_0x25ed('0x3d'),_0x9d9419=>{if(_0x9d9419)return console[a73_0x25ed('0x1a')](_0x9d9419);else{const _0x57ac5f=fs_1['default'][a73_0x25ed('0x2b')](_0x365c1d);const _0x3386fc=_0x57ac5f[a73_0x25ed('0x14')];if(_0x3386fc>0x0){fs_1['default'][a73_0x25ed('0x2e')](_0x5d52e6,a73_0x25ed('0x2f'),function(_0x9d9419,_0x4ad212){if(_0x9d9419){return console[a73_0x25ed('0x1a')](_0x9d9419);}else{try{const _0x13e919=JSON[a73_0x25ed('0x30')](_0x4ad212);console[a73_0x25ed('0xa')](_0x13e919);const _0x11c814=_0x13e919['eventos'][0x0][a73_0x25ed('0x3e')];const _0xf52314=_0x13e919[a73_0x25ed('0x3f')][0x0][a73_0x25ed('0x40')];const _0x4031c0=moment_1[a73_0x25ed('0xc')](_0x11c814+'\x20'+_0xf52314+'\x20-05:00','YYYYMMDD\x20HHmmss\x20Z');const _0x120357=parseFloat(_0x13e919[a73_0x25ed('0x3f')][0x0][a73_0x25ed('0x41')][a73_0x25ed('0x42')](',','.'));const _0x2df95e=parseFloat(_0x13e919[a73_0x25ed('0x3f')][0x0][a73_0x25ed('0x43')][a73_0x25ed('0x42')](',','.'));const _0x3a1361=_0x13e919[a73_0x25ed('0x3f')][0x0][a73_0x25ed('0x44')];const _0x3a7a05=_0x13e919[a73_0x25ed('0x3f')][0x0][a73_0x25ed('0x45')][0x0][a73_0x25ed('0x46')];const _0x225b3a=_0x13e919[a73_0x25ed('0x3f')][0x0][a73_0x25ed('0x45')][0x0][a73_0x25ed('0x47')];console[a73_0x25ed('0xa')](_0x120357);console['log'](_0x2df95e);console[a73_0x25ed('0xa')](_0x3a1361);console[a73_0x25ed('0xa')](_0x3a7a05);console[a73_0x25ed('0xa')](_0x225b3a);console[a73_0x25ed('0xa')](_0x4031c0);if(_0x3a7a05>0x0){sequelize_utils_1['default']['models'][a73_0x25ed('0x33')][a73_0x25ed('0x34')]({'amount':_0x3a7a05,'counted_at':_0x4031c0});}sequelize_utils_1['default'][a73_0x25ed('0x15')][a73_0x25ed('0x48')][a73_0x25ed('0x34')]({'device_id':null,'lat':''+_0x120357,'lon':''+_0x2df95e,'tracked_at':_0x4031c0});}catch(_0x3a368f){return console[a73_0x25ed('0x1a')](_0x3a368f);}}});}}});_0x3db4b4['json']({'status':0x1,'data':_0x154397['file']});}}exports[a73_0x25ed('0xc')]=SyncFilesController;