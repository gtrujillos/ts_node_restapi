var a73_0xa5ec=['downloadFtp','processFtp','log','ready','connected','list','endsWith','json','size','models','syncFilesModel','findOrCreate','name','error','ipd','connected:','file_name','get','colombia/','end','pipe','createWriteStream','status','save','Downloaded:\x20','connect','ftp.vivotek.com','findOne','then','media/','existsSync','statSync','fileName:\x20','fileSizeInBytes:\x20','readFile','parse','CountingInfo','Out','EndTime','passCountingsModel','create','uploadEvent','zlib','file','path','filename','.json','createReadStream','createGunzip','finish','utf8','eventos','fecha','hora','\x20-05:00','YYYYMMDD\x20HHmmss\x20Z','replace','longitud','velocidad','puerta','salidas','__importDefault','__esModule','defineProperty','../../infrastructure/controller-utils','media','default','syncFtp','bind'];(function(_0x2d8f05,_0x4b81bb){var _0x4d74cb=function(_0x32719f){while(--_0x32719f){_0x2d8f05['push'](_0x2d8f05['shift']());}};_0x4d74cb(++_0x4b81bb);}(a73_0xa5ec,0x82));var a73_0x39ae=function(_0x29266e,_0x52d912){_0x29266e=_0x29266e-0x0;var _0x21fafc=a73_0xa5ec[_0x29266e];return _0x21fafc;};'use strict';var __importDefault=this&&this[a73_0x39ae('0x0')]||function(_0x108e58){return _0x108e58&&_0x108e58[a73_0x39ae('0x1')]?_0x108e58:{'default':_0x108e58};};Object[a73_0x39ae('0x2')](exports,'__esModule',{'value':!![]});const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a73_0x39ae('0x3')));const sequelize_utils_1=__importDefault(require('../../infrastructure/sequelize-utils'));const moment_1=__importDefault(require('moment'));const UPLOAD_PATH=a73_0x39ae('0x4');class SyncFilesController extends controller_utils_1[a73_0x39ae('0x5')]{constructor(_0x50482c){super(_0x50482c,null);this['syncFtp']=this[a73_0x39ae('0x6')][a73_0x39ae('0x7')](this);this[a73_0x39ae('0x8')]=this[a73_0x39ae('0x8')]['bind'](this);this[a73_0x39ae('0x9')]=this[a73_0x39ae('0x9')][a73_0x39ae('0x7')](this);}[a73_0x39ae('0x6')](_0x1a4d72,_0x486db3,_0x2cee54){console[a73_0x39ae('0xa')]('connecting');const _0x209863=[];const _0x39e00d=new ftp_1[(a73_0x39ae('0x5'))]();_0x39e00d['on'](a73_0x39ae('0xb'),function(){console[a73_0x39ae('0xa')](a73_0x39ae('0xc'));_0x39e00d[a73_0x39ae('0xd')]('colombia',![],function(_0x12f4d1,_0x26ea85){if(_0x12f4d1){console[a73_0x39ae('0xa')](_0x12f4d1);}else{for(const _0x47867f of _0x26ea85){if(_0x47867f['name'][a73_0x39ae('0xe')](a73_0x39ae('0xf'))&&_0x47867f[a73_0x39ae('0x10')]>0x0){sequelize_utils_1['default'][a73_0x39ae('0x11')][a73_0x39ae('0x12')][a73_0x39ae('0x13')]({'where':{'file_name':_0x47867f[a73_0x39ae('0x14')]}})['spread']((_0x2b4f9e,_0x16f7d9)=>{if(_0x16f7d9){_0x209863['push'](_0x2b4f9e);}});}}}});});_0x39e00d['on'](a73_0x39ae('0x15'),function(_0xf25f37){});_0x39e00d['connect']({'host':'ftp.vivotek.com','port':0x15,'user':a73_0x39ae('0x16'),'password':'ipd'});_0x486db3[a73_0x39ae('0xf')]({'data':[]});}[a73_0x39ae('0x8')](_0x27b253,_0x114b9f,_0x134230){sequelize_utils_1[a73_0x39ae('0x5')]['models'][a73_0x39ae('0x12')]['findOne']({'where':{'status':null}})['then'](_0x2a3161=>{if(_0x2a3161){const _0x47c7ae=new ftp_1[(a73_0x39ae('0x5'))]();_0x47c7ae['on']('ready',function(){console['log'](a73_0x39ae('0x17')+_0x2a3161[a73_0x39ae('0x18')]);_0x47c7ae[a73_0x39ae('0x19')](a73_0x39ae('0x1a')+_0x2a3161['file_name'],function(_0x4a3903,_0x5ac070){_0x47c7ae[a73_0x39ae('0x1b')]();if(_0x4a3903){}else{const _0x35ec22='media/'+_0x2a3161[a73_0x39ae('0x18')]+'.txt';_0x5ac070[a73_0x39ae('0x1c')](fs_1[a73_0x39ae('0x5')][a73_0x39ae('0x1d')](_0x35ec22));_0x2a3161[a73_0x39ae('0x1e')]=0x1;_0x2a3161[a73_0x39ae('0x1f')]();console['log'](a73_0x39ae('0x20')+_0x2a3161['fileName']);}});});_0x47c7ae['on']('error',function(_0x44ac20){});_0x47c7ae[a73_0x39ae('0x21')]({'host':a73_0x39ae('0x22'),'port':0x15,'user':a73_0x39ae('0x16'),'password':a73_0x39ae('0x16')});}else{}});_0x114b9f[a73_0x39ae('0xf')]({'data':[]});}['processFtp'](_0x3391de,_0x32300d,_0x5ec7c9){sequelize_utils_1[a73_0x39ae('0x5')]['models'][a73_0x39ae('0x12')][a73_0x39ae('0x23')]({'where':{'status':0x1}})[a73_0x39ae('0x24')](_0x2168a4=>{if(_0x2168a4){const _0x44170b=a73_0x39ae('0x25')+_0x2168a4[a73_0x39ae('0x18')]+'.txt';if(fs_1[a73_0x39ae('0x5')][a73_0x39ae('0x26')](_0x44170b)){const _0x1064d2=fs_1[a73_0x39ae('0x5')][a73_0x39ae('0x27')](_0x44170b);const _0x4bd012=_0x1064d2[a73_0x39ae('0x10')];console[a73_0x39ae('0xa')](a73_0x39ae('0x28')+_0x44170b);console[a73_0x39ae('0xa')](a73_0x39ae('0x29')+_0x4bd012);if(_0x4bd012>0x0){fs_1[a73_0x39ae('0x5')][a73_0x39ae('0x2a')](_0x44170b,'utf8',function(_0x285de0,_0x258420){if(_0x285de0){_0x2168a4['status']=null;}else{try{const _0x1a1aeb=JSON[a73_0x39ae('0x2b')](_0x258420);for(const _0x326483 of _0x1a1aeb['Data'][0x0][a73_0x39ae('0x2c')]){const _0x520bcc=_0x326483['In'];const _0x202109=_0x326483[a73_0x39ae('0x2d')];const _0x574301=Date[a73_0x39ae('0x2b')](_0x326483[a73_0x39ae('0x2e')]);if(_0x520bcc>0x0){sequelize_utils_1[a73_0x39ae('0x5')][a73_0x39ae('0x11')][a73_0x39ae('0x2f')][a73_0x39ae('0x30')]({'amount':_0x520bcc,'counted_at':_0x574301});}if(_0x202109>0x0){sequelize_utils_1[a73_0x39ae('0x5')][a73_0x39ae('0x11')]['passCountingsModel'][a73_0x39ae('0x30')]({'amount':_0x202109*-0x1,'counted_at':_0x574301});}}_0x2168a4['status']=0x2;}catch(_0x2065e2){_0x2168a4[a73_0x39ae('0x1e')]=null;}}_0x2168a4[a73_0x39ae('0x1f')]();});}else{_0x2168a4[a73_0x39ae('0x1e')]=null;_0x2168a4[a73_0x39ae('0x1f')]();}}else{_0x2168a4[a73_0x39ae('0x1e')]=null;_0x2168a4[a73_0x39ae('0x1f')]();}}else{}});_0x32300d[a73_0x39ae('0xf')]({'data':[]});}[a73_0x39ae('0x31')](_0x721049,_0x52acfb,_0x39487b){const _0x333426=require(a73_0x39ae('0x32'));const _0x472ecc=_0x721049[a73_0x39ae('0x33')][a73_0x39ae('0x34')];const _0x4d2f9f=UPLOAD_PATH+'/'+_0x721049[a73_0x39ae('0x33')][a73_0x39ae('0x35')]+a73_0x39ae('0x36');const _0x243bea=fs_1[a73_0x39ae('0x5')][a73_0x39ae('0x37')](_0x472ecc);const _0x85bcb4=fs_1[a73_0x39ae('0x5')][a73_0x39ae('0x1d')](_0x4d2f9f);const _0x111a67=_0x333426[a73_0x39ae('0x38')]();console['log'](_0x721049[a73_0x39ae('0x33')]);_0x243bea['pipe'](_0x111a67)[a73_0x39ae('0x1c')](_0x85bcb4)['on'](a73_0x39ae('0x39'),_0x47f68a=>{if(_0x47f68a)return console[a73_0x39ae('0x15')](_0x47f68a);else{const _0x169121=fs_1[a73_0x39ae('0x5')][a73_0x39ae('0x27')](_0x472ecc);const _0x92ff19=_0x169121[a73_0x39ae('0x10')];if(_0x92ff19>0x0){fs_1[a73_0x39ae('0x5')]['readFile'](_0x4d2f9f,a73_0x39ae('0x3a'),function(_0x47f68a,_0x575b8e){if(_0x47f68a){return console[a73_0x39ae('0x15')](_0x47f68a);}else{try{const _0x460930=JSON['parse'](_0x575b8e);console['log'](_0x460930);const _0x5075b5=_0x460930[a73_0x39ae('0x3b')][0x0][a73_0x39ae('0x3c')];const _0x5013dc=_0x460930[a73_0x39ae('0x3b')][0x0][a73_0x39ae('0x3d')];const _0x568f82=moment_1[a73_0x39ae('0x5')](_0x5075b5+'\x20'+_0x5013dc+a73_0x39ae('0x3e'),a73_0x39ae('0x3f'));const _0x300be6=parseFloat(_0x460930[a73_0x39ae('0x3b')][0x0]['latitud'][a73_0x39ae('0x40')](',','.'));const _0x432bde=parseFloat(_0x460930[a73_0x39ae('0x3b')][0x0][a73_0x39ae('0x41')][a73_0x39ae('0x40')](',','.'));const _0x5d4bbe=_0x460930[a73_0x39ae('0x3b')][0x0][a73_0x39ae('0x42')];const _0x228dac=_0x460930[a73_0x39ae('0x3b')][0x0][a73_0x39ae('0x43')][0x0]['ingresos'];const _0x36d024=_0x460930[a73_0x39ae('0x3b')][0x0]['puerta'][0x0][a73_0x39ae('0x44')];console[a73_0x39ae('0xa')](_0x300be6);console[a73_0x39ae('0xa')](_0x432bde);console['log'](_0x5d4bbe);console[a73_0x39ae('0xa')](_0x228dac);console[a73_0x39ae('0xa')](_0x36d024);console[a73_0x39ae('0xa')](_0x568f82);if(_0x228dac>0x0){sequelize_utils_1['default'][a73_0x39ae('0x11')][a73_0x39ae('0x2f')][a73_0x39ae('0x30')]({'amount':_0x228dac,'counted_at':_0x568f82});}sequelize_utils_1[a73_0x39ae('0x5')]['models']['locationPointsModel']['create']({'device_id':null,'lat':''+_0x300be6,'lon':''+_0x432bde,'tracked_at':_0x568f82});}catch(_0x598548){return console[a73_0x39ae('0x15')](_0x598548);}}});}}});_0x52acfb[a73_0x39ae('0xf')]({'status':0x1,'data':_0x721049[a73_0x39ae('0x33')]});}}exports['default']=SyncFilesController;