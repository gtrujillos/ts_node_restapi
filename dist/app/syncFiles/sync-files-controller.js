var a73_0x4194=['CountingInfo','Out','EndTime','passCountingsModel','create','uploadEvent','zlib','path','file','filename','createReadStream','finish','utf8','fecha','eventos','hora','\x20-05:00','YYYYMMDD\x20HHmmss\x20Z','replace','puerta','locationPointsModel','__importDefault','defineProperty','__esModule','ftp','../../infrastructure/sequelize-utils','moment','media','default','syncFtp','bind','downloadFtp','processFtp','log','ready','connected','list','name','endsWith','json','syncFilesModel','findOrCreate','spread','push','connect','ftp.vivotek.com','ipd','findOne','then','connected:','file_name','get','colombia/','end','media/','.txt','pipe','createWriteStream','status','save','Downloaded:\x20','error','models','existsSync','statSync','size','fileName:\x20','fileSizeInBytes:\x20','readFile','parse'];(function(_0x31d9c0,_0x1b2820){var _0x63b512=function(_0x37139e){while(--_0x37139e){_0x31d9c0['push'](_0x31d9c0['shift']());}};_0x63b512(++_0x1b2820);}(a73_0x4194,0x12d));var a73_0x5003=function(_0x364726,_0x26b445){_0x364726=_0x364726-0x0;var _0x34249c=a73_0x4194[_0x364726];return _0x34249c;};'use strict';var __importDefault=this&&this[a73_0x5003('0x0')]||function(_0x1a7a6c){return _0x1a7a6c&&_0x1a7a6c['__esModule']?_0x1a7a6c:{'default':_0x1a7a6c};};Object[a73_0x5003('0x1')](exports,a73_0x5003('0x2'),{'value':!![]});const ftp_1=__importDefault(require(a73_0x5003('0x3')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require('../../infrastructure/controller-utils'));const sequelize_utils_1=__importDefault(require(a73_0x5003('0x4')));const moment_1=__importDefault(require(a73_0x5003('0x5')));const UPLOAD_PATH=a73_0x5003('0x6');class SyncFilesController extends controller_utils_1[a73_0x5003('0x7')]{constructor(_0x1e2786){super(_0x1e2786,null);this[a73_0x5003('0x8')]=this[a73_0x5003('0x8')][a73_0x5003('0x9')](this);this[a73_0x5003('0xa')]=this['downloadFtp'][a73_0x5003('0x9')](this);this[a73_0x5003('0xb')]=this[a73_0x5003('0xb')][a73_0x5003('0x9')](this);}['syncFtp'](_0x59b9ad,_0x5d8776,_0x59b119){console[a73_0x5003('0xc')]('connecting');const _0x5409e1=[];const _0x223e5b=new ftp_1['default']();_0x223e5b['on'](a73_0x5003('0xd'),function(){console[a73_0x5003('0xc')](a73_0x5003('0xe'));_0x223e5b[a73_0x5003('0xf')]('colombia',![],function(_0xa8bc55,_0x1d1b5d){if(_0xa8bc55){console[a73_0x5003('0xc')](_0xa8bc55);}else{for(const _0x39e891 of _0x1d1b5d){if(_0x39e891[a73_0x5003('0x10')][a73_0x5003('0x11')](a73_0x5003('0x12'))&&_0x39e891['size']>0x0){sequelize_utils_1['default']['models'][a73_0x5003('0x13')][a73_0x5003('0x14')]({'where':{'file_name':_0x39e891['name']}})[a73_0x5003('0x15')]((_0x18ca05,_0xe84ff4)=>{if(_0xe84ff4){_0x5409e1[a73_0x5003('0x16')](_0x18ca05);}});}}}});});_0x223e5b['on']('error',function(_0x3bd5b8){});_0x223e5b[a73_0x5003('0x17')]({'host':a73_0x5003('0x18'),'port':0x15,'user':'ipd','password':a73_0x5003('0x19')});_0x5d8776[a73_0x5003('0x12')]({'data':[]});}[a73_0x5003('0xa')](_0x1b7a0f,_0x3f3a53,_0x1bbd22){sequelize_utils_1[a73_0x5003('0x7')]['models'][a73_0x5003('0x13')][a73_0x5003('0x1a')]({'where':{'status':null}})[a73_0x5003('0x1b')](_0x3a8ce6=>{if(_0x3a8ce6){const _0x58aeb7=new ftp_1['default']();_0x58aeb7['on'](a73_0x5003('0xd'),function(){console[a73_0x5003('0xc')](a73_0x5003('0x1c')+_0x3a8ce6[a73_0x5003('0x1d')]);_0x58aeb7[a73_0x5003('0x1e')](a73_0x5003('0x1f')+_0x3a8ce6[a73_0x5003('0x1d')],function(_0x17ff7c,_0x316b48){_0x58aeb7[a73_0x5003('0x20')]();if(_0x17ff7c){}else{const _0x23574c=a73_0x5003('0x21')+_0x3a8ce6[a73_0x5003('0x1d')]+a73_0x5003('0x22');_0x316b48[a73_0x5003('0x23')](fs_1['default'][a73_0x5003('0x24')](_0x23574c));_0x3a8ce6[a73_0x5003('0x25')]=0x1;_0x3a8ce6[a73_0x5003('0x26')]();console[a73_0x5003('0xc')](a73_0x5003('0x27')+_0x3a8ce6['fileName']);}});});_0x58aeb7['on'](a73_0x5003('0x28'),function(_0xfe282e){});_0x58aeb7['connect']({'host':a73_0x5003('0x18'),'port':0x15,'user':a73_0x5003('0x19'),'password':'ipd'});}else{}});_0x3f3a53[a73_0x5003('0x12')]({'data':[]});}[a73_0x5003('0xb')](_0x82a3a5,_0x502585,_0x43f310){sequelize_utils_1['default'][a73_0x5003('0x29')][a73_0x5003('0x13')]['findOne']({'where':{'status':0x1}})[a73_0x5003('0x1b')](_0x44909f=>{if(_0x44909f){const _0x36984a=a73_0x5003('0x21')+_0x44909f[a73_0x5003('0x1d')]+a73_0x5003('0x22');if(fs_1[a73_0x5003('0x7')][a73_0x5003('0x2a')](_0x36984a)){const _0x4bff78=fs_1[a73_0x5003('0x7')][a73_0x5003('0x2b')](_0x36984a);const _0xbfd267=_0x4bff78[a73_0x5003('0x2c')];console[a73_0x5003('0xc')](a73_0x5003('0x2d')+_0x36984a);console[a73_0x5003('0xc')](a73_0x5003('0x2e')+_0xbfd267);if(_0xbfd267>0x0){fs_1[a73_0x5003('0x7')][a73_0x5003('0x2f')](_0x36984a,'utf8',function(_0x35b9eb,_0x19b13a){if(_0x35b9eb){_0x44909f[a73_0x5003('0x25')]=null;}else{try{const _0xd74a20=JSON[a73_0x5003('0x30')](_0x19b13a);for(const _0x5e0ab0 of _0xd74a20['Data'][0x0][a73_0x5003('0x31')]){const _0x4277e2=_0x5e0ab0['In'];const _0x1a3e19=_0x5e0ab0[a73_0x5003('0x32')];const _0x263468=Date[a73_0x5003('0x30')](_0x5e0ab0[a73_0x5003('0x33')]);if(_0x4277e2>0x0){sequelize_utils_1[a73_0x5003('0x7')]['models'][a73_0x5003('0x34')][a73_0x5003('0x35')]({'amount':_0x4277e2,'counted_at':_0x263468});}if(_0x1a3e19>0x0){sequelize_utils_1[a73_0x5003('0x7')][a73_0x5003('0x29')][a73_0x5003('0x34')][a73_0x5003('0x35')]({'amount':_0x1a3e19*-0x1,'counted_at':_0x263468});}}_0x44909f[a73_0x5003('0x25')]=0x2;}catch(_0x56c2af){_0x44909f[a73_0x5003('0x25')]=null;}}_0x44909f[a73_0x5003('0x26')]();});}else{_0x44909f[a73_0x5003('0x25')]=null;_0x44909f[a73_0x5003('0x26')]();}}else{_0x44909f[a73_0x5003('0x25')]=null;_0x44909f['save']();}}else{}});_0x502585['json']({'data':[]});}[a73_0x5003('0x36')](_0x4715ca,_0x23f320,_0x162e9e){const _0x3f35a1=require(a73_0x5003('0x37'));const _0x43a237=_0x4715ca['file'][a73_0x5003('0x38')];const _0x4b4a77=UPLOAD_PATH+'/'+_0x4715ca[a73_0x5003('0x39')][a73_0x5003('0x3a')]+'.json';const _0x5ae1eb=fs_1[a73_0x5003('0x7')][a73_0x5003('0x3b')](_0x43a237);const _0x156587=fs_1[a73_0x5003('0x7')][a73_0x5003('0x24')](_0x4b4a77);const _0x15e910=_0x3f35a1['createGunzip']();console['log'](_0x4715ca[a73_0x5003('0x39')]);_0x5ae1eb[a73_0x5003('0x23')](_0x15e910)[a73_0x5003('0x23')](_0x156587)['on'](a73_0x5003('0x3c'),_0x47974c=>{if(_0x47974c)return console[a73_0x5003('0x28')](_0x47974c);else{const _0x52ef94=fs_1[a73_0x5003('0x7')][a73_0x5003('0x2b')](_0x43a237);const _0x597030=_0x52ef94[a73_0x5003('0x2c')];if(_0x597030>0x0){fs_1['default'][a73_0x5003('0x2f')](_0x4b4a77,a73_0x5003('0x3d'),function(_0x47974c,_0x55ff7d){if(_0x47974c){return console[a73_0x5003('0x28')](_0x47974c);}else{try{const _0x527f07=JSON[a73_0x5003('0x30')](_0x55ff7d);console['log'](_0x527f07);const _0x4173c0=_0x527f07['eventos'][0x0][a73_0x5003('0x3e')];const _0x4d8a92=_0x527f07[a73_0x5003('0x3f')][0x0][a73_0x5003('0x40')];const _0x55ca62=moment_1[a73_0x5003('0x7')](_0x4173c0+'\x20'+_0x4d8a92+a73_0x5003('0x41'),a73_0x5003('0x42'));const _0x202a85=parseFloat(_0x527f07['eventos'][0x0]['latitud']['replace'](',','.'));const _0x253adf=parseFloat(_0x527f07[a73_0x5003('0x3f')][0x0]['longitud'][a73_0x5003('0x43')](',','.'));const _0x3a3030=_0x527f07[a73_0x5003('0x3f')][0x0]['velocidad'];const _0x52eb6f=_0x527f07[a73_0x5003('0x3f')][0x0][a73_0x5003('0x44')][0x0]['ingresos'];const _0x3a60f0=_0x527f07['eventos'][0x0]['puerta'][0x0]['salidas'];console[a73_0x5003('0xc')](_0x202a85);console[a73_0x5003('0xc')](_0x253adf);console[a73_0x5003('0xc')](_0x3a3030);console[a73_0x5003('0xc')](_0x52eb6f);console[a73_0x5003('0xc')](_0x3a60f0);console['log'](_0x55ca62);if(_0x52eb6f>0x0){sequelize_utils_1[a73_0x5003('0x7')][a73_0x5003('0x29')][a73_0x5003('0x34')][a73_0x5003('0x35')]({'amount':_0x52eb6f,'counted_at':_0x55ca62});}sequelize_utils_1[a73_0x5003('0x7')][a73_0x5003('0x29')][a73_0x5003('0x45')]['create']({'device_id':null,'lat':''+_0x202a85,'lon':''+_0x253adf,'tracked_at':_0x55ca62});}catch(_0x4a7bf8){return console[a73_0x5003('0x28')](_0x4a7bf8);}}});}}});_0x23f320[a73_0x5003('0x12')]({'status':0x1,'data':_0x4715ca['file']});}}exports[a73_0x5003('0x7')]=SyncFilesController;