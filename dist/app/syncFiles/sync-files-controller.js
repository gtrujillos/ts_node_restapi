var a73_0x471a=['statSync','eventos','fecha','hora','\x20-05:00','YYYYMMDD\x20HHmmss\x20Z','latitud','replace','puerta','ingresos','salidas','locationPointsModel','__importDefault','__esModule','defineProperty','ftp','../../infrastructure/controller-utils','../../infrastructure/sequelize-utils','moment','media','default','syncFtp','bind','downloadFtp','processFtp','log','connecting','ready','connected','list','colombia','name','endsWith','json','size','models','syncFilesModel','findOrCreate','spread','connect','ftp.vivotek.com','ipd','findOne','then','get','colombia/','end','media/','.txt','pipe','createWriteStream','status','save','fileName','error','file_name','existsSync','fileName:\x20','readFile','utf8','parse','CountingInfo','EndTime','create','passCountingsModel','uploadEvent','zlib','path','file','filename','.json','createReadStream','createGunzip','finish'];(function(_0x122d39,_0xaa94f){var _0x5e91bb=function(_0x4c4c10){while(--_0x4c4c10){_0x122d39['push'](_0x122d39['shift']());}};_0x5e91bb(++_0xaa94f);}(a73_0x471a,0xa0));var a73_0x3cea=function(_0x1e6f9e,_0x518766){_0x1e6f9e=_0x1e6f9e-0x0;var _0x57e2f4=a73_0x471a[_0x1e6f9e];return _0x57e2f4;};'use strict';var __importDefault=this&&this[a73_0x3cea('0x0')]||function(_0x2aa228){return _0x2aa228&&_0x2aa228[a73_0x3cea('0x1')]?_0x2aa228:{'default':_0x2aa228};};Object[a73_0x3cea('0x2')](exports,a73_0x3cea('0x1'),{'value':!![]});const ftp_1=__importDefault(require(a73_0x3cea('0x3')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a73_0x3cea('0x4')));const sequelize_utils_1=__importDefault(require(a73_0x3cea('0x5')));const moment_1=__importDefault(require(a73_0x3cea('0x6')));const UPLOAD_PATH=a73_0x3cea('0x7');class SyncFilesController extends controller_utils_1[a73_0x3cea('0x8')]{constructor(_0x425881){super(_0x425881,null);this[a73_0x3cea('0x9')]=this[a73_0x3cea('0x9')][a73_0x3cea('0xa')](this);this['downloadFtp']=this[a73_0x3cea('0xb')][a73_0x3cea('0xa')](this);this[a73_0x3cea('0xc')]=this['processFtp']['bind'](this);}['syncFtp'](_0x211e6e,_0x4d1585,_0x45bf63){console[a73_0x3cea('0xd')](a73_0x3cea('0xe'));const _0x4b95c5=[];const _0x4e4973=new ftp_1['default']();_0x4e4973['on'](a73_0x3cea('0xf'),function(){console[a73_0x3cea('0xd')](a73_0x3cea('0x10'));_0x4e4973[a73_0x3cea('0x11')](a73_0x3cea('0x12'),![],function(_0x1c8c69,_0x429378){if(_0x1c8c69){console[a73_0x3cea('0xd')](_0x1c8c69);}else{for(const _0x3be359 of _0x429378){if(_0x3be359[a73_0x3cea('0x13')][a73_0x3cea('0x14')](a73_0x3cea('0x15'))&&_0x3be359[a73_0x3cea('0x16')]>0x0){sequelize_utils_1[a73_0x3cea('0x8')][a73_0x3cea('0x17')][a73_0x3cea('0x18')][a73_0x3cea('0x19')]({'where':{'file_name':_0x3be359['name']}})[a73_0x3cea('0x1a')]((_0x16ca64,_0x355544)=>{if(_0x355544){_0x4b95c5['push'](_0x16ca64);}});}}}});});_0x4e4973['on']('error',function(_0x555add){});_0x4e4973[a73_0x3cea('0x1b')]({'host':a73_0x3cea('0x1c'),'port':0x15,'user':a73_0x3cea('0x1d'),'password':a73_0x3cea('0x1d')});_0x4d1585[a73_0x3cea('0x15')]({'data':[]});}[a73_0x3cea('0xb')](_0x35d98c,_0x99a685,_0x3d86a4){sequelize_utils_1[a73_0x3cea('0x8')]['models']['syncFilesModel'][a73_0x3cea('0x1e')]({'where':{'status':null}})[a73_0x3cea('0x1f')](_0x492bde=>{if(_0x492bde){const _0x556241=new ftp_1[(a73_0x3cea('0x8'))]();_0x556241['on'](a73_0x3cea('0xf'),function(){console[a73_0x3cea('0xd')]('connected:'+_0x492bde['file_name']);_0x556241[a73_0x3cea('0x20')](a73_0x3cea('0x21')+_0x492bde['file_name'],function(_0x4b1547,_0x58f834){_0x556241[a73_0x3cea('0x22')]();if(_0x4b1547){}else{const _0x4c6ff8=a73_0x3cea('0x23')+_0x492bde['file_name']+a73_0x3cea('0x24');_0x58f834[a73_0x3cea('0x25')](fs_1[a73_0x3cea('0x8')][a73_0x3cea('0x26')](_0x4c6ff8));_0x492bde[a73_0x3cea('0x27')]=0x1;_0x492bde[a73_0x3cea('0x28')]();console[a73_0x3cea('0xd')]('Downloaded:\x20'+_0x492bde[a73_0x3cea('0x29')]);}});});_0x556241['on'](a73_0x3cea('0x2a'),function(_0x402abe){});_0x556241[a73_0x3cea('0x1b')]({'host':a73_0x3cea('0x1c'),'port':0x15,'user':a73_0x3cea('0x1d'),'password':a73_0x3cea('0x1d')});}else{}});_0x99a685[a73_0x3cea('0x15')]({'data':[]});}['processFtp'](_0x9bdd33,_0xce5008,_0x1ae34a){sequelize_utils_1[a73_0x3cea('0x8')][a73_0x3cea('0x17')][a73_0x3cea('0x18')][a73_0x3cea('0x1e')]({'where':{'status':0x1}})[a73_0x3cea('0x1f')](_0x13c87b=>{if(_0x13c87b){const _0x2b9c46=a73_0x3cea('0x23')+_0x13c87b[a73_0x3cea('0x2b')]+'.txt';if(fs_1[a73_0x3cea('0x8')][a73_0x3cea('0x2c')](_0x2b9c46)){const _0x19479f=fs_1['default']['statSync'](_0x2b9c46);const _0x47ea1b=_0x19479f[a73_0x3cea('0x16')];console[a73_0x3cea('0xd')](a73_0x3cea('0x2d')+_0x2b9c46);console[a73_0x3cea('0xd')]('fileSizeInBytes:\x20'+_0x47ea1b);if(_0x47ea1b>0x0){fs_1[a73_0x3cea('0x8')][a73_0x3cea('0x2e')](_0x2b9c46,a73_0x3cea('0x2f'),function(_0x1786e4,_0x5cd8e5){if(_0x1786e4){_0x13c87b[a73_0x3cea('0x27')]=null;}else{try{const _0xfb3bf6=JSON[a73_0x3cea('0x30')](_0x5cd8e5);for(const _0x27feb1 of _0xfb3bf6['Data'][0x0][a73_0x3cea('0x31')]){const _0x16d593=_0x27feb1['In'];const _0x39a298=_0x27feb1['Out'];const _0x2c0b07=Date[a73_0x3cea('0x30')](_0x27feb1[a73_0x3cea('0x32')]);if(_0x16d593>0x0){sequelize_utils_1[a73_0x3cea('0x8')]['models']['passCountingsModel'][a73_0x3cea('0x33')]({'amount':_0x16d593,'counted_at':_0x2c0b07});}if(_0x39a298>0x0){sequelize_utils_1[a73_0x3cea('0x8')]['models'][a73_0x3cea('0x34')][a73_0x3cea('0x33')]({'amount':_0x39a298*-0x1,'counted_at':_0x2c0b07});}}_0x13c87b[a73_0x3cea('0x27')]=0x2;}catch(_0x3a1a61){_0x13c87b[a73_0x3cea('0x27')]=null;}}_0x13c87b[a73_0x3cea('0x28')]();});}else{_0x13c87b[a73_0x3cea('0x27')]=null;_0x13c87b[a73_0x3cea('0x28')]();}}else{_0x13c87b[a73_0x3cea('0x27')]=null;_0x13c87b[a73_0x3cea('0x28')]();}}else{}});_0xce5008['json']({'data':[]});}[a73_0x3cea('0x35')](_0x2a9331,_0x2b9b2b,_0x223a6d){const _0x171e33=require(a73_0x3cea('0x36'));const _0x3069de=_0x2a9331['file'][a73_0x3cea('0x37')];const _0x4ba49b=UPLOAD_PATH+'/'+_0x2a9331[a73_0x3cea('0x38')][a73_0x3cea('0x39')]+a73_0x3cea('0x3a');const _0x37cfa6=fs_1[a73_0x3cea('0x8')][a73_0x3cea('0x3b')](_0x3069de);const _0x6e5657=fs_1[a73_0x3cea('0x8')][a73_0x3cea('0x26')](_0x4ba49b);const _0x2c45bd=_0x171e33[a73_0x3cea('0x3c')]();console[a73_0x3cea('0xd')](_0x2a9331['file']);_0x37cfa6[a73_0x3cea('0x25')](_0x2c45bd)[a73_0x3cea('0x25')](_0x6e5657)['on'](a73_0x3cea('0x3d'),_0x3aab97=>{if(_0x3aab97)return console[a73_0x3cea('0x2a')](_0x3aab97);else{const _0x52bc99=fs_1['default'][a73_0x3cea('0x3e')](_0x3069de);const _0x3b0a4c=_0x52bc99[a73_0x3cea('0x16')];if(_0x3b0a4c>0x0){fs_1[a73_0x3cea('0x8')][a73_0x3cea('0x2e')](_0x4ba49b,a73_0x3cea('0x2f'),function(_0x3aab97,_0x46832b){if(_0x3aab97){return console[a73_0x3cea('0x2a')](_0x3aab97);}else{try{const _0x74bfef=JSON[a73_0x3cea('0x30')](_0x46832b);console['log'](_0x74bfef);const _0x29da30=_0x74bfef[a73_0x3cea('0x3f')][0x0][a73_0x3cea('0x40')];const _0x14053b=_0x74bfef[a73_0x3cea('0x3f')][0x0][a73_0x3cea('0x41')];const _0x31371e=moment_1[a73_0x3cea('0x8')](_0x29da30+'\x20'+_0x14053b+a73_0x3cea('0x42'),a73_0x3cea('0x43'));const _0x2373fc=parseFloat(_0x74bfef[a73_0x3cea('0x3f')][0x0][a73_0x3cea('0x44')][a73_0x3cea('0x45')](',','.'));const _0x3b8413=parseFloat(_0x74bfef[a73_0x3cea('0x3f')][0x0]['longitud'][a73_0x3cea('0x45')](',','.'));const _0x40b129=_0x74bfef[a73_0x3cea('0x3f')][0x0]['velocidad'];const _0x595354=_0x74bfef[a73_0x3cea('0x3f')][0x0][a73_0x3cea('0x46')][0x0][a73_0x3cea('0x47')];const _0x17962=_0x74bfef[a73_0x3cea('0x3f')][0x0][a73_0x3cea('0x46')][0x0][a73_0x3cea('0x48')];console[a73_0x3cea('0xd')](_0x2373fc);console['log'](_0x3b8413);console[a73_0x3cea('0xd')](_0x40b129);console[a73_0x3cea('0xd')](_0x595354);console[a73_0x3cea('0xd')](_0x17962);console['log'](_0x31371e);if(_0x595354>0x0){sequelize_utils_1[a73_0x3cea('0x8')][a73_0x3cea('0x17')]['passCountingsModel'][a73_0x3cea('0x33')]({'amount':_0x595354,'counted_at':_0x31371e});}sequelize_utils_1['default'][a73_0x3cea('0x17')][a73_0x3cea('0x49')][a73_0x3cea('0x33')]({'device_id':null,'lat':''+_0x2373fc,'lon':''+_0x3b8413,'tracked_at':_0x31371e});}catch(_0x262de4){return console[a73_0x3cea('0x2a')](_0x262de4);}}});}}});_0x2b9b2b[a73_0x3cea('0x15')]({'status':0x1,'data':_0x2a9331[a73_0x3cea('0x38')]});}}exports['default']=SyncFilesController;