var a69_0x23ed=['connecting','ready','log','connected','colombia','name','json','size','models','spread','push','error','connect','ftp.vivotek.com','ipd','findOne','then','connected:','file_name','colombia/','end','media/','pipe','status','Downloaded:\x20','fileName','.txt','existsSync','statSync','readFile','parse','Data','CountingInfo','EndTime','passCountingsModel','create','save','uploadEvent','zlib','file','path','filename','.json','createWriteStream','createGunzip','finish','utf8','eventos','hora','\x20-05:00','latitud','replace','longitud','velocidad','puerta','ingresos','locationPointsModel','__importDefault','__esModule','ftp','media','default','syncFtp','bind','downloadFtp','processFtp'];(function(_0x1961f2,_0x38fb96){var _0x212fcf=function(_0x418710){while(--_0x418710){_0x1961f2['push'](_0x1961f2['shift']());}};_0x212fcf(++_0x38fb96);}(a69_0x23ed,0x183));var a69_0xb08b=function(_0x2cf0ad,_0x4fe671){_0x2cf0ad=_0x2cf0ad-0x0;var _0x2c2eff=a69_0x23ed[_0x2cf0ad];return _0x2c2eff;};'use strict';var __importDefault=this&&this[a69_0xb08b('0x0')]||function(_0x5d6b38){return _0x5d6b38&&_0x5d6b38[a69_0xb08b('0x1')]?_0x5d6b38:{'default':_0x5d6b38};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const ftp_1=__importDefault(require(a69_0xb08b('0x2')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require('../../infrastructure/controller-utils'));const sequelize_utils_1=__importDefault(require('../../infrastructure/sequelize-utils'));const moment_1=__importDefault(require('moment'));const UPLOAD_PATH=a69_0xb08b('0x3');class SyncFilesController extends controller_utils_1[a69_0xb08b('0x4')]{constructor(_0x232ee5){super(_0x232ee5,null);this[a69_0xb08b('0x5')]=this[a69_0xb08b('0x5')][a69_0xb08b('0x6')](this);this[a69_0xb08b('0x7')]=this[a69_0xb08b('0x7')]['bind'](this);this[a69_0xb08b('0x8')]=this['processFtp'][a69_0xb08b('0x6')](this);}[a69_0xb08b('0x5')](_0x2f17e3,_0x4386b3,_0x25ebaf){console['log'](a69_0xb08b('0x9'));const _0x2220d2=[];const _0x46743c=new ftp_1[(a69_0xb08b('0x4'))]();_0x46743c['on'](a69_0xb08b('0xa'),function(){console[a69_0xb08b('0xb')](a69_0xb08b('0xc'));_0x46743c['list'](a69_0xb08b('0xd'),![],function(_0x1aad4,_0x1573c9){if(_0x1aad4){console[a69_0xb08b('0xb')](_0x1aad4);}else{for(const _0x3e78e8 of _0x1573c9){if(_0x3e78e8[a69_0xb08b('0xe')]['endsWith'](a69_0xb08b('0xf'))&&_0x3e78e8[a69_0xb08b('0x10')]>0x0){sequelize_utils_1[a69_0xb08b('0x4')][a69_0xb08b('0x11')]['syncFilesModel']['findOrCreate']({'where':{'file_name':_0x3e78e8[a69_0xb08b('0xe')]}})[a69_0xb08b('0x12')]((_0x171b06,_0x4c00b9)=>{if(_0x4c00b9){_0x2220d2[a69_0xb08b('0x13')](_0x171b06);}});}}}});});_0x46743c['on'](a69_0xb08b('0x14'),function(_0x2ff4d3){});_0x46743c[a69_0xb08b('0x15')]({'host':a69_0xb08b('0x16'),'port':0x15,'user':a69_0xb08b('0x17'),'password':'ipd'});_0x4386b3['json']({'data':[]});}[a69_0xb08b('0x7')](_0x35b61a,_0x5d0b07,_0x5bb1f5){sequelize_utils_1[a69_0xb08b('0x4')][a69_0xb08b('0x11')]['syncFilesModel'][a69_0xb08b('0x18')]({'where':{'status':null}})[a69_0xb08b('0x19')](_0x216caf=>{if(_0x216caf){const _0x42c4d7=new ftp_1[(a69_0xb08b('0x4'))]();_0x42c4d7['on'](a69_0xb08b('0xa'),function(){console[a69_0xb08b('0xb')](a69_0xb08b('0x1a')+_0x216caf[a69_0xb08b('0x1b')]);_0x42c4d7['get'](a69_0xb08b('0x1c')+_0x216caf[a69_0xb08b('0x1b')],function(_0xa5c592,_0x1c2818){_0x42c4d7[a69_0xb08b('0x1d')]();if(_0xa5c592){}else{const _0x13c3a9=a69_0xb08b('0x1e')+_0x216caf['file_name']+'.txt';_0x1c2818[a69_0xb08b('0x1f')](fs_1[a69_0xb08b('0x4')]['createWriteStream'](_0x13c3a9));_0x216caf[a69_0xb08b('0x20')]=0x1;_0x216caf['save']();console[a69_0xb08b('0xb')](a69_0xb08b('0x21')+_0x216caf[a69_0xb08b('0x22')]);}});});_0x42c4d7['on'](a69_0xb08b('0x14'),function(_0x50d478){});_0x42c4d7[a69_0xb08b('0x15')]({'host':a69_0xb08b('0x16'),'port':0x15,'user':a69_0xb08b('0x17'),'password':'ipd'});}else{}});_0x5d0b07[a69_0xb08b('0xf')]({'data':[]});}[a69_0xb08b('0x8')](_0x21b9ff,_0x5e5473,_0x1adf3f){sequelize_utils_1[a69_0xb08b('0x4')]['models']['syncFilesModel'][a69_0xb08b('0x18')]({'where':{'status':0x1}})[a69_0xb08b('0x19')](_0x3fc49a=>{if(_0x3fc49a){const _0x2bff13=a69_0xb08b('0x1e')+_0x3fc49a[a69_0xb08b('0x1b')]+a69_0xb08b('0x23');if(fs_1['default'][a69_0xb08b('0x24')](_0x2bff13)){const _0x37a9a6=fs_1[a69_0xb08b('0x4')][a69_0xb08b('0x25')](_0x2bff13);const _0x53af44=_0x37a9a6[a69_0xb08b('0x10')];console[a69_0xb08b('0xb')]('fileName:\x20'+_0x2bff13);console[a69_0xb08b('0xb')]('fileSizeInBytes:\x20'+_0x53af44);if(_0x53af44>0x0){fs_1['default'][a69_0xb08b('0x26')](_0x2bff13,'utf8',function(_0x110497,_0x21e76b){if(_0x110497){_0x3fc49a[a69_0xb08b('0x20')]=null;}else{try{const _0x4fcea3=JSON[a69_0xb08b('0x27')](_0x21e76b);for(const _0x1b5559 of _0x4fcea3[a69_0xb08b('0x28')][0x0][a69_0xb08b('0x29')]){const _0x1a7e8b=_0x1b5559['In'];const _0x1c099f=_0x1b5559['Out'];const _0x43e6ba=Date[a69_0xb08b('0x27')](_0x1b5559[a69_0xb08b('0x2a')]);if(_0x1a7e8b>0x0){sequelize_utils_1['default'][a69_0xb08b('0x11')]['passCountingsModel']['create']({'amount':_0x1a7e8b,'counted_at':_0x43e6ba});}if(_0x1c099f>0x0){sequelize_utils_1[a69_0xb08b('0x4')][a69_0xb08b('0x11')][a69_0xb08b('0x2b')][a69_0xb08b('0x2c')]({'amount':_0x1c099f*-0x1,'counted_at':_0x43e6ba});}}_0x3fc49a[a69_0xb08b('0x20')]=0x2;}catch(_0x3042b4){_0x3fc49a[a69_0xb08b('0x20')]=null;}}_0x3fc49a['save']();});}else{_0x3fc49a['status']=null;_0x3fc49a[a69_0xb08b('0x2d')]();}}else{_0x3fc49a[a69_0xb08b('0x20')]=null;_0x3fc49a['save']();}}else{}});_0x5e5473[a69_0xb08b('0xf')]({'data':[]});}[a69_0xb08b('0x2e')](_0x5cb980,_0x215170,_0x3303be){const _0x254023=require(a69_0xb08b('0x2f'));const _0x2a778a=_0x5cb980[a69_0xb08b('0x30')][a69_0xb08b('0x31')];const _0x24d1c0=UPLOAD_PATH+'/'+_0x5cb980['file'][a69_0xb08b('0x32')]+a69_0xb08b('0x33');const _0x4ac27d=fs_1[a69_0xb08b('0x4')]['createReadStream'](_0x2a778a);const _0x55b498=fs_1['default'][a69_0xb08b('0x34')](_0x24d1c0);const _0x4113bb=_0x254023[a69_0xb08b('0x35')]();console[a69_0xb08b('0xb')](_0x5cb980['file']);_0x4ac27d[a69_0xb08b('0x1f')](_0x4113bb)[a69_0xb08b('0x1f')](_0x55b498)['on'](a69_0xb08b('0x36'),_0x6e6bc4=>{if(_0x6e6bc4)return console[a69_0xb08b('0x14')](_0x6e6bc4);else{const _0x2f3aa2=fs_1[a69_0xb08b('0x4')][a69_0xb08b('0x25')](_0x2a778a);const _0x2715be=_0x2f3aa2['size'];if(_0x2715be>0x0){fs_1[a69_0xb08b('0x4')][a69_0xb08b('0x26')](_0x24d1c0,a69_0xb08b('0x37'),function(_0x6e6bc4,_0x5daf88){if(_0x6e6bc4){return console[a69_0xb08b('0x14')](_0x6e6bc4);}else{try{const _0x538456=JSON[a69_0xb08b('0x27')](_0x5daf88);console[a69_0xb08b('0xb')](_0x538456);const _0x413a75=_0x538456[a69_0xb08b('0x38')][0x0]['fecha'];const _0x59a1ce=_0x538456[a69_0xb08b('0x38')][0x0][a69_0xb08b('0x39')];const _0x4066a5=moment_1[a69_0xb08b('0x4')](_0x413a75+'\x20'+_0x59a1ce+a69_0xb08b('0x3a'),'YYYYMMDD\x20HHmmss\x20Z');const _0x5c0f84=parseFloat(_0x538456[a69_0xb08b('0x38')][0x0][a69_0xb08b('0x3b')][a69_0xb08b('0x3c')](',','.'));const _0x1ab733=parseFloat(_0x538456[a69_0xb08b('0x38')][0x0][a69_0xb08b('0x3d')][a69_0xb08b('0x3c')](',','.'));const _0x15f7ac=_0x538456['eventos'][0x0][a69_0xb08b('0x3e')];const _0x585c78=_0x538456[a69_0xb08b('0x38')][0x0][a69_0xb08b('0x3f')][0x0][a69_0xb08b('0x40')];const _0xb338e6=_0x538456[a69_0xb08b('0x38')][0x0]['puerta'][0x0]['salidas'];console['log'](_0x5c0f84);console['log'](_0x1ab733);console[a69_0xb08b('0xb')](_0x15f7ac);console[a69_0xb08b('0xb')](_0x585c78);console[a69_0xb08b('0xb')](_0xb338e6);console[a69_0xb08b('0xb')](_0x4066a5);if(_0x585c78>0x0){sequelize_utils_1['default'][a69_0xb08b('0x11')][a69_0xb08b('0x2b')][a69_0xb08b('0x2c')]({'amount':_0x585c78,'counted_at':_0x4066a5});}sequelize_utils_1[a69_0xb08b('0x4')][a69_0xb08b('0x11')][a69_0xb08b('0x41')][a69_0xb08b('0x2c')]({'device_id':null,'lat':''+_0x5c0f84,'lon':''+_0x1ab733,'tracked_at':_0x4066a5});}catch(_0x40e44e){return console['error'](_0x40e44e);}}});}}});_0x215170['json']({'status':0x1,'data':_0x5cb980[a69_0xb08b('0x30')]});}}exports[a69_0xb08b('0x4')]=SyncFilesController;