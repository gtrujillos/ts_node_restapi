var a79_0x186d=['ingresos','salidas','passCountingsModel','create','locationPointsModel','__importDefault','__esModule','defineProperty','../../infrastructure/controller-utils','../../infrastructure/sequelize-utils','moment','media','default','syncFtp','downloadFtp','bind','processFtp','log','connecting','ready','connected','list','colombia','name','endsWith','json','size','models','syncFilesModel','findOrCreate','spread','push','error','connect','ftp.vivotek.com','ipd','findOne','then','get','colombia/','file_name','end','media/','.txt','pipe','createWriteStream','status','save','fileName','existsSync','fileName:\x20','readFile','parse','Data','CountingInfo','Out','EndTime','zlib','path','file','createReadStream','createGunzip','finish','utf8','eventos','fecha','hora','\x20-05:00','YYYYMMDD\x20HHmmss\x20Z','replace','longitud','velocidad','puerta'];(function(_0x45658b,_0xa6ed42){var _0x51c273=function(_0x5a2c04){while(--_0x5a2c04){_0x45658b['push'](_0x45658b['shift']());}};_0x51c273(++_0xa6ed42);}(a79_0x186d,0xe0));var a79_0x5e1d=function(_0x330ff1,_0x3110f7){_0x330ff1=_0x330ff1-0x0;var _0x3b5213=a79_0x186d[_0x330ff1];return _0x3b5213;};'use strict';var __importDefault=this&&this[a79_0x5e1d('0x0')]||function(_0x5b6137){return _0x5b6137&&_0x5b6137[a79_0x5e1d('0x1')]?_0x5b6137:{'default':_0x5b6137};};Object[a79_0x5e1d('0x2')](exports,a79_0x5e1d('0x1'),{'value':!![]});const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a79_0x5e1d('0x3')));const sequelize_utils_1=__importDefault(require(a79_0x5e1d('0x4')));const moment_1=__importDefault(require(a79_0x5e1d('0x5')));const UPLOAD_PATH=a79_0x5e1d('0x6');class SyncFilesController extends controller_utils_1[a79_0x5e1d('0x7')]{constructor(_0x41a067){super(_0x41a067,null);this[a79_0x5e1d('0x8')]=this[a79_0x5e1d('0x8')]['bind'](this);this[a79_0x5e1d('0x9')]=this[a79_0x5e1d('0x9')][a79_0x5e1d('0xa')](this);this[a79_0x5e1d('0xb')]=this[a79_0x5e1d('0xb')]['bind'](this);}[a79_0x5e1d('0x8')](_0x262011,_0x47bd88,_0x507df8){console[a79_0x5e1d('0xc')](a79_0x5e1d('0xd'));const _0x243006=[];const _0x129f91=new ftp_1[(a79_0x5e1d('0x7'))]();_0x129f91['on'](a79_0x5e1d('0xe'),function(){console['log'](a79_0x5e1d('0xf'));_0x129f91[a79_0x5e1d('0x10')](a79_0x5e1d('0x11'),![],function(_0x5760f8,_0x3f4d78){if(_0x5760f8){console[a79_0x5e1d('0xc')](_0x5760f8);}else{for(const _0x89c1af of _0x3f4d78){if(_0x89c1af[a79_0x5e1d('0x12')][a79_0x5e1d('0x13')](a79_0x5e1d('0x14'))&&_0x89c1af[a79_0x5e1d('0x15')]>0x0){sequelize_utils_1[a79_0x5e1d('0x7')][a79_0x5e1d('0x16')][a79_0x5e1d('0x17')][a79_0x5e1d('0x18')]({'where':{'file_name':_0x89c1af['name']}})[a79_0x5e1d('0x19')]((_0x45d9de,_0x9da049)=>{if(_0x9da049){_0x243006[a79_0x5e1d('0x1a')](_0x45d9de);}});}}}});});_0x129f91['on'](a79_0x5e1d('0x1b'),function(_0x4b22bf){});_0x129f91[a79_0x5e1d('0x1c')]({'host':a79_0x5e1d('0x1d'),'port':0x15,'user':a79_0x5e1d('0x1e'),'password':a79_0x5e1d('0x1e')});_0x47bd88[a79_0x5e1d('0x14')]({'data':[]});}['downloadFtp'](_0x425b76,_0x305126,_0x4a8cc1){sequelize_utils_1[a79_0x5e1d('0x7')][a79_0x5e1d('0x16')]['syncFilesModel'][a79_0x5e1d('0x1f')]({'where':{'status':null}})[a79_0x5e1d('0x20')](_0x59c3d8=>{if(_0x59c3d8){const _0x1b0ce2=new ftp_1[(a79_0x5e1d('0x7'))]();_0x1b0ce2['on']('ready',function(){console['log']('connected:'+_0x59c3d8['file_name']);_0x1b0ce2[a79_0x5e1d('0x21')](a79_0x5e1d('0x22')+_0x59c3d8[a79_0x5e1d('0x23')],function(_0x5e5592,_0x511338){_0x1b0ce2[a79_0x5e1d('0x24')]();if(_0x5e5592){}else{const _0x5af1a6=a79_0x5e1d('0x25')+_0x59c3d8[a79_0x5e1d('0x23')]+a79_0x5e1d('0x26');_0x511338[a79_0x5e1d('0x27')](fs_1[a79_0x5e1d('0x7')][a79_0x5e1d('0x28')](_0x5af1a6));_0x59c3d8[a79_0x5e1d('0x29')]=0x1;_0x59c3d8[a79_0x5e1d('0x2a')]();console[a79_0x5e1d('0xc')]('Downloaded:\x20'+_0x59c3d8[a79_0x5e1d('0x2b')]);}});});_0x1b0ce2['on'](a79_0x5e1d('0x1b'),function(_0x555b70){});_0x1b0ce2['connect']({'host':a79_0x5e1d('0x1d'),'port':0x15,'user':a79_0x5e1d('0x1e'),'password':a79_0x5e1d('0x1e')});}else{}});_0x305126['json']({'data':[]});}[a79_0x5e1d('0xb')](_0x5f41ee,_0x332f6e,_0x5ac45a){sequelize_utils_1['default'][a79_0x5e1d('0x16')]['syncFilesModel'][a79_0x5e1d('0x1f')]({'where':{'status':0x1}})['then'](_0xa4d207=>{if(_0xa4d207){const _0x38e4eb=a79_0x5e1d('0x25')+_0xa4d207[a79_0x5e1d('0x23')]+a79_0x5e1d('0x26');if(fs_1[a79_0x5e1d('0x7')][a79_0x5e1d('0x2c')](_0x38e4eb)){const _0x293535=fs_1[a79_0x5e1d('0x7')]['statSync'](_0x38e4eb);const _0x5c869c=_0x293535[a79_0x5e1d('0x15')];console[a79_0x5e1d('0xc')](a79_0x5e1d('0x2d')+_0x38e4eb);console['log']('fileSizeInBytes:\x20'+_0x5c869c);if(_0x5c869c>0x0){fs_1['default'][a79_0x5e1d('0x2e')](_0x38e4eb,'utf8',function(_0xbc9e5,_0x1f9868){if(_0xbc9e5){_0xa4d207[a79_0x5e1d('0x29')]=null;}else{try{const _0x21d4fc=JSON[a79_0x5e1d('0x2f')](_0x1f9868);for(const _0xefafbc of _0x21d4fc[a79_0x5e1d('0x30')][0x0][a79_0x5e1d('0x31')]){const _0x33a8ba=_0xefafbc['In'];const _0x2fb83b=_0xefafbc[a79_0x5e1d('0x32')];const _0x26b2fd=Date['parse'](_0xefafbc[a79_0x5e1d('0x33')]);if(_0x33a8ba>0x0){sequelize_utils_1[a79_0x5e1d('0x7')]['models']['passCountingsModel']['create']({'amount':_0x33a8ba,'counted_at':_0x26b2fd});}if(_0x2fb83b>0x0){sequelize_utils_1['default']['models']['passCountingsModel']['create']({'amount':_0x2fb83b*-0x1,'counted_at':_0x26b2fd});}}_0xa4d207[a79_0x5e1d('0x29')]=0x2;}catch(_0x790908){_0xa4d207['status']=null;}}_0xa4d207[a79_0x5e1d('0x2a')]();});}else{_0xa4d207[a79_0x5e1d('0x29')]=null;_0xa4d207[a79_0x5e1d('0x2a')]();}}else{_0xa4d207[a79_0x5e1d('0x29')]=null;_0xa4d207[a79_0x5e1d('0x2a')]();}}else{}});_0x332f6e['json']({'data':[]});}['uploadEvent'](_0x3159c2,_0x273a35,_0xece4ac){const _0x5425be=require(a79_0x5e1d('0x34'));const _0x142b92=_0x3159c2['file'][a79_0x5e1d('0x35')];const _0x4e0bdb=UPLOAD_PATH+'/'+_0x3159c2[a79_0x5e1d('0x36')]['filename']+'.json';const _0x57e961=fs_1[a79_0x5e1d('0x7')][a79_0x5e1d('0x37')](_0x142b92);const _0x529699=fs_1[a79_0x5e1d('0x7')][a79_0x5e1d('0x28')](_0x4e0bdb);const _0x26d23a=_0x5425be[a79_0x5e1d('0x38')]();console[a79_0x5e1d('0xc')](_0x3159c2[a79_0x5e1d('0x36')]);_0x57e961[a79_0x5e1d('0x27')](_0x26d23a)[a79_0x5e1d('0x27')](_0x529699)['on'](a79_0x5e1d('0x39'),_0x178b03=>{if(_0x178b03)return console[a79_0x5e1d('0x1b')](_0x178b03);else{const _0xfb4dc0=fs_1[a79_0x5e1d('0x7')]['statSync'](_0x142b92);const _0x55393c=_0xfb4dc0[a79_0x5e1d('0x15')];if(_0x55393c>0x0){fs_1[a79_0x5e1d('0x7')][a79_0x5e1d('0x2e')](_0x4e0bdb,a79_0x5e1d('0x3a'),function(_0x178b03,_0x44f037){if(_0x178b03){return console[a79_0x5e1d('0x1b')](_0x178b03);}else{try{const _0x3c89c6=JSON[a79_0x5e1d('0x2f')](_0x44f037);console['log'](_0x3c89c6);const _0x18f922=_0x3c89c6[a79_0x5e1d('0x3b')][0x0][a79_0x5e1d('0x3c')];const _0x437cdf=_0x3c89c6['eventos'][0x0][a79_0x5e1d('0x3d')];const _0x460ce6=moment_1[a79_0x5e1d('0x7')](_0x18f922+'\x20'+_0x437cdf+a79_0x5e1d('0x3e'),a79_0x5e1d('0x3f'));const _0x4621fd=parseFloat(_0x3c89c6[a79_0x5e1d('0x3b')][0x0]['latitud'][a79_0x5e1d('0x40')](',','.'));const _0x33a52a=parseFloat(_0x3c89c6[a79_0x5e1d('0x3b')][0x0][a79_0x5e1d('0x41')][a79_0x5e1d('0x40')](',','.'));const _0x1db5c3=_0x3c89c6[a79_0x5e1d('0x3b')][0x0][a79_0x5e1d('0x42')];const _0x2eb532=_0x3c89c6[a79_0x5e1d('0x3b')][0x0][a79_0x5e1d('0x43')][0x0][a79_0x5e1d('0x44')];const _0x5caab3=_0x3c89c6[a79_0x5e1d('0x3b')][0x0]['puerta'][0x0][a79_0x5e1d('0x45')];console[a79_0x5e1d('0xc')](_0x4621fd);console[a79_0x5e1d('0xc')](_0x33a52a);console[a79_0x5e1d('0xc')](_0x1db5c3);console[a79_0x5e1d('0xc')](_0x2eb532);console[a79_0x5e1d('0xc')](_0x5caab3);console['log'](_0x460ce6);if(_0x2eb532>0x0){sequelize_utils_1['default'][a79_0x5e1d('0x16')][a79_0x5e1d('0x46')][a79_0x5e1d('0x47')]({'amount':_0x2eb532,'counted_at':_0x460ce6});}sequelize_utils_1[a79_0x5e1d('0x7')][a79_0x5e1d('0x16')][a79_0x5e1d('0x48')]['create']({'device_id':null,'lat':''+_0x4621fd,'lon':''+_0x33a52a,'tracked_at':_0x460ce6});}catch(_0x574c85){return console['error'](_0x574c85);}}});}}});_0x273a35['json']({'status':0x1,'data':_0x3159c2[a79_0x5e1d('0x36')]});}}exports[a79_0x5e1d('0x7')]=SyncFilesController;