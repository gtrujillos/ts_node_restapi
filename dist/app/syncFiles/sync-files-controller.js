var a69_0x144d=['colombia','name','endsWith','json','size','models','syncFilesModel','findOrCreate','spread','push','error','connect','ipd','then','ready','file_name','get','colombia/','end','.txt','createWriteStream','fileName','ftp.vivotek.com','media/','existsSync','statSync','fileName:\x20','readFile','utf8','status','parse','Data','CountingInfo','Out','EndTime','passCountingsModel','create','save','zlib','path','file','.json','createReadStream','pipe','finish','eventos','fecha','hora','\x20-05:00','latitud','replace','longitud','velocidad','puerta','ingresos','salidas','locationPointsModel','__importDefault','defineProperty','__esModule','ftp','../../infrastructure/sequelize-utils','moment','default','syncFtp','bind','downloadFtp','processFtp','log','connecting','connected'];(function(_0x1425f1,_0x4c0686){var _0x3b2778=function(_0x48d5a0){while(--_0x48d5a0){_0x1425f1['push'](_0x1425f1['shift']());}};_0x3b2778(++_0x4c0686);}(a69_0x144d,0x155));var a69_0x4752=function(_0x3fd917,_0x550ee0){_0x3fd917=_0x3fd917-0x0;var _0x7bfdc5=a69_0x144d[_0x3fd917];return _0x7bfdc5;};'use strict';var __importDefault=this&&this[a69_0x4752('0x0')]||function(_0x2d96c5){return _0x2d96c5&&_0x2d96c5['__esModule']?_0x2d96c5:{'default':_0x2d96c5};};Object[a69_0x4752('0x1')](exports,a69_0x4752('0x2'),{'value':!![]});const ftp_1=__importDefault(require(a69_0x4752('0x3')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require('../../infrastructure/controller-utils'));const sequelize_utils_1=__importDefault(require(a69_0x4752('0x4')));const moment_1=__importDefault(require(a69_0x4752('0x5')));const UPLOAD_PATH='media';class SyncFilesController extends controller_utils_1[a69_0x4752('0x6')]{constructor(_0xf39110){super(_0xf39110,null);this[a69_0x4752('0x7')]=this[a69_0x4752('0x7')][a69_0x4752('0x8')](this);this[a69_0x4752('0x9')]=this[a69_0x4752('0x9')][a69_0x4752('0x8')](this);this[a69_0x4752('0xa')]=this['processFtp'][a69_0x4752('0x8')](this);}['syncFtp'](_0x3f17c7,_0x3d1b03,_0x1c18fc){console[a69_0x4752('0xb')](a69_0x4752('0xc'));const _0x1487d7=[];const _0x3b5d20=new ftp_1[(a69_0x4752('0x6'))]();_0x3b5d20['on']('ready',function(){console[a69_0x4752('0xb')](a69_0x4752('0xd'));_0x3b5d20['list'](a69_0x4752('0xe'),![],function(_0x3e6d7d,_0x5d3579){if(_0x3e6d7d){console[a69_0x4752('0xb')](_0x3e6d7d);}else{for(const _0x5c9839 of _0x5d3579){if(_0x5c9839[a69_0x4752('0xf')][a69_0x4752('0x10')](a69_0x4752('0x11'))&&_0x5c9839[a69_0x4752('0x12')]>0x0){sequelize_utils_1[a69_0x4752('0x6')][a69_0x4752('0x13')][a69_0x4752('0x14')][a69_0x4752('0x15')]({'where':{'file_name':_0x5c9839[a69_0x4752('0xf')]}})[a69_0x4752('0x16')]((_0x514b71,_0x1a442e)=>{if(_0x1a442e){_0x1487d7[a69_0x4752('0x17')](_0x514b71);}});}}}});});_0x3b5d20['on'](a69_0x4752('0x18'),function(_0x74dd55){});_0x3b5d20[a69_0x4752('0x19')]({'host':'ftp.vivotek.com','port':0x15,'user':a69_0x4752('0x1a'),'password':a69_0x4752('0x1a')});_0x3d1b03[a69_0x4752('0x11')]({'data':[]});}[a69_0x4752('0x9')](_0x5d0844,_0x310dc6,_0x35aa21){sequelize_utils_1[a69_0x4752('0x6')][a69_0x4752('0x13')][a69_0x4752('0x14')]['findOne']({'where':{'status':null}})[a69_0x4752('0x1b')](_0xd380df=>{if(_0xd380df){const _0x46dd37=new ftp_1[(a69_0x4752('0x6'))]();_0x46dd37['on'](a69_0x4752('0x1c'),function(){console[a69_0x4752('0xb')]('connected:'+_0xd380df[a69_0x4752('0x1d')]);_0x46dd37[a69_0x4752('0x1e')](a69_0x4752('0x1f')+_0xd380df[a69_0x4752('0x1d')],function(_0x18dd8e,_0x5a2ee3){_0x46dd37[a69_0x4752('0x20')]();if(_0x18dd8e){}else{const _0x53079c='media/'+_0xd380df[a69_0x4752('0x1d')]+a69_0x4752('0x21');_0x5a2ee3['pipe'](fs_1[a69_0x4752('0x6')][a69_0x4752('0x22')](_0x53079c));_0xd380df['status']=0x1;_0xd380df['save']();console['log']('Downloaded:\x20'+_0xd380df[a69_0x4752('0x23')]);}});});_0x46dd37['on']('error',function(_0x4cc0d0){});_0x46dd37[a69_0x4752('0x19')]({'host':a69_0x4752('0x24'),'port':0x15,'user':a69_0x4752('0x1a'),'password':a69_0x4752('0x1a')});}else{}});_0x310dc6[a69_0x4752('0x11')]({'data':[]});}[a69_0x4752('0xa')](_0x577b95,_0x8f174c,_0x3bd3c8){sequelize_utils_1[a69_0x4752('0x6')][a69_0x4752('0x13')][a69_0x4752('0x14')]['findOne']({'where':{'status':0x1}})[a69_0x4752('0x1b')](_0x565d1a=>{if(_0x565d1a){const _0x35ecc4=a69_0x4752('0x25')+_0x565d1a['file_name']+a69_0x4752('0x21');if(fs_1[a69_0x4752('0x6')][a69_0x4752('0x26')](_0x35ecc4)){const _0x5996ac=fs_1[a69_0x4752('0x6')][a69_0x4752('0x27')](_0x35ecc4);const _0x50f00f=_0x5996ac['size'];console[a69_0x4752('0xb')](a69_0x4752('0x28')+_0x35ecc4);console[a69_0x4752('0xb')]('fileSizeInBytes:\x20'+_0x50f00f);if(_0x50f00f>0x0){fs_1['default'][a69_0x4752('0x29')](_0x35ecc4,a69_0x4752('0x2a'),function(_0x240b02,_0x274960){if(_0x240b02){_0x565d1a[a69_0x4752('0x2b')]=null;}else{try{const _0x2318a6=JSON[a69_0x4752('0x2c')](_0x274960);for(const _0x2e67df of _0x2318a6[a69_0x4752('0x2d')][0x0][a69_0x4752('0x2e')]){const _0x29be67=_0x2e67df['In'];const _0x4e7043=_0x2e67df[a69_0x4752('0x2f')];const _0x5c08a3=Date[a69_0x4752('0x2c')](_0x2e67df[a69_0x4752('0x30')]);if(_0x29be67>0x0){sequelize_utils_1['default'][a69_0x4752('0x13')][a69_0x4752('0x31')][a69_0x4752('0x32')]({'amount':_0x29be67,'counted_at':_0x5c08a3});}if(_0x4e7043>0x0){sequelize_utils_1['default']['models'][a69_0x4752('0x31')][a69_0x4752('0x32')]({'amount':_0x4e7043*-0x1,'counted_at':_0x5c08a3});}}_0x565d1a['status']=0x2;}catch(_0x2e3824){_0x565d1a[a69_0x4752('0x2b')]=null;}}_0x565d1a[a69_0x4752('0x33')]();});}else{_0x565d1a['status']=null;_0x565d1a['save']();}}else{_0x565d1a[a69_0x4752('0x2b')]=null;_0x565d1a[a69_0x4752('0x33')]();}}else{}});_0x8f174c['json']({'data':[]});}['uploadEvent'](_0xabb382,_0x2c6886,_0x47bab3){const _0x1b15cc=require(a69_0x4752('0x34'));const _0x418871=_0xabb382['file'][a69_0x4752('0x35')];const _0x55040f=UPLOAD_PATH+'/'+_0xabb382[a69_0x4752('0x36')]['filename']+a69_0x4752('0x37');const _0x23754a=fs_1[a69_0x4752('0x6')][a69_0x4752('0x38')](_0x418871);const _0x34da40=fs_1[a69_0x4752('0x6')][a69_0x4752('0x22')](_0x55040f);const _0x4b06c3=_0x1b15cc['createGunzip']();console['log'](_0xabb382[a69_0x4752('0x36')]);_0x23754a[a69_0x4752('0x39')](_0x4b06c3)[a69_0x4752('0x39')](_0x34da40)['on'](a69_0x4752('0x3a'),_0x5c98a3=>{if(_0x5c98a3)return console[a69_0x4752('0x18')](_0x5c98a3);else{const _0x3f0979=fs_1[a69_0x4752('0x6')][a69_0x4752('0x27')](_0x418871);const _0x3f3f7a=_0x3f0979['size'];if(_0x3f3f7a>0x0){fs_1[a69_0x4752('0x6')]['readFile'](_0x55040f,'utf8',function(_0x5c98a3,_0x48d475){if(_0x5c98a3){return console[a69_0x4752('0x18')](_0x5c98a3);}else{try{const _0x4684b0=JSON[a69_0x4752('0x2c')](_0x48d475);console[a69_0x4752('0xb')](_0x4684b0);const _0x2c80c2=_0x4684b0[a69_0x4752('0x3b')][0x0][a69_0x4752('0x3c')];const _0x31a7a2=_0x4684b0['eventos'][0x0][a69_0x4752('0x3d')];const _0x94860f=moment_1['default'](_0x2c80c2+'\x20'+_0x31a7a2+a69_0x4752('0x3e'),'YYYYMMDD\x20HHmmss\x20Z');const _0x512f22=parseFloat(_0x4684b0[a69_0x4752('0x3b')][0x0][a69_0x4752('0x3f')][a69_0x4752('0x40')](',','.'));const _0x3458bc=parseFloat(_0x4684b0[a69_0x4752('0x3b')][0x0][a69_0x4752('0x41')][a69_0x4752('0x40')](',','.'));const _0x3e7f16=_0x4684b0['eventos'][0x0][a69_0x4752('0x42')];const _0x17f5c7=_0x4684b0['eventos'][0x0][a69_0x4752('0x43')][0x0][a69_0x4752('0x44')];const _0x3cc712=_0x4684b0[a69_0x4752('0x3b')][0x0]['puerta'][0x0][a69_0x4752('0x45')];console[a69_0x4752('0xb')](_0x512f22);console['log'](_0x3458bc);console[a69_0x4752('0xb')](_0x3e7f16);console[a69_0x4752('0xb')](_0x17f5c7);console[a69_0x4752('0xb')](_0x3cc712);console[a69_0x4752('0xb')](_0x94860f);if(_0x17f5c7>0x0){sequelize_utils_1[a69_0x4752('0x6')][a69_0x4752('0x13')][a69_0x4752('0x31')][a69_0x4752('0x32')]({'amount':_0x17f5c7,'counted_at':_0x94860f});}sequelize_utils_1[a69_0x4752('0x6')][a69_0x4752('0x13')][a69_0x4752('0x46')]['create']({'device_id':null,'lat':''+_0x512f22,'lon':''+_0x3458bc,'tracked_at':_0x94860f});}catch(_0x284803){return console[a69_0x4752('0x18')](_0x284803);}}});}}});_0x2c6886['json']({'status':0x1,'data':_0xabb382[a69_0x4752('0x36')]});}}exports[a69_0x4752('0x6')]=SyncFilesController;