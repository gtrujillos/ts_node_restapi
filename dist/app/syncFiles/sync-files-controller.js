var a126_0x1a6a=['statSync','fileName:\x20','fileSizeInBytes:\x20','readFile','Data','CountingInfo','Out','parse','EndTime','passCountingsModel','create','uploadEvent','file','path','filename','.json','createGunzip','finish','utf8','eventos','hora','\x20-05:00','latitud','replace','velocidad','puerta','ingresos','salidas','__importDefault','__esModule','ftp','../../infrastructure/base-controller','moment','media','default','syncFtp','bind','downloadFtp','processFtp','log','ready','connected','list','name','endsWith','json','size','models','findOrCreate','spread','ftp.vivotek.com','ipd','syncFilesModel','findOne','then','connected:','file_name','get','colombia/','media/','pipe','createWriteStream','status','save','Downloaded:\x20','fileName','error','connect','.txt','existsSync'];(function(_0x80be61,_0xe58513){var _0x26c19e=function(_0x31f1b4){while(--_0x31f1b4){_0x80be61['push'](_0x80be61['shift']());}};_0x26c19e(++_0xe58513);}(a126_0x1a6a,0x1c0));var a126_0x5b1c=function(_0xafd813,_0x67367b){_0xafd813=_0xafd813-0x0;var _0x23e5cd=a126_0x1a6a[_0xafd813];return _0x23e5cd;};'use strict';var __importDefault=this&&this[a126_0x5b1c('0x0')]||function(_0x3c113a){return _0x3c113a&&_0x3c113a[a126_0x5b1c('0x1')]?_0x3c113a:{'default':_0x3c113a};};Object['defineProperty'](exports,a126_0x5b1c('0x1'),{'value':!![]});const ftp_1=__importDefault(require(a126_0x5b1c('0x2')));const fs_1=__importDefault(require('fs'));const base_controller_1=__importDefault(require(a126_0x5b1c('0x3')));const sequelize_utils_1=__importDefault(require('../../infrastructure/sequelize-utils'));const moment_1=__importDefault(require(a126_0x5b1c('0x4')));const UPLOAD_PATH=a126_0x5b1c('0x5');class SyncFilesController extends base_controller_1[a126_0x5b1c('0x6')]{constructor(_0x3b11fa){super(_0x3b11fa,null);this[a126_0x5b1c('0x7')]=this[a126_0x5b1c('0x7')][a126_0x5b1c('0x8')](this);this[a126_0x5b1c('0x9')]=this['downloadFtp'][a126_0x5b1c('0x8')](this);this['processFtp']=this[a126_0x5b1c('0xa')][a126_0x5b1c('0x8')](this);}[a126_0x5b1c('0x7')](_0x21583e,_0x34547d,_0xf5cac2){console[a126_0x5b1c('0xb')]('connecting');const _0x43cb43=[];const _0x2cd3a1=new ftp_1[(a126_0x5b1c('0x6'))]();_0x2cd3a1['on'](a126_0x5b1c('0xc'),function(){console[a126_0x5b1c('0xb')](a126_0x5b1c('0xd'));_0x2cd3a1[a126_0x5b1c('0xe')]('colombia',![],function(_0x570450,_0x3ae5ad){if(_0x570450){console[a126_0x5b1c('0xb')](_0x570450);}else{for(const _0x41ec78 of _0x3ae5ad){if(_0x41ec78[a126_0x5b1c('0xf')][a126_0x5b1c('0x10')](a126_0x5b1c('0x11'))&&_0x41ec78[a126_0x5b1c('0x12')]>0x0){sequelize_utils_1[a126_0x5b1c('0x6')][a126_0x5b1c('0x13')]['syncFilesModel'][a126_0x5b1c('0x14')]({'where':{'file_name':_0x41ec78[a126_0x5b1c('0xf')]}})[a126_0x5b1c('0x15')]((_0x52aada,_0x499131)=>{if(_0x499131){_0x43cb43['push'](_0x52aada);}});}}}});});_0x2cd3a1['on']('error',function(_0xbeb237){});_0x2cd3a1['connect']({'host':a126_0x5b1c('0x16'),'port':0x15,'user':a126_0x5b1c('0x17'),'password':a126_0x5b1c('0x17')});_0x34547d['json']({'data':[]});}[a126_0x5b1c('0x9')](_0x13cc22,_0xcffc1,_0x26e0cc){sequelize_utils_1['default'][a126_0x5b1c('0x13')][a126_0x5b1c('0x18')][a126_0x5b1c('0x19')]({'where':{'status':null}})[a126_0x5b1c('0x1a')](_0x20b849=>{if(_0x20b849){const _0x1173e5=new ftp_1[(a126_0x5b1c('0x6'))]();_0x1173e5['on'](a126_0x5b1c('0xc'),function(){console[a126_0x5b1c('0xb')](a126_0x5b1c('0x1b')+_0x20b849[a126_0x5b1c('0x1c')]);_0x1173e5[a126_0x5b1c('0x1d')](a126_0x5b1c('0x1e')+_0x20b849[a126_0x5b1c('0x1c')],function(_0x3fa832,_0x4f5e6c){_0x1173e5['end']();if(_0x3fa832){}else{const _0x47e602=a126_0x5b1c('0x1f')+_0x20b849[a126_0x5b1c('0x1c')]+'.txt';_0x4f5e6c[a126_0x5b1c('0x20')](fs_1[a126_0x5b1c('0x6')][a126_0x5b1c('0x21')](_0x47e602));_0x20b849[a126_0x5b1c('0x22')]=0x1;_0x20b849[a126_0x5b1c('0x23')]();console['log'](a126_0x5b1c('0x24')+_0x20b849[a126_0x5b1c('0x25')]);}});});_0x1173e5['on'](a126_0x5b1c('0x26'),function(_0x3f5fe8){});_0x1173e5[a126_0x5b1c('0x27')]({'host':a126_0x5b1c('0x16'),'port':0x15,'user':a126_0x5b1c('0x17'),'password':a126_0x5b1c('0x17')});}else{}});_0xcffc1[a126_0x5b1c('0x11')]({'data':[]});}['processFtp'](_0x2549e7,_0x450aaa,_0x1585de){sequelize_utils_1[a126_0x5b1c('0x6')][a126_0x5b1c('0x13')][a126_0x5b1c('0x18')][a126_0x5b1c('0x19')]({'where':{'status':0x1}})['then'](_0x303bb8=>{if(_0x303bb8){const _0x4d6be8=a126_0x5b1c('0x1f')+_0x303bb8[a126_0x5b1c('0x1c')]+a126_0x5b1c('0x28');if(fs_1['default'][a126_0x5b1c('0x29')](_0x4d6be8)){const _0xedb0cf=fs_1[a126_0x5b1c('0x6')][a126_0x5b1c('0x2a')](_0x4d6be8);const _0x2e6096=_0xedb0cf[a126_0x5b1c('0x12')];console[a126_0x5b1c('0xb')](a126_0x5b1c('0x2b')+_0x4d6be8);console['log'](a126_0x5b1c('0x2c')+_0x2e6096);if(_0x2e6096>0x0){fs_1[a126_0x5b1c('0x6')][a126_0x5b1c('0x2d')](_0x4d6be8,'utf8',function(_0x5edff7,_0x494b18){if(_0x5edff7){_0x303bb8[a126_0x5b1c('0x22')]=null;}else{try{const _0x20a8f4=JSON['parse'](_0x494b18);for(const _0x480e40 of _0x20a8f4[a126_0x5b1c('0x2e')][0x0][a126_0x5b1c('0x2f')]){const _0x1e9d04=_0x480e40['In'];const _0x52a350=_0x480e40[a126_0x5b1c('0x30')];const _0x59c76f=Date[a126_0x5b1c('0x31')](_0x480e40[a126_0x5b1c('0x32')]);if(_0x1e9d04>0x0){sequelize_utils_1[a126_0x5b1c('0x6')][a126_0x5b1c('0x13')][a126_0x5b1c('0x33')][a126_0x5b1c('0x34')]({'amount':_0x1e9d04,'counted_at':_0x59c76f});}if(_0x52a350>0x0){sequelize_utils_1[a126_0x5b1c('0x6')][a126_0x5b1c('0x13')][a126_0x5b1c('0x33')][a126_0x5b1c('0x34')]({'amount':_0x52a350*-0x1,'counted_at':_0x59c76f});}}_0x303bb8[a126_0x5b1c('0x22')]=0x2;}catch(_0x12a315){_0x303bb8[a126_0x5b1c('0x22')]=null;}}_0x303bb8[a126_0x5b1c('0x23')]();});}else{_0x303bb8[a126_0x5b1c('0x22')]=null;_0x303bb8[a126_0x5b1c('0x23')]();}}else{_0x303bb8[a126_0x5b1c('0x22')]=null;_0x303bb8[a126_0x5b1c('0x23')]();}}else{}});_0x450aaa[a126_0x5b1c('0x11')]({'data':[]});}[a126_0x5b1c('0x35')](_0x5d4e0e,_0xeefecc,_0x16bc7d){const _0x452a72=require('zlib');const _0x756752=_0x5d4e0e[a126_0x5b1c('0x36')][a126_0x5b1c('0x37')];const _0x3d70c0=UPLOAD_PATH+'/'+_0x5d4e0e[a126_0x5b1c('0x36')][a126_0x5b1c('0x38')]+a126_0x5b1c('0x39');const _0x5dede7=fs_1[a126_0x5b1c('0x6')]['createReadStream'](_0x756752);const _0x138658=fs_1[a126_0x5b1c('0x6')][a126_0x5b1c('0x21')](_0x3d70c0);const _0x1fd28e=_0x452a72[a126_0x5b1c('0x3a')]();console['log'](_0x5d4e0e[a126_0x5b1c('0x36')]);_0x5dede7[a126_0x5b1c('0x20')](_0x1fd28e)['pipe'](_0x138658)['on'](a126_0x5b1c('0x3b'),_0x2679fb=>{if(_0x2679fb)return console[a126_0x5b1c('0x26')](_0x2679fb);else{const _0x2b33dd=fs_1[a126_0x5b1c('0x6')]['statSync'](_0x756752);const _0x563e7b=_0x2b33dd[a126_0x5b1c('0x12')];if(_0x563e7b>0x0){fs_1[a126_0x5b1c('0x6')][a126_0x5b1c('0x2d')](_0x3d70c0,a126_0x5b1c('0x3c'),function(_0x2679fb,_0x4bd7a1){if(_0x2679fb){return console[a126_0x5b1c('0x26')](_0x2679fb);}else{try{const _0x2d7a16=JSON[a126_0x5b1c('0x31')](_0x4bd7a1);console['log'](_0x2d7a16);const _0x2e0775=_0x2d7a16[a126_0x5b1c('0x3d')][0x0]['fecha'];const _0x1a5883=_0x2d7a16['eventos'][0x0][a126_0x5b1c('0x3e')];const _0x17158e=moment_1[a126_0x5b1c('0x6')](_0x2e0775+'\x20'+_0x1a5883+a126_0x5b1c('0x3f'),'YYYYMMDD\x20HHmmss\x20Z');const _0x560482=parseFloat(_0x2d7a16[a126_0x5b1c('0x3d')][0x0][a126_0x5b1c('0x40')][a126_0x5b1c('0x41')](',','.'));const _0x29c381=parseFloat(_0x2d7a16[a126_0x5b1c('0x3d')][0x0]['longitud'][a126_0x5b1c('0x41')](',','.'));const _0x56bf7c=_0x2d7a16[a126_0x5b1c('0x3d')][0x0][a126_0x5b1c('0x42')];const _0x273c50=_0x2d7a16['eventos'][0x0][a126_0x5b1c('0x43')][0x0][a126_0x5b1c('0x44')];const _0x1eea94=_0x2d7a16[a126_0x5b1c('0x3d')][0x0][a126_0x5b1c('0x43')][0x0][a126_0x5b1c('0x45')];console[a126_0x5b1c('0xb')](_0x560482);console['log'](_0x29c381);console['log'](_0x56bf7c);console[a126_0x5b1c('0xb')](_0x273c50);console['log'](_0x1eea94);console['log'](_0x17158e);if(_0x273c50>0x0){sequelize_utils_1[a126_0x5b1c('0x6')][a126_0x5b1c('0x13')][a126_0x5b1c('0x33')]['create']({'amount':_0x273c50,'counted_at':_0x17158e});}sequelize_utils_1['default']['models']['locationPointsModel'][a126_0x5b1c('0x34')]({'device_id':null,'lat':''+_0x560482,'lon':''+_0x29c381,'tracked_at':_0x17158e});}catch(_0x4a2fcc){return console[a126_0x5b1c('0x26')](_0x4a2fcc);}}});}}});_0xeefecc['json']({'status':0x1,'data':_0x5d4e0e[a126_0x5b1c('0x36')]});}}exports[a126_0x5b1c('0x6')]=SyncFilesController;