var a69_0x5b68=['json','syncFilesModel','connected:','get','colombia/','file_name','.txt','pipe','createWriteStream','status','Downloaded:\x20','fileName','findOne','then','media/','existsSync','statSync','fileName:\x20','fileSizeInBytes:\x20','utf8','parse','Data','CountingInfo','passCountingsModel','save','uploadEvent','zlib','file','path','filename','.json','createGunzip','finish','size','readFile','eventos','hora','YYYYMMDD\x20HHmmss\x20Z','replace','longitud','velocidad','ingresos','puerta','create','__importDefault','__esModule','defineProperty','ftp','../../infrastructure/controller-utils','../../infrastructure/sequelize-utils','moment','syncFtp','bind','downloadFtp','processFtp','log','connecting','default','ready','list','name','endsWith','models','spread','push','error','connect','ftp.vivotek.com','ipd'];(function(_0x3da48a,_0x148add){var _0x3e98e3=function(_0x45f742){while(--_0x45f742){_0x3da48a['push'](_0x3da48a['shift']());}};_0x3e98e3(++_0x148add);}(a69_0x5b68,0x140));var a69_0x12a3=function(_0x2d83b8,_0x377411){_0x2d83b8=_0x2d83b8-0x0;var _0x41fc3a=a69_0x5b68[_0x2d83b8];return _0x41fc3a;};'use strict';var __importDefault=this&&this[a69_0x12a3('0x0')]||function(_0x2f53bd){return _0x2f53bd&&_0x2f53bd[a69_0x12a3('0x1')]?_0x2f53bd:{'default':_0x2f53bd};};Object[a69_0x12a3('0x2')](exports,a69_0x12a3('0x1'),{'value':!![]});const ftp_1=__importDefault(require(a69_0x12a3('0x3')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a69_0x12a3('0x4')));const sequelize_utils_1=__importDefault(require(a69_0x12a3('0x5')));const moment_1=__importDefault(require(a69_0x12a3('0x6')));const UPLOAD_PATH='media';class SyncFilesController extends controller_utils_1['default']{constructor(_0x4f2b65){super(_0x4f2b65,null);this[a69_0x12a3('0x7')]=this[a69_0x12a3('0x7')][a69_0x12a3('0x8')](this);this['downloadFtp']=this[a69_0x12a3('0x9')][a69_0x12a3('0x8')](this);this['processFtp']=this[a69_0x12a3('0xa')][a69_0x12a3('0x8')](this);}[a69_0x12a3('0x7')](_0x351f8b,_0x1e90fb,_0x43dfa0){console[a69_0x12a3('0xb')](a69_0x12a3('0xc'));const _0x51b01b=[];const _0x4d6a85=new ftp_1[(a69_0x12a3('0xd'))]();_0x4d6a85['on'](a69_0x12a3('0xe'),function(){console[a69_0x12a3('0xb')]('connected');_0x4d6a85[a69_0x12a3('0xf')]('colombia',![],function(_0x3be0a1,_0xe8381f){if(_0x3be0a1){console[a69_0x12a3('0xb')](_0x3be0a1);}else{for(const _0x4ee984 of _0xe8381f){if(_0x4ee984[a69_0x12a3('0x10')][a69_0x12a3('0x11')]('json')&&_0x4ee984['size']>0x0){sequelize_utils_1['default'][a69_0x12a3('0x12')]['syncFilesModel']['findOrCreate']({'where':{'file_name':_0x4ee984[a69_0x12a3('0x10')]}})[a69_0x12a3('0x13')]((_0x475615,_0x538a8f)=>{if(_0x538a8f){_0x51b01b[a69_0x12a3('0x14')](_0x475615);}});}}}});});_0x4d6a85['on'](a69_0x12a3('0x15'),function(_0x4cae19){});_0x4d6a85[a69_0x12a3('0x16')]({'host':a69_0x12a3('0x17'),'port':0x15,'user':a69_0x12a3('0x18'),'password':a69_0x12a3('0x18')});_0x1e90fb[a69_0x12a3('0x19')]({'data':[]});}['downloadFtp'](_0x667698,_0x20a61b,_0x34c6cb){sequelize_utils_1[a69_0x12a3('0xd')][a69_0x12a3('0x12')][a69_0x12a3('0x1a')]['findOne']({'where':{'status':null}})['then'](_0x359f27=>{if(_0x359f27){const _0x537b7f=new ftp_1[(a69_0x12a3('0xd'))]();_0x537b7f['on']('ready',function(){console[a69_0x12a3('0xb')](a69_0x12a3('0x1b')+_0x359f27['file_name']);_0x537b7f[a69_0x12a3('0x1c')](a69_0x12a3('0x1d')+_0x359f27[a69_0x12a3('0x1e')],function(_0x302808,_0x3d8751){_0x537b7f['end']();if(_0x302808){}else{const _0x430981='media/'+_0x359f27[a69_0x12a3('0x1e')]+a69_0x12a3('0x1f');_0x3d8751[a69_0x12a3('0x20')](fs_1['default'][a69_0x12a3('0x21')](_0x430981));_0x359f27[a69_0x12a3('0x22')]=0x1;_0x359f27['save']();console[a69_0x12a3('0xb')](a69_0x12a3('0x23')+_0x359f27[a69_0x12a3('0x24')]);}});});_0x537b7f['on'](a69_0x12a3('0x15'),function(_0x173bec){});_0x537b7f['connect']({'host':a69_0x12a3('0x17'),'port':0x15,'user':'ipd','password':a69_0x12a3('0x18')});}else{}});_0x20a61b[a69_0x12a3('0x19')]({'data':[]});}['processFtp'](_0x1981f5,_0x1d5288,_0x80a3b2){sequelize_utils_1[a69_0x12a3('0xd')][a69_0x12a3('0x12')][a69_0x12a3('0x1a')][a69_0x12a3('0x25')]({'where':{'status':0x1}})[a69_0x12a3('0x26')](_0x22969c=>{if(_0x22969c){const _0xeb2a9b=a69_0x12a3('0x27')+_0x22969c[a69_0x12a3('0x1e')]+a69_0x12a3('0x1f');if(fs_1[a69_0x12a3('0xd')][a69_0x12a3('0x28')](_0xeb2a9b)){const _0x1632f0=fs_1['default'][a69_0x12a3('0x29')](_0xeb2a9b);const _0x2e14b5=_0x1632f0['size'];console[a69_0x12a3('0xb')](a69_0x12a3('0x2a')+_0xeb2a9b);console['log'](a69_0x12a3('0x2b')+_0x2e14b5);if(_0x2e14b5>0x0){fs_1[a69_0x12a3('0xd')]['readFile'](_0xeb2a9b,a69_0x12a3('0x2c'),function(_0xc376dc,_0xb8800f){if(_0xc376dc){_0x22969c[a69_0x12a3('0x22')]=null;}else{try{const _0x26ac34=JSON[a69_0x12a3('0x2d')](_0xb8800f);for(const _0x3fcc14 of _0x26ac34[a69_0x12a3('0x2e')][0x0][a69_0x12a3('0x2f')]){const _0x5d4290=_0x3fcc14['In'];const _0x4d4ae4=_0x3fcc14['Out'];const _0x10589a=Date['parse'](_0x3fcc14['EndTime']);if(_0x5d4290>0x0){sequelize_utils_1['default']['models'][a69_0x12a3('0x30')]['create']({'amount':_0x5d4290,'counted_at':_0x10589a});}if(_0x4d4ae4>0x0){sequelize_utils_1[a69_0x12a3('0xd')][a69_0x12a3('0x12')][a69_0x12a3('0x30')]['create']({'amount':_0x4d4ae4*-0x1,'counted_at':_0x10589a});}}_0x22969c[a69_0x12a3('0x22')]=0x2;}catch(_0x5e43d1){_0x22969c[a69_0x12a3('0x22')]=null;}}_0x22969c[a69_0x12a3('0x31')]();});}else{_0x22969c['status']=null;_0x22969c[a69_0x12a3('0x31')]();}}else{_0x22969c[a69_0x12a3('0x22')]=null;_0x22969c[a69_0x12a3('0x31')]();}}else{}});_0x1d5288[a69_0x12a3('0x19')]({'data':[]});}[a69_0x12a3('0x32')](_0x378cd4,_0x455db6,_0x36fe3e){const _0x50aaf4=require(a69_0x12a3('0x33'));const _0x1b71f2=_0x378cd4[a69_0x12a3('0x34')][a69_0x12a3('0x35')];const _0x5168ec=UPLOAD_PATH+'/'+_0x378cd4[a69_0x12a3('0x34')][a69_0x12a3('0x36')]+a69_0x12a3('0x37');const _0x4e1463=fs_1[a69_0x12a3('0xd')]['createReadStream'](_0x1b71f2);const _0x4a619b=fs_1[a69_0x12a3('0xd')][a69_0x12a3('0x21')](_0x5168ec);const _0x55d1e0=_0x50aaf4[a69_0x12a3('0x38')]();console[a69_0x12a3('0xb')](_0x378cd4[a69_0x12a3('0x34')]);_0x4e1463[a69_0x12a3('0x20')](_0x55d1e0)['pipe'](_0x4a619b)['on'](a69_0x12a3('0x39'),_0x2a5ead=>{if(_0x2a5ead)return console['error'](_0x2a5ead);else{const _0x28b62b=fs_1[a69_0x12a3('0xd')][a69_0x12a3('0x29')](_0x1b71f2);const _0x15c2de=_0x28b62b[a69_0x12a3('0x3a')];if(_0x15c2de>0x0){fs_1[a69_0x12a3('0xd')][a69_0x12a3('0x3b')](_0x5168ec,'utf8',function(_0x2a5ead,_0x4375f8){if(_0x2a5ead){return console[a69_0x12a3('0x15')](_0x2a5ead);}else{try{const _0x317a05=JSON['parse'](_0x4375f8);console[a69_0x12a3('0xb')](_0x317a05);const _0x4e541b=_0x317a05[a69_0x12a3('0x3c')][0x0]['fecha'];const _0x329e7d=_0x317a05[a69_0x12a3('0x3c')][0x0][a69_0x12a3('0x3d')];const _0x5cc37d=moment_1[a69_0x12a3('0xd')](_0x4e541b+'\x20'+_0x329e7d+'\x20-05:00',a69_0x12a3('0x3e'));const _0x1c57ab=parseFloat(_0x317a05[a69_0x12a3('0x3c')][0x0]['latitud'][a69_0x12a3('0x3f')](',','.'));const _0x5a546d=parseFloat(_0x317a05[a69_0x12a3('0x3c')][0x0][a69_0x12a3('0x40')][a69_0x12a3('0x3f')](',','.'));const _0x1364e3=_0x317a05['eventos'][0x0][a69_0x12a3('0x41')];const _0x92089e=_0x317a05[a69_0x12a3('0x3c')][0x0]['puerta'][0x0][a69_0x12a3('0x42')];const _0x5cb30e=_0x317a05[a69_0x12a3('0x3c')][0x0][a69_0x12a3('0x43')][0x0]['salidas'];console[a69_0x12a3('0xb')](_0x1c57ab);console[a69_0x12a3('0xb')](_0x5a546d);console[a69_0x12a3('0xb')](_0x1364e3);console[a69_0x12a3('0xb')](_0x92089e);console[a69_0x12a3('0xb')](_0x5cb30e);console[a69_0x12a3('0xb')](_0x5cc37d);if(_0x92089e>0x0){sequelize_utils_1[a69_0x12a3('0xd')][a69_0x12a3('0x12')][a69_0x12a3('0x30')][a69_0x12a3('0x44')]({'amount':_0x92089e,'counted_at':_0x5cc37d});}sequelize_utils_1['default'][a69_0x12a3('0x12')]['locationPointsModel'][a69_0x12a3('0x44')]({'device_id':null,'lat':''+_0x1c57ab,'lon':''+_0x5a546d,'tracked_at':_0x5cc37d});}catch(_0x52741b){return console['error'](_0x52741b);}}});}}});_0x455db6[a69_0x12a3('0x19')]({'status':0x1,'data':_0x378cd4['file']});}}exports['default']=SyncFilesController;