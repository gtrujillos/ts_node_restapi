var a73_0x5d85=['utf8','parse','Data','CountingInfo','Out','EndTime','passCountingsModel','create','zlib','path','file','.json','createReadStream','createGunzip','pipe','finish','fecha','\x20-05:00','YYYYMMDD\x20HHmmss\x20Z','eventos','latitud','replace','longitud','velocidad','puerta','salidas','__importDefault','__esModule','defineProperty','ftp','../../infrastructure/controller-utils','moment','media','default','syncFtp','bind','downloadFtp','processFtp','log','connecting','ready','connected','list','colombia','name','endsWith','json','size','models','syncFilesModel','findOrCreate','spread','error','connect','ftp.vivotek.com','ipd','findOne','then','connected:','colombia/','file_name','end','.txt','createWriteStream','status','save','Downloaded:\x20','fileName','media/','existsSync','statSync','fileName:\x20','fileSizeInBytes:\x20','readFile'];(function(_0x1b704c,_0x4e395f){var _0x3a93c7=function(_0x58b09b){while(--_0x58b09b){_0x1b704c['push'](_0x1b704c['shift']());}};_0x3a93c7(++_0x4e395f);}(a73_0x5d85,0x1d6));var a73_0x13df=function(_0xabf242,_0x489bf8){_0xabf242=_0xabf242-0x0;var _0x3d651c=a73_0x5d85[_0xabf242];return _0x3d651c;};'use strict';var __importDefault=this&&this[a73_0x13df('0x0')]||function(_0xa82263){return _0xa82263&&_0xa82263[a73_0x13df('0x1')]?_0xa82263:{'default':_0xa82263};};Object[a73_0x13df('0x2')](exports,a73_0x13df('0x1'),{'value':!![]});const ftp_1=__importDefault(require(a73_0x13df('0x3')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a73_0x13df('0x4')));const sequelize_utils_1=__importDefault(require('../../infrastructure/sequelize-utils'));const moment_1=__importDefault(require(a73_0x13df('0x5')));const UPLOAD_PATH=a73_0x13df('0x6');class SyncFilesController extends controller_utils_1[a73_0x13df('0x7')]{constructor(_0x28edd0){super(_0x28edd0,null);this[a73_0x13df('0x8')]=this[a73_0x13df('0x8')][a73_0x13df('0x9')](this);this[a73_0x13df('0xa')]=this['downloadFtp']['bind'](this);this[a73_0x13df('0xb')]=this[a73_0x13df('0xb')][a73_0x13df('0x9')](this);}['syncFtp'](_0x41ace0,_0x685062,_0x3efd52){console[a73_0x13df('0xc')](a73_0x13df('0xd'));const _0x1a514e=[];const _0x332830=new ftp_1[(a73_0x13df('0x7'))]();_0x332830['on'](a73_0x13df('0xe'),function(){console[a73_0x13df('0xc')](a73_0x13df('0xf'));_0x332830[a73_0x13df('0x10')](a73_0x13df('0x11'),![],function(_0x101b15,_0x4eaf78){if(_0x101b15){console[a73_0x13df('0xc')](_0x101b15);}else{for(const _0xce87a9 of _0x4eaf78){if(_0xce87a9[a73_0x13df('0x12')][a73_0x13df('0x13')](a73_0x13df('0x14'))&&_0xce87a9[a73_0x13df('0x15')]>0x0){sequelize_utils_1[a73_0x13df('0x7')][a73_0x13df('0x16')][a73_0x13df('0x17')][a73_0x13df('0x18')]({'where':{'file_name':_0xce87a9[a73_0x13df('0x12')]}})[a73_0x13df('0x19')]((_0x15634a,_0x12e1dd)=>{if(_0x12e1dd){_0x1a514e['push'](_0x15634a);}});}}}});});_0x332830['on'](a73_0x13df('0x1a'),function(_0x34ea29){});_0x332830[a73_0x13df('0x1b')]({'host':a73_0x13df('0x1c'),'port':0x15,'user':a73_0x13df('0x1d'),'password':a73_0x13df('0x1d')});_0x685062['json']({'data':[]});}['downloadFtp'](_0x19dfa4,_0x417683,_0x36d494){sequelize_utils_1[a73_0x13df('0x7')][a73_0x13df('0x16')][a73_0x13df('0x17')][a73_0x13df('0x1e')]({'where':{'status':null}})[a73_0x13df('0x1f')](_0x3c8bee=>{if(_0x3c8bee){const _0x46068f=new ftp_1[(a73_0x13df('0x7'))]();_0x46068f['on']('ready',function(){console[a73_0x13df('0xc')](a73_0x13df('0x20')+_0x3c8bee['file_name']);_0x46068f['get'](a73_0x13df('0x21')+_0x3c8bee[a73_0x13df('0x22')],function(_0xd85f33,_0x4953f7){_0x46068f[a73_0x13df('0x23')]();if(_0xd85f33){}else{const _0xe1ec3='media/'+_0x3c8bee[a73_0x13df('0x22')]+a73_0x13df('0x24');_0x4953f7['pipe'](fs_1[a73_0x13df('0x7')][a73_0x13df('0x25')](_0xe1ec3));_0x3c8bee[a73_0x13df('0x26')]=0x1;_0x3c8bee[a73_0x13df('0x27')]();console[a73_0x13df('0xc')](a73_0x13df('0x28')+_0x3c8bee[a73_0x13df('0x29')]);}});});_0x46068f['on'](a73_0x13df('0x1a'),function(_0x37e96e){});_0x46068f[a73_0x13df('0x1b')]({'host':a73_0x13df('0x1c'),'port':0x15,'user':'ipd','password':'ipd'});}else{}});_0x417683[a73_0x13df('0x14')]({'data':[]});}['processFtp'](_0x5b4050,_0x1d098d,_0x5a5a02){sequelize_utils_1['default'][a73_0x13df('0x16')][a73_0x13df('0x17')]['findOne']({'where':{'status':0x1}})['then'](_0xc7845a=>{if(_0xc7845a){const _0x59d31a=a73_0x13df('0x2a')+_0xc7845a[a73_0x13df('0x22')]+a73_0x13df('0x24');if(fs_1[a73_0x13df('0x7')][a73_0x13df('0x2b')](_0x59d31a)){const _0x4915a6=fs_1[a73_0x13df('0x7')][a73_0x13df('0x2c')](_0x59d31a);const _0x118b7b=_0x4915a6['size'];console[a73_0x13df('0xc')](a73_0x13df('0x2d')+_0x59d31a);console[a73_0x13df('0xc')](a73_0x13df('0x2e')+_0x118b7b);if(_0x118b7b>0x0){fs_1['default'][a73_0x13df('0x2f')](_0x59d31a,a73_0x13df('0x30'),function(_0xc4dea,_0x44cc13){if(_0xc4dea){_0xc7845a['status']=null;}else{try{const _0x44a420=JSON[a73_0x13df('0x31')](_0x44cc13);for(const _0x4c8d07 of _0x44a420[a73_0x13df('0x32')][0x0][a73_0x13df('0x33')]){const _0x1dc6fe=_0x4c8d07['In'];const _0x389d58=_0x4c8d07[a73_0x13df('0x34')];const _0x135383=Date[a73_0x13df('0x31')](_0x4c8d07[a73_0x13df('0x35')]);if(_0x1dc6fe>0x0){sequelize_utils_1[a73_0x13df('0x7')][a73_0x13df('0x16')][a73_0x13df('0x36')][a73_0x13df('0x37')]({'amount':_0x1dc6fe,'counted_at':_0x135383});}if(_0x389d58>0x0){sequelize_utils_1['default'][a73_0x13df('0x16')]['passCountingsModel'][a73_0x13df('0x37')]({'amount':_0x389d58*-0x1,'counted_at':_0x135383});}}_0xc7845a['status']=0x2;}catch(_0x425cbb){_0xc7845a[a73_0x13df('0x26')]=null;}}_0xc7845a[a73_0x13df('0x27')]();});}else{_0xc7845a[a73_0x13df('0x26')]=null;_0xc7845a['save']();}}else{_0xc7845a['status']=null;_0xc7845a[a73_0x13df('0x27')]();}}else{}});_0x1d098d[a73_0x13df('0x14')]({'data':[]});}['uploadEvent'](_0x4ab459,_0x491560,_0x2c33b2){const _0x764791=require(a73_0x13df('0x38'));const _0x58c0fc=_0x4ab459['file'][a73_0x13df('0x39')];const _0x9bf239=UPLOAD_PATH+'/'+_0x4ab459[a73_0x13df('0x3a')]['filename']+a73_0x13df('0x3b');const _0x2ed54e=fs_1[a73_0x13df('0x7')][a73_0x13df('0x3c')](_0x58c0fc);const _0x598f2a=fs_1[a73_0x13df('0x7')]['createWriteStream'](_0x9bf239);const _0x41c6e8=_0x764791[a73_0x13df('0x3d')]();console['log'](_0x4ab459[a73_0x13df('0x3a')]);_0x2ed54e[a73_0x13df('0x3e')](_0x41c6e8)[a73_0x13df('0x3e')](_0x598f2a)['on'](a73_0x13df('0x3f'),_0x9334fc=>{if(_0x9334fc)return console[a73_0x13df('0x1a')](_0x9334fc);else{const _0x55f813=fs_1[a73_0x13df('0x7')]['statSync'](_0x58c0fc);const _0x388520=_0x55f813[a73_0x13df('0x15')];if(_0x388520>0x0){fs_1[a73_0x13df('0x7')][a73_0x13df('0x2f')](_0x9bf239,a73_0x13df('0x30'),function(_0x9334fc,_0x375ce1){if(_0x9334fc){return console[a73_0x13df('0x1a')](_0x9334fc);}else{try{const _0x4b96b5=JSON[a73_0x13df('0x31')](_0x375ce1);console['log'](_0x4b96b5);const _0x13dd25=_0x4b96b5['eventos'][0x0][a73_0x13df('0x40')];const _0x1ec582=_0x4b96b5['eventos'][0x0]['hora'];const _0x420253=moment_1['default'](_0x13dd25+'\x20'+_0x1ec582+a73_0x13df('0x41'),a73_0x13df('0x42'));const _0x2b6f77=parseFloat(_0x4b96b5[a73_0x13df('0x43')][0x0][a73_0x13df('0x44')][a73_0x13df('0x45')](',','.'));const _0x290610=parseFloat(_0x4b96b5[a73_0x13df('0x43')][0x0][a73_0x13df('0x46')]['replace'](',','.'));const _0x3b9468=_0x4b96b5[a73_0x13df('0x43')][0x0][a73_0x13df('0x47')];const _0x98a0cb=_0x4b96b5[a73_0x13df('0x43')][0x0][a73_0x13df('0x48')][0x0]['ingresos'];const _0x1e8b56=_0x4b96b5[a73_0x13df('0x43')][0x0]['puerta'][0x0][a73_0x13df('0x49')];console['log'](_0x2b6f77);console['log'](_0x290610);console['log'](_0x3b9468);console[a73_0x13df('0xc')](_0x98a0cb);console[a73_0x13df('0xc')](_0x1e8b56);console[a73_0x13df('0xc')](_0x420253);if(_0x98a0cb>0x0){sequelize_utils_1['default'][a73_0x13df('0x16')][a73_0x13df('0x36')][a73_0x13df('0x37')]({'amount':_0x98a0cb,'counted_at':_0x420253});}sequelize_utils_1[a73_0x13df('0x7')][a73_0x13df('0x16')]['locationPointsModel'][a73_0x13df('0x37')]({'device_id':null,'lat':''+_0x2b6f77,'lon':''+_0x290610,'tracked_at':_0x420253});}catch(_0x551da5){return console[a73_0x13df('0x1a')](_0x551da5);}}});}}});_0x491560['json']({'status':0x1,'data':_0x4ab459[a73_0x13df('0x3a')]});}}exports[a73_0x13df('0x7')]=SyncFilesController;