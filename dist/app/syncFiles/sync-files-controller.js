var a162_0x6c81=['findOrCreate','spread','push','error','connect','ftp.vivotek.com','ipd','json','findOne','then','connected:','file_name','get','colombia/','end','media/','.txt','pipe','createWriteStream','status','save','Downloaded:\x20','syncFilesModel','existsSync','fileName:\x20','fileSizeInBytes:\x20','readFile','parse','Data','EndTime','passCountingsModel','create','uploadEvent','zlib','file','path','filename','.json','createReadStream','finish','statSync','utf8','eventos','hora','\x20-05:00','YYYYMMDD\x20HHmmss\x20Z','latitud','replace','longitud','puerta','ingresos','defineProperty','__esModule','ftp','../../infrastructure/controller-utils','../../infrastructure/sequelize-utils','media','default','syncFtp','downloadFtp','bind','processFtp','log','connecting','connected','colombia','name','endsWith','size','models'];(function(_0x440a2f,_0x1b5c60){var _0x17ef0a=function(_0x5cba43){while(--_0x5cba43){_0x440a2f['push'](_0x440a2f['shift']());}};_0x17ef0a(++_0x1b5c60);}(a162_0x6c81,0x191));var a162_0x2cf4=function(_0x49058f,_0x40b00d){_0x49058f=_0x49058f-0x0;var _0x19ab83=a162_0x6c81[_0x49058f];return _0x19ab83;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x2427fb){return _0x2427fb&&_0x2427fb['__esModule']?_0x2427fb:{'default':_0x2427fb};};Object[a162_0x2cf4('0x0')](exports,a162_0x2cf4('0x1'),{'value':!![]});const ftp_1=__importDefault(require(a162_0x2cf4('0x2')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a162_0x2cf4('0x3')));const sequelize_utils_1=__importDefault(require(a162_0x2cf4('0x4')));const moment_1=__importDefault(require('moment'));const UPLOAD_PATH=a162_0x2cf4('0x5');class SyncFilesController extends controller_utils_1[a162_0x2cf4('0x6')]{constructor(_0x378345){super(_0x378345,null);this[a162_0x2cf4('0x7')]=this[a162_0x2cf4('0x7')]['bind'](this);this[a162_0x2cf4('0x8')]=this[a162_0x2cf4('0x8')][a162_0x2cf4('0x9')](this);this[a162_0x2cf4('0xa')]=this[a162_0x2cf4('0xa')][a162_0x2cf4('0x9')](this);}[a162_0x2cf4('0x7')](_0xdaa2eb,_0x4a26e8,_0x2ee359){console[a162_0x2cf4('0xb')](a162_0x2cf4('0xc'));const _0x1a61d0=[];const _0x3a29ca=new ftp_1['default']();_0x3a29ca['on']('ready',function(){console['log'](a162_0x2cf4('0xd'));_0x3a29ca['list'](a162_0x2cf4('0xe'),![],function(_0x3b1205,_0x9e983){if(_0x3b1205){console[a162_0x2cf4('0xb')](_0x3b1205);}else{for(const _0x31b286 of _0x9e983){if(_0x31b286[a162_0x2cf4('0xf')][a162_0x2cf4('0x10')]('json')&&_0x31b286[a162_0x2cf4('0x11')]>0x0){sequelize_utils_1[a162_0x2cf4('0x6')][a162_0x2cf4('0x12')]['syncFilesModel'][a162_0x2cf4('0x13')]({'where':{'file_name':_0x31b286[a162_0x2cf4('0xf')]}})[a162_0x2cf4('0x14')]((_0x42c23a,_0x5bde71)=>{if(_0x5bde71){_0x1a61d0[a162_0x2cf4('0x15')](_0x42c23a);}});}}}});});_0x3a29ca['on'](a162_0x2cf4('0x16'),function(_0x42abca){});_0x3a29ca[a162_0x2cf4('0x17')]({'host':a162_0x2cf4('0x18'),'port':0x15,'user':a162_0x2cf4('0x19'),'password':'ipd'});_0x4a26e8[a162_0x2cf4('0x1a')]({'data':[]});}[a162_0x2cf4('0x8')](_0x3000de,_0x4eff5c,_0x24bdf3){sequelize_utils_1[a162_0x2cf4('0x6')][a162_0x2cf4('0x12')]['syncFilesModel'][a162_0x2cf4('0x1b')]({'where':{'status':null}})[a162_0x2cf4('0x1c')](_0x171795=>{if(_0x171795){const _0x4642d0=new ftp_1[(a162_0x2cf4('0x6'))]();_0x4642d0['on']('ready',function(){console[a162_0x2cf4('0xb')](a162_0x2cf4('0x1d')+_0x171795[a162_0x2cf4('0x1e')]);_0x4642d0[a162_0x2cf4('0x1f')](a162_0x2cf4('0x20')+_0x171795[a162_0x2cf4('0x1e')],function(_0x2411de,_0x122552){_0x4642d0[a162_0x2cf4('0x21')]();if(_0x2411de){}else{const _0x2874f7=a162_0x2cf4('0x22')+_0x171795['file_name']+a162_0x2cf4('0x23');_0x122552[a162_0x2cf4('0x24')](fs_1[a162_0x2cf4('0x6')][a162_0x2cf4('0x25')](_0x2874f7));_0x171795[a162_0x2cf4('0x26')]=0x1;_0x171795[a162_0x2cf4('0x27')]();console[a162_0x2cf4('0xb')](a162_0x2cf4('0x28')+_0x171795['fileName']);}});});_0x4642d0['on'](a162_0x2cf4('0x16'),function(_0x5a2e7b){});_0x4642d0[a162_0x2cf4('0x17')]({'host':a162_0x2cf4('0x18'),'port':0x15,'user':'ipd','password':a162_0x2cf4('0x19')});}else{}});_0x4eff5c[a162_0x2cf4('0x1a')]({'data':[]});}[a162_0x2cf4('0xa')](_0x38fdb1,_0x494838,_0x3ce5a7){sequelize_utils_1[a162_0x2cf4('0x6')][a162_0x2cf4('0x12')][a162_0x2cf4('0x29')][a162_0x2cf4('0x1b')]({'where':{'status':0x1}})[a162_0x2cf4('0x1c')](_0x553ecb=>{if(_0x553ecb){const _0x54213b=a162_0x2cf4('0x22')+_0x553ecb[a162_0x2cf4('0x1e')]+a162_0x2cf4('0x23');if(fs_1[a162_0x2cf4('0x6')][a162_0x2cf4('0x2a')](_0x54213b)){const _0x1708cb=fs_1[a162_0x2cf4('0x6')]['statSync'](_0x54213b);const _0x5df3a9=_0x1708cb[a162_0x2cf4('0x11')];console['log'](a162_0x2cf4('0x2b')+_0x54213b);console[a162_0x2cf4('0xb')](a162_0x2cf4('0x2c')+_0x5df3a9);if(_0x5df3a9>0x0){fs_1[a162_0x2cf4('0x6')][a162_0x2cf4('0x2d')](_0x54213b,'utf8',function(_0x32be77,_0x43edfb){if(_0x32be77){_0x553ecb[a162_0x2cf4('0x26')]=null;}else{try{const _0x2bcaad=JSON[a162_0x2cf4('0x2e')](_0x43edfb);for(const _0x462333 of _0x2bcaad[a162_0x2cf4('0x2f')][0x0]['CountingInfo']){const _0x3daea8=_0x462333['In'];const _0x42ae97=_0x462333['Out'];const _0x5bf25a=Date[a162_0x2cf4('0x2e')](_0x462333[a162_0x2cf4('0x30')]);if(_0x3daea8>0x0){sequelize_utils_1['default'][a162_0x2cf4('0x12')][a162_0x2cf4('0x31')][a162_0x2cf4('0x32')]({'amount':_0x3daea8,'counted_at':_0x5bf25a});}if(_0x42ae97>0x0){sequelize_utils_1['default'][a162_0x2cf4('0x12')][a162_0x2cf4('0x31')][a162_0x2cf4('0x32')]({'amount':_0x42ae97*-0x1,'counted_at':_0x5bf25a});}}_0x553ecb['status']=0x2;}catch(_0x5c9706){_0x553ecb['status']=null;}}_0x553ecb[a162_0x2cf4('0x27')]();});}else{_0x553ecb[a162_0x2cf4('0x26')]=null;_0x553ecb[a162_0x2cf4('0x27')]();}}else{_0x553ecb[a162_0x2cf4('0x26')]=null;_0x553ecb[a162_0x2cf4('0x27')]();}}else{}});_0x494838['json']({'data':[]});}[a162_0x2cf4('0x33')](_0x22b11a,_0x1557ad,_0xa67542){const _0x5bad07=require(a162_0x2cf4('0x34'));const _0x147564=_0x22b11a[a162_0x2cf4('0x35')][a162_0x2cf4('0x36')];const _0x485778=UPLOAD_PATH+'/'+_0x22b11a[a162_0x2cf4('0x35')][a162_0x2cf4('0x37')]+a162_0x2cf4('0x38');const _0x2b6ef4=fs_1[a162_0x2cf4('0x6')][a162_0x2cf4('0x39')](_0x147564);const _0x5aad1e=fs_1[a162_0x2cf4('0x6')][a162_0x2cf4('0x25')](_0x485778);const _0x502c8b=_0x5bad07['createGunzip']();console['log'](_0x22b11a['file']);_0x2b6ef4[a162_0x2cf4('0x24')](_0x502c8b)[a162_0x2cf4('0x24')](_0x5aad1e)['on'](a162_0x2cf4('0x3a'),_0xde100e=>{if(_0xde100e)return console[a162_0x2cf4('0x16')](_0xde100e);else{const _0x5bc735=fs_1[a162_0x2cf4('0x6')][a162_0x2cf4('0x3b')](_0x147564);const _0x23aa32=_0x5bc735['size'];if(_0x23aa32>0x0){fs_1[a162_0x2cf4('0x6')][a162_0x2cf4('0x2d')](_0x485778,a162_0x2cf4('0x3c'),function(_0xde100e,_0x3e342a){if(_0xde100e){return console[a162_0x2cf4('0x16')](_0xde100e);}else{try{const _0x569362=JSON[a162_0x2cf4('0x2e')](_0x3e342a);console['log'](_0x569362);const _0x3d9dee=_0x569362['eventos'][0x0]['fecha'];const _0x2608e7=_0x569362[a162_0x2cf4('0x3d')][0x0][a162_0x2cf4('0x3e')];const _0x5c40f2=moment_1['default'](_0x3d9dee+'\x20'+_0x2608e7+a162_0x2cf4('0x3f'),a162_0x2cf4('0x40'));const _0xd9eb86=parseFloat(_0x569362[a162_0x2cf4('0x3d')][0x0][a162_0x2cf4('0x41')][a162_0x2cf4('0x42')](',','.'));const _0x5eee40=parseFloat(_0x569362['eventos'][0x0][a162_0x2cf4('0x43')][a162_0x2cf4('0x42')](',','.'));const _0x371838=_0x569362[a162_0x2cf4('0x3d')][0x0]['velocidad'];const _0xb1b2f9=_0x569362[a162_0x2cf4('0x3d')][0x0][a162_0x2cf4('0x44')][0x0][a162_0x2cf4('0x45')];const _0x249bd0=_0x569362[a162_0x2cf4('0x3d')][0x0][a162_0x2cf4('0x44')][0x0]['salidas'];console['log'](_0xd9eb86);console['log'](_0x5eee40);console[a162_0x2cf4('0xb')](_0x371838);console[a162_0x2cf4('0xb')](_0xb1b2f9);console[a162_0x2cf4('0xb')](_0x249bd0);console[a162_0x2cf4('0xb')](_0x5c40f2);if(_0xb1b2f9>0x0){sequelize_utils_1[a162_0x2cf4('0x6')]['models'][a162_0x2cf4('0x31')][a162_0x2cf4('0x32')]({'amount':_0xb1b2f9,'counted_at':_0x5c40f2});}sequelize_utils_1[a162_0x2cf4('0x6')][a162_0x2cf4('0x12')]['locationPointsModel'][a162_0x2cf4('0x32')]({'device_id':null,'lat':''+_0xd9eb86,'lon':''+_0x5eee40,'tracked_at':_0x5c40f2});}catch(_0x302f67){return console[a162_0x2cf4('0x16')](_0x302f67);}}});}}});_0x1557ad[a162_0x2cf4('0x1a')]({'status':0x1,'data':_0x22b11a[a162_0x2cf4('0x35')]});}}exports[a162_0x2cf4('0x6')]=SyncFilesController;