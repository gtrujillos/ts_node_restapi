var a73_0x7af3=['utf8','status','parse','Data','CountingInfo','Out','EndTime','passCountingsModel','create','uploadEvent','zlib','file','path','filename','.json','size','fecha','eventos','hora','\x20-05:00','YYYYMMDD\x20HHmmss\x20Z','latitud','replace','longitud','velocidad','ingresos','puerta','salidas','locationPointsModel','__importDefault','__esModule','defineProperty','../../infrastructure/controller-utils','../../infrastructure/sequelize-utils','moment','media','default','syncFtp','downloadFtp','bind','processFtp','log','connecting','ready','connected','list','endsWith','json','models','syncFilesModel','name','spread','push','error','ftp.vivotek.com','ipd','then','file_name','get','colombia/','media/','.txt','pipe','createWriteStream','save','Downloaded:\x20','connect','findOne','existsSync','statSync','fileName:\x20','fileSizeInBytes:\x20','readFile'];(function(_0x700e90,_0x146cda){var _0x43d112=function(_0x2197b8){while(--_0x2197b8){_0x700e90['push'](_0x700e90['shift']());}};_0x43d112(++_0x146cda);}(a73_0x7af3,0xf8));var a73_0x3626=function(_0x386937,_0x229014){_0x386937=_0x386937-0x0;var _0x899f36=a73_0x7af3[_0x386937];return _0x899f36;};'use strict';var __importDefault=this&&this[a73_0x3626('0x0')]||function(_0x2d4f3b){return _0x2d4f3b&&_0x2d4f3b[a73_0x3626('0x1')]?_0x2d4f3b:{'default':_0x2d4f3b};};Object[a73_0x3626('0x2')](exports,a73_0x3626('0x1'),{'value':!![]});const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a73_0x3626('0x3')));const sequelize_utils_1=__importDefault(require(a73_0x3626('0x4')));const moment_1=__importDefault(require(a73_0x3626('0x5')));const UPLOAD_PATH=a73_0x3626('0x6');class SyncFilesController extends controller_utils_1[a73_0x3626('0x7')]{constructor(_0x12db40){super(_0x12db40,null);this[a73_0x3626('0x8')]=this[a73_0x3626('0x8')]['bind'](this);this[a73_0x3626('0x9')]=this[a73_0x3626('0x9')][a73_0x3626('0xa')](this);this[a73_0x3626('0xb')]=this[a73_0x3626('0xb')][a73_0x3626('0xa')](this);}[a73_0x3626('0x8')](_0x521e9e,_0x4a8c06,_0x17b1e8){console[a73_0x3626('0xc')](a73_0x3626('0xd'));const _0x36b8e7=[];const _0x216ea2=new ftp_1[(a73_0x3626('0x7'))]();_0x216ea2['on'](a73_0x3626('0xe'),function(){console[a73_0x3626('0xc')](a73_0x3626('0xf'));_0x216ea2[a73_0x3626('0x10')]('colombia',![],function(_0x30dcc8,_0x3a554c){if(_0x30dcc8){console[a73_0x3626('0xc')](_0x30dcc8);}else{for(const _0x10cc2a of _0x3a554c){if(_0x10cc2a['name'][a73_0x3626('0x11')](a73_0x3626('0x12'))&&_0x10cc2a['size']>0x0){sequelize_utils_1[a73_0x3626('0x7')][a73_0x3626('0x13')][a73_0x3626('0x14')]['findOrCreate']({'where':{'file_name':_0x10cc2a[a73_0x3626('0x15')]}})[a73_0x3626('0x16')]((_0x1cb06e,_0x10f306)=>{if(_0x10f306){_0x36b8e7[a73_0x3626('0x17')](_0x1cb06e);}});}}}});});_0x216ea2['on'](a73_0x3626('0x18'),function(_0x11093d){});_0x216ea2['connect']({'host':a73_0x3626('0x19'),'port':0x15,'user':'ipd','password':a73_0x3626('0x1a')});_0x4a8c06['json']({'data':[]});}[a73_0x3626('0x9')](_0x1fbb2d,_0x25e309,_0x27399e){sequelize_utils_1['default'][a73_0x3626('0x13')]['syncFilesModel']['findOne']({'where':{'status':null}})[a73_0x3626('0x1b')](_0x1f2385=>{if(_0x1f2385){const _0x1f3d59=new ftp_1[(a73_0x3626('0x7'))]();_0x1f3d59['on'](a73_0x3626('0xe'),function(){console[a73_0x3626('0xc')]('connected:'+_0x1f2385[a73_0x3626('0x1c')]);_0x1f3d59[a73_0x3626('0x1d')](a73_0x3626('0x1e')+_0x1f2385[a73_0x3626('0x1c')],function(_0x5559de,_0x397286){_0x1f3d59['end']();if(_0x5559de){}else{const _0x501194=a73_0x3626('0x1f')+_0x1f2385[a73_0x3626('0x1c')]+a73_0x3626('0x20');_0x397286[a73_0x3626('0x21')](fs_1['default'][a73_0x3626('0x22')](_0x501194));_0x1f2385['status']=0x1;_0x1f2385[a73_0x3626('0x23')]();console[a73_0x3626('0xc')](a73_0x3626('0x24')+_0x1f2385['fileName']);}});});_0x1f3d59['on'](a73_0x3626('0x18'),function(_0x1871dd){});_0x1f3d59[a73_0x3626('0x25')]({'host':a73_0x3626('0x19'),'port':0x15,'user':a73_0x3626('0x1a'),'password':a73_0x3626('0x1a')});}else{}});_0x25e309[a73_0x3626('0x12')]({'data':[]});}[a73_0x3626('0xb')](_0x404ce6,_0x1f7e8a,_0x5bc1f8){sequelize_utils_1[a73_0x3626('0x7')][a73_0x3626('0x13')][a73_0x3626('0x14')][a73_0x3626('0x26')]({'where':{'status':0x1}})['then'](_0x58dca2=>{if(_0x58dca2){const _0x3dff29=a73_0x3626('0x1f')+_0x58dca2[a73_0x3626('0x1c')]+a73_0x3626('0x20');if(fs_1[a73_0x3626('0x7')][a73_0x3626('0x27')](_0x3dff29)){const _0x17973b=fs_1[a73_0x3626('0x7')][a73_0x3626('0x28')](_0x3dff29);const _0x541065=_0x17973b['size'];console['log'](a73_0x3626('0x29')+_0x3dff29);console['log'](a73_0x3626('0x2a')+_0x541065);if(_0x541065>0x0){fs_1[a73_0x3626('0x7')][a73_0x3626('0x2b')](_0x3dff29,a73_0x3626('0x2c'),function(_0x39e38f,_0x32c9fc){if(_0x39e38f){_0x58dca2[a73_0x3626('0x2d')]=null;}else{try{const _0x31a2e1=JSON[a73_0x3626('0x2e')](_0x32c9fc);for(const _0x579a28 of _0x31a2e1[a73_0x3626('0x2f')][0x0][a73_0x3626('0x30')]){const _0x57eba1=_0x579a28['In'];const _0xb0b9c0=_0x579a28[a73_0x3626('0x31')];const _0x4c50e0=Date['parse'](_0x579a28[a73_0x3626('0x32')]);if(_0x57eba1>0x0){sequelize_utils_1[a73_0x3626('0x7')]['models'][a73_0x3626('0x33')][a73_0x3626('0x34')]({'amount':_0x57eba1,'counted_at':_0x4c50e0});}if(_0xb0b9c0>0x0){sequelize_utils_1[a73_0x3626('0x7')][a73_0x3626('0x13')][a73_0x3626('0x33')]['create']({'amount':_0xb0b9c0*-0x1,'counted_at':_0x4c50e0});}}_0x58dca2[a73_0x3626('0x2d')]=0x2;}catch(_0xa9a80b){_0x58dca2[a73_0x3626('0x2d')]=null;}}_0x58dca2['save']();});}else{_0x58dca2['status']=null;_0x58dca2[a73_0x3626('0x23')]();}}else{_0x58dca2[a73_0x3626('0x2d')]=null;_0x58dca2[a73_0x3626('0x23')]();}}else{}});_0x1f7e8a['json']({'data':[]});}[a73_0x3626('0x35')](_0x265f91,_0x2ac8ed,_0x34414b){const _0x1a7d6a=require(a73_0x3626('0x36'));const _0x3abf2c=_0x265f91[a73_0x3626('0x37')][a73_0x3626('0x38')];const _0x39af0b=UPLOAD_PATH+'/'+_0x265f91[a73_0x3626('0x37')][a73_0x3626('0x39')]+a73_0x3626('0x3a');const _0x20d7ae=fs_1[a73_0x3626('0x7')]['createReadStream'](_0x3abf2c);const _0x43b144=fs_1[a73_0x3626('0x7')]['createWriteStream'](_0x39af0b);const _0xe593ca=_0x1a7d6a['createGunzip']();console[a73_0x3626('0xc')](_0x265f91[a73_0x3626('0x37')]);_0x20d7ae[a73_0x3626('0x21')](_0xe593ca)[a73_0x3626('0x21')](_0x43b144)['on']('finish',_0x3b1982=>{if(_0x3b1982)return console['error'](_0x3b1982);else{const _0x59f1a2=fs_1[a73_0x3626('0x7')]['statSync'](_0x3abf2c);const _0x46641c=_0x59f1a2[a73_0x3626('0x3b')];if(_0x46641c>0x0){fs_1[a73_0x3626('0x7')]['readFile'](_0x39af0b,a73_0x3626('0x2c'),function(_0x3b1982,_0x368b5c){if(_0x3b1982){return console[a73_0x3626('0x18')](_0x3b1982);}else{try{const _0x3dfa0e=JSON[a73_0x3626('0x2e')](_0x368b5c);console[a73_0x3626('0xc')](_0x3dfa0e);const _0x44ebe7=_0x3dfa0e['eventos'][0x0][a73_0x3626('0x3c')];const _0xdd2227=_0x3dfa0e[a73_0x3626('0x3d')][0x0][a73_0x3626('0x3e')];const _0x491b2e=moment_1[a73_0x3626('0x7')](_0x44ebe7+'\x20'+_0xdd2227+a73_0x3626('0x3f'),a73_0x3626('0x40'));const _0x27d7b6=parseFloat(_0x3dfa0e[a73_0x3626('0x3d')][0x0][a73_0x3626('0x41')][a73_0x3626('0x42')](',','.'));const _0x5dd80a=parseFloat(_0x3dfa0e[a73_0x3626('0x3d')][0x0][a73_0x3626('0x43')][a73_0x3626('0x42')](',','.'));const _0x167559=_0x3dfa0e[a73_0x3626('0x3d')][0x0][a73_0x3626('0x44')];const _0xfdf206=_0x3dfa0e[a73_0x3626('0x3d')][0x0]['puerta'][0x0][a73_0x3626('0x45')];const _0xafcb23=_0x3dfa0e[a73_0x3626('0x3d')][0x0][a73_0x3626('0x46')][0x0][a73_0x3626('0x47')];console['log'](_0x27d7b6);console['log'](_0x5dd80a);console[a73_0x3626('0xc')](_0x167559);console[a73_0x3626('0xc')](_0xfdf206);console['log'](_0xafcb23);console['log'](_0x491b2e);if(_0xfdf206>0x0){sequelize_utils_1[a73_0x3626('0x7')][a73_0x3626('0x13')][a73_0x3626('0x33')][a73_0x3626('0x34')]({'amount':_0xfdf206,'counted_at':_0x491b2e});}sequelize_utils_1['default']['models'][a73_0x3626('0x48')][a73_0x3626('0x34')]({'device_id':null,'lat':''+_0x27d7b6,'lon':''+_0x5dd80a,'tracked_at':_0x491b2e});}catch(_0x2419c1){return console[a73_0x3626('0x18')](_0x2419c1);}}});}}});_0x2ac8ed[a73_0x3626('0x12')]({'status':0x1,'data':_0x265f91[a73_0x3626('0x37')]});}}exports[a73_0x3626('0x7')]=SyncFilesController;