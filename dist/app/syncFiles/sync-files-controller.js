var a73_0x4dd7=['path','filename','.json','createGunzip','finish','error','utf8','eventos','fecha','hora','\x20-05:00','YYYYMMDD\x20HHmmss\x20Z','latitud','replace','velocidad','puerta','ingresos','salidas','locationPointsModel','__importDefault','__esModule','defineProperty','ftp','media','syncFtp','bind','downloadFtp','processFtp','log','connecting','default','ready','connected','endsWith','json','size','models','syncFilesModel','findOrCreate','name','spread','connect','ftp.vivotek.com','ipd','findOne','then','connected:','colombia/','file_name','end','.txt','pipe','createWriteStream','status','save','Downloaded:\x20','fileName','media/','existsSync','statSync','fileSizeInBytes:\x20','readFile','parse','Data','CountingInfo','passCountingsModel','create','zlib','file'];(function(_0x27f8a6,_0x5ae075){var _0x205107=function(_0x5cb155){while(--_0x5cb155){_0x27f8a6['push'](_0x27f8a6['shift']());}};_0x205107(++_0x5ae075);}(a73_0x4dd7,0x1b1));var a73_0x11d1=function(_0x330ad6,_0x53cde6){_0x330ad6=_0x330ad6-0x0;var _0x1a3621=a73_0x4dd7[_0x330ad6];return _0x1a3621;};'use strict';var __importDefault=this&&this[a73_0x11d1('0x0')]||function(_0x976d78){return _0x976d78&&_0x976d78[a73_0x11d1('0x1')]?_0x976d78:{'default':_0x976d78};};Object[a73_0x11d1('0x2')](exports,a73_0x11d1('0x1'),{'value':!![]});const ftp_1=__importDefault(require(a73_0x11d1('0x3')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require('../../infrastructure/controller-utils'));const sequelize_utils_1=__importDefault(require('../../infrastructure/sequelize-utils'));const moment_1=__importDefault(require('moment'));const UPLOAD_PATH=a73_0x11d1('0x4');class SyncFilesController extends controller_utils_1['default']{constructor(_0x2e3d85){super(_0x2e3d85,null);this[a73_0x11d1('0x5')]=this[a73_0x11d1('0x5')][a73_0x11d1('0x6')](this);this[a73_0x11d1('0x7')]=this[a73_0x11d1('0x7')][a73_0x11d1('0x6')](this);this['processFtp']=this[a73_0x11d1('0x8')][a73_0x11d1('0x6')](this);}[a73_0x11d1('0x5')](_0x3153bd,_0x8b8d31,_0x3fb489){console[a73_0x11d1('0x9')](a73_0x11d1('0xa'));const _0x38befb=[];const _0x4406eb=new ftp_1[(a73_0x11d1('0xb'))]();_0x4406eb['on'](a73_0x11d1('0xc'),function(){console[a73_0x11d1('0x9')](a73_0x11d1('0xd'));_0x4406eb['list']('colombia',![],function(_0x2267be,_0x40e8b4){if(_0x2267be){console['log'](_0x2267be);}else{for(const _0x24f3a3 of _0x40e8b4){if(_0x24f3a3['name'][a73_0x11d1('0xe')](a73_0x11d1('0xf'))&&_0x24f3a3[a73_0x11d1('0x10')]>0x0){sequelize_utils_1[a73_0x11d1('0xb')][a73_0x11d1('0x11')][a73_0x11d1('0x12')][a73_0x11d1('0x13')]({'where':{'file_name':_0x24f3a3[a73_0x11d1('0x14')]}})[a73_0x11d1('0x15')]((_0x24fbc0,_0x575767)=>{if(_0x575767){_0x38befb['push'](_0x24fbc0);}});}}}});});_0x4406eb['on']('error',function(_0x2bb8ce){});_0x4406eb[a73_0x11d1('0x16')]({'host':a73_0x11d1('0x17'),'port':0x15,'user':a73_0x11d1('0x18'),'password':a73_0x11d1('0x18')});_0x8b8d31[a73_0x11d1('0xf')]({'data':[]});}['downloadFtp'](_0x5d26a0,_0x507d93,_0x21507d){sequelize_utils_1[a73_0x11d1('0xb')][a73_0x11d1('0x11')][a73_0x11d1('0x12')][a73_0x11d1('0x19')]({'where':{'status':null}})[a73_0x11d1('0x1a')](_0x5da8b2=>{if(_0x5da8b2){const _0x404852=new ftp_1[(a73_0x11d1('0xb'))]();_0x404852['on']('ready',function(){console[a73_0x11d1('0x9')](a73_0x11d1('0x1b')+_0x5da8b2['file_name']);_0x404852['get'](a73_0x11d1('0x1c')+_0x5da8b2[a73_0x11d1('0x1d')],function(_0x1f8461,_0x24cbde){_0x404852[a73_0x11d1('0x1e')]();if(_0x1f8461){}else{const _0x54f154='media/'+_0x5da8b2[a73_0x11d1('0x1d')]+a73_0x11d1('0x1f');_0x24cbde[a73_0x11d1('0x20')](fs_1['default'][a73_0x11d1('0x21')](_0x54f154));_0x5da8b2[a73_0x11d1('0x22')]=0x1;_0x5da8b2[a73_0x11d1('0x23')]();console[a73_0x11d1('0x9')](a73_0x11d1('0x24')+_0x5da8b2[a73_0x11d1('0x25')]);}});});_0x404852['on']('error',function(_0x33f9dd){});_0x404852[a73_0x11d1('0x16')]({'host':a73_0x11d1('0x17'),'port':0x15,'user':'ipd','password':'ipd'});}else{}});_0x507d93[a73_0x11d1('0xf')]({'data':[]});}[a73_0x11d1('0x8')](_0x58cd5e,_0x33cc3f,_0xc3a14f){sequelize_utils_1[a73_0x11d1('0xb')]['models'][a73_0x11d1('0x12')][a73_0x11d1('0x19')]({'where':{'status':0x1}})[a73_0x11d1('0x1a')](_0x1901c0=>{if(_0x1901c0){const _0x21bfc3=a73_0x11d1('0x26')+_0x1901c0[a73_0x11d1('0x1d')]+a73_0x11d1('0x1f');if(fs_1['default'][a73_0x11d1('0x27')](_0x21bfc3)){const _0x3f3baf=fs_1[a73_0x11d1('0xb')][a73_0x11d1('0x28')](_0x21bfc3);const _0x112cf7=_0x3f3baf[a73_0x11d1('0x10')];console['log']('fileName:\x20'+_0x21bfc3);console[a73_0x11d1('0x9')](a73_0x11d1('0x29')+_0x112cf7);if(_0x112cf7>0x0){fs_1[a73_0x11d1('0xb')][a73_0x11d1('0x2a')](_0x21bfc3,'utf8',function(_0x1b052d,_0x948ef0){if(_0x1b052d){_0x1901c0['status']=null;}else{try{const _0x1a2171=JSON[a73_0x11d1('0x2b')](_0x948ef0);for(const _0x2961e9 of _0x1a2171[a73_0x11d1('0x2c')][0x0][a73_0x11d1('0x2d')]){const _0x29ab35=_0x2961e9['In'];const _0x50630a=_0x2961e9['Out'];const _0x28fe54=Date[a73_0x11d1('0x2b')](_0x2961e9['EndTime']);if(_0x29ab35>0x0){sequelize_utils_1['default']['models'][a73_0x11d1('0x2e')][a73_0x11d1('0x2f')]({'amount':_0x29ab35,'counted_at':_0x28fe54});}if(_0x50630a>0x0){sequelize_utils_1[a73_0x11d1('0xb')][a73_0x11d1('0x11')][a73_0x11d1('0x2e')][a73_0x11d1('0x2f')]({'amount':_0x50630a*-0x1,'counted_at':_0x28fe54});}}_0x1901c0[a73_0x11d1('0x22')]=0x2;}catch(_0x2256e3){_0x1901c0[a73_0x11d1('0x22')]=null;}}_0x1901c0[a73_0x11d1('0x23')]();});}else{_0x1901c0[a73_0x11d1('0x22')]=null;_0x1901c0[a73_0x11d1('0x23')]();}}else{_0x1901c0[a73_0x11d1('0x22')]=null;_0x1901c0[a73_0x11d1('0x23')]();}}else{}});_0x33cc3f[a73_0x11d1('0xf')]({'data':[]});}['uploadEvent'](_0x271834,_0x550814,_0x36ab4b){const _0x54ce40=require(a73_0x11d1('0x30'));const _0x16f320=_0x271834[a73_0x11d1('0x31')][a73_0x11d1('0x32')];const _0x2825f2=UPLOAD_PATH+'/'+_0x271834[a73_0x11d1('0x31')][a73_0x11d1('0x33')]+a73_0x11d1('0x34');const _0x30fe5f=fs_1[a73_0x11d1('0xb')]['createReadStream'](_0x16f320);const _0x51f521=fs_1[a73_0x11d1('0xb')][a73_0x11d1('0x21')](_0x2825f2);const _0x13223e=_0x54ce40[a73_0x11d1('0x35')]();console[a73_0x11d1('0x9')](_0x271834[a73_0x11d1('0x31')]);_0x30fe5f[a73_0x11d1('0x20')](_0x13223e)[a73_0x11d1('0x20')](_0x51f521)['on'](a73_0x11d1('0x36'),_0x387a4c=>{if(_0x387a4c)return console[a73_0x11d1('0x37')](_0x387a4c);else{const _0x58aae1=fs_1[a73_0x11d1('0xb')][a73_0x11d1('0x28')](_0x16f320);const _0x899c0b=_0x58aae1[a73_0x11d1('0x10')];if(_0x899c0b>0x0){fs_1[a73_0x11d1('0xb')]['readFile'](_0x2825f2,a73_0x11d1('0x38'),function(_0x387a4c,_0x4d6a0b){if(_0x387a4c){return console[a73_0x11d1('0x37')](_0x387a4c);}else{try{const _0x31e262=JSON[a73_0x11d1('0x2b')](_0x4d6a0b);console['log'](_0x31e262);const _0x1ca0aa=_0x31e262[a73_0x11d1('0x39')][0x0][a73_0x11d1('0x3a')];const _0x14dd26=_0x31e262[a73_0x11d1('0x39')][0x0][a73_0x11d1('0x3b')];const _0x379580=moment_1[a73_0x11d1('0xb')](_0x1ca0aa+'\x20'+_0x14dd26+a73_0x11d1('0x3c'),a73_0x11d1('0x3d'));const _0xbd975f=parseFloat(_0x31e262[a73_0x11d1('0x39')][0x0][a73_0x11d1('0x3e')][a73_0x11d1('0x3f')](',','.'));const _0x1d91b5=parseFloat(_0x31e262[a73_0x11d1('0x39')][0x0]['longitud'][a73_0x11d1('0x3f')](',','.'));const _0x2b40e5=_0x31e262[a73_0x11d1('0x39')][0x0][a73_0x11d1('0x40')];const _0x312d57=_0x31e262[a73_0x11d1('0x39')][0x0][a73_0x11d1('0x41')][0x0][a73_0x11d1('0x42')];const _0x29c40c=_0x31e262['eventos'][0x0][a73_0x11d1('0x41')][0x0][a73_0x11d1('0x43')];console[a73_0x11d1('0x9')](_0xbd975f);console[a73_0x11d1('0x9')](_0x1d91b5);console[a73_0x11d1('0x9')](_0x2b40e5);console[a73_0x11d1('0x9')](_0x312d57);console[a73_0x11d1('0x9')](_0x29c40c);console[a73_0x11d1('0x9')](_0x379580);if(_0x312d57>0x0){sequelize_utils_1[a73_0x11d1('0xb')][a73_0x11d1('0x11')]['passCountingsModel']['create']({'amount':_0x312d57,'counted_at':_0x379580});}sequelize_utils_1['default']['models'][a73_0x11d1('0x44')]['create']({'device_id':null,'lat':''+_0xbd975f,'lon':''+_0x1d91b5,'tracked_at':_0x379580});}catch(_0x18ef66){return console['error'](_0x18ef66);}}});}}});_0x550814[a73_0x11d1('0xf')]({'status':0x1,'data':_0x271834['file']});}}exports['default']=SyncFilesController;