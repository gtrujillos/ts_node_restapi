var a162_0x2f43=['existsSync','statSync','fileName:\x20','fileSizeInBytes:\x20','readFile','utf8','parse','CountingInfo','Out','passCountingsModel','create','uploadEvent','zlib','file','.json','createWriteStream','createGunzip','eventos','hora','\x20-05:00','YYYYMMDD\x20HHmmss\x20Z','replace','longitud','ingresos','puerta','locationPointsModel','__importDefault','__esModule','defineProperty','ftp','media','default','syncFtp','bind','downloadFtp','processFtp','log','connecting','ready','connected','list','colombia','name','size','models','syncFilesModel','findOrCreate','spread','push','error','connect','ftp.vivotek.com','json','findOne','connected:','file_name','colombia/','end','media/','.txt','pipe','status','save','Downloaded:\x20','fileName','ipd','then'];(function(_0x58c3f9,_0x16044b){var _0x21e2f1=function(_0xefebc){while(--_0xefebc){_0x58c3f9['push'](_0x58c3f9['shift']());}};_0x21e2f1(++_0x16044b);}(a162_0x2f43,0xe3));var a162_0x509c=function(_0xda9002,_0x4a3e10){_0xda9002=_0xda9002-0x0;var _0x1936bd=a162_0x2f43[_0xda9002];return _0x1936bd;};'use strict';var __importDefault=this&&this[a162_0x509c('0x0')]||function(_0x19b59c){return _0x19b59c&&_0x19b59c[a162_0x509c('0x1')]?_0x19b59c:{'default':_0x19b59c};};Object[a162_0x509c('0x2')](exports,a162_0x509c('0x1'),{'value':!![]});const ftp_1=__importDefault(require(a162_0x509c('0x3')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require('../../infrastructure/controller-utils'));const sequelize_utils_1=__importDefault(require('../../infrastructure/sequelize-utils'));const moment_1=__importDefault(require('moment'));const UPLOAD_PATH=a162_0x509c('0x4');class SyncFilesController extends controller_utils_1[a162_0x509c('0x5')]{constructor(_0x20f6f0){super(_0x20f6f0,null);this[a162_0x509c('0x6')]=this[a162_0x509c('0x6')][a162_0x509c('0x7')](this);this[a162_0x509c('0x8')]=this['downloadFtp']['bind'](this);this[a162_0x509c('0x9')]=this[a162_0x509c('0x9')]['bind'](this);}[a162_0x509c('0x6')](_0xa258e9,_0x591373,_0x5c1600){console[a162_0x509c('0xa')](a162_0x509c('0xb'));const _0x2bc924=[];const _0x5aa843=new ftp_1[(a162_0x509c('0x5'))]();_0x5aa843['on'](a162_0x509c('0xc'),function(){console[a162_0x509c('0xa')](a162_0x509c('0xd'));_0x5aa843[a162_0x509c('0xe')](a162_0x509c('0xf'),![],function(_0x510165,_0x2a697d){if(_0x510165){console[a162_0x509c('0xa')](_0x510165);}else{for(const _0x495fba of _0x2a697d){if(_0x495fba[a162_0x509c('0x10')]['endsWith']('json')&&_0x495fba[a162_0x509c('0x11')]>0x0){sequelize_utils_1[a162_0x509c('0x5')][a162_0x509c('0x12')][a162_0x509c('0x13')][a162_0x509c('0x14')]({'where':{'file_name':_0x495fba['name']}})[a162_0x509c('0x15')]((_0x2fa299,_0x1181f7)=>{if(_0x1181f7){_0x2bc924[a162_0x509c('0x16')](_0x2fa299);}});}}}});});_0x5aa843['on'](a162_0x509c('0x17'),function(_0x43fd85){});_0x5aa843[a162_0x509c('0x18')]({'host':a162_0x509c('0x19'),'port':0x15,'user':'ipd','password':'ipd'});_0x591373[a162_0x509c('0x1a')]({'data':[]});}[a162_0x509c('0x8')](_0x501c8f,_0xffd58e,_0x46c346){sequelize_utils_1['default'][a162_0x509c('0x12')]['syncFilesModel'][a162_0x509c('0x1b')]({'where':{'status':null}})['then'](_0x27e59c=>{if(_0x27e59c){const _0x1250ec=new ftp_1[(a162_0x509c('0x5'))]();_0x1250ec['on'](a162_0x509c('0xc'),function(){console[a162_0x509c('0xa')](a162_0x509c('0x1c')+_0x27e59c[a162_0x509c('0x1d')]);_0x1250ec['get'](a162_0x509c('0x1e')+_0x27e59c['file_name'],function(_0x4c336f,_0x1470f0){_0x1250ec[a162_0x509c('0x1f')]();if(_0x4c336f){}else{const _0x520d22=a162_0x509c('0x20')+_0x27e59c[a162_0x509c('0x1d')]+a162_0x509c('0x21');_0x1470f0[a162_0x509c('0x22')](fs_1['default']['createWriteStream'](_0x520d22));_0x27e59c[a162_0x509c('0x23')]=0x1;_0x27e59c[a162_0x509c('0x24')]();console[a162_0x509c('0xa')](a162_0x509c('0x25')+_0x27e59c[a162_0x509c('0x26')]);}});});_0x1250ec['on'](a162_0x509c('0x17'),function(_0x5966a9){});_0x1250ec[a162_0x509c('0x18')]({'host':a162_0x509c('0x19'),'port':0x15,'user':a162_0x509c('0x27'),'password':a162_0x509c('0x27')});}else{}});_0xffd58e['json']({'data':[]});}[a162_0x509c('0x9')](_0x5ba6bb,_0x3912fc,_0x1eac50){sequelize_utils_1[a162_0x509c('0x5')][a162_0x509c('0x12')][a162_0x509c('0x13')][a162_0x509c('0x1b')]({'where':{'status':0x1}})[a162_0x509c('0x28')](_0x3c2702=>{if(_0x3c2702){const _0x62193c=a162_0x509c('0x20')+_0x3c2702['file_name']+a162_0x509c('0x21');if(fs_1[a162_0x509c('0x5')][a162_0x509c('0x29')](_0x62193c)){const _0x195c45=fs_1['default'][a162_0x509c('0x2a')](_0x62193c);const _0x372f97=_0x195c45[a162_0x509c('0x11')];console[a162_0x509c('0xa')](a162_0x509c('0x2b')+_0x62193c);console[a162_0x509c('0xa')](a162_0x509c('0x2c')+_0x372f97);if(_0x372f97>0x0){fs_1[a162_0x509c('0x5')][a162_0x509c('0x2d')](_0x62193c,a162_0x509c('0x2e'),function(_0x5d505c,_0x56c1ae){if(_0x5d505c){_0x3c2702['status']=null;}else{try{const _0x2038fb=JSON[a162_0x509c('0x2f')](_0x56c1ae);for(const _0x4dca9c of _0x2038fb['Data'][0x0][a162_0x509c('0x30')]){const _0x5ba83f=_0x4dca9c['In'];const _0x138b07=_0x4dca9c[a162_0x509c('0x31')];const _0x193679=Date[a162_0x509c('0x2f')](_0x4dca9c['EndTime']);if(_0x5ba83f>0x0){sequelize_utils_1[a162_0x509c('0x5')]['models'][a162_0x509c('0x32')][a162_0x509c('0x33')]({'amount':_0x5ba83f,'counted_at':_0x193679});}if(_0x138b07>0x0){sequelize_utils_1[a162_0x509c('0x5')][a162_0x509c('0x12')][a162_0x509c('0x32')]['create']({'amount':_0x138b07*-0x1,'counted_at':_0x193679});}}_0x3c2702[a162_0x509c('0x23')]=0x2;}catch(_0x37fc3a){_0x3c2702[a162_0x509c('0x23')]=null;}}_0x3c2702[a162_0x509c('0x24')]();});}else{_0x3c2702[a162_0x509c('0x23')]=null;_0x3c2702['save']();}}else{_0x3c2702[a162_0x509c('0x23')]=null;_0x3c2702[a162_0x509c('0x24')]();}}else{}});_0x3912fc[a162_0x509c('0x1a')]({'data':[]});}[a162_0x509c('0x34')](_0x26c203,_0x8b2e1a,_0xc31cdf){const _0x3e5dc5=require(a162_0x509c('0x35'));const _0x1f7d26=_0x26c203[a162_0x509c('0x36')]['path'];const _0x112a3b=UPLOAD_PATH+'/'+_0x26c203[a162_0x509c('0x36')]['filename']+a162_0x509c('0x37');const _0x117982=fs_1[a162_0x509c('0x5')]['createReadStream'](_0x1f7d26);const _0xb615da=fs_1[a162_0x509c('0x5')][a162_0x509c('0x38')](_0x112a3b);const _0x3e3b0e=_0x3e5dc5[a162_0x509c('0x39')]();console[a162_0x509c('0xa')](_0x26c203[a162_0x509c('0x36')]);_0x117982[a162_0x509c('0x22')](_0x3e3b0e)[a162_0x509c('0x22')](_0xb615da)['on']('finish',_0x196ae5=>{if(_0x196ae5)return console[a162_0x509c('0x17')](_0x196ae5);else{const _0x30bec5=fs_1['default'][a162_0x509c('0x2a')](_0x1f7d26);const _0x262826=_0x30bec5[a162_0x509c('0x11')];if(_0x262826>0x0){fs_1[a162_0x509c('0x5')][a162_0x509c('0x2d')](_0x112a3b,a162_0x509c('0x2e'),function(_0x196ae5,_0x1c7074){if(_0x196ae5){return console[a162_0x509c('0x17')](_0x196ae5);}else{try{const _0xe71826=JSON[a162_0x509c('0x2f')](_0x1c7074);console[a162_0x509c('0xa')](_0xe71826);const _0x5d9da4=_0xe71826[a162_0x509c('0x3a')][0x0]['fecha'];const _0x2af7e9=_0xe71826[a162_0x509c('0x3a')][0x0][a162_0x509c('0x3b')];const _0x3ce50d=moment_1['default'](_0x5d9da4+'\x20'+_0x2af7e9+a162_0x509c('0x3c'),a162_0x509c('0x3d'));const _0xb3d1cb=parseFloat(_0xe71826[a162_0x509c('0x3a')][0x0]['latitud'][a162_0x509c('0x3e')](',','.'));const _0x3940ff=parseFloat(_0xe71826['eventos'][0x0][a162_0x509c('0x3f')]['replace'](',','.'));const _0x95be0a=_0xe71826[a162_0x509c('0x3a')][0x0]['velocidad'];const _0x4ded1f=_0xe71826[a162_0x509c('0x3a')][0x0]['puerta'][0x0][a162_0x509c('0x40')];const _0x838c1=_0xe71826[a162_0x509c('0x3a')][0x0][a162_0x509c('0x41')][0x0]['salidas'];console[a162_0x509c('0xa')](_0xb3d1cb);console['log'](_0x3940ff);console[a162_0x509c('0xa')](_0x95be0a);console[a162_0x509c('0xa')](_0x4ded1f);console['log'](_0x838c1);console[a162_0x509c('0xa')](_0x3ce50d);if(_0x4ded1f>0x0){sequelize_utils_1['default'][a162_0x509c('0x12')][a162_0x509c('0x32')][a162_0x509c('0x33')]({'amount':_0x4ded1f,'counted_at':_0x3ce50d});}sequelize_utils_1['default'][a162_0x509c('0x12')][a162_0x509c('0x42')][a162_0x509c('0x33')]({'device_id':null,'lat':''+_0xb3d1cb,'lon':''+_0x3940ff,'tracked_at':_0x3ce50d});}catch(_0xedffb){return console[a162_0x509c('0x17')](_0xedffb);}}});}}});_0x8b2e1a['json']({'status':0x1,'data':_0x26c203[a162_0x509c('0x36')]});}}exports['default']=SyncFilesController;