var a73_0x3717=['default','syncFtp','bind','downloadFtp','processFtp','log','ready','connected','name','endsWith','json','models','syncFilesModel','findOrCreate','spread','push','error','ftp.vivotek.com','ipd','findOne','then','connected:','file_name','get','colombia/','.txt','pipe','createWriteStream','status','Downloaded:\x20','connect','media/','existsSync','statSync','size','fileSizeInBytes:\x20','readFile','utf8','parse','CountingInfo','Out','EndTime','passCountingsModel','create','save','uploadEvent','zlib','file','path','filename','.json','createReadStream','createGunzip','eventos','hora','\x20-05:00','latitud','longitud','replace','velocidad','puerta','ingresos','salidas','__importDefault','__esModule','defineProperty','../../infrastructure/sequelize-utils','moment'];(function(_0xc5f10c,_0x1a4d04){var _0x48327f=function(_0x2df8ff){while(--_0x2df8ff){_0xc5f10c['push'](_0xc5f10c['shift']());}};_0x48327f(++_0x1a4d04);}(a73_0x3717,0xc7));var a73_0x5686=function(_0x5ee5b3,_0x276572){_0x5ee5b3=_0x5ee5b3-0x0;var _0x280d4b=a73_0x3717[_0x5ee5b3];return _0x280d4b;};'use strict';var __importDefault=this&&this[a73_0x5686('0x0')]||function(_0x137cf3){return _0x137cf3&&_0x137cf3[a73_0x5686('0x1')]?_0x137cf3:{'default':_0x137cf3};};Object[a73_0x5686('0x2')](exports,a73_0x5686('0x1'),{'value':!![]});const ftp_1=__importDefault(require('ftp'));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require('../../infrastructure/controller-utils'));const sequelize_utils_1=__importDefault(require(a73_0x5686('0x3')));const moment_1=__importDefault(require(a73_0x5686('0x4')));const UPLOAD_PATH='media';class SyncFilesController extends controller_utils_1[a73_0x5686('0x5')]{constructor(_0x2e950d){super(_0x2e950d,null);this[a73_0x5686('0x6')]=this[a73_0x5686('0x6')][a73_0x5686('0x7')](this);this[a73_0x5686('0x8')]=this[a73_0x5686('0x8')][a73_0x5686('0x7')](this);this[a73_0x5686('0x9')]=this[a73_0x5686('0x9')]['bind'](this);}[a73_0x5686('0x6')](_0x506346,_0x3782f0,_0x266f26){console[a73_0x5686('0xa')]('connecting');const _0x555fb2=[];const _0x2ece07=new ftp_1[(a73_0x5686('0x5'))]();_0x2ece07['on'](a73_0x5686('0xb'),function(){console[a73_0x5686('0xa')](a73_0x5686('0xc'));_0x2ece07['list']('colombia',![],function(_0x5d406,_0x5306fa){if(_0x5d406){console['log'](_0x5d406);}else{for(const _0x3290d8 of _0x5306fa){if(_0x3290d8[a73_0x5686('0xd')][a73_0x5686('0xe')](a73_0x5686('0xf'))&&_0x3290d8['size']>0x0){sequelize_utils_1[a73_0x5686('0x5')][a73_0x5686('0x10')][a73_0x5686('0x11')][a73_0x5686('0x12')]({'where':{'file_name':_0x3290d8[a73_0x5686('0xd')]}})[a73_0x5686('0x13')]((_0x122580,_0x512971)=>{if(_0x512971){_0x555fb2[a73_0x5686('0x14')](_0x122580);}});}}}});});_0x2ece07['on'](a73_0x5686('0x15'),function(_0x442709){});_0x2ece07['connect']({'host':a73_0x5686('0x16'),'port':0x15,'user':'ipd','password':a73_0x5686('0x17')});_0x3782f0['json']({'data':[]});}[a73_0x5686('0x8')](_0x3f6feb,_0x24cb00,_0x5ed58c){sequelize_utils_1['default'][a73_0x5686('0x10')][a73_0x5686('0x11')][a73_0x5686('0x18')]({'where':{'status':null}})[a73_0x5686('0x19')](_0x4aae38=>{if(_0x4aae38){const _0x428a52=new ftp_1[(a73_0x5686('0x5'))]();_0x428a52['on'](a73_0x5686('0xb'),function(){console[a73_0x5686('0xa')](a73_0x5686('0x1a')+_0x4aae38[a73_0x5686('0x1b')]);_0x428a52[a73_0x5686('0x1c')](a73_0x5686('0x1d')+_0x4aae38[a73_0x5686('0x1b')],function(_0x29095a,_0x46b85a){_0x428a52['end']();if(_0x29095a){}else{const _0x548731='media/'+_0x4aae38[a73_0x5686('0x1b')]+a73_0x5686('0x1e');_0x46b85a[a73_0x5686('0x1f')](fs_1[a73_0x5686('0x5')][a73_0x5686('0x20')](_0x548731));_0x4aae38[a73_0x5686('0x21')]=0x1;_0x4aae38['save']();console[a73_0x5686('0xa')](a73_0x5686('0x22')+_0x4aae38['fileName']);}});});_0x428a52['on'](a73_0x5686('0x15'),function(_0x5987b7){});_0x428a52[a73_0x5686('0x23')]({'host':a73_0x5686('0x16'),'port':0x15,'user':a73_0x5686('0x17'),'password':'ipd'});}else{}});_0x24cb00[a73_0x5686('0xf')]({'data':[]});}[a73_0x5686('0x9')](_0x43d940,_0x230553,_0x338293){sequelize_utils_1[a73_0x5686('0x5')][a73_0x5686('0x10')][a73_0x5686('0x11')][a73_0x5686('0x18')]({'where':{'status':0x1}})[a73_0x5686('0x19')](_0x370515=>{if(_0x370515){const _0x4974b1=a73_0x5686('0x24')+_0x370515['file_name']+a73_0x5686('0x1e');if(fs_1[a73_0x5686('0x5')][a73_0x5686('0x25')](_0x4974b1)){const _0x53e300=fs_1[a73_0x5686('0x5')][a73_0x5686('0x26')](_0x4974b1);const _0x562c65=_0x53e300[a73_0x5686('0x27')];console['log']('fileName:\x20'+_0x4974b1);console[a73_0x5686('0xa')](a73_0x5686('0x28')+_0x562c65);if(_0x562c65>0x0){fs_1[a73_0x5686('0x5')][a73_0x5686('0x29')](_0x4974b1,a73_0x5686('0x2a'),function(_0x281cd3,_0x81ca61){if(_0x281cd3){_0x370515['status']=null;}else{try{const _0x25881e=JSON[a73_0x5686('0x2b')](_0x81ca61);for(const _0x2aee5a of _0x25881e['Data'][0x0][a73_0x5686('0x2c')]){const _0x21d812=_0x2aee5a['In'];const _0x2004af=_0x2aee5a[a73_0x5686('0x2d')];const _0x38c4ed=Date[a73_0x5686('0x2b')](_0x2aee5a[a73_0x5686('0x2e')]);if(_0x21d812>0x0){sequelize_utils_1[a73_0x5686('0x5')][a73_0x5686('0x10')][a73_0x5686('0x2f')]['create']({'amount':_0x21d812,'counted_at':_0x38c4ed});}if(_0x2004af>0x0){sequelize_utils_1[a73_0x5686('0x5')][a73_0x5686('0x10')][a73_0x5686('0x2f')][a73_0x5686('0x30')]({'amount':_0x2004af*-0x1,'counted_at':_0x38c4ed});}}_0x370515[a73_0x5686('0x21')]=0x2;}catch(_0x24e243){_0x370515[a73_0x5686('0x21')]=null;}}_0x370515['save']();});}else{_0x370515[a73_0x5686('0x21')]=null;_0x370515[a73_0x5686('0x31')]();}}else{_0x370515[a73_0x5686('0x21')]=null;_0x370515[a73_0x5686('0x31')]();}}else{}});_0x230553['json']({'data':[]});}[a73_0x5686('0x32')](_0x31b1c4,_0x4c4200,_0x854b12){const _0x4ba5b2=require(a73_0x5686('0x33'));const _0x5c8dd1=_0x31b1c4[a73_0x5686('0x34')][a73_0x5686('0x35')];const _0x29548e=UPLOAD_PATH+'/'+_0x31b1c4[a73_0x5686('0x34')][a73_0x5686('0x36')]+a73_0x5686('0x37');const _0x2afdfc=fs_1[a73_0x5686('0x5')][a73_0x5686('0x38')](_0x5c8dd1);const _0xfec286=fs_1[a73_0x5686('0x5')][a73_0x5686('0x20')](_0x29548e);const _0x176a1d=_0x4ba5b2[a73_0x5686('0x39')]();console[a73_0x5686('0xa')](_0x31b1c4['file']);_0x2afdfc[a73_0x5686('0x1f')](_0x176a1d)[a73_0x5686('0x1f')](_0xfec286)['on']('finish',_0x12a348=>{if(_0x12a348)return console[a73_0x5686('0x15')](_0x12a348);else{const _0x5a2c21=fs_1[a73_0x5686('0x5')][a73_0x5686('0x26')](_0x5c8dd1);const _0x47a4a1=_0x5a2c21[a73_0x5686('0x27')];if(_0x47a4a1>0x0){fs_1[a73_0x5686('0x5')][a73_0x5686('0x29')](_0x29548e,'utf8',function(_0x12a348,_0xb7ae8a){if(_0x12a348){return console[a73_0x5686('0x15')](_0x12a348);}else{try{const _0x10f287=JSON[a73_0x5686('0x2b')](_0xb7ae8a);console[a73_0x5686('0xa')](_0x10f287);const _0x4f90c8=_0x10f287[a73_0x5686('0x3a')][0x0]['fecha'];const _0x4b6ea8=_0x10f287[a73_0x5686('0x3a')][0x0][a73_0x5686('0x3b')];const _0x46d134=moment_1[a73_0x5686('0x5')](_0x4f90c8+'\x20'+_0x4b6ea8+a73_0x5686('0x3c'),'YYYYMMDD\x20HHmmss\x20Z');const _0x40e7f5=parseFloat(_0x10f287['eventos'][0x0][a73_0x5686('0x3d')]['replace'](',','.'));const _0x2a5c24=parseFloat(_0x10f287['eventos'][0x0][a73_0x5686('0x3e')][a73_0x5686('0x3f')](',','.'));const _0x57e5b4=_0x10f287[a73_0x5686('0x3a')][0x0][a73_0x5686('0x40')];const _0x4787d1=_0x10f287[a73_0x5686('0x3a')][0x0][a73_0x5686('0x41')][0x0][a73_0x5686('0x42')];const _0x209237=_0x10f287[a73_0x5686('0x3a')][0x0][a73_0x5686('0x41')][0x0][a73_0x5686('0x43')];console['log'](_0x40e7f5);console[a73_0x5686('0xa')](_0x2a5c24);console['log'](_0x57e5b4);console[a73_0x5686('0xa')](_0x4787d1);console[a73_0x5686('0xa')](_0x209237);console[a73_0x5686('0xa')](_0x46d134);if(_0x4787d1>0x0){sequelize_utils_1[a73_0x5686('0x5')]['models']['passCountingsModel'][a73_0x5686('0x30')]({'amount':_0x4787d1,'counted_at':_0x46d134});}sequelize_utils_1['default']['models']['locationPointsModel']['create']({'device_id':null,'lat':''+_0x40e7f5,'lon':''+_0x2a5c24,'tracked_at':_0x46d134});}catch(_0x4dda7b){return console['error'](_0x4dda7b);}}});}}});_0x4c4200[a73_0x5686('0xf')]({'status':0x1,'data':_0x31b1c4[a73_0x5686('0x34')]});}}exports[a73_0x5686('0x5')]=SyncFilesController;