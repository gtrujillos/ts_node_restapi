var a162_0x50df=['createReadStream','createGunzip','pipe','finish','size','eventos','hora','\x20-05:00','YYYYMMDD\x20HHmmss\x20Z','latitud','longitud','velocidad','puerta','ingresos','salidas','locationPointsModel','__importDefault','__esModule','ftp','../../infrastructure/controller-utils','media','default','syncFtp','processFtp','log','connecting','ready','connected','name','json','models','syncFilesModel','findOrCreate','spread','push','error','connect','ipd','downloadFtp','findOne','connected:','file_name','get','end','media/','.txt','createWriteStream','status','save','Downloaded:\x20','then','statSync','fileName:\x20','fileSizeInBytes:\x20','readFile','utf8','parse','Data','CountingInfo','Out','EndTime','passCountingsModel','create','zlib','file','filename','.json'];(function(_0x5cf1f9,_0x53d2ec){var _0x4eb1fc=function(_0x5ac6bc){while(--_0x5ac6bc){_0x5cf1f9['push'](_0x5cf1f9['shift']());}};_0x4eb1fc(++_0x53d2ec);}(a162_0x50df,0x1e5));var a162_0x1c1b=function(_0x4fd0ec,_0x31a81b){_0x4fd0ec=_0x4fd0ec-0x0;var _0x2ba2eb=a162_0x50df[_0x4fd0ec];return _0x2ba2eb;};'use strict';var __importDefault=this&&this[a162_0x1c1b('0x0')]||function(_0x538a93){return _0x538a93&&_0x538a93[a162_0x1c1b('0x1')]?_0x538a93:{'default':_0x538a93};};Object['defineProperty'](exports,a162_0x1c1b('0x1'),{'value':!![]});const ftp_1=__importDefault(require(a162_0x1c1b('0x2')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a162_0x1c1b('0x3')));const sequelize_utils_1=__importDefault(require('../../infrastructure/sequelize-utils'));const moment_1=__importDefault(require('moment'));const UPLOAD_PATH=a162_0x1c1b('0x4');class SyncFilesController extends controller_utils_1[a162_0x1c1b('0x5')]{constructor(_0x1b0856){super(_0x1b0856,null);this[a162_0x1c1b('0x6')]=this['syncFtp']['bind'](this);this['downloadFtp']=this['downloadFtp']['bind'](this);this[a162_0x1c1b('0x7')]=this[a162_0x1c1b('0x7')]['bind'](this);}[a162_0x1c1b('0x6')](_0x37914e,_0x819f40,_0x48cb52){console[a162_0x1c1b('0x8')](a162_0x1c1b('0x9'));const _0x275ce1=[];const _0x108524=new ftp_1[(a162_0x1c1b('0x5'))]();_0x108524['on'](a162_0x1c1b('0xa'),function(){console['log'](a162_0x1c1b('0xb'));_0x108524['list']('colombia',![],function(_0x5059a6,_0x3e77fd){if(_0x5059a6){console[a162_0x1c1b('0x8')](_0x5059a6);}else{for(const _0x21f7b8 of _0x3e77fd){if(_0x21f7b8[a162_0x1c1b('0xc')]['endsWith'](a162_0x1c1b('0xd'))&&_0x21f7b8['size']>0x0){sequelize_utils_1['default'][a162_0x1c1b('0xe')][a162_0x1c1b('0xf')][a162_0x1c1b('0x10')]({'where':{'file_name':_0x21f7b8['name']}})[a162_0x1c1b('0x11')]((_0x54b238,_0x4f6aa2)=>{if(_0x4f6aa2){_0x275ce1[a162_0x1c1b('0x12')](_0x54b238);}});}}}});});_0x108524['on'](a162_0x1c1b('0x13'),function(_0x245c25){});_0x108524[a162_0x1c1b('0x14')]({'host':'ftp.vivotek.com','port':0x15,'user':a162_0x1c1b('0x15'),'password':a162_0x1c1b('0x15')});_0x819f40[a162_0x1c1b('0xd')]({'data':[]});}[a162_0x1c1b('0x16')](_0x3ddb29,_0x5d5dc5,_0x23ae8c){sequelize_utils_1['default'][a162_0x1c1b('0xe')][a162_0x1c1b('0xf')][a162_0x1c1b('0x17')]({'where':{'status':null}})['then'](_0x3df7ca=>{if(_0x3df7ca){const _0x3b9e9a=new ftp_1[(a162_0x1c1b('0x5'))]();_0x3b9e9a['on'](a162_0x1c1b('0xa'),function(){console[a162_0x1c1b('0x8')](a162_0x1c1b('0x18')+_0x3df7ca[a162_0x1c1b('0x19')]);_0x3b9e9a[a162_0x1c1b('0x1a')]('colombia/'+_0x3df7ca[a162_0x1c1b('0x19')],function(_0x350429,_0x373bd4){_0x3b9e9a[a162_0x1c1b('0x1b')]();if(_0x350429){}else{const _0x271ccd=a162_0x1c1b('0x1c')+_0x3df7ca[a162_0x1c1b('0x19')]+a162_0x1c1b('0x1d');_0x373bd4['pipe'](fs_1[a162_0x1c1b('0x5')][a162_0x1c1b('0x1e')](_0x271ccd));_0x3df7ca[a162_0x1c1b('0x1f')]=0x1;_0x3df7ca[a162_0x1c1b('0x20')]();console[a162_0x1c1b('0x8')](a162_0x1c1b('0x21')+_0x3df7ca['fileName']);}});});_0x3b9e9a['on']('error',function(_0x81baa1){});_0x3b9e9a[a162_0x1c1b('0x14')]({'host':'ftp.vivotek.com','port':0x15,'user':a162_0x1c1b('0x15'),'password':a162_0x1c1b('0x15')});}else{}});_0x5d5dc5[a162_0x1c1b('0xd')]({'data':[]});}[a162_0x1c1b('0x7')](_0x2be135,_0x45254f,_0x644e13){sequelize_utils_1['default']['models'][a162_0x1c1b('0xf')]['findOne']({'where':{'status':0x1}})[a162_0x1c1b('0x22')](_0x39b443=>{if(_0x39b443){const _0x3cd19c='media/'+_0x39b443[a162_0x1c1b('0x19')]+'.txt';if(fs_1[a162_0x1c1b('0x5')]['existsSync'](_0x3cd19c)){const _0x2659a8=fs_1[a162_0x1c1b('0x5')][a162_0x1c1b('0x23')](_0x3cd19c);const _0xfbb1de=_0x2659a8['size'];console['log'](a162_0x1c1b('0x24')+_0x3cd19c);console['log'](a162_0x1c1b('0x25')+_0xfbb1de);if(_0xfbb1de>0x0){fs_1['default'][a162_0x1c1b('0x26')](_0x3cd19c,a162_0x1c1b('0x27'),function(_0x4d3572,_0x424036){if(_0x4d3572){_0x39b443[a162_0x1c1b('0x1f')]=null;}else{try{const _0x1c8b1d=JSON[a162_0x1c1b('0x28')](_0x424036);for(const _0x49366a of _0x1c8b1d[a162_0x1c1b('0x29')][0x0][a162_0x1c1b('0x2a')]){const _0x3d10c3=_0x49366a['In'];const _0x599f50=_0x49366a[a162_0x1c1b('0x2b')];const _0xd8ba00=Date[a162_0x1c1b('0x28')](_0x49366a[a162_0x1c1b('0x2c')]);if(_0x3d10c3>0x0){sequelize_utils_1[a162_0x1c1b('0x5')][a162_0x1c1b('0xe')][a162_0x1c1b('0x2d')]['create']({'amount':_0x3d10c3,'counted_at':_0xd8ba00});}if(_0x599f50>0x0){sequelize_utils_1[a162_0x1c1b('0x5')][a162_0x1c1b('0xe')][a162_0x1c1b('0x2d')][a162_0x1c1b('0x2e')]({'amount':_0x599f50*-0x1,'counted_at':_0xd8ba00});}}_0x39b443['status']=0x2;}catch(_0xc28eae){_0x39b443['status']=null;}}_0x39b443[a162_0x1c1b('0x20')]();});}else{_0x39b443[a162_0x1c1b('0x1f')]=null;_0x39b443[a162_0x1c1b('0x20')]();}}else{_0x39b443[a162_0x1c1b('0x1f')]=null;_0x39b443['save']();}}else{}});_0x45254f[a162_0x1c1b('0xd')]({'data':[]});}['uploadEvent'](_0x48655e,_0x161b1d,_0x3dc9f2){const _0x429b0c=require(a162_0x1c1b('0x2f'));const _0x3501aa=_0x48655e[a162_0x1c1b('0x30')]['path'];const _0x32fa05=UPLOAD_PATH+'/'+_0x48655e[a162_0x1c1b('0x30')][a162_0x1c1b('0x31')]+a162_0x1c1b('0x32');const _0x590a9d=fs_1[a162_0x1c1b('0x5')][a162_0x1c1b('0x33')](_0x3501aa);const _0x20b683=fs_1['default'][a162_0x1c1b('0x1e')](_0x32fa05);const _0x3f3886=_0x429b0c[a162_0x1c1b('0x34')]();console['log'](_0x48655e[a162_0x1c1b('0x30')]);_0x590a9d[a162_0x1c1b('0x35')](_0x3f3886)[a162_0x1c1b('0x35')](_0x20b683)['on'](a162_0x1c1b('0x36'),_0x331044=>{if(_0x331044)return console[a162_0x1c1b('0x13')](_0x331044);else{const _0x449aa1=fs_1[a162_0x1c1b('0x5')][a162_0x1c1b('0x23')](_0x3501aa);const _0x2aa33b=_0x449aa1[a162_0x1c1b('0x37')];if(_0x2aa33b>0x0){fs_1[a162_0x1c1b('0x5')][a162_0x1c1b('0x26')](_0x32fa05,a162_0x1c1b('0x27'),function(_0x331044,_0x3909fd){if(_0x331044){return console[a162_0x1c1b('0x13')](_0x331044);}else{try{const _0x2570e=JSON[a162_0x1c1b('0x28')](_0x3909fd);console[a162_0x1c1b('0x8')](_0x2570e);const _0x215709=_0x2570e['eventos'][0x0]['fecha'];const _0x5995b3=_0x2570e[a162_0x1c1b('0x38')][0x0][a162_0x1c1b('0x39')];const _0x4f4c14=moment_1[a162_0x1c1b('0x5')](_0x215709+'\x20'+_0x5995b3+a162_0x1c1b('0x3a'),a162_0x1c1b('0x3b'));const _0x1c9836=parseFloat(_0x2570e[a162_0x1c1b('0x38')][0x0][a162_0x1c1b('0x3c')]['replace'](',','.'));const _0x36d445=parseFloat(_0x2570e[a162_0x1c1b('0x38')][0x0][a162_0x1c1b('0x3d')]['replace'](',','.'));const _0x1456fb=_0x2570e['eventos'][0x0][a162_0x1c1b('0x3e')];const _0x2b8006=_0x2570e[a162_0x1c1b('0x38')][0x0][a162_0x1c1b('0x3f')][0x0][a162_0x1c1b('0x40')];const _0x1a68bc=_0x2570e[a162_0x1c1b('0x38')][0x0][a162_0x1c1b('0x3f')][0x0][a162_0x1c1b('0x41')];console[a162_0x1c1b('0x8')](_0x1c9836);console['log'](_0x36d445);console['log'](_0x1456fb);console[a162_0x1c1b('0x8')](_0x2b8006);console[a162_0x1c1b('0x8')](_0x1a68bc);console[a162_0x1c1b('0x8')](_0x4f4c14);if(_0x2b8006>0x0){sequelize_utils_1['default'][a162_0x1c1b('0xe')]['passCountingsModel'][a162_0x1c1b('0x2e')]({'amount':_0x2b8006,'counted_at':_0x4f4c14});}sequelize_utils_1[a162_0x1c1b('0x5')][a162_0x1c1b('0xe')][a162_0x1c1b('0x42')][a162_0x1c1b('0x2e')]({'device_id':null,'lat':''+_0x1c9836,'lon':''+_0x36d445,'tracked_at':_0x4f4c14});}catch(_0x1114bd){return console[a162_0x1c1b('0x13')](_0x1114bd);}}});}}});_0x161b1d[a162_0x1c1b('0xd')]({'status':0x1,'data':_0x48655e[a162_0x1c1b('0x30')]});}}exports[a162_0x1c1b('0x5')]=SyncFilesController;