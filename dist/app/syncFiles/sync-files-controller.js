var a162_0x3cca=['findOrCreate','push','connect','ftp.vivotek.com','ipd','models','findOne','then','file_name','get','colombia/','end','media/','.txt','pipe','createWriteStream','status','save','Downloaded:\x20','fileName','error','existsSync','fileName:\x20','fileSizeInBytes:\x20','parse','Data','CountingInfo','Out','EndTime','passCountingsModel','create','uploadEvent','zlib','path','file','filename','.json','finish','statSync','eventos','fecha','hora','\x20-05:00','YYYYMMDD\x20HHmmss\x20Z','latitud','replace','velocidad','ingresos','locationPointsModel','__importDefault','defineProperty','__esModule','ftp','moment','default','syncFtp','bind','downloadFtp','processFtp','log','connecting','ready','colombia','name','endsWith','json','size','syncFilesModel'];(function(_0x9a8e14,_0x147104){var _0x38f4ef=function(_0xf2d754){while(--_0xf2d754){_0x9a8e14['push'](_0x9a8e14['shift']());}};_0x38f4ef(++_0x147104);}(a162_0x3cca,0x141));var a162_0xb323=function(_0x113d7b,_0x1c00c3){_0x113d7b=_0x113d7b-0x0;var _0x2d6905=a162_0x3cca[_0x113d7b];return _0x2d6905;};'use strict';var __importDefault=this&&this[a162_0xb323('0x0')]||function(_0x2da007){return _0x2da007&&_0x2da007['__esModule']?_0x2da007:{'default':_0x2da007};};Object[a162_0xb323('0x1')](exports,a162_0xb323('0x2'),{'value':!![]});const ftp_1=__importDefault(require(a162_0xb323('0x3')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require('../../infrastructure/controller-utils'));const sequelize_utils_1=__importDefault(require('../../infrastructure/sequelize-utils'));const moment_1=__importDefault(require(a162_0xb323('0x4')));const UPLOAD_PATH='media';class SyncFilesController extends controller_utils_1[a162_0xb323('0x5')]{constructor(_0x4f8f1c){super(_0x4f8f1c,null);this[a162_0xb323('0x6')]=this[a162_0xb323('0x6')][a162_0xb323('0x7')](this);this[a162_0xb323('0x8')]=this['downloadFtp'][a162_0xb323('0x7')](this);this[a162_0xb323('0x9')]=this[a162_0xb323('0x9')][a162_0xb323('0x7')](this);}[a162_0xb323('0x6')](_0x2ab5d6,_0x1fb460,_0x1ad0db){console[a162_0xb323('0xa')](a162_0xb323('0xb'));const _0x1be39d=[];const _0x218c9b=new ftp_1[(a162_0xb323('0x5'))]();_0x218c9b['on'](a162_0xb323('0xc'),function(){console[a162_0xb323('0xa')]('connected');_0x218c9b['list'](a162_0xb323('0xd'),![],function(_0x3122cf,_0x2974c9){if(_0x3122cf){console[a162_0xb323('0xa')](_0x3122cf);}else{for(const _0x4434fe of _0x2974c9){if(_0x4434fe[a162_0xb323('0xe')][a162_0xb323('0xf')](a162_0xb323('0x10'))&&_0x4434fe[a162_0xb323('0x11')]>0x0){sequelize_utils_1[a162_0xb323('0x5')]['models'][a162_0xb323('0x12')][a162_0xb323('0x13')]({'where':{'file_name':_0x4434fe[a162_0xb323('0xe')]}})['spread']((_0x4c4883,_0x4892e5)=>{if(_0x4892e5){_0x1be39d[a162_0xb323('0x14')](_0x4c4883);}});}}}});});_0x218c9b['on']('error',function(_0x34ad2f){});_0x218c9b[a162_0xb323('0x15')]({'host':a162_0xb323('0x16'),'port':0x15,'user':a162_0xb323('0x17'),'password':a162_0xb323('0x17')});_0x1fb460['json']({'data':[]});}['downloadFtp'](_0x15bbb0,_0x124fc7,_0x403737){sequelize_utils_1['default'][a162_0xb323('0x18')][a162_0xb323('0x12')][a162_0xb323('0x19')]({'where':{'status':null}})[a162_0xb323('0x1a')](_0x474f44=>{if(_0x474f44){const _0x4d7e86=new ftp_1['default']();_0x4d7e86['on']('ready',function(){console[a162_0xb323('0xa')]('connected:'+_0x474f44[a162_0xb323('0x1b')]);_0x4d7e86[a162_0xb323('0x1c')](a162_0xb323('0x1d')+_0x474f44[a162_0xb323('0x1b')],function(_0xd86c9a,_0x442227){_0x4d7e86[a162_0xb323('0x1e')]();if(_0xd86c9a){}else{const _0x333815=a162_0xb323('0x1f')+_0x474f44[a162_0xb323('0x1b')]+a162_0xb323('0x20');_0x442227[a162_0xb323('0x21')](fs_1[a162_0xb323('0x5')][a162_0xb323('0x22')](_0x333815));_0x474f44[a162_0xb323('0x23')]=0x1;_0x474f44[a162_0xb323('0x24')]();console[a162_0xb323('0xa')](a162_0xb323('0x25')+_0x474f44[a162_0xb323('0x26')]);}});});_0x4d7e86['on'](a162_0xb323('0x27'),function(_0x390052){});_0x4d7e86[a162_0xb323('0x15')]({'host':a162_0xb323('0x16'),'port':0x15,'user':a162_0xb323('0x17'),'password':a162_0xb323('0x17')});}else{}});_0x124fc7[a162_0xb323('0x10')]({'data':[]});}['processFtp'](_0x2cd020,_0x551fcd,_0xdbf390){sequelize_utils_1[a162_0xb323('0x5')][a162_0xb323('0x18')][a162_0xb323('0x12')][a162_0xb323('0x19')]({'where':{'status':0x1}})[a162_0xb323('0x1a')](_0x13ad1a=>{if(_0x13ad1a){const _0x20d3ee=a162_0xb323('0x1f')+_0x13ad1a['file_name']+a162_0xb323('0x20');if(fs_1[a162_0xb323('0x5')][a162_0xb323('0x28')](_0x20d3ee)){const _0x180720=fs_1[a162_0xb323('0x5')]['statSync'](_0x20d3ee);const _0x33bd7f=_0x180720[a162_0xb323('0x11')];console[a162_0xb323('0xa')](a162_0xb323('0x29')+_0x20d3ee);console[a162_0xb323('0xa')](a162_0xb323('0x2a')+_0x33bd7f);if(_0x33bd7f>0x0){fs_1[a162_0xb323('0x5')]['readFile'](_0x20d3ee,'utf8',function(_0x1de9e1,_0x12ee74){if(_0x1de9e1){_0x13ad1a[a162_0xb323('0x23')]=null;}else{try{const _0x10af24=JSON[a162_0xb323('0x2b')](_0x12ee74);for(const _0x46f6b1 of _0x10af24[a162_0xb323('0x2c')][0x0][a162_0xb323('0x2d')]){const _0x3fab38=_0x46f6b1['In'];const _0x3a05ad=_0x46f6b1[a162_0xb323('0x2e')];const _0x3a1120=Date['parse'](_0x46f6b1[a162_0xb323('0x2f')]);if(_0x3fab38>0x0){sequelize_utils_1['default'][a162_0xb323('0x18')][a162_0xb323('0x30')]['create']({'amount':_0x3fab38,'counted_at':_0x3a1120});}if(_0x3a05ad>0x0){sequelize_utils_1[a162_0xb323('0x5')]['models']['passCountingsModel'][a162_0xb323('0x31')]({'amount':_0x3a05ad*-0x1,'counted_at':_0x3a1120});}}_0x13ad1a[a162_0xb323('0x23')]=0x2;}catch(_0x3448b3){_0x13ad1a[a162_0xb323('0x23')]=null;}}_0x13ad1a[a162_0xb323('0x24')]();});}else{_0x13ad1a[a162_0xb323('0x23')]=null;_0x13ad1a[a162_0xb323('0x24')]();}}else{_0x13ad1a[a162_0xb323('0x23')]=null;_0x13ad1a[a162_0xb323('0x24')]();}}else{}});_0x551fcd[a162_0xb323('0x10')]({'data':[]});}[a162_0xb323('0x32')](_0x5c9412,_0x2999e3,_0x3a34d4){const _0x7d1659=require(a162_0xb323('0x33'));const _0x2141f7=_0x5c9412['file'][a162_0xb323('0x34')];const _0xc6b7c3=UPLOAD_PATH+'/'+_0x5c9412[a162_0xb323('0x35')][a162_0xb323('0x36')]+a162_0xb323('0x37');const _0x80603c=fs_1['default']['createReadStream'](_0x2141f7);const _0x194dc2=fs_1[a162_0xb323('0x5')][a162_0xb323('0x22')](_0xc6b7c3);const _0x1e6046=_0x7d1659['createGunzip']();console['log'](_0x5c9412['file']);_0x80603c['pipe'](_0x1e6046)[a162_0xb323('0x21')](_0x194dc2)['on'](a162_0xb323('0x38'),_0x4d0fe0=>{if(_0x4d0fe0)return console[a162_0xb323('0x27')](_0x4d0fe0);else{const _0x17fef6=fs_1['default'][a162_0xb323('0x39')](_0x2141f7);const _0x43b800=_0x17fef6[a162_0xb323('0x11')];if(_0x43b800>0x0){fs_1[a162_0xb323('0x5')]['readFile'](_0xc6b7c3,'utf8',function(_0x4d0fe0,_0x33a10){if(_0x4d0fe0){return console[a162_0xb323('0x27')](_0x4d0fe0);}else{try{const _0x474503=JSON['parse'](_0x33a10);console[a162_0xb323('0xa')](_0x474503);const _0x50f6ff=_0x474503[a162_0xb323('0x3a')][0x0][a162_0xb323('0x3b')];const _0x1190f8=_0x474503[a162_0xb323('0x3a')][0x0][a162_0xb323('0x3c')];const _0x227377=moment_1[a162_0xb323('0x5')](_0x50f6ff+'\x20'+_0x1190f8+a162_0xb323('0x3d'),a162_0xb323('0x3e'));const _0x1e2a10=parseFloat(_0x474503[a162_0xb323('0x3a')][0x0][a162_0xb323('0x3f')]['replace'](',','.'));const _0x249771=parseFloat(_0x474503['eventos'][0x0]['longitud'][a162_0xb323('0x40')](',','.'));const _0x3e9f76=_0x474503[a162_0xb323('0x3a')][0x0][a162_0xb323('0x41')];const _0x4d7104=_0x474503[a162_0xb323('0x3a')][0x0]['puerta'][0x0][a162_0xb323('0x42')];const _0x111cfe=_0x474503['eventos'][0x0]['puerta'][0x0]['salidas'];console['log'](_0x1e2a10);console[a162_0xb323('0xa')](_0x249771);console[a162_0xb323('0xa')](_0x3e9f76);console[a162_0xb323('0xa')](_0x4d7104);console[a162_0xb323('0xa')](_0x111cfe);console[a162_0xb323('0xa')](_0x227377);if(_0x4d7104>0x0){sequelize_utils_1[a162_0xb323('0x5')][a162_0xb323('0x18')]['passCountingsModel'][a162_0xb323('0x31')]({'amount':_0x4d7104,'counted_at':_0x227377});}sequelize_utils_1[a162_0xb323('0x5')][a162_0xb323('0x18')][a162_0xb323('0x43')][a162_0xb323('0x31')]({'device_id':null,'lat':''+_0x1e2a10,'lon':''+_0x249771,'tracked_at':_0x227377});}catch(_0x3e1975){return console[a162_0xb323('0x27')](_0x3e1975);}}});}}});_0x2999e3[a162_0xb323('0x10')]({'status':0x1,'data':_0x5c9412[a162_0xb323('0x35')]});}}exports[a162_0xb323('0x5')]=SyncFilesController;