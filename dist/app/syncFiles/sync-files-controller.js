var a72_0x3bcd=['defineProperty','ftp','../../infrastructure/controller-utils','moment','default','syncFtp','downloadFtp','bind','processFtp','log','connecting','ready','connected','list','colombia','name','json','size','findOrCreate','spread','error','ftp.vivotek.com','ipd','models','syncFilesModel','connected:','file_name','end','.txt','pipe','createWriteStream','status','save','Downloaded:\x20','fileName','connect','findOne','existsSync','statSync','fileName:\x20','fileSizeInBytes:\x20','readFile','utf8','parse','CountingInfo','Out','passCountingsModel','create','uploadEvent','zlib','file','path','filename','.json','createReadStream','createGunzip','finish','eventos','fecha','hora','\x20-05:00','YYYYMMDD\x20HHmmss\x20Z','longitud','velocidad','puerta','ingresos','salidas','locationPointsModel','__importDefault','__esModule'];(function(_0x3aae3a,_0x2ce681){var _0x3ba6d5=function(_0x384d34){while(--_0x384d34){_0x3aae3a['push'](_0x3aae3a['shift']());}};_0x3ba6d5(++_0x2ce681);}(a72_0x3bcd,0x1e8));var a72_0x5a1b=function(_0x52bd8b,_0x1bcfd0){_0x52bd8b=_0x52bd8b-0x0;var _0x22ce44=a72_0x3bcd[_0x52bd8b];return _0x22ce44;};'use strict';var __importDefault=this&&this[a72_0x5a1b('0x0')]||function(_0x4d3ef4){return _0x4d3ef4&&_0x4d3ef4[a72_0x5a1b('0x1')]?_0x4d3ef4:{'default':_0x4d3ef4};};Object[a72_0x5a1b('0x2')](exports,a72_0x5a1b('0x1'),{'value':!![]});const ftp_1=__importDefault(require(a72_0x5a1b('0x3')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a72_0x5a1b('0x4')));const sequelize_utils_1=__importDefault(require('../../infrastructure/sequelize-utils'));const moment_1=__importDefault(require(a72_0x5a1b('0x5')));const UPLOAD_PATH='media';class SyncFilesController extends controller_utils_1[a72_0x5a1b('0x6')]{constructor(_0x12c52c){super(_0x12c52c,null);this[a72_0x5a1b('0x7')]=this[a72_0x5a1b('0x7')]['bind'](this);this[a72_0x5a1b('0x8')]=this['downloadFtp'][a72_0x5a1b('0x9')](this);this[a72_0x5a1b('0xa')]=this[a72_0x5a1b('0xa')][a72_0x5a1b('0x9')](this);}['syncFtp'](_0x54d039,_0x533963,_0x4d201a){console[a72_0x5a1b('0xb')](a72_0x5a1b('0xc'));const _0x1852f1=[];const _0x4973e6=new ftp_1[(a72_0x5a1b('0x6'))]();_0x4973e6['on'](a72_0x5a1b('0xd'),function(){console[a72_0x5a1b('0xb')](a72_0x5a1b('0xe'));_0x4973e6[a72_0x5a1b('0xf')](a72_0x5a1b('0x10'),![],function(_0x4307a9,_0x1a10cb){if(_0x4307a9){console[a72_0x5a1b('0xb')](_0x4307a9);}else{for(const _0x32cca2 of _0x1a10cb){if(_0x32cca2[a72_0x5a1b('0x11')]['endsWith'](a72_0x5a1b('0x12'))&&_0x32cca2[a72_0x5a1b('0x13')]>0x0){sequelize_utils_1[a72_0x5a1b('0x6')]['models']['syncFilesModel'][a72_0x5a1b('0x14')]({'where':{'file_name':_0x32cca2['name']}})[a72_0x5a1b('0x15')]((_0x459836,_0x2c4c01)=>{if(_0x2c4c01){_0x1852f1['push'](_0x459836);}});}}}});});_0x4973e6['on'](a72_0x5a1b('0x16'),function(_0x4bf888){});_0x4973e6['connect']({'host':a72_0x5a1b('0x17'),'port':0x15,'user':a72_0x5a1b('0x18'),'password':a72_0x5a1b('0x18')});_0x533963[a72_0x5a1b('0x12')]({'data':[]});}[a72_0x5a1b('0x8')](_0x4f8edc,_0x3524e5,_0x3bf769){sequelize_utils_1[a72_0x5a1b('0x6')][a72_0x5a1b('0x19')][a72_0x5a1b('0x1a')]['findOne']({'where':{'status':null}})['then'](_0x5efb41=>{if(_0x5efb41){const _0x10f71b=new ftp_1['default']();_0x10f71b['on'](a72_0x5a1b('0xd'),function(){console[a72_0x5a1b('0xb')](a72_0x5a1b('0x1b')+_0x5efb41[a72_0x5a1b('0x1c')]);_0x10f71b['get']('colombia/'+_0x5efb41[a72_0x5a1b('0x1c')],function(_0x128624,_0x2011aa){_0x10f71b[a72_0x5a1b('0x1d')]();if(_0x128624){}else{const _0xce8928='media/'+_0x5efb41[a72_0x5a1b('0x1c')]+a72_0x5a1b('0x1e');_0x2011aa[a72_0x5a1b('0x1f')](fs_1[a72_0x5a1b('0x6')][a72_0x5a1b('0x20')](_0xce8928));_0x5efb41[a72_0x5a1b('0x21')]=0x1;_0x5efb41[a72_0x5a1b('0x22')]();console[a72_0x5a1b('0xb')](a72_0x5a1b('0x23')+_0x5efb41[a72_0x5a1b('0x24')]);}});});_0x10f71b['on'](a72_0x5a1b('0x16'),function(_0x5b9e5c){});_0x10f71b[a72_0x5a1b('0x25')]({'host':'ftp.vivotek.com','port':0x15,'user':'ipd','password':a72_0x5a1b('0x18')});}else{}});_0x3524e5[a72_0x5a1b('0x12')]({'data':[]});}[a72_0x5a1b('0xa')](_0x375865,_0x20ee34,_0x476a04){sequelize_utils_1[a72_0x5a1b('0x6')]['models'][a72_0x5a1b('0x1a')][a72_0x5a1b('0x26')]({'where':{'status':0x1}})['then'](_0x48c2d2=>{if(_0x48c2d2){const _0x3503e9='media/'+_0x48c2d2[a72_0x5a1b('0x1c')]+a72_0x5a1b('0x1e');if(fs_1['default'][a72_0x5a1b('0x27')](_0x3503e9)){const _0x4654d8=fs_1[a72_0x5a1b('0x6')][a72_0x5a1b('0x28')](_0x3503e9);const _0x30b12d=_0x4654d8['size'];console['log'](a72_0x5a1b('0x29')+_0x3503e9);console[a72_0x5a1b('0xb')](a72_0x5a1b('0x2a')+_0x30b12d);if(_0x30b12d>0x0){fs_1[a72_0x5a1b('0x6')][a72_0x5a1b('0x2b')](_0x3503e9,a72_0x5a1b('0x2c'),function(_0x3a45d1,_0x2d645e){if(_0x3a45d1){_0x48c2d2[a72_0x5a1b('0x21')]=null;}else{try{const _0x7a56a6=JSON[a72_0x5a1b('0x2d')](_0x2d645e);for(const _0x1a779b of _0x7a56a6['Data'][0x0][a72_0x5a1b('0x2e')]){const _0x2e83c4=_0x1a779b['In'];const _0x2404ee=_0x1a779b[a72_0x5a1b('0x2f')];const _0x53608c=Date[a72_0x5a1b('0x2d')](_0x1a779b['EndTime']);if(_0x2e83c4>0x0){sequelize_utils_1[a72_0x5a1b('0x6')][a72_0x5a1b('0x19')][a72_0x5a1b('0x30')][a72_0x5a1b('0x31')]({'amount':_0x2e83c4,'counted_at':_0x53608c});}if(_0x2404ee>0x0){sequelize_utils_1[a72_0x5a1b('0x6')][a72_0x5a1b('0x19')][a72_0x5a1b('0x30')][a72_0x5a1b('0x31')]({'amount':_0x2404ee*-0x1,'counted_at':_0x53608c});}}_0x48c2d2['status']=0x2;}catch(_0x375360){_0x48c2d2[a72_0x5a1b('0x21')]=null;}}_0x48c2d2[a72_0x5a1b('0x22')]();});}else{_0x48c2d2['status']=null;_0x48c2d2['save']();}}else{_0x48c2d2['status']=null;_0x48c2d2['save']();}}else{}});_0x20ee34[a72_0x5a1b('0x12')]({'data':[]});}[a72_0x5a1b('0x32')](_0x4c0e79,_0x24e4d9,_0x438d47){const _0x2d6b41=require(a72_0x5a1b('0x33'));const _0x30eea6=_0x4c0e79[a72_0x5a1b('0x34')][a72_0x5a1b('0x35')];const _0x54431e=UPLOAD_PATH+'/'+_0x4c0e79['file'][a72_0x5a1b('0x36')]+a72_0x5a1b('0x37');const _0x2bf4c1=fs_1['default'][a72_0x5a1b('0x38')](_0x30eea6);const _0x156e30=fs_1[a72_0x5a1b('0x6')]['createWriteStream'](_0x54431e);const _0x563152=_0x2d6b41[a72_0x5a1b('0x39')]();console[a72_0x5a1b('0xb')](_0x4c0e79[a72_0x5a1b('0x34')]);_0x2bf4c1[a72_0x5a1b('0x1f')](_0x563152)[a72_0x5a1b('0x1f')](_0x156e30)['on'](a72_0x5a1b('0x3a'),_0x3bec75=>{if(_0x3bec75)return console['error'](_0x3bec75);else{const _0x3a8aa9=fs_1[a72_0x5a1b('0x6')][a72_0x5a1b('0x28')](_0x30eea6);const _0x102c5d=_0x3a8aa9[a72_0x5a1b('0x13')];if(_0x102c5d>0x0){fs_1[a72_0x5a1b('0x6')][a72_0x5a1b('0x2b')](_0x54431e,a72_0x5a1b('0x2c'),function(_0x3bec75,_0x32bc31){if(_0x3bec75){return console[a72_0x5a1b('0x16')](_0x3bec75);}else{try{const _0xe7bd8d=JSON[a72_0x5a1b('0x2d')](_0x32bc31);console[a72_0x5a1b('0xb')](_0xe7bd8d);const _0x431d45=_0xe7bd8d[a72_0x5a1b('0x3b')][0x0][a72_0x5a1b('0x3c')];const _0x5a551b=_0xe7bd8d['eventos'][0x0][a72_0x5a1b('0x3d')];const _0x5ddd35=moment_1[a72_0x5a1b('0x6')](_0x431d45+'\x20'+_0x5a551b+a72_0x5a1b('0x3e'),a72_0x5a1b('0x3f'));const _0x5a7967=parseFloat(_0xe7bd8d[a72_0x5a1b('0x3b')][0x0]['latitud']['replace'](',','.'));const _0x2c2675=parseFloat(_0xe7bd8d['eventos'][0x0][a72_0x5a1b('0x40')]['replace'](',','.'));const _0x2dc2d6=_0xe7bd8d['eventos'][0x0][a72_0x5a1b('0x41')];const _0x56c507=_0xe7bd8d['eventos'][0x0][a72_0x5a1b('0x42')][0x0][a72_0x5a1b('0x43')];const _0x4cf89d=_0xe7bd8d['eventos'][0x0][a72_0x5a1b('0x42')][0x0][a72_0x5a1b('0x44')];console[a72_0x5a1b('0xb')](_0x5a7967);console['log'](_0x2c2675);console[a72_0x5a1b('0xb')](_0x2dc2d6);console['log'](_0x56c507);console[a72_0x5a1b('0xb')](_0x4cf89d);console[a72_0x5a1b('0xb')](_0x5ddd35);if(_0x56c507>0x0){sequelize_utils_1[a72_0x5a1b('0x6')][a72_0x5a1b('0x19')]['passCountingsModel'][a72_0x5a1b('0x31')]({'amount':_0x56c507,'counted_at':_0x5ddd35});}sequelize_utils_1[a72_0x5a1b('0x6')][a72_0x5a1b('0x19')][a72_0x5a1b('0x45')][a72_0x5a1b('0x31')]({'device_id':null,'lat':''+_0x5a7967,'lon':''+_0x2c2675,'tracked_at':_0x5ddd35});}catch(_0x1b6520){return console[a72_0x5a1b('0x16')](_0x1b6520);}}});}}});_0x24e4d9[a72_0x5a1b('0x12')]({'status':0x1,'data':_0x4c0e79[a72_0x5a1b('0x34')]});}}exports[a72_0x5a1b('0x6')]=SyncFilesController;