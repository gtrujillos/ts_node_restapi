var a73_0xc501=['then','connected:','file_name','get','end','.txt','pipe','createWriteStream','status','save','fileName','connect','media/','existsSync','fileName:\x20','fileSizeInBytes:\x20','readFile','utf8','Out','parse','passCountingsModel','create','uploadEvent','zlib','file','path','filename','.json','createGunzip','finish','eventos','fecha','hora','\x20-05:00','YYYYMMDD\x20HHmmss\x20Z','latitud','replace','longitud','velocidad','ingresos','salidas','json','__importDefault','__esModule','defineProperty','ftp','../../infrastructure/controller-utils','../../infrastructure/sequelize-utils','moment','default','syncFtp','bind','downloadFtp','processFtp','log','connecting','ready','connected','list','name','endsWith','size','models','findOrCreate','spread','push','error','ftp.vivotek.com','ipd','syncFilesModel','findOne'];(function(_0x354724,_0xc065c0){var _0x15333e=function(_0x22daf1){while(--_0x22daf1){_0x354724['push'](_0x354724['shift']());}};_0x15333e(++_0xc065c0);}(a73_0xc501,0xb8));var a73_0x1e58=function(_0x559ad5,_0x34cfdf){_0x559ad5=_0x559ad5-0x0;var _0x3bc31c=a73_0xc501[_0x559ad5];return _0x3bc31c;};'use strict';var __importDefault=this&&this[a73_0x1e58('0x0')]||function(_0x3aea3b){return _0x3aea3b&&_0x3aea3b[a73_0x1e58('0x1')]?_0x3aea3b:{'default':_0x3aea3b};};Object[a73_0x1e58('0x2')](exports,a73_0x1e58('0x1'),{'value':!![]});const ftp_1=__importDefault(require(a73_0x1e58('0x3')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a73_0x1e58('0x4')));const sequelize_utils_1=__importDefault(require(a73_0x1e58('0x5')));const moment_1=__importDefault(require(a73_0x1e58('0x6')));const UPLOAD_PATH='media';class SyncFilesController extends controller_utils_1[a73_0x1e58('0x7')]{constructor(_0x356a2a){super(_0x356a2a,null);this[a73_0x1e58('0x8')]=this['syncFtp'][a73_0x1e58('0x9')](this);this['downloadFtp']=this[a73_0x1e58('0xa')]['bind'](this);this['processFtp']=this[a73_0x1e58('0xb')][a73_0x1e58('0x9')](this);}[a73_0x1e58('0x8')](_0x58add5,_0x2786f1,_0x23186a){console[a73_0x1e58('0xc')](a73_0x1e58('0xd'));const _0x413bc6=[];const _0xfba76c=new ftp_1[(a73_0x1e58('0x7'))]();_0xfba76c['on'](a73_0x1e58('0xe'),function(){console[a73_0x1e58('0xc')](a73_0x1e58('0xf'));_0xfba76c[a73_0x1e58('0x10')]('colombia',![],function(_0x43b712,_0xade400){if(_0x43b712){console[a73_0x1e58('0xc')](_0x43b712);}else{for(const _0x1e3c19 of _0xade400){if(_0x1e3c19[a73_0x1e58('0x11')][a73_0x1e58('0x12')]('json')&&_0x1e3c19[a73_0x1e58('0x13')]>0x0){sequelize_utils_1[a73_0x1e58('0x7')][a73_0x1e58('0x14')]['syncFilesModel'][a73_0x1e58('0x15')]({'where':{'file_name':_0x1e3c19['name']}})[a73_0x1e58('0x16')]((_0x27f905,_0x17f285)=>{if(_0x17f285){_0x413bc6[a73_0x1e58('0x17')](_0x27f905);}});}}}});});_0xfba76c['on'](a73_0x1e58('0x18'),function(_0x151ed1){});_0xfba76c['connect']({'host':a73_0x1e58('0x19'),'port':0x15,'user':a73_0x1e58('0x1a'),'password':a73_0x1e58('0x1a')});_0x2786f1['json']({'data':[]});}[a73_0x1e58('0xa')](_0x2d0414,_0x2a2eac,_0x5b8377){sequelize_utils_1[a73_0x1e58('0x7')][a73_0x1e58('0x14')][a73_0x1e58('0x1b')][a73_0x1e58('0x1c')]({'where':{'status':null}})[a73_0x1e58('0x1d')](_0x52bfa1=>{if(_0x52bfa1){const _0x2c79f3=new ftp_1[(a73_0x1e58('0x7'))]();_0x2c79f3['on'](a73_0x1e58('0xe'),function(){console[a73_0x1e58('0xc')](a73_0x1e58('0x1e')+_0x52bfa1[a73_0x1e58('0x1f')]);_0x2c79f3[a73_0x1e58('0x20')]('colombia/'+_0x52bfa1[a73_0x1e58('0x1f')],function(_0x4bc424,_0x2de6be){_0x2c79f3[a73_0x1e58('0x21')]();if(_0x4bc424){}else{const _0x3cf678='media/'+_0x52bfa1[a73_0x1e58('0x1f')]+a73_0x1e58('0x22');_0x2de6be[a73_0x1e58('0x23')](fs_1['default'][a73_0x1e58('0x24')](_0x3cf678));_0x52bfa1[a73_0x1e58('0x25')]=0x1;_0x52bfa1[a73_0x1e58('0x26')]();console[a73_0x1e58('0xc')]('Downloaded:\x20'+_0x52bfa1[a73_0x1e58('0x27')]);}});});_0x2c79f3['on'](a73_0x1e58('0x18'),function(_0xfef167){});_0x2c79f3[a73_0x1e58('0x28')]({'host':'ftp.vivotek.com','port':0x15,'user':a73_0x1e58('0x1a'),'password':'ipd'});}else{}});_0x2a2eac['json']({'data':[]});}[a73_0x1e58('0xb')](_0x3f3309,_0x2b16e6,_0xa59f84){sequelize_utils_1['default'][a73_0x1e58('0x14')]['syncFilesModel'][a73_0x1e58('0x1c')]({'where':{'status':0x1}})[a73_0x1e58('0x1d')](_0x57492e=>{if(_0x57492e){const _0x29198f=a73_0x1e58('0x29')+_0x57492e['file_name']+a73_0x1e58('0x22');if(fs_1[a73_0x1e58('0x7')][a73_0x1e58('0x2a')](_0x29198f)){const _0x1797b7=fs_1[a73_0x1e58('0x7')]['statSync'](_0x29198f);const _0x3eb793=_0x1797b7['size'];console[a73_0x1e58('0xc')](a73_0x1e58('0x2b')+_0x29198f);console[a73_0x1e58('0xc')](a73_0x1e58('0x2c')+_0x3eb793);if(_0x3eb793>0x0){fs_1[a73_0x1e58('0x7')][a73_0x1e58('0x2d')](_0x29198f,a73_0x1e58('0x2e'),function(_0xd0ae28,_0x1de3b5){if(_0xd0ae28){_0x57492e[a73_0x1e58('0x25')]=null;}else{try{const _0x4b7a84=JSON['parse'](_0x1de3b5);for(const _0x44ef06 of _0x4b7a84['Data'][0x0]['CountingInfo']){const _0x456b85=_0x44ef06['In'];const _0x4d9caa=_0x44ef06[a73_0x1e58('0x2f')];const _0xa108b3=Date[a73_0x1e58('0x30')](_0x44ef06['EndTime']);if(_0x456b85>0x0){sequelize_utils_1[a73_0x1e58('0x7')][a73_0x1e58('0x14')][a73_0x1e58('0x31')]['create']({'amount':_0x456b85,'counted_at':_0xa108b3});}if(_0x4d9caa>0x0){sequelize_utils_1[a73_0x1e58('0x7')]['models'][a73_0x1e58('0x31')][a73_0x1e58('0x32')]({'amount':_0x4d9caa*-0x1,'counted_at':_0xa108b3});}}_0x57492e[a73_0x1e58('0x25')]=0x2;}catch(_0x7421f5){_0x57492e['status']=null;}}_0x57492e[a73_0x1e58('0x26')]();});}else{_0x57492e[a73_0x1e58('0x25')]=null;_0x57492e['save']();}}else{_0x57492e['status']=null;_0x57492e[a73_0x1e58('0x26')]();}}else{}});_0x2b16e6['json']({'data':[]});}[a73_0x1e58('0x33')](_0x3fdfee,_0x53180d,_0x468ec9){const _0x2c075d=require(a73_0x1e58('0x34'));const _0x4f3261=_0x3fdfee[a73_0x1e58('0x35')][a73_0x1e58('0x36')];const _0x21c019=UPLOAD_PATH+'/'+_0x3fdfee[a73_0x1e58('0x35')][a73_0x1e58('0x37')]+a73_0x1e58('0x38');const _0x34662b=fs_1[a73_0x1e58('0x7')]['createReadStream'](_0x4f3261);const _0x384170=fs_1[a73_0x1e58('0x7')]['createWriteStream'](_0x21c019);const _0x2018c0=_0x2c075d[a73_0x1e58('0x39')]();console[a73_0x1e58('0xc')](_0x3fdfee[a73_0x1e58('0x35')]);_0x34662b[a73_0x1e58('0x23')](_0x2018c0)['pipe'](_0x384170)['on'](a73_0x1e58('0x3a'),_0x1a14ef=>{if(_0x1a14ef)return console[a73_0x1e58('0x18')](_0x1a14ef);else{const _0x229d9c=fs_1[a73_0x1e58('0x7')]['statSync'](_0x4f3261);const _0xf0a154=_0x229d9c[a73_0x1e58('0x13')];if(_0xf0a154>0x0){fs_1['default'][a73_0x1e58('0x2d')](_0x21c019,a73_0x1e58('0x2e'),function(_0x1a14ef,_0x132424){if(_0x1a14ef){return console[a73_0x1e58('0x18')](_0x1a14ef);}else{try{const _0x20eb34=JSON[a73_0x1e58('0x30')](_0x132424);console[a73_0x1e58('0xc')](_0x20eb34);const _0x2877fb=_0x20eb34[a73_0x1e58('0x3b')][0x0][a73_0x1e58('0x3c')];const _0x5611d1=_0x20eb34['eventos'][0x0][a73_0x1e58('0x3d')];const _0x77d460=moment_1['default'](_0x2877fb+'\x20'+_0x5611d1+a73_0x1e58('0x3e'),a73_0x1e58('0x3f'));const _0x4da88c=parseFloat(_0x20eb34[a73_0x1e58('0x3b')][0x0][a73_0x1e58('0x40')][a73_0x1e58('0x41')](',','.'));const _0x1b7fa5=parseFloat(_0x20eb34['eventos'][0x0][a73_0x1e58('0x42')][a73_0x1e58('0x41')](',','.'));const _0x4d785c=_0x20eb34[a73_0x1e58('0x3b')][0x0][a73_0x1e58('0x43')];const _0x11b2db=_0x20eb34[a73_0x1e58('0x3b')][0x0]['puerta'][0x0][a73_0x1e58('0x44')];const _0x425146=_0x20eb34[a73_0x1e58('0x3b')][0x0]['puerta'][0x0][a73_0x1e58('0x45')];console[a73_0x1e58('0xc')](_0x4da88c);console[a73_0x1e58('0xc')](_0x1b7fa5);console[a73_0x1e58('0xc')](_0x4d785c);console[a73_0x1e58('0xc')](_0x11b2db);console[a73_0x1e58('0xc')](_0x425146);console[a73_0x1e58('0xc')](_0x77d460);if(_0x11b2db>0x0){sequelize_utils_1['default'][a73_0x1e58('0x14')][a73_0x1e58('0x31')][a73_0x1e58('0x32')]({'amount':_0x11b2db,'counted_at':_0x77d460});}sequelize_utils_1['default'][a73_0x1e58('0x14')]['locationPointsModel']['create']({'device_id':null,'lat':''+_0x4da88c,'lon':''+_0x1b7fa5,'tracked_at':_0x77d460});}catch(_0x4351b9){return console[a73_0x1e58('0x18')](_0x4351b9);}}});}}});_0x53180d[a73_0x1e58('0x46')]({'status':0x1,'data':_0x3fdfee[a73_0x1e58('0x35')]});}}exports[a73_0x1e58('0x7')]=SyncFilesController;