var a126_0x2977=['velocidad','puerta','ingresos','salidas','locationPointsModel','create','__importDefault','__esModule','defineProperty','ftp','../../infrastructure/base-controller','../../infrastructure/sequelize-utils','moment','syncFtp','bind','downloadFtp','processFtp','log','connecting','default','ready','connected','list','colombia','name','endsWith','json','size','syncFilesModel','spread','push','error','connect','ftp.vivotek.com','ipd','findOne','then','file_name','colombia/','end','media/','pipe','createWriteStream','status','fileName','models','existsSync','fileSizeInBytes:\x20','readFile','utf8','parse','Data','CountingInfo','EndTime','passCountingsModel','save','zlib','path','file','.json','createReadStream','createGunzip','statSync','eventos','fecha','\x20-05:00','YYYYMMDD\x20HHmmss\x20Z','latitud','longitud','replace'];(function(_0x191433,_0x8efdca){var _0x34f2af=function(_0x5ecf22){while(--_0x5ecf22){_0x191433['push'](_0x191433['shift']());}};_0x34f2af(++_0x8efdca);}(a126_0x2977,0x164));var a126_0x78c5=function(_0x193fb3,_0xc17daa){_0x193fb3=_0x193fb3-0x0;var _0x2fb199=a126_0x2977[_0x193fb3];return _0x2fb199;};'use strict';var __importDefault=this&&this[a126_0x78c5('0x0')]||function(_0x24f82f){return _0x24f82f&&_0x24f82f[a126_0x78c5('0x1')]?_0x24f82f:{'default':_0x24f82f};};Object[a126_0x78c5('0x2')](exports,a126_0x78c5('0x1'),{'value':!![]});const ftp_1=__importDefault(require(a126_0x78c5('0x3')));const fs_1=__importDefault(require('fs'));const base_controller_1=__importDefault(require(a126_0x78c5('0x4')));const sequelize_utils_1=__importDefault(require(a126_0x78c5('0x5')));const moment_1=__importDefault(require(a126_0x78c5('0x6')));const UPLOAD_PATH='media';class SyncFilesController extends base_controller_1['default']{constructor(_0x32609a){super(_0x32609a,null);this[a126_0x78c5('0x7')]=this['syncFtp'][a126_0x78c5('0x8')](this);this[a126_0x78c5('0x9')]=this[a126_0x78c5('0x9')][a126_0x78c5('0x8')](this);this[a126_0x78c5('0xa')]=this[a126_0x78c5('0xa')]['bind'](this);}['syncFtp'](_0x334c1f,_0x11f533,_0xf08146){console[a126_0x78c5('0xb')](a126_0x78c5('0xc'));const _0x7d169e=[];const _0x588ccf=new ftp_1[(a126_0x78c5('0xd'))]();_0x588ccf['on'](a126_0x78c5('0xe'),function(){console[a126_0x78c5('0xb')](a126_0x78c5('0xf'));_0x588ccf[a126_0x78c5('0x10')](a126_0x78c5('0x11'),![],function(_0x8aae95,_0x4cb869){if(_0x8aae95){console['log'](_0x8aae95);}else{for(const _0x20e080 of _0x4cb869){if(_0x20e080[a126_0x78c5('0x12')][a126_0x78c5('0x13')](a126_0x78c5('0x14'))&&_0x20e080[a126_0x78c5('0x15')]>0x0){sequelize_utils_1[a126_0x78c5('0xd')]['models'][a126_0x78c5('0x16')]['findOrCreate']({'where':{'file_name':_0x20e080[a126_0x78c5('0x12')]}})[a126_0x78c5('0x17')]((_0x251a44,_0x236b56)=>{if(_0x236b56){_0x7d169e[a126_0x78c5('0x18')](_0x251a44);}});}}}});});_0x588ccf['on'](a126_0x78c5('0x19'),function(_0x3de7e6){});_0x588ccf[a126_0x78c5('0x1a')]({'host':a126_0x78c5('0x1b'),'port':0x15,'user':a126_0x78c5('0x1c'),'password':a126_0x78c5('0x1c')});_0x11f533['json']({'data':[]});}['downloadFtp'](_0x442c3d,_0x1cf5f4,_0x215f21){sequelize_utils_1[a126_0x78c5('0xd')]['models'][a126_0x78c5('0x16')][a126_0x78c5('0x1d')]({'where':{'status':null}})[a126_0x78c5('0x1e')](_0x1c8678=>{if(_0x1c8678){const _0x415db4=new ftp_1[(a126_0x78c5('0xd'))]();_0x415db4['on']('ready',function(){console[a126_0x78c5('0xb')]('connected:'+_0x1c8678[a126_0x78c5('0x1f')]);_0x415db4['get'](a126_0x78c5('0x20')+_0x1c8678[a126_0x78c5('0x1f')],function(_0x34ec3e,_0x3510d7){_0x415db4[a126_0x78c5('0x21')]();if(_0x34ec3e){}else{const _0x50e964=a126_0x78c5('0x22')+_0x1c8678[a126_0x78c5('0x1f')]+'.txt';_0x3510d7[a126_0x78c5('0x23')](fs_1[a126_0x78c5('0xd')][a126_0x78c5('0x24')](_0x50e964));_0x1c8678[a126_0x78c5('0x25')]=0x1;_0x1c8678['save']();console['log']('Downloaded:\x20'+_0x1c8678[a126_0x78c5('0x26')]);}});});_0x415db4['on'](a126_0x78c5('0x19'),function(_0x525321){});_0x415db4[a126_0x78c5('0x1a')]({'host':a126_0x78c5('0x1b'),'port':0x15,'user':'ipd','password':a126_0x78c5('0x1c')});}else{}});_0x1cf5f4[a126_0x78c5('0x14')]({'data':[]});}['processFtp'](_0x509c3c,_0x501e72,_0x7bc5e7){sequelize_utils_1[a126_0x78c5('0xd')][a126_0x78c5('0x27')][a126_0x78c5('0x16')][a126_0x78c5('0x1d')]({'where':{'status':0x1}})[a126_0x78c5('0x1e')](_0x589698=>{if(_0x589698){const _0x214408='media/'+_0x589698[a126_0x78c5('0x1f')]+'.txt';if(fs_1[a126_0x78c5('0xd')][a126_0x78c5('0x28')](_0x214408)){const _0x105023=fs_1[a126_0x78c5('0xd')]['statSync'](_0x214408);const _0x3666d8=_0x105023[a126_0x78c5('0x15')];console['log']('fileName:\x20'+_0x214408);console[a126_0x78c5('0xb')](a126_0x78c5('0x29')+_0x3666d8);if(_0x3666d8>0x0){fs_1[a126_0x78c5('0xd')][a126_0x78c5('0x2a')](_0x214408,a126_0x78c5('0x2b'),function(_0x2a2b2c,_0x5db856){if(_0x2a2b2c){_0x589698[a126_0x78c5('0x25')]=null;}else{try{const _0x14561b=JSON[a126_0x78c5('0x2c')](_0x5db856);for(const _0x5d0337 of _0x14561b[a126_0x78c5('0x2d')][0x0][a126_0x78c5('0x2e')]){const _0x304cae=_0x5d0337['In'];const _0x4e54eb=_0x5d0337['Out'];const _0x57509b=Date[a126_0x78c5('0x2c')](_0x5d0337[a126_0x78c5('0x2f')]);if(_0x304cae>0x0){sequelize_utils_1[a126_0x78c5('0xd')][a126_0x78c5('0x27')][a126_0x78c5('0x30')]['create']({'amount':_0x304cae,'counted_at':_0x57509b});}if(_0x4e54eb>0x0){sequelize_utils_1[a126_0x78c5('0xd')][a126_0x78c5('0x27')][a126_0x78c5('0x30')]['create']({'amount':_0x4e54eb*-0x1,'counted_at':_0x57509b});}}_0x589698[a126_0x78c5('0x25')]=0x2;}catch(_0x1575d4){_0x589698[a126_0x78c5('0x25')]=null;}}_0x589698[a126_0x78c5('0x31')]();});}else{_0x589698[a126_0x78c5('0x25')]=null;_0x589698['save']();}}else{_0x589698['status']=null;_0x589698[a126_0x78c5('0x31')]();}}else{}});_0x501e72[a126_0x78c5('0x14')]({'data':[]});}['uploadEvent'](_0x5b9235,_0x43bdfd,_0x2e5d62){const _0x21eca5=require(a126_0x78c5('0x32'));const _0xc563f9=_0x5b9235['file'][a126_0x78c5('0x33')];const _0xdf9c8a=UPLOAD_PATH+'/'+_0x5b9235[a126_0x78c5('0x34')]['filename']+a126_0x78c5('0x35');const _0x535858=fs_1[a126_0x78c5('0xd')][a126_0x78c5('0x36')](_0xc563f9);const _0x2352b6=fs_1[a126_0x78c5('0xd')][a126_0x78c5('0x24')](_0xdf9c8a);const _0x103bf2=_0x21eca5[a126_0x78c5('0x37')]();console['log'](_0x5b9235[a126_0x78c5('0x34')]);_0x535858[a126_0x78c5('0x23')](_0x103bf2)[a126_0x78c5('0x23')](_0x2352b6)['on']('finish',_0x68c3a5=>{if(_0x68c3a5)return console['error'](_0x68c3a5);else{const _0x49ac4f=fs_1[a126_0x78c5('0xd')][a126_0x78c5('0x38')](_0xc563f9);const _0x2fe0ed=_0x49ac4f['size'];if(_0x2fe0ed>0x0){fs_1[a126_0x78c5('0xd')][a126_0x78c5('0x2a')](_0xdf9c8a,'utf8',function(_0x68c3a5,_0x1288e1){if(_0x68c3a5){return console[a126_0x78c5('0x19')](_0x68c3a5);}else{try{const _0x2a106f=JSON['parse'](_0x1288e1);console[a126_0x78c5('0xb')](_0x2a106f);const _0x22530e=_0x2a106f[a126_0x78c5('0x39')][0x0][a126_0x78c5('0x3a')];const _0x46056b=_0x2a106f[a126_0x78c5('0x39')][0x0]['hora'];const _0x33a35f=moment_1[a126_0x78c5('0xd')](_0x22530e+'\x20'+_0x46056b+a126_0x78c5('0x3b'),a126_0x78c5('0x3c'));const _0x2cd310=parseFloat(_0x2a106f[a126_0x78c5('0x39')][0x0][a126_0x78c5('0x3d')]['replace'](',','.'));const _0x236083=parseFloat(_0x2a106f[a126_0x78c5('0x39')][0x0][a126_0x78c5('0x3e')][a126_0x78c5('0x3f')](',','.'));const _0x4e4204=_0x2a106f['eventos'][0x0][a126_0x78c5('0x40')];const _0x2e615e=_0x2a106f[a126_0x78c5('0x39')][0x0][a126_0x78c5('0x41')][0x0][a126_0x78c5('0x42')];const _0xddfe84=_0x2a106f[a126_0x78c5('0x39')][0x0][a126_0x78c5('0x41')][0x0][a126_0x78c5('0x43')];console[a126_0x78c5('0xb')](_0x2cd310);console[a126_0x78c5('0xb')](_0x236083);console[a126_0x78c5('0xb')](_0x4e4204);console['log'](_0x2e615e);console[a126_0x78c5('0xb')](_0xddfe84);console[a126_0x78c5('0xb')](_0x33a35f);if(_0x2e615e>0x0){sequelize_utils_1[a126_0x78c5('0xd')][a126_0x78c5('0x27')]['passCountingsModel']['create']({'amount':_0x2e615e,'counted_at':_0x33a35f});}sequelize_utils_1[a126_0x78c5('0xd')]['models'][a126_0x78c5('0x44')][a126_0x78c5('0x45')]({'device_id':null,'lat':''+_0x2cd310,'lon':''+_0x236083,'tracked_at':_0x33a35f});}catch(_0x544288){return console[a126_0x78c5('0x19')](_0x544288);}}});}}});_0x43bdfd[a126_0x78c5('0x14')]({'status':0x1,'data':_0x5b9235[a126_0x78c5('0x34')]});}}exports[a126_0x78c5('0xd')]=SyncFilesController;