var a73_0x2aac=['bind','processFtp','connecting','ready','log','connected','name','endsWith','size','models','syncFilesModel','findOrCreate','spread','error','connect','ipd','json','findOne','then','file_name','get','colombia/','media/','pipe','createWriteStream','status','fileName','ftp.vivotek.com','.txt','existsSync','statSync','fileName:\x20','fileSizeInBytes:\x20','readFile','utf8','parse','CountingInfo','Out','EndTime','passCountingsModel','create','save','zlib','file','path','filename','.json','createReadStream','eventos','fecha','hora','\x20-05:00','YYYYMMDD\x20HHmmss\x20Z','latitud','replace','velocidad','puerta','ingresos','salidas','locationPointsModel','__importDefault','__esModule','ftp','../../infrastructure/controller-utils','../../infrastructure/sequelize-utils','media','default','syncFtp','downloadFtp'];(function(_0xa18bf5,_0x5f4416){var _0x36c24d=function(_0x2c0ba1){while(--_0x2c0ba1){_0xa18bf5['push'](_0xa18bf5['shift']());}};_0x36c24d(++_0x5f4416);}(a73_0x2aac,0x150));var a73_0xf504=function(_0x5ed270,_0x4fb432){_0x5ed270=_0x5ed270-0x0;var _0x4919bd=a73_0x2aac[_0x5ed270];return _0x4919bd;};'use strict';var __importDefault=this&&this[a73_0xf504('0x0')]||function(_0x5e0873){return _0x5e0873&&_0x5e0873[a73_0xf504('0x1')]?_0x5e0873:{'default':_0x5e0873};};Object['defineProperty'](exports,a73_0xf504('0x1'),{'value':!![]});const ftp_1=__importDefault(require(a73_0xf504('0x2')));const fs_1=__importDefault(require('fs'));const controller_utils_1=__importDefault(require(a73_0xf504('0x3')));const sequelize_utils_1=__importDefault(require(a73_0xf504('0x4')));const moment_1=__importDefault(require('moment'));const UPLOAD_PATH=a73_0xf504('0x5');class SyncFilesController extends controller_utils_1[a73_0xf504('0x6')]{constructor(_0x2556f1){super(_0x2556f1,null);this[a73_0xf504('0x7')]=this[a73_0xf504('0x7')]['bind'](this);this[a73_0xf504('0x8')]=this[a73_0xf504('0x8')][a73_0xf504('0x9')](this);this['processFtp']=this[a73_0xf504('0xa')]['bind'](this);}[a73_0xf504('0x7')](_0x5a28e1,_0x1e041e,_0x28ce34){console['log'](a73_0xf504('0xb'));const _0x5d6dcd=[];const _0x1165e9=new ftp_1[(a73_0xf504('0x6'))]();_0x1165e9['on'](a73_0xf504('0xc'),function(){console[a73_0xf504('0xd')](a73_0xf504('0xe'));_0x1165e9['list']('colombia',![],function(_0x17f83f,_0x52af94){if(_0x17f83f){console[a73_0xf504('0xd')](_0x17f83f);}else{for(const _0x567ee8 of _0x52af94){if(_0x567ee8[a73_0xf504('0xf')][a73_0xf504('0x10')]('json')&&_0x567ee8[a73_0xf504('0x11')]>0x0){sequelize_utils_1[a73_0xf504('0x6')][a73_0xf504('0x12')][a73_0xf504('0x13')][a73_0xf504('0x14')]({'where':{'file_name':_0x567ee8[a73_0xf504('0xf')]}})[a73_0xf504('0x15')]((_0x26c160,_0x56d7fb)=>{if(_0x56d7fb){_0x5d6dcd['push'](_0x26c160);}});}}}});});_0x1165e9['on'](a73_0xf504('0x16'),function(_0x1fa1be){});_0x1165e9[a73_0xf504('0x17')]({'host':'ftp.vivotek.com','port':0x15,'user':a73_0xf504('0x18'),'password':'ipd'});_0x1e041e[a73_0xf504('0x19')]({'data':[]});}[a73_0xf504('0x8')](_0xa9ad5c,_0x14b0f0,_0x316c52){sequelize_utils_1[a73_0xf504('0x6')][a73_0xf504('0x12')][a73_0xf504('0x13')][a73_0xf504('0x1a')]({'where':{'status':null}})[a73_0xf504('0x1b')](_0x3448a0=>{if(_0x3448a0){const _0x210556=new ftp_1[(a73_0xf504('0x6'))]();_0x210556['on'](a73_0xf504('0xc'),function(){console[a73_0xf504('0xd')]('connected:'+_0x3448a0[a73_0xf504('0x1c')]);_0x210556[a73_0xf504('0x1d')](a73_0xf504('0x1e')+_0x3448a0[a73_0xf504('0x1c')],function(_0x4ca569,_0x446462){_0x210556['end']();if(_0x4ca569){}else{const _0x1b77a0=a73_0xf504('0x1f')+_0x3448a0[a73_0xf504('0x1c')]+'.txt';_0x446462[a73_0xf504('0x20')](fs_1[a73_0xf504('0x6')][a73_0xf504('0x21')](_0x1b77a0));_0x3448a0[a73_0xf504('0x22')]=0x1;_0x3448a0['save']();console[a73_0xf504('0xd')]('Downloaded:\x20'+_0x3448a0[a73_0xf504('0x23')]);}});});_0x210556['on'](a73_0xf504('0x16'),function(_0x3aad32){});_0x210556[a73_0xf504('0x17')]({'host':a73_0xf504('0x24'),'port':0x15,'user':a73_0xf504('0x18'),'password':'ipd'});}else{}});_0x14b0f0[a73_0xf504('0x19')]({'data':[]});}[a73_0xf504('0xa')](_0x8b996e,_0x1eb8f1,_0x5c6dda){sequelize_utils_1[a73_0xf504('0x6')][a73_0xf504('0x12')][a73_0xf504('0x13')][a73_0xf504('0x1a')]({'where':{'status':0x1}})['then'](_0x5e46e2=>{if(_0x5e46e2){const _0x54fb51=a73_0xf504('0x1f')+_0x5e46e2[a73_0xf504('0x1c')]+a73_0xf504('0x25');if(fs_1['default'][a73_0xf504('0x26')](_0x54fb51)){const _0x5978e6=fs_1[a73_0xf504('0x6')][a73_0xf504('0x27')](_0x54fb51);const _0x4d7ae4=_0x5978e6[a73_0xf504('0x11')];console[a73_0xf504('0xd')](a73_0xf504('0x28')+_0x54fb51);console[a73_0xf504('0xd')](a73_0xf504('0x29')+_0x4d7ae4);if(_0x4d7ae4>0x0){fs_1['default'][a73_0xf504('0x2a')](_0x54fb51,a73_0xf504('0x2b'),function(_0x3e5d18,_0x5625d2){if(_0x3e5d18){_0x5e46e2[a73_0xf504('0x22')]=null;}else{try{const _0x703e7f=JSON[a73_0xf504('0x2c')](_0x5625d2);for(const _0x309be7 of _0x703e7f['Data'][0x0][a73_0xf504('0x2d')]){const _0x7a2c1d=_0x309be7['In'];const _0x4e414f=_0x309be7[a73_0xf504('0x2e')];const _0xd29937=Date['parse'](_0x309be7[a73_0xf504('0x2f')]);if(_0x7a2c1d>0x0){sequelize_utils_1[a73_0xf504('0x6')][a73_0xf504('0x12')][a73_0xf504('0x30')][a73_0xf504('0x31')]({'amount':_0x7a2c1d,'counted_at':_0xd29937});}if(_0x4e414f>0x0){sequelize_utils_1['default']['models'][a73_0xf504('0x30')]['create']({'amount':_0x4e414f*-0x1,'counted_at':_0xd29937});}}_0x5e46e2[a73_0xf504('0x22')]=0x2;}catch(_0x423cfc){_0x5e46e2[a73_0xf504('0x22')]=null;}}_0x5e46e2[a73_0xf504('0x32')]();});}else{_0x5e46e2[a73_0xf504('0x22')]=null;_0x5e46e2[a73_0xf504('0x32')]();}}else{_0x5e46e2[a73_0xf504('0x22')]=null;_0x5e46e2['save']();}}else{}});_0x1eb8f1['json']({'data':[]});}['uploadEvent'](_0x343e77,_0x196f00,_0x2c52ca){const _0x189630=require(a73_0xf504('0x33'));const _0x3f22ce=_0x343e77[a73_0xf504('0x34')][a73_0xf504('0x35')];const _0x294dce=UPLOAD_PATH+'/'+_0x343e77[a73_0xf504('0x34')][a73_0xf504('0x36')]+a73_0xf504('0x37');const _0x1beda1=fs_1[a73_0xf504('0x6')][a73_0xf504('0x38')](_0x3f22ce);const _0x1bd983=fs_1[a73_0xf504('0x6')]['createWriteStream'](_0x294dce);const _0x1e656e=_0x189630['createGunzip']();console[a73_0xf504('0xd')](_0x343e77[a73_0xf504('0x34')]);_0x1beda1[a73_0xf504('0x20')](_0x1e656e)['pipe'](_0x1bd983)['on']('finish',_0x3ed68d=>{if(_0x3ed68d)return console[a73_0xf504('0x16')](_0x3ed68d);else{const _0x4d78d6=fs_1['default'][a73_0xf504('0x27')](_0x3f22ce);const _0x299b3c=_0x4d78d6[a73_0xf504('0x11')];if(_0x299b3c>0x0){fs_1[a73_0xf504('0x6')][a73_0xf504('0x2a')](_0x294dce,a73_0xf504('0x2b'),function(_0x3ed68d,_0x31fdf8){if(_0x3ed68d){return console['error'](_0x3ed68d);}else{try{const _0x654cd2=JSON[a73_0xf504('0x2c')](_0x31fdf8);console[a73_0xf504('0xd')](_0x654cd2);const _0xbe9113=_0x654cd2[a73_0xf504('0x39')][0x0][a73_0xf504('0x3a')];const _0x289e55=_0x654cd2[a73_0xf504('0x39')][0x0][a73_0xf504('0x3b')];const _0x38e303=moment_1[a73_0xf504('0x6')](_0xbe9113+'\x20'+_0x289e55+a73_0xf504('0x3c'),a73_0xf504('0x3d'));const _0x3e2ec4=parseFloat(_0x654cd2[a73_0xf504('0x39')][0x0][a73_0xf504('0x3e')][a73_0xf504('0x3f')](',','.'));const _0x48b5cf=parseFloat(_0x654cd2[a73_0xf504('0x39')][0x0]['longitud'][a73_0xf504('0x3f')](',','.'));const _0xae5a02=_0x654cd2[a73_0xf504('0x39')][0x0][a73_0xf504('0x40')];const _0x3edc8b=_0x654cd2[a73_0xf504('0x39')][0x0][a73_0xf504('0x41')][0x0][a73_0xf504('0x42')];const _0x44db11=_0x654cd2[a73_0xf504('0x39')][0x0]['puerta'][0x0][a73_0xf504('0x43')];console[a73_0xf504('0xd')](_0x3e2ec4);console[a73_0xf504('0xd')](_0x48b5cf);console[a73_0xf504('0xd')](_0xae5a02);console['log'](_0x3edc8b);console[a73_0xf504('0xd')](_0x44db11);console[a73_0xf504('0xd')](_0x38e303);if(_0x3edc8b>0x0){sequelize_utils_1[a73_0xf504('0x6')][a73_0xf504('0x12')]['passCountingsModel'][a73_0xf504('0x31')]({'amount':_0x3edc8b,'counted_at':_0x38e303});}sequelize_utils_1[a73_0xf504('0x6')][a73_0xf504('0x12')][a73_0xf504('0x44')][a73_0xf504('0x31')]({'device_id':null,'lat':''+_0x3e2ec4,'lon':''+_0x48b5cf,'tracked_at':_0x38e303});}catch(_0x38ca05){return console['error'](_0x38ca05);}}});}}});_0x196f00[a73_0xf504('0x19')]({'status':0x1,'data':_0x343e77['file']});}}exports['default']=SyncFilesController;