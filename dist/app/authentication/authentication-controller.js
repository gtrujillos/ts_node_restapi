var a30_0x5bd4=['then','usernameNotFoundError','default','validPassword','sign','options','successResponse','errorResponse','hashPassword','create','dataValues','secret','stack','catch','__importDefault','__esModule','defineProperty','../../infrastructure/crypt-utils','jsonwebtoken','i18n','../../config/jwt.js','../../infrastructure/response-utils','../../resources/locale-strings','string-format','model','login','bind','createAccount','body','first_name','last_name','email','username','password'];(function(_0x392a50,_0x4ab71a){var _0xedd152=function(_0x504e38){while(--_0x504e38){_0x392a50['push'](_0x392a50['shift']());}};_0xedd152(++_0x4ab71a);}(a30_0x5bd4,0xfc));var a30_0x5006=function(_0x452a87,_0x2973f4){_0x452a87=_0x452a87-0x0;var _0x44a7cb=a30_0x5bd4[_0x452a87];return _0x44a7cb;};'use strict';var __importDefault=this&&this[a30_0x5006('0x0')]||function(_0x13d4e2){return _0x13d4e2&&_0x13d4e2[a30_0x5006('0x1')]?_0x13d4e2:{'default':_0x13d4e2};};Object[a30_0x5006('0x2')](exports,a30_0x5006('0x1'),{'value':!![]});const crypt_utils_1=__importDefault(require(a30_0x5006('0x3')));const jwt=require(a30_0x5006('0x4'));const i18n=require(a30_0x5006('0x5'));const configJwt=require(a30_0x5006('0x6'));const authUtils=require('../../infrastructure/auth-utils');const responseUtils=require(a30_0x5006('0x7'));const LocaleStrings=require(a30_0x5006('0x8'));const format=require(a30_0x5006('0x9'));class AuthenticationController{constructor(_0x14ca23){this[a30_0x5006('0xa')]=_0x14ca23;this['login']=this[a30_0x5006('0xb')][a30_0x5006('0xc')](this);this[a30_0x5006('0xd')]=this[a30_0x5006('0xd')][a30_0x5006('0xc')](this);}['login'](_0xd4c52f,_0x1cbf36,_0x17f505){this[a30_0x5006('0xa')]['findOne']({'where':{'username':_0xd4c52f[a30_0x5006('0xe')]['username']},'attributes':['id',a30_0x5006('0xf'),a30_0x5006('0x10'),a30_0x5006('0x11'),a30_0x5006('0x12'),a30_0x5006('0x13')]})[a30_0x5006('0x14')](_0x41feb2=>{if(!_0x41feb2){return responseUtils['errorResponse'](_0x1cbf36,format(LocaleStrings[a30_0x5006('0x15')],_0xd4c52f[a30_0x5006('0xe')][a30_0x5006('0x12')]),0x193);}if(crypt_utils_1[a30_0x5006('0x16')][a30_0x5006('0x17')](_0xd4c52f[a30_0x5006('0xe')][a30_0x5006('0x13')],_0x41feb2[a30_0x5006('0x13')])){_0x41feb2=_0x41feb2['toJSON']();const _0x179930={'id':_0x41feb2['id']};const _0x1923eb=jwt[a30_0x5006('0x18')](_0x179930,configJwt['secret'],configJwt[a30_0x5006('0x19')]);const _0x2cb04a={'token':_0x1923eb};return responseUtils[a30_0x5006('0x1a')](_0x1cbf36,_0x2cb04a,0xc8);}else{return responseUtils[a30_0x5006('0x1b')](_0x1cbf36,format(LocaleStrings['passwordNotMatchError']),0x193);}})['catch'](_0x346c8e=>{return responseUtils['errorResponse'](_0x1cbf36,_0x346c8e['stack'],0x1f4);});}[a30_0x5006('0xd')](_0x30ca72,_0x342575,_0x37e1f9){this[a30_0x5006('0xa')]['findOne']({'where':{'username':_0x30ca72[a30_0x5006('0xe')][a30_0x5006('0x12')]}})[a30_0x5006('0x14')](_0x16cf98=>{if(_0x16cf98){return responseUtils[a30_0x5006('0x1b')](_0x342575,format(LocaleStrings['usernameTakenError'],_0x30ca72[a30_0x5006('0xe')][a30_0x5006('0x12')]),0x193);}else{_0x30ca72[a30_0x5006('0xe')][a30_0x5006('0x11')]=_0x30ca72[a30_0x5006('0xe')][a30_0x5006('0x12')];const _0x475b18={'first_name':_0x30ca72[a30_0x5006('0xe')]['first_name'],'last_name':_0x30ca72[a30_0x5006('0xe')]['last_name'],'email':_0x30ca72['body'][a30_0x5006('0x11')],'username':_0x30ca72[a30_0x5006('0xe')]['username'],'password':crypt_utils_1[a30_0x5006('0x16')][a30_0x5006('0x1c')](_0x30ca72[a30_0x5006('0xe')][a30_0x5006('0x13')])};this[a30_0x5006('0xa')][a30_0x5006('0x1d')](_0x475b18)[a30_0x5006('0x14')](function(_0x5e649c,_0x558076){const _0x461519={'id':_0x5e649c[a30_0x5006('0x1e')]['id']};const _0x4783a9=jwt[a30_0x5006('0x18')](_0x461519,configJwt[a30_0x5006('0x1f')],configJwt['options']);const _0x20c413={'token':_0x4783a9};return responseUtils['successResponse'](_0x342575,_0x20c413,0xc8);})['catch'](_0x16e82a=>{return responseUtils[a30_0x5006('0x1b')](_0x342575,_0x16e82a[a30_0x5006('0x20')],0x1f4);});}})[a30_0x5006('0x21')](_0x5158ee=>{return responseUtils[a30_0x5006('0x1b')](_0x342575,_0x5158ee[a30_0x5006('0x20')],0x1f4);});}}exports['default']=AuthenticationController;