var a11_0x746d=['../../infrastructure/response-utils','../../resources/locale-strings','login','createAccount','bind','model','findOne','body','username','uuid','last_name','email','password','then','errorResponse','validPassword','toJSON','secret','options','successResponse','passwordNotMatchError','catch','first_name','generateHash','create','dataValues','status','updated_at','sign','token','stack','default','jsonwebtoken','../../config/jwt.js'];(function(_0x202f27,_0x231660){var _0x4fbf7d=function(_0x514765){while(--_0x514765){_0x202f27['push'](_0x202f27['shift']());}};_0x4fbf7d(++_0x231660);}(a11_0x746d,0x196));var a11_0x9a48=function(_0x2425bc,_0x1a43ee){_0x2425bc=_0x2425bc-0x0;var _0x56368a=a11_0x746d[_0x2425bc];return _0x56368a;};'use strict';Object['defineProperty'](exports,'__esModule',{'value':!![]});const jwt=require(a11_0x9a48('0x0'));const i18n=require('i18n');const configJwt=require(a11_0x9a48('0x1'));const authUtils=require('../../infrastructure/auth-utils');const responseUtils=require(a11_0x9a48('0x2'));const LocaleStrings=require(a11_0x9a48('0x3'));const format=require('string-format');class AuthenticationController{constructor(_0x4897c1){this['model']=_0x4897c1;this[a11_0x9a48('0x4')]=this['login']['bind'](this);this[a11_0x9a48('0x5')]=this['createAccount'][a11_0x9a48('0x6')](this);}['login'](_0x32b77c,_0x213e28,_0x121dd4){this[a11_0x9a48('0x7')][a11_0x9a48('0x8')]({'where':{'username':_0x32b77c[a11_0x9a48('0x9')][a11_0x9a48('0xa')]},'attributes':[a11_0x9a48('0xb'),'first_name',a11_0x9a48('0xc'),a11_0x9a48('0xd'),a11_0x9a48('0xa'),a11_0x9a48('0xe')]})[a11_0x9a48('0xf')](_0x5d198b=>{if(!_0x5d198b){return responseUtils[a11_0x9a48('0x10')](_0x213e28,format(LocaleStrings['usernameNotFoundError'],_0x32b77c['body'][a11_0x9a48('0xa')]),0x193);}if(authUtils[a11_0x9a48('0x11')](_0x32b77c[a11_0x9a48('0x9')][a11_0x9a48('0xe')],_0x5d198b[a11_0x9a48('0xe')])){_0x5d198b=_0x5d198b[a11_0x9a48('0x12')]();const _0x385c06={'uuid':_0x5d198b[a11_0x9a48('0xb')]};const _0x407f7b=jwt['sign'](_0x385c06,configJwt[a11_0x9a48('0x13')],configJwt[a11_0x9a48('0x14')]);delete _0x5d198b['password'];_0x5d198b['token']=_0x407f7b;return responseUtils[a11_0x9a48('0x15')](_0x213e28,_0x5d198b,0xc8);}else{return responseUtils[a11_0x9a48('0x10')](_0x213e28,format(LocaleStrings[a11_0x9a48('0x16')]),0x193);}})[a11_0x9a48('0x17')](_0x78b6f6=>{return responseUtils[a11_0x9a48('0x10')](_0x213e28,_0x78b6f6['stack'],0x1f4);});}[a11_0x9a48('0x5')](_0x562842,_0x3316bc,_0x459d29){this[a11_0x9a48('0x7')]['findOne']({'where':{'username':_0x562842[a11_0x9a48('0x9')]['username']}})[a11_0x9a48('0xf')](_0x43c47a=>{if(_0x43c47a){return responseUtils[a11_0x9a48('0x10')](_0x3316bc,format(LocaleStrings['usernameTakenError'],_0x562842[a11_0x9a48('0x9')]['username']),0x193);}else{_0x562842[a11_0x9a48('0x9')]['email']=_0x562842[a11_0x9a48('0x9')][a11_0x9a48('0xa')];const _0x2d9439={'first_name':_0x562842[a11_0x9a48('0x9')][a11_0x9a48('0x18')],'last_name':_0x562842[a11_0x9a48('0x9')][a11_0x9a48('0xc')],'email':_0x562842[a11_0x9a48('0x9')][a11_0x9a48('0xd')],'username':_0x562842[a11_0x9a48('0x9')][a11_0x9a48('0xa')],'password':authUtils[a11_0x9a48('0x19')](_0x562842['body'][a11_0x9a48('0xe')])};this['model'][a11_0x9a48('0x1a')](_0x2d9439)[a11_0x9a48('0xf')](function(_0x176e34,_0x21553b){delete _0x176e34['dataValues']['id'];delete _0x176e34[a11_0x9a48('0x1b')][a11_0x9a48('0x1c')];delete _0x176e34[a11_0x9a48('0x1b')]['password'];delete _0x176e34['dataValues'][a11_0x9a48('0x1d')];delete _0x176e34['dataValues']['created_at'];const _0x4ad787={'uuid':_0x176e34[a11_0x9a48('0xb')]};const _0x97034e=jwt[a11_0x9a48('0x1e')](_0x4ad787,configJwt[a11_0x9a48('0x13')],configJwt[a11_0x9a48('0x14')]);_0x176e34['dataValues'][a11_0x9a48('0x1f')]=_0x97034e;return responseUtils[a11_0x9a48('0x15')](_0x3316bc,_0x176e34,0xc8);})[a11_0x9a48('0x17')](_0x3ae338=>{return responseUtils[a11_0x9a48('0x10')](_0x3316bc,_0x3ae338[a11_0x9a48('0x20')],0x1f4);});}})[a11_0x9a48('0x17')](_0x4207a1=>{return responseUtils[a11_0x9a48('0x10')](_0x3316bc,_0x4207a1['stack'],0x1f4);});}}exports[a11_0x9a48('0x21')]=AuthenticationController;