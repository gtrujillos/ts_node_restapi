var a30_0x85ea=['defineProperty','../../infrastructure/crypt-utils','jsonwebtoken','i18n','../../config/jwt.js','../../infrastructure/response-utils','../../resources/locale-strings','model','login','bind','createAccount','body','username','first_name','last_name','email','password','errorResponse','usernameNotFoundError','default','validPassword','toJSON','secret','catch','stack','findOne','then','hashPassword','create','dataValues','sign','options','successResponse','__importDefault','__esModule'];(function(_0xafb1cb,_0x22ca46){var _0x5e16e7=function(_0x54f1b9){while(--_0x54f1b9){_0xafb1cb['push'](_0xafb1cb['shift']());}};_0x5e16e7(++_0x22ca46);}(a30_0x85ea,0x1e8));var a30_0x49ff=function(_0x1196c6,_0x44e6fa){_0x1196c6=_0x1196c6-0x0;var _0x18d0d0=a30_0x85ea[_0x1196c6];return _0x18d0d0;};'use strict';var __importDefault=this&&this[a30_0x49ff('0x0')]||function(_0x292800){return _0x292800&&_0x292800[a30_0x49ff('0x1')]?_0x292800:{'default':_0x292800};};Object[a30_0x49ff('0x2')](exports,a30_0x49ff('0x1'),{'value':!![]});const crypt_utils_1=__importDefault(require(a30_0x49ff('0x3')));const jwt=require(a30_0x49ff('0x4'));const i18n=require(a30_0x49ff('0x5'));const configJwt=require(a30_0x49ff('0x6'));const authUtils=require('../../infrastructure/auth-utils');const responseUtils=require(a30_0x49ff('0x7'));const LocaleStrings=require(a30_0x49ff('0x8'));const format=require('string-format');class AuthenticationController{constructor(_0x131d31){this[a30_0x49ff('0x9')]=_0x131d31;this[a30_0x49ff('0xa')]=this[a30_0x49ff('0xa')][a30_0x49ff('0xb')](this);this[a30_0x49ff('0xc')]=this[a30_0x49ff('0xc')][a30_0x49ff('0xb')](this);}['login'](_0x475c6b,_0x296fcd,_0x318ab0){this[a30_0x49ff('0x9')]['findOne']({'where':{'username':_0x475c6b[a30_0x49ff('0xd')][a30_0x49ff('0xe')]},'attributes':['id',a30_0x49ff('0xf'),a30_0x49ff('0x10'),a30_0x49ff('0x11'),a30_0x49ff('0xe'),a30_0x49ff('0x12')]})['then'](_0x14b261=>{if(!_0x14b261){return responseUtils[a30_0x49ff('0x13')](_0x296fcd,format(LocaleStrings[a30_0x49ff('0x14')],_0x475c6b[a30_0x49ff('0xd')][a30_0x49ff('0xe')]),0x193);}if(crypt_utils_1[a30_0x49ff('0x15')][a30_0x49ff('0x16')](_0x475c6b['body'][a30_0x49ff('0x12')],_0x14b261[a30_0x49ff('0x12')])){_0x14b261=_0x14b261[a30_0x49ff('0x17')]();const _0x4e3b88={'id':_0x14b261['id']};const _0x4ced28=jwt['sign'](_0x4e3b88,configJwt[a30_0x49ff('0x18')],configJwt['options']);const _0x2511d9={'token':_0x4ced28};return responseUtils['successResponse'](_0x296fcd,_0x2511d9,0xc8);}else{return responseUtils[a30_0x49ff('0x13')](_0x296fcd,format(LocaleStrings['passwordNotMatchError']),0x193);}})[a30_0x49ff('0x19')](_0x266201=>{return responseUtils[a30_0x49ff('0x13')](_0x296fcd,_0x266201[a30_0x49ff('0x1a')],0x1f4);});}[a30_0x49ff('0xc')](_0xad33b9,_0x320ae4,_0x408032){this[a30_0x49ff('0x9')][a30_0x49ff('0x1b')]({'where':{'username':_0xad33b9[a30_0x49ff('0xd')][a30_0x49ff('0xe')]}})[a30_0x49ff('0x1c')](_0x48bcf4=>{if(_0x48bcf4){return responseUtils[a30_0x49ff('0x13')](_0x320ae4,format(LocaleStrings['usernameTakenError'],_0xad33b9[a30_0x49ff('0xd')]['username']),0x193);}else{_0xad33b9[a30_0x49ff('0xd')][a30_0x49ff('0x11')]=_0xad33b9[a30_0x49ff('0xd')][a30_0x49ff('0xe')];const _0x220d3a={'first_name':_0xad33b9['body'][a30_0x49ff('0xf')],'last_name':_0xad33b9['body'][a30_0x49ff('0x10')],'email':_0xad33b9[a30_0x49ff('0xd')][a30_0x49ff('0x11')],'username':_0xad33b9[a30_0x49ff('0xd')][a30_0x49ff('0xe')],'password':crypt_utils_1[a30_0x49ff('0x15')][a30_0x49ff('0x1d')](_0xad33b9[a30_0x49ff('0xd')][a30_0x49ff('0x12')])};this[a30_0x49ff('0x9')][a30_0x49ff('0x1e')](_0x220d3a)[a30_0x49ff('0x1c')](function(_0x505447,_0x4887bd){const _0x31d617={'id':_0x505447[a30_0x49ff('0x1f')]['id']};const _0x12dcbb=jwt[a30_0x49ff('0x20')](_0x31d617,configJwt[a30_0x49ff('0x18')],configJwt[a30_0x49ff('0x21')]);const _0x33219b={'token':_0x12dcbb};return responseUtils[a30_0x49ff('0x22')](_0x320ae4,_0x33219b,0xc8);})[a30_0x49ff('0x19')](_0x302f36=>{return responseUtils[a30_0x49ff('0x13')](_0x320ae4,_0x302f36[a30_0x49ff('0x1a')],0x1f4);});}})[a30_0x49ff('0x19')](_0x2ca141=>{return responseUtils[a30_0x49ff('0x13')](_0x320ae4,_0x2ca141[a30_0x49ff('0x1a')],0x1f4);});}}exports[a30_0x49ff('0x15')]=AuthenticationController;