var a30_0x5b5c=['__esModule','defineProperty','jsonwebtoken','i18n','../../config/jwt.js','../../infrastructure/auth-utils','../../resources/locale-strings','login','bind','createAccount','model','body','first_name','last_name','username','password','then','errorResponse','usernameNotFoundError','default','toJSON','sign','secret','options','successResponse','catch','stack','findOne','email','create','dataValues'];(function(_0x403a0a,_0x4a54cd){var _0x3a6afa=function(_0x5d5088){while(--_0x5d5088){_0x403a0a['push'](_0x403a0a['shift']());}};_0x3a6afa(++_0x4a54cd);}(a30_0x5b5c,0x1f0));var a30_0x187f=function(_0x205b4e,_0x862bb4){_0x205b4e=_0x205b4e-0x0;var _0x3b20e7=a30_0x5b5c[_0x205b4e];return _0x3b20e7;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x6ab817){return _0x6ab817&&_0x6ab817[a30_0x187f('0x0')]?_0x6ab817:{'default':_0x6ab817};};Object[a30_0x187f('0x1')](exports,a30_0x187f('0x0'),{'value':!![]});const crypt_utils_1=__importDefault(require('../../infrastructure/crypt-utils'));const jwt=require(a30_0x187f('0x2'));const i18n=require(a30_0x187f('0x3'));const configJwt=require(a30_0x187f('0x4'));const authUtils=require(a30_0x187f('0x5'));const responseUtils=require('../../infrastructure/response-utils');const LocaleStrings=require(a30_0x187f('0x6'));const format=require('string-format');class AuthenticationController{constructor(_0x183791){this['model']=_0x183791;this[a30_0x187f('0x7')]=this['login'][a30_0x187f('0x8')](this);this[a30_0x187f('0x9')]=this[a30_0x187f('0x9')][a30_0x187f('0x8')](this);}[a30_0x187f('0x7')](_0x530244,_0x13e214,_0x3b9880){this[a30_0x187f('0xa')]['findOne']({'where':{'username':_0x530244[a30_0x187f('0xb')]['username']},'attributes':['id',a30_0x187f('0xc'),a30_0x187f('0xd'),'email',a30_0x187f('0xe'),a30_0x187f('0xf')]})[a30_0x187f('0x10')](_0x241c56=>{if(!_0x241c56){return responseUtils[a30_0x187f('0x11')](_0x13e214,format(LocaleStrings[a30_0x187f('0x12')],_0x530244['body']['username']),0x193);}if(crypt_utils_1[a30_0x187f('0x13')]['validPassword'](_0x530244[a30_0x187f('0xb')][a30_0x187f('0xf')],_0x241c56[a30_0x187f('0xf')])){_0x241c56=_0x241c56[a30_0x187f('0x14')]();const _0x38da61={'id':_0x241c56['id']};const _0x555f7a=jwt[a30_0x187f('0x15')](_0x38da61,configJwt[a30_0x187f('0x16')],configJwt[a30_0x187f('0x17')]);const _0x55a511={'token':_0x555f7a};return responseUtils[a30_0x187f('0x18')](_0x13e214,_0x55a511,0xc8);}else{return responseUtils[a30_0x187f('0x11')](_0x13e214,format(LocaleStrings['passwordNotMatchError']),0x193);}})[a30_0x187f('0x19')](_0x5cc6de=>{return responseUtils['errorResponse'](_0x13e214,_0x5cc6de[a30_0x187f('0x1a')],0x1f4);});}[a30_0x187f('0x9')](_0x1d1af0,_0x2f7ec0,_0x5964ab){this[a30_0x187f('0xa')][a30_0x187f('0x1b')]({'where':{'username':_0x1d1af0['body'][a30_0x187f('0xe')]}})[a30_0x187f('0x10')](_0x191e9a=>{if(_0x191e9a){return responseUtils[a30_0x187f('0x11')](_0x2f7ec0,format(LocaleStrings['usernameTakenError'],_0x1d1af0['body'][a30_0x187f('0xe')]),0x193);}else{_0x1d1af0['body'][a30_0x187f('0x1c')]=_0x1d1af0[a30_0x187f('0xb')][a30_0x187f('0xe')];const _0x180ec4={'first_name':_0x1d1af0[a30_0x187f('0xb')]['first_name'],'last_name':_0x1d1af0[a30_0x187f('0xb')]['last_name'],'email':_0x1d1af0[a30_0x187f('0xb')][a30_0x187f('0x1c')],'username':_0x1d1af0[a30_0x187f('0xb')][a30_0x187f('0xe')],'password':crypt_utils_1['default']['hashPassword'](_0x1d1af0[a30_0x187f('0xb')][a30_0x187f('0xf')])};this['model'][a30_0x187f('0x1d')](_0x180ec4)[a30_0x187f('0x10')](function(_0x4fee76,_0xc6dd36){const _0x37fcda={'id':_0x4fee76[a30_0x187f('0x1e')]['id']};const _0x9c75d8=jwt[a30_0x187f('0x15')](_0x37fcda,configJwt[a30_0x187f('0x16')],configJwt[a30_0x187f('0x17')]);const _0x70cec2={'token':_0x9c75d8};return responseUtils[a30_0x187f('0x18')](_0x2f7ec0,_0x70cec2,0xc8);})[a30_0x187f('0x19')](_0x49c86d=>{return responseUtils[a30_0x187f('0x11')](_0x2f7ec0,_0x49c86d[a30_0x187f('0x1a')],0x1f4);});}})[a30_0x187f('0x19')](_0x161403=>{return responseUtils[a30_0x187f('0x11')](_0x2f7ec0,_0x161403[a30_0x187f('0x1a')],0x1f4);});}}exports[a30_0x187f('0x13')]=AuthenticationController;