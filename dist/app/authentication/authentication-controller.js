var a30_0x1bf5=['options','passwordNotMatchError','stack','email','last_name','default','hashPassword','then','dataValues','catch','__importDefault','defineProperty','../../infrastructure/crypt-utils','jsonwebtoken','../../config/jwt.js','../../infrastructure/auth-utils','../../infrastructure/response-utils','string-format','model','login','bind','createAccount','body','first_name','username','errorResponse','usernameNotFoundError','validPassword','password','toJSON','secret'];(function(_0x56b273,_0x2bca33){var _0x2ad4ce=function(_0x40fc82){while(--_0x40fc82){_0x56b273['push'](_0x56b273['shift']());}};_0x2ad4ce(++_0x2bca33);}(a30_0x1bf5,0x67));var a30_0x688a=function(_0x3f9a28,_0x47dd6f){_0x3f9a28=_0x3f9a28-0x0;var _0x4556cd=a30_0x1bf5[_0x3f9a28];return _0x4556cd;};'use strict';var __importDefault=this&&this[a30_0x688a('0x0')]||function(_0x498a32){return _0x498a32&&_0x498a32['__esModule']?_0x498a32:{'default':_0x498a32};};Object[a30_0x688a('0x1')](exports,'__esModule',{'value':!![]});const crypt_utils_1=__importDefault(require(a30_0x688a('0x2')));const jwt=require(a30_0x688a('0x3'));const i18n=require('i18n');const configJwt=require(a30_0x688a('0x4'));const authUtils=require(a30_0x688a('0x5'));const responseUtils=require(a30_0x688a('0x6'));const LocaleStrings=require('../../resources/locale-strings');const format=require(a30_0x688a('0x7'));class AuthenticationController{constructor(_0x1b39f2){this[a30_0x688a('0x8')]=_0x1b39f2;this['login']=this[a30_0x688a('0x9')][a30_0x688a('0xa')](this);this[a30_0x688a('0xb')]=this[a30_0x688a('0xb')][a30_0x688a('0xa')](this);}[a30_0x688a('0x9')](_0x23ab25,_0x4cb3c6,_0x53baab){this['model']['findOne']({'where':{'username':_0x23ab25[a30_0x688a('0xc')]['username']},'attributes':['id',a30_0x688a('0xd'),'last_name','email',a30_0x688a('0xe'),'password']})['then'](_0x5ecba7=>{if(!_0x5ecba7){return responseUtils[a30_0x688a('0xf')](_0x4cb3c6,format(LocaleStrings[a30_0x688a('0x10')],_0x23ab25[a30_0x688a('0xc')][a30_0x688a('0xe')]),0x193);}if(crypt_utils_1['default'][a30_0x688a('0x11')](_0x23ab25['body'][a30_0x688a('0x12')],_0x5ecba7['password'])){_0x5ecba7=_0x5ecba7[a30_0x688a('0x13')]();const _0x5c9b6f={'id':_0x5ecba7['id']};const _0x44a9fe=jwt['sign'](_0x5c9b6f,configJwt[a30_0x688a('0x14')],configJwt[a30_0x688a('0x15')]);const _0x43b11d={'token':_0x44a9fe};return responseUtils['successResponse'](_0x4cb3c6,_0x43b11d,0xc8);}else{return responseUtils['errorResponse'](_0x4cb3c6,format(LocaleStrings[a30_0x688a('0x16')]),0x193);}})['catch'](_0x441e02=>{return responseUtils['errorResponse'](_0x4cb3c6,_0x441e02[a30_0x688a('0x17')],0x1f4);});}[a30_0x688a('0xb')](_0x187974,_0x484c04,_0x3670c3){this['model']['findOne']({'where':{'username':_0x187974['body'][a30_0x688a('0xe')]}})['then'](_0x50b694=>{if(_0x50b694){return responseUtils[a30_0x688a('0xf')](_0x484c04,format(LocaleStrings['usernameTakenError'],_0x187974[a30_0x688a('0xc')][a30_0x688a('0xe')]),0x193);}else{_0x187974[a30_0x688a('0xc')][a30_0x688a('0x18')]=_0x187974[a30_0x688a('0xc')]['username'];const _0x30bded={'first_name':_0x187974[a30_0x688a('0xc')][a30_0x688a('0xd')],'last_name':_0x187974[a30_0x688a('0xc')][a30_0x688a('0x19')],'email':_0x187974[a30_0x688a('0xc')]['email'],'username':_0x187974[a30_0x688a('0xc')][a30_0x688a('0xe')],'password':crypt_utils_1[a30_0x688a('0x1a')][a30_0x688a('0x1b')](_0x187974['body'][a30_0x688a('0x12')])};this[a30_0x688a('0x8')]['create'](_0x30bded)[a30_0x688a('0x1c')](function(_0x2a9cc2,_0x2a42c3){const _0x2eb897={'id':_0x2a9cc2[a30_0x688a('0x1d')]['id']};const _0x5248dc=jwt['sign'](_0x2eb897,configJwt[a30_0x688a('0x14')],configJwt[a30_0x688a('0x15')]);const _0x340e20={'token':_0x5248dc};return responseUtils['successResponse'](_0x484c04,_0x340e20,0xc8);})[a30_0x688a('0x1e')](_0x43bd03=>{return responseUtils[a30_0x688a('0xf')](_0x484c04,_0x43bd03[a30_0x688a('0x17')],0x1f4);});}})[a30_0x688a('0x1e')](_0x5111e4=>{return responseUtils['errorResponse'](_0x484c04,_0x5111e4[a30_0x688a('0x17')],0x1f4);});}}exports['default']=AuthenticationController;