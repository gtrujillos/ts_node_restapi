var a39_0x4635=['first_name','hashPassword','__importDefault','__esModule','defineProperty','../../infrastructure/sequelize-utils','../../infrastructure/crypt-utils','jsonwebtoken','i18n','../../infrastructure/auth-utils','string-format','fs-extra','login','bind','logout','usernameExist','createAccount','findOne','username','last_name','email','password','then','errorResponse','usernameNotFoundError','body','validPassword','generateJWT','default','encryptId','successResponse','passwordNotMatchError','catch','model','stack'];(function(_0x576742,_0x27eb07){var _0xcb28b5=function(_0x13f2f8){while(--_0x13f2f8){_0x576742['push'](_0x576742['shift']());}};_0xcb28b5(++_0x27eb07);}(a39_0x4635,0x1a6));var a39_0xfd55=function(_0x2965c9,_0x3ce813){_0x2965c9=_0x2965c9-0x0;var _0x438eda=a39_0x4635[_0x2965c9];return _0x438eda;};'use strict';var __importDefault=this&&this[a39_0xfd55('0x0')]||function(_0x4518b6){return _0x4518b6&&_0x4518b6[a39_0xfd55('0x1')]?_0x4518b6:{'default':_0x4518b6};};Object[a39_0xfd55('0x2')](exports,a39_0xfd55('0x1'),{'value':!![]});const sequelize_utils_1=__importDefault(require(a39_0xfd55('0x3')));const crypt_utils_1=__importDefault(require(a39_0xfd55('0x4')));const jwt=require(a39_0xfd55('0x5'));const i18n=require(a39_0xfd55('0x6'));const authUtils=require(a39_0xfd55('0x7'));const responseUtils=require('../../infrastructure/response-utils');const LocaleStrings=require('../../resources/locale-strings');const format=require(a39_0xfd55('0x8'));const formidable=require('formidable');const fsExtra=require(a39_0xfd55('0x9'));class AuthenticationController{constructor(_0x5e7a29){this['model']=_0x5e7a29;this[a39_0xfd55('0xa')]=this[a39_0xfd55('0xa')][a39_0xfd55('0xb')](this);this['logout']=this[a39_0xfd55('0xc')][a39_0xfd55('0xb')](this);this[a39_0xfd55('0xd')]=this[a39_0xfd55('0xd')]['bind'](this);this[a39_0xfd55('0xe')]=this[a39_0xfd55('0xe')]['bind'](this);}['login'](_0x520eec,_0x53bb39,_0x17f0f6){this['model'][a39_0xfd55('0xf')]({'where':{'username':_0x520eec['body'][a39_0xfd55('0x10')]},'attributes':['id','first_name',a39_0xfd55('0x11'),a39_0xfd55('0x12'),'username',a39_0xfd55('0x13')]})[a39_0xfd55('0x14')](_0x19d41f=>{if(!_0x19d41f){return responseUtils[a39_0xfd55('0x15')](_0x520eec,_0x53bb39,format(LocaleStrings[a39_0xfd55('0x16')],_0x520eec[a39_0xfd55('0x17')]['username']),0x193);}if(crypt_utils_1['default'][a39_0xfd55('0x18')](_0x520eec['body'][a39_0xfd55('0x13')],_0x19d41f[a39_0xfd55('0x13')]==null?'':_0x19d41f[a39_0xfd55('0x13')])){_0x19d41f=_0x19d41f['toJSON']();const _0x42ba3f=authUtils[a39_0xfd55('0x19')](_0x19d41f);const _0x38d06b={'token':_0x42ba3f,'id':sequelize_utils_1[a39_0xfd55('0x1a')][a39_0xfd55('0x1b')](_0x19d41f['id'])};return responseUtils[a39_0xfd55('0x1c')](_0x520eec,_0x53bb39,_0x38d06b,0xc8);}else{return responseUtils[a39_0xfd55('0x15')](_0x520eec,_0x53bb39,format(LocaleStrings[a39_0xfd55('0x1d')]),0x193);}})[a39_0xfd55('0x1e')](_0x1c4330=>{return responseUtils['errorResponse'](_0x520eec,_0x53bb39,_0x1c4330,0x1f4);});}[a39_0xfd55('0xc')](_0x3f0c99,_0x131e21,_0x571c6a){return responseUtils[a39_0xfd55('0x1c')](_0x3f0c99,_0x131e21,!![],0xc8);}[a39_0xfd55('0xd')](_0xa0150e,_0x22e4c3,_0x5f44d1){this[a39_0xfd55('0x1f')][a39_0xfd55('0xf')]({'where':{'username':_0xa0150e[a39_0xfd55('0x17')]['username']}})[a39_0xfd55('0x14')](_0xec85c1=>{let _0x551273=![];if(_0xec85c1){_0x551273=!![];}return responseUtils[a39_0xfd55('0x1c')](_0xa0150e,_0x22e4c3,{'exist':_0x551273},0xc8);})[a39_0xfd55('0x1e')](_0x19a9ed=>{return responseUtils['errorResponse'](_0xa0150e,_0x22e4c3,_0x19a9ed[a39_0xfd55('0x20')],0x1f4);});}[a39_0xfd55('0xe')](_0x3403e9,_0xb9bc31,_0x5b541c){this['model']['findOne']({'where':{'username':_0x3403e9[a39_0xfd55('0x17')]['username']}})[a39_0xfd55('0x14')](_0x3f59ca=>{if(_0x3f59ca){return responseUtils[a39_0xfd55('0x15')](_0x3403e9,_0xb9bc31,format(LocaleStrings['usernameTakenError'],_0x3403e9['body']['username']),0x193);}else{_0x3403e9[a39_0xfd55('0x17')]['email']=_0x3403e9[a39_0xfd55('0x17')]['username'];const _0x349dea={'first_name':_0x3403e9[a39_0xfd55('0x17')][a39_0xfd55('0x21')],'last_name':_0x3403e9[a39_0xfd55('0x17')]['last_name'],'email':_0x3403e9[a39_0xfd55('0x17')][a39_0xfd55('0x12')],'username':_0x3403e9[a39_0xfd55('0x17')][a39_0xfd55('0x10')],'password':crypt_utils_1[a39_0xfd55('0x1a')][a39_0xfd55('0x22')](_0x3403e9[a39_0xfd55('0x17')][a39_0xfd55('0x13')])};this['model']['create'](_0x349dea)['then'](function(_0x351400,_0x443074){const _0x3c9194=authUtils['generateJWT'](_0x351400);const _0x4bb905={'token':_0x3c9194,'id':sequelize_utils_1[a39_0xfd55('0x1a')][a39_0xfd55('0x1b')](_0x351400['id'])};return responseUtils[a39_0xfd55('0x1c')](_0x3403e9,_0xb9bc31,_0x4bb905,0xc8);})[a39_0xfd55('0x1e')](_0x53f71b=>{return responseUtils[a39_0xfd55('0x15')](_0x3403e9,_0xb9bc31,_0x53f71b[a39_0xfd55('0x20')],0x1f4);});}})[a39_0xfd55('0x1e')](_0x2d6a6e=>{return responseUtils[a39_0xfd55('0x15')](_0x3403e9,_0xb9bc31,_0x2d6a6e[a39_0xfd55('0x20')],0x1f4);});}}exports[a39_0xfd55('0x1a')]=AuthenticationController;