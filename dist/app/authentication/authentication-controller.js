var a30_0x2620=['email','last_name','hashPassword','create','options','__esModule','defineProperty','jsonwebtoken','i18n','../../infrastructure/auth-utils','../../infrastructure/response-utils','../../resources/locale-strings','string-format','model','login','bind','createAccount','findOne','body','username','first_name','password','then','usernameNotFoundError','default','validPassword','toJSON','sign','secret','successResponse','errorResponse','passwordNotMatchError','catch','usernameTakenError'];(function(_0x541a12,_0x14beeb){var _0x474368=function(_0x5134ab){while(--_0x5134ab){_0x541a12['push'](_0x541a12['shift']());}};_0x474368(++_0x14beeb);}(a30_0x2620,0xd1));var a30_0x279f=function(_0x37a75d,_0x317e19){_0x37a75d=_0x37a75d-0x0;var _0x29f6b2=a30_0x2620[_0x37a75d];return _0x29f6b2;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x566f87){return _0x566f87&&_0x566f87[a30_0x279f('0x0')]?_0x566f87:{'default':_0x566f87};};Object[a30_0x279f('0x1')](exports,'__esModule',{'value':!![]});const crypt_utils_1=__importDefault(require('../../infrastructure/crypt-utils'));const jwt=require(a30_0x279f('0x2'));const i18n=require(a30_0x279f('0x3'));const configJwt=require('../../config/jwt.js');const authUtils=require(a30_0x279f('0x4'));const responseUtils=require(a30_0x279f('0x5'));const LocaleStrings=require(a30_0x279f('0x6'));const format=require(a30_0x279f('0x7'));class AuthenticationController{constructor(_0x293ee3){this[a30_0x279f('0x8')]=_0x293ee3;this['login']=this[a30_0x279f('0x9')][a30_0x279f('0xa')](this);this[a30_0x279f('0xb')]=this['createAccount']['bind'](this);}['login'](_0x1520c3,_0xafbe4d,_0x1897be){this[a30_0x279f('0x8')][a30_0x279f('0xc')]({'where':{'username':_0x1520c3[a30_0x279f('0xd')][a30_0x279f('0xe')]},'attributes':['id',a30_0x279f('0xf'),'last_name','email',a30_0x279f('0xe'),a30_0x279f('0x10')]})[a30_0x279f('0x11')](_0x578fd7=>{if(!_0x578fd7){return responseUtils['errorResponse'](_0xafbe4d,format(LocaleStrings[a30_0x279f('0x12')],_0x1520c3[a30_0x279f('0xd')][a30_0x279f('0xe')]),0x193);}if(crypt_utils_1[a30_0x279f('0x13')][a30_0x279f('0x14')](_0x1520c3[a30_0x279f('0xd')][a30_0x279f('0x10')],_0x578fd7[a30_0x279f('0x10')])){_0x578fd7=_0x578fd7[a30_0x279f('0x15')]();const _0x2b5adf={'id':_0x578fd7['id']};const _0x280d28=jwt[a30_0x279f('0x16')](_0x2b5adf,configJwt[a30_0x279f('0x17')],configJwt['options']);const _0x2808cc={'token':_0x280d28};return responseUtils[a30_0x279f('0x18')](_0xafbe4d,_0x2808cc,0xc8);}else{return responseUtils[a30_0x279f('0x19')](_0xafbe4d,format(LocaleStrings[a30_0x279f('0x1a')]),0x193);}})[a30_0x279f('0x1b')](_0x255bdf=>{return responseUtils['errorResponse'](_0xafbe4d,_0x255bdf,0x1f4);});}[a30_0x279f('0xb')](_0x272cf5,_0x5513f9,_0x5a51b4){this[a30_0x279f('0x8')][a30_0x279f('0xc')]({'where':{'username':_0x272cf5['body'][a30_0x279f('0xe')]}})[a30_0x279f('0x11')](_0x26df5a=>{if(_0x26df5a){return responseUtils['errorResponse'](_0x5513f9,format(LocaleStrings[a30_0x279f('0x1c')],_0x272cf5['body']['username']),0x193);}else{_0x272cf5[a30_0x279f('0xd')][a30_0x279f('0x1d')]=_0x272cf5['body'][a30_0x279f('0xe')];const _0x32fb7b={'first_name':_0x272cf5[a30_0x279f('0xd')][a30_0x279f('0xf')],'last_name':_0x272cf5[a30_0x279f('0xd')][a30_0x279f('0x1e')],'email':_0x272cf5[a30_0x279f('0xd')][a30_0x279f('0x1d')],'username':_0x272cf5['body'][a30_0x279f('0xe')],'password':crypt_utils_1['default'][a30_0x279f('0x1f')](_0x272cf5[a30_0x279f('0xd')][a30_0x279f('0x10')])};this[a30_0x279f('0x8')][a30_0x279f('0x20')](_0x32fb7b)['then'](function(_0x57fb7c,_0x186090){const _0x4d3d7e={'id':_0x57fb7c['dataValues']['id']};const _0x28ebad=jwt[a30_0x279f('0x16')](_0x4d3d7e,configJwt['secret'],configJwt[a30_0x279f('0x21')]);const _0x1f7c81={'token':_0x28ebad};return responseUtils[a30_0x279f('0x18')](_0x5513f9,_0x1f7c81,0xc8);})[a30_0x279f('0x1b')](_0x361e90=>{return responseUtils[a30_0x279f('0x19')](_0x5513f9,_0x361e90['stack'],0x1f4);});}})[a30_0x279f('0x1b')](_0x2317d2=>{return responseUtils[a30_0x279f('0x19')](_0x5513f9,_0x2317d2['stack'],0x1f4);});}}exports[a30_0x279f('0x13')]=AuthenticationController;