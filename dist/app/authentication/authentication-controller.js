var a30_0x30cf=['bind','body','username','first_name','last_name','password','then','errorResponse','usernameNotFoundError','default','validPassword','toJSON','sign','secret','options','successResponse','passwordNotMatchError','catch','createAccount','email','create','stack','__importDefault','__esModule','defineProperty','jsonwebtoken','../../infrastructure/auth-utils','../../infrastructure/response-utils','string-format','model','login'];(function(_0x26f1c8,_0x9ca38b){var _0x4fbc32=function(_0x32d461){while(--_0x32d461){_0x26f1c8['push'](_0x26f1c8['shift']());}};_0x4fbc32(++_0x9ca38b);}(a30_0x30cf,0x10e));var a30_0x2bc2=function(_0x3de3b1,_0x1fda7c){_0x3de3b1=_0x3de3b1-0x0;var _0x4b45ce=a30_0x30cf[_0x3de3b1];return _0x4b45ce;};'use strict';var __importDefault=this&&this[a30_0x2bc2('0x0')]||function(_0x58f749){return _0x58f749&&_0x58f749[a30_0x2bc2('0x1')]?_0x58f749:{'default':_0x58f749};};Object[a30_0x2bc2('0x2')](exports,a30_0x2bc2('0x1'),{'value':!![]});const crypt_utils_1=__importDefault(require('../../infrastructure/crypt-utils'));const jwt=require(a30_0x2bc2('0x3'));const i18n=require('i18n');const configJwt=require('../../config/jwt.js');const authUtils=require(a30_0x2bc2('0x4'));const responseUtils=require(a30_0x2bc2('0x5'));const LocaleStrings=require('../../resources/locale-strings');const format=require(a30_0x2bc2('0x6'));class AuthenticationController{constructor(_0x2609eb){this[a30_0x2bc2('0x7')]=_0x2609eb;this[a30_0x2bc2('0x8')]=this[a30_0x2bc2('0x8')][a30_0x2bc2('0x9')](this);this['createAccount']=this['createAccount'][a30_0x2bc2('0x9')](this);}[a30_0x2bc2('0x8')](_0x5ae58e,_0x56393c,_0x52d29b){this[a30_0x2bc2('0x7')]['findOne']({'where':{'username':_0x5ae58e[a30_0x2bc2('0xa')][a30_0x2bc2('0xb')]},'attributes':['id',a30_0x2bc2('0xc'),a30_0x2bc2('0xd'),'email','username',a30_0x2bc2('0xe')]})[a30_0x2bc2('0xf')](_0x31d120=>{if(!_0x31d120){return responseUtils[a30_0x2bc2('0x10')](_0x56393c,format(LocaleStrings[a30_0x2bc2('0x11')],_0x5ae58e[a30_0x2bc2('0xa')][a30_0x2bc2('0xb')]),0x193);}if(crypt_utils_1[a30_0x2bc2('0x12')][a30_0x2bc2('0x13')](_0x5ae58e[a30_0x2bc2('0xa')][a30_0x2bc2('0xe')],_0x31d120[a30_0x2bc2('0xe')])){_0x31d120=_0x31d120[a30_0x2bc2('0x14')]();const _0x3115b1={'id':_0x31d120['id']};const _0x36a3f7=jwt[a30_0x2bc2('0x15')](_0x3115b1,configJwt[a30_0x2bc2('0x16')],configJwt[a30_0x2bc2('0x17')]);const _0x297044={'token':_0x36a3f7};return responseUtils[a30_0x2bc2('0x18')](_0x56393c,_0x297044,0xc8);}else{return responseUtils['errorResponse'](_0x56393c,format(LocaleStrings[a30_0x2bc2('0x19')]),0x193);}})[a30_0x2bc2('0x1a')](_0x1c9abb=>{return responseUtils[a30_0x2bc2('0x10')](_0x56393c,_0x1c9abb,0x1f4);});}[a30_0x2bc2('0x1b')](_0x45c868,_0x158155,_0x5a7b41){this[a30_0x2bc2('0x7')]['findOne']({'where':{'username':_0x45c868[a30_0x2bc2('0xa')][a30_0x2bc2('0xb')]}})[a30_0x2bc2('0xf')](_0x3c517e=>{if(_0x3c517e){return responseUtils[a30_0x2bc2('0x10')](_0x158155,format(LocaleStrings['usernameTakenError'],_0x45c868[a30_0x2bc2('0xa')][a30_0x2bc2('0xb')]),0x193);}else{_0x45c868[a30_0x2bc2('0xa')][a30_0x2bc2('0x1c')]=_0x45c868[a30_0x2bc2('0xa')][a30_0x2bc2('0xb')];const _0x5e3ef6={'first_name':_0x45c868[a30_0x2bc2('0xa')][a30_0x2bc2('0xc')],'last_name':_0x45c868['body'][a30_0x2bc2('0xd')],'email':_0x45c868[a30_0x2bc2('0xa')]['email'],'username':_0x45c868[a30_0x2bc2('0xa')][a30_0x2bc2('0xb')],'password':crypt_utils_1['default']['hashPassword'](_0x45c868[a30_0x2bc2('0xa')][a30_0x2bc2('0xe')])};this['model'][a30_0x2bc2('0x1d')](_0x5e3ef6)[a30_0x2bc2('0xf')](function(_0x54befb,_0x3407e7){const _0x4fabc6={'id':_0x54befb['dataValues']['id']};const _0x4b2cc8=jwt[a30_0x2bc2('0x15')](_0x4fabc6,configJwt[a30_0x2bc2('0x16')],configJwt[a30_0x2bc2('0x17')]);const _0x203fdb={'token':_0x4b2cc8};return responseUtils[a30_0x2bc2('0x18')](_0x158155,_0x203fdb,0xc8);})[a30_0x2bc2('0x1a')](_0x11eaed=>{return responseUtils[a30_0x2bc2('0x10')](_0x158155,_0x11eaed[a30_0x2bc2('0x1e')],0x1f4);});}})['catch'](_0x403b24=>{return responseUtils[a30_0x2bc2('0x10')](_0x158155,_0x403b24[a30_0x2bc2('0x1e')],0x1f4);});}}exports[a30_0x2bc2('0x12')]=AuthenticationController;