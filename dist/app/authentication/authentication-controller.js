var a39_0x58ef=['email','create','encryptId','__importDefault','__esModule','../../infrastructure/sequelize-utils','../../infrastructure/crypt-utils','jsonwebtoken','i18n','../../infrastructure/auth-utils','../../resources/locale-strings','string-format','model','login','bind','usernameExist','createAccount','findOne','username','first_name','last_name','password','then','errorResponse','default','validPassword','toJSON','generateJWT','successResponse','passwordNotMatchError','catch','logout','body','stack','usernameTakenError'];(function(_0x40a332,_0x2bfa2c){var _0x3ef93b=function(_0x1ff368){while(--_0x1ff368){_0x40a332['push'](_0x40a332['shift']());}};_0x3ef93b(++_0x2bfa2c);}(a39_0x58ef,0x13e));var a39_0x330d=function(_0x3bf383,_0x3f23ea){_0x3bf383=_0x3bf383-0x0;var _0x39be4f=a39_0x58ef[_0x3bf383];return _0x39be4f;};'use strict';var __importDefault=this&&this[a39_0x330d('0x0')]||function(_0x52a80f){return _0x52a80f&&_0x52a80f[a39_0x330d('0x1')]?_0x52a80f:{'default':_0x52a80f};};Object['defineProperty'](exports,a39_0x330d('0x1'),{'value':!![]});const sequelize_utils_1=__importDefault(require(a39_0x330d('0x2')));const crypt_utils_1=__importDefault(require(a39_0x330d('0x3')));const jwt=require(a39_0x330d('0x4'));const i18n=require(a39_0x330d('0x5'));const authUtils=require(a39_0x330d('0x6'));const responseUtils=require('../../infrastructure/response-utils');const LocaleStrings=require(a39_0x330d('0x7'));const format=require(a39_0x330d('0x8'));const formidable=require('formidable');const fsExtra=require('fs-extra');class AuthenticationController{constructor(_0x392aaf){this[a39_0x330d('0x9')]=_0x392aaf;this['login']=this[a39_0x330d('0xa')][a39_0x330d('0xb')](this);this['logout']=this['logout'][a39_0x330d('0xb')](this);this[a39_0x330d('0xc')]=this[a39_0x330d('0xc')][a39_0x330d('0xb')](this);this[a39_0x330d('0xd')]=this[a39_0x330d('0xd')]['bind'](this);}[a39_0x330d('0xa')](_0xc6525f,_0x5596c3,_0x3d8ab5){this['model'][a39_0x330d('0xe')]({'where':{'username':_0xc6525f['body'][a39_0x330d('0xf')]},'attributes':['id',a39_0x330d('0x10'),a39_0x330d('0x11'),'email',a39_0x330d('0xf'),a39_0x330d('0x12')]})[a39_0x330d('0x13')](_0x3a1799=>{if(!_0x3a1799){return responseUtils[a39_0x330d('0x14')](_0xc6525f,_0x5596c3,format(LocaleStrings['usernameNotFoundError'],_0xc6525f['body'][a39_0x330d('0xf')]),0x193);}if(crypt_utils_1[a39_0x330d('0x15')][a39_0x330d('0x16')](_0xc6525f['body'][a39_0x330d('0x12')],_0x3a1799['password']==null?'':_0x3a1799[a39_0x330d('0x12')])){_0x3a1799=_0x3a1799[a39_0x330d('0x17')]();const _0x4ad793=authUtils[a39_0x330d('0x18')](_0x3a1799);const _0x158620={'token':_0x4ad793,'id':sequelize_utils_1[a39_0x330d('0x15')]['encryptId'](_0x3a1799['id'])};return responseUtils[a39_0x330d('0x19')](_0xc6525f,_0x5596c3,_0x158620,0xc8);}else{return responseUtils[a39_0x330d('0x14')](_0xc6525f,_0x5596c3,format(LocaleStrings[a39_0x330d('0x1a')]),0x193);}})[a39_0x330d('0x1b')](_0x237fa5=>{return responseUtils[a39_0x330d('0x14')](_0xc6525f,_0x5596c3,_0x237fa5,0x1f4);});}[a39_0x330d('0x1c')](_0xda3bcd,_0x67b2ea,_0x2d8700){return responseUtils[a39_0x330d('0x19')](_0xda3bcd,_0x67b2ea,!![],0xc8);}[a39_0x330d('0xc')](_0x101e9d,_0x1eb9ad,_0x5dbabb){this[a39_0x330d('0x9')][a39_0x330d('0xe')]({'where':{'username':_0x101e9d[a39_0x330d('0x1d')][a39_0x330d('0xf')]}})['then'](_0x1a9055=>{let _0x387496=![];if(_0x1a9055){_0x387496=!![];}return responseUtils[a39_0x330d('0x19')](_0x101e9d,_0x1eb9ad,{'exist':_0x387496},0xc8);})[a39_0x330d('0x1b')](_0x2e94a5=>{return responseUtils[a39_0x330d('0x14')](_0x101e9d,_0x1eb9ad,_0x2e94a5[a39_0x330d('0x1e')],0x1f4);});}[a39_0x330d('0xd')](_0x213143,_0x29af52,_0x2d5788){this['model']['findOne']({'where':{'username':_0x213143[a39_0x330d('0x1d')][a39_0x330d('0xf')]}})['then'](_0x20d3bf=>{if(_0x20d3bf){return responseUtils[a39_0x330d('0x14')](_0x213143,_0x29af52,format(LocaleStrings[a39_0x330d('0x1f')],_0x213143[a39_0x330d('0x1d')][a39_0x330d('0xf')]),0x193);}else{_0x213143[a39_0x330d('0x1d')][a39_0x330d('0x20')]=_0x213143['body']['username'];const _0xf7d0de={'first_name':_0x213143[a39_0x330d('0x1d')]['first_name'],'last_name':_0x213143[a39_0x330d('0x1d')]['last_name'],'email':_0x213143[a39_0x330d('0x1d')]['email'],'username':_0x213143[a39_0x330d('0x1d')][a39_0x330d('0xf')],'password':crypt_utils_1[a39_0x330d('0x15')]['hashPassword'](_0x213143[a39_0x330d('0x1d')][a39_0x330d('0x12')])};this[a39_0x330d('0x9')][a39_0x330d('0x21')](_0xf7d0de)[a39_0x330d('0x13')](function(_0xc9594d,_0x524707){const _0x359827=authUtils[a39_0x330d('0x18')](_0xc9594d);const _0x3887f1={'token':_0x359827,'id':sequelize_utils_1[a39_0x330d('0x15')][a39_0x330d('0x22')](_0xc9594d['id'])};return responseUtils['successResponse'](_0x213143,_0x29af52,_0x3887f1,0xc8);})['catch'](_0x57ebc1=>{return responseUtils[a39_0x330d('0x14')](_0x213143,_0x29af52,_0x57ebc1[a39_0x330d('0x1e')],0x1f4);});}})[a39_0x330d('0x1b')](_0x2dbf25=>{return responseUtils[a39_0x330d('0x14')](_0x213143,_0x29af52,_0x2dbf25[a39_0x330d('0x1e')],0x1f4);});}}exports[a39_0x330d('0x15')]=AuthenticationController;