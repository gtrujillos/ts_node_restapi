var a11_0x4efa=['string-format','login','bind','createAccount','model','findOne','username','uuid','first_name','last_name','email','password','usernameNotFoundError','body','sign','options','token','successResponse','errorResponse','passwordNotMatchError','stack','then','generateHash','create','dataValues','status','created_at','secret','catch','default','__esModule','jsonwebtoken','../../config/jwt.js','../../infrastructure/response-utils','../../resources/locale-strings'];(function(_0x303898,_0x1a633a){var _0x542c15=function(_0x1576d4){while(--_0x1576d4){_0x303898['push'](_0x303898['shift']());}};_0x542c15(++_0x1a633a);}(a11_0x4efa,0x136));var a11_0x31e3=function(_0x548c78,_0x1c1590){_0x548c78=_0x548c78-0x0;var _0x1d9105=a11_0x4efa[_0x548c78];return _0x1d9105;};'use strict';Object['defineProperty'](exports,a11_0x31e3('0x0'),{'value':!![]});const jwt=require(a11_0x31e3('0x1'));const i18n=require('i18n');const configJwt=require(a11_0x31e3('0x2'));const authUtils=require('../../infrastructure/auth-utils');const responseUtils=require(a11_0x31e3('0x3'));const LocaleStrings=require(a11_0x31e3('0x4'));const format=require(a11_0x31e3('0x5'));class AuthenticationController{constructor(_0x5aa642){this['model']=_0x5aa642;this['login']=this[a11_0x31e3('0x6')][a11_0x31e3('0x7')](this);this['createAccount']=this[a11_0x31e3('0x8')][a11_0x31e3('0x7')](this);}[a11_0x31e3('0x6')](_0x3ad61d,_0x57a51c,_0x548576){this[a11_0x31e3('0x9')][a11_0x31e3('0xa')]({'where':{'username':_0x3ad61d['body'][a11_0x31e3('0xb')]},'attributes':[a11_0x31e3('0xc'),a11_0x31e3('0xd'),a11_0x31e3('0xe'),a11_0x31e3('0xf'),'username',a11_0x31e3('0x10')]})['then'](_0x4148e9=>{if(!_0x4148e9){return responseUtils['errorResponse'](_0x57a51c,format(LocaleStrings[a11_0x31e3('0x11')],_0x3ad61d[a11_0x31e3('0x12')][a11_0x31e3('0xb')]),0x193);}if(authUtils['validPassword'](_0x3ad61d[a11_0x31e3('0x12')]['password'],_0x4148e9[a11_0x31e3('0x10')])){_0x4148e9=_0x4148e9['toJSON']();const _0x1bce7b={'uuid':_0x4148e9[a11_0x31e3('0xc')]};const _0x27cc2d=jwt[a11_0x31e3('0x13')](_0x1bce7b,configJwt['secret'],configJwt[a11_0x31e3('0x14')]);delete _0x4148e9[a11_0x31e3('0x10')];_0x4148e9[a11_0x31e3('0x15')]=_0x27cc2d;return responseUtils[a11_0x31e3('0x16')](_0x57a51c,_0x4148e9,0xc8);}else{return responseUtils[a11_0x31e3('0x17')](_0x57a51c,format(LocaleStrings[a11_0x31e3('0x18')]),0x193);}})['catch'](_0x2fadbf=>{return responseUtils[a11_0x31e3('0x17')](_0x57a51c,_0x2fadbf[a11_0x31e3('0x19')],0x1f4);});}[a11_0x31e3('0x8')](_0x5ce527,_0x51bf3e,_0x39789f){this[a11_0x31e3('0x9')][a11_0x31e3('0xa')]({'where':{'username':_0x5ce527['body'][a11_0x31e3('0xb')]}})[a11_0x31e3('0x1a')](_0x1b129b=>{if(_0x1b129b){return responseUtils[a11_0x31e3('0x17')](_0x51bf3e,format(LocaleStrings['usernameTakenError'],_0x5ce527[a11_0x31e3('0x12')][a11_0x31e3('0xb')]),0x193);}else{_0x5ce527[a11_0x31e3('0x12')][a11_0x31e3('0xf')]=_0x5ce527[a11_0x31e3('0x12')][a11_0x31e3('0xb')];const _0x184953={'first_name':_0x5ce527[a11_0x31e3('0x12')][a11_0x31e3('0xd')],'last_name':_0x5ce527[a11_0x31e3('0x12')]['last_name'],'email':_0x5ce527[a11_0x31e3('0x12')][a11_0x31e3('0xf')],'username':_0x5ce527[a11_0x31e3('0x12')][a11_0x31e3('0xb')],'password':authUtils[a11_0x31e3('0x1b')](_0x5ce527[a11_0x31e3('0x12')][a11_0x31e3('0x10')])};this[a11_0x31e3('0x9')][a11_0x31e3('0x1c')](_0x184953)[a11_0x31e3('0x1a')](function(_0x151614,_0x2df8ff){delete _0x151614[a11_0x31e3('0x1d')]['id'];delete _0x151614[a11_0x31e3('0x1d')][a11_0x31e3('0x1e')];delete _0x151614[a11_0x31e3('0x1d')][a11_0x31e3('0x10')];delete _0x151614['dataValues']['updated_at'];delete _0x151614[a11_0x31e3('0x1d')][a11_0x31e3('0x1f')];const _0x1303e2={'uuid':_0x151614[a11_0x31e3('0xc')]};const _0x569777=jwt[a11_0x31e3('0x13')](_0x1303e2,configJwt[a11_0x31e3('0x20')],configJwt['options']);_0x151614[a11_0x31e3('0x1d')][a11_0x31e3('0x15')]=_0x569777;return responseUtils[a11_0x31e3('0x16')](_0x51bf3e,_0x151614,0xc8);})[a11_0x31e3('0x21')](_0x23270c=>{return responseUtils[a11_0x31e3('0x17')](_0x51bf3e,_0x23270c[a11_0x31e3('0x19')],0x1f4);});}})['catch'](_0x5bfe2b=>{return responseUtils[a11_0x31e3('0x17')](_0x51bf3e,_0x5bfe2b[a11_0x31e3('0x19')],0x1f4);});}}exports[a11_0x31e3('0x22')]=AuthenticationController;