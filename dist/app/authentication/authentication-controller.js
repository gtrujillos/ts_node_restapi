var a30_0x7da3=['then','errorResponse','default','validPassword','password','sign','secret','options','successResponse','passwordNotMatchError','hashPassword','create','dataValues','stack','__importDefault','__esModule','defineProperty','jsonwebtoken','i18n','../../config/jwt.js','../../infrastructure/auth-utils','../../infrastructure/response-utils','string-format','model','login','bind','createAccount','findOne','body','username','first_name','last_name','email'];(function(_0x148128,_0x185686){var _0x30c18f=function(_0xf9d60){while(--_0xf9d60){_0x148128['push'](_0x148128['shift']());}};_0x30c18f(++_0x185686);}(a30_0x7da3,0xf5));var a30_0x1600=function(_0x2d8f05,_0x4b81bb){_0x2d8f05=_0x2d8f05-0x0;var _0x4d74cb=a30_0x7da3[_0x2d8f05];return _0x4d74cb;};'use strict';var __importDefault=this&&this[a30_0x1600('0x0')]||function(_0x2d6cf1){return _0x2d6cf1&&_0x2d6cf1[a30_0x1600('0x1')]?_0x2d6cf1:{'default':_0x2d6cf1};};Object[a30_0x1600('0x2')](exports,a30_0x1600('0x1'),{'value':!![]});const crypt_utils_1=__importDefault(require('../../infrastructure/crypt-utils'));const jwt=require(a30_0x1600('0x3'));const i18n=require(a30_0x1600('0x4'));const configJwt=require(a30_0x1600('0x5'));const authUtils=require(a30_0x1600('0x6'));const responseUtils=require(a30_0x1600('0x7'));const LocaleStrings=require('../../resources/locale-strings');const format=require(a30_0x1600('0x8'));class AuthenticationController{constructor(_0x41369f){this[a30_0x1600('0x9')]=_0x41369f;this[a30_0x1600('0xa')]=this[a30_0x1600('0xa')][a30_0x1600('0xb')](this);this[a30_0x1600('0xc')]=this[a30_0x1600('0xc')][a30_0x1600('0xb')](this);}['login'](_0x3d9960,_0x1f47dd,_0x163eb4){this['model'][a30_0x1600('0xd')]({'where':{'username':_0x3d9960[a30_0x1600('0xe')][a30_0x1600('0xf')]},'attributes':['id',a30_0x1600('0x10'),a30_0x1600('0x11'),a30_0x1600('0x12'),a30_0x1600('0xf'),'password']})[a30_0x1600('0x13')](_0x1807c2=>{if(!_0x1807c2){return responseUtils[a30_0x1600('0x14')](_0x1f47dd,format(LocaleStrings['usernameNotFoundError'],_0x3d9960['body'][a30_0x1600('0xf')]),0x193);}if(crypt_utils_1[a30_0x1600('0x15')][a30_0x1600('0x16')](_0x3d9960[a30_0x1600('0xe')][a30_0x1600('0x17')],_0x1807c2['password'])){_0x1807c2=_0x1807c2['toJSON']();const _0x34b5dc={'id':_0x1807c2['id']};const _0xe1705b=jwt[a30_0x1600('0x18')](_0x34b5dc,configJwt[a30_0x1600('0x19')],configJwt[a30_0x1600('0x1a')]);const _0x39de17={'token':_0xe1705b};return responseUtils[a30_0x1600('0x1b')](_0x1f47dd,_0x39de17,0xc8);}else{return responseUtils[a30_0x1600('0x14')](_0x1f47dd,format(LocaleStrings[a30_0x1600('0x1c')]),0x193);}})['catch'](_0xfed32e=>{return responseUtils[a30_0x1600('0x14')](_0x1f47dd,_0xfed32e,0x1f4);});}[a30_0x1600('0xc')](_0x363205,_0x3b95f8,_0x67ecf8){this[a30_0x1600('0x9')]['findOne']({'where':{'username':_0x363205[a30_0x1600('0xe')][a30_0x1600('0xf')]}})[a30_0x1600('0x13')](_0x438fa6=>{if(_0x438fa6){return responseUtils[a30_0x1600('0x14')](_0x3b95f8,format(LocaleStrings['usernameTakenError'],_0x363205['body'][a30_0x1600('0xf')]),0x193);}else{_0x363205[a30_0x1600('0xe')]['email']=_0x363205[a30_0x1600('0xe')]['username'];const _0x54bbe1={'first_name':_0x363205[a30_0x1600('0xe')][a30_0x1600('0x10')],'last_name':_0x363205[a30_0x1600('0xe')][a30_0x1600('0x11')],'email':_0x363205[a30_0x1600('0xe')]['email'],'username':_0x363205[a30_0x1600('0xe')]['username'],'password':crypt_utils_1[a30_0x1600('0x15')][a30_0x1600('0x1d')](_0x363205[a30_0x1600('0xe')]['password'])};this['model'][a30_0x1600('0x1e')](_0x54bbe1)[a30_0x1600('0x13')](function(_0x5c2e7a,_0x2edc47){const _0x4dc1a5={'id':_0x5c2e7a[a30_0x1600('0x1f')]['id']};const _0x34742e=jwt[a30_0x1600('0x18')](_0x4dc1a5,configJwt[a30_0x1600('0x19')],configJwt[a30_0x1600('0x1a')]);const _0x4707d5={'token':_0x34742e};return responseUtils[a30_0x1600('0x1b')](_0x3b95f8,_0x4707d5,0xc8);})['catch'](_0x476116=>{return responseUtils[a30_0x1600('0x14')](_0x3b95f8,_0x476116[a30_0x1600('0x20')],0x1f4);});}})['catch'](_0x3c9fd1=>{return responseUtils['errorResponse'](_0x3b95f8,_0x3c9fd1[a30_0x1600('0x20')],0x1f4);});}}exports['default']=AuthenticationController;