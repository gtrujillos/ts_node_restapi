var a30_0x113f=['successResponse','stack','__importDefault','__esModule','defineProperty','../../infrastructure/crypt-utils','jsonwebtoken','i18n','../../config/jwt.js','../../infrastructure/auth-utils','string-format','model','login','bind','createAccount','body','username','last_name','email','password','then','errorResponse','default','validPassword','toJSON','sign','secret','options','passwordNotMatchError','catch','findOne','first_name','dataValues'];(function(_0x287bba,_0x5919d1){var _0x12b15a=function(_0x5acd19){while(--_0x5acd19){_0x287bba['push'](_0x287bba['shift']());}};_0x12b15a(++_0x5919d1);}(a30_0x113f,0xc8));var a30_0x1532=function(_0x3fe21a,_0x24026b){_0x3fe21a=_0x3fe21a-0x0;var _0x586ac8=a30_0x113f[_0x3fe21a];return _0x586ac8;};'use strict';var __importDefault=this&&this[a30_0x1532('0x0')]||function(_0x58db66){return _0x58db66&&_0x58db66[a30_0x1532('0x1')]?_0x58db66:{'default':_0x58db66};};Object[a30_0x1532('0x2')](exports,a30_0x1532('0x1'),{'value':!![]});const crypt_utils_1=__importDefault(require(a30_0x1532('0x3')));const jwt=require(a30_0x1532('0x4'));const i18n=require(a30_0x1532('0x5'));const configJwt=require(a30_0x1532('0x6'));const authUtils=require(a30_0x1532('0x7'));const responseUtils=require('../../infrastructure/response-utils');const LocaleStrings=require('../../resources/locale-strings');const format=require(a30_0x1532('0x8'));class AuthenticationController{constructor(_0x5c1377){this[a30_0x1532('0x9')]=_0x5c1377;this['login']=this[a30_0x1532('0xa')][a30_0x1532('0xb')](this);this[a30_0x1532('0xc')]=this[a30_0x1532('0xc')][a30_0x1532('0xb')](this);}['login'](_0x363c4f,_0x6bc04a,_0x242b58){this[a30_0x1532('0x9')]['findOne']({'where':{'username':_0x363c4f[a30_0x1532('0xd')][a30_0x1532('0xe')]},'attributes':['id','first_name',a30_0x1532('0xf'),a30_0x1532('0x10'),'username',a30_0x1532('0x11')]})[a30_0x1532('0x12')](_0x3442ab=>{if(!_0x3442ab){return responseUtils[a30_0x1532('0x13')](_0x6bc04a,format(LocaleStrings['usernameNotFoundError'],_0x363c4f[a30_0x1532('0xd')]['username']),0x193);}if(crypt_utils_1[a30_0x1532('0x14')][a30_0x1532('0x15')](_0x363c4f[a30_0x1532('0xd')][a30_0x1532('0x11')],_0x3442ab['password'])){_0x3442ab=_0x3442ab[a30_0x1532('0x16')]();const _0x3d98c5={'id':_0x3442ab['id']};const _0x183a69=jwt[a30_0x1532('0x17')](_0x3d98c5,configJwt[a30_0x1532('0x18')],configJwt[a30_0x1532('0x19')]);const _0x5547ba={'token':_0x183a69};return responseUtils['successResponse'](_0x6bc04a,_0x5547ba,0xc8);}else{return responseUtils[a30_0x1532('0x13')](_0x6bc04a,format(LocaleStrings[a30_0x1532('0x1a')]),0x193);}})[a30_0x1532('0x1b')](_0x2a34f6=>{return responseUtils['errorResponse'](_0x6bc04a,_0x2a34f6,0x1f4);});}['createAccount'](_0x3e924b,_0x55cff4,_0x132e79){this[a30_0x1532('0x9')][a30_0x1532('0x1c')]({'where':{'username':_0x3e924b[a30_0x1532('0xd')][a30_0x1532('0xe')]}})[a30_0x1532('0x12')](_0x1e73cd=>{if(_0x1e73cd){return responseUtils[a30_0x1532('0x13')](_0x55cff4,format(LocaleStrings['usernameTakenError'],_0x3e924b[a30_0x1532('0xd')][a30_0x1532('0xe')]),0x193);}else{_0x3e924b[a30_0x1532('0xd')][a30_0x1532('0x10')]=_0x3e924b['body'][a30_0x1532('0xe')];const _0x3015f2={'first_name':_0x3e924b['body'][a30_0x1532('0x1d')],'last_name':_0x3e924b[a30_0x1532('0xd')][a30_0x1532('0xf')],'email':_0x3e924b[a30_0x1532('0xd')][a30_0x1532('0x10')],'username':_0x3e924b['body']['username'],'password':crypt_utils_1[a30_0x1532('0x14')]['hashPassword'](_0x3e924b[a30_0x1532('0xd')][a30_0x1532('0x11')])};this[a30_0x1532('0x9')]['create'](_0x3015f2)['then'](function(_0x13bc97,_0x3e5c1c){const _0xab134a={'id':_0x13bc97[a30_0x1532('0x1e')]['id']};const _0x30ab60=jwt['sign'](_0xab134a,configJwt['secret'],configJwt[a30_0x1532('0x19')]);const _0xd50e65={'token':_0x30ab60};return responseUtils[a30_0x1532('0x1f')](_0x55cff4,_0xd50e65,0xc8);})[a30_0x1532('0x1b')](_0x92ef00=>{return responseUtils[a30_0x1532('0x13')](_0x55cff4,_0x92ef00[a30_0x1532('0x20')],0x1f4);});}})[a30_0x1532('0x1b')](_0x4f5afa=>{return responseUtils[a30_0x1532('0x13')](_0x55cff4,_0x4f5afa[a30_0x1532('0x20')],0x1f4);});}}exports[a30_0x1532('0x14')]=AuthenticationController;