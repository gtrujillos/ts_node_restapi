var a39_0x55d6=['logout','usernameExist','createAccount','model','body','first_name','last_name','username','password','errorResponse','usernameNotFoundError','validPassword','toJSON','generateJWT','encryptId','successResponse','passwordNotMatchError','findOne','then','catch','usernameTakenError','email','hashPassword','stack','__importDefault','__esModule','defineProperty','../../infrastructure/sequelize-utils','../../infrastructure/crypt-utils','i18n','../../infrastructure/auth-utils','../../infrastructure/response-utils','string-format','login','bind'];(function(_0x407da1,_0x1053ba){var _0x2479d8=function(_0x21949d){while(--_0x21949d){_0x407da1['push'](_0x407da1['shift']());}};_0x2479d8(++_0x1053ba);}(a39_0x55d6,0x1df));var a39_0xe374=function(_0x41d6d3,_0x509296){_0x41d6d3=_0x41d6d3-0x0;var _0x2c5eba=a39_0x55d6[_0x41d6d3];return _0x2c5eba;};'use strict';var __importDefault=this&&this[a39_0xe374('0x0')]||function(_0x3514e6){return _0x3514e6&&_0x3514e6[a39_0xe374('0x1')]?_0x3514e6:{'default':_0x3514e6};};Object[a39_0xe374('0x2')](exports,'__esModule',{'value':!![]});const sequelize_utils_1=__importDefault(require(a39_0xe374('0x3')));const crypt_utils_1=__importDefault(require(a39_0xe374('0x4')));const jwt=require('jsonwebtoken');const i18n=require(a39_0xe374('0x5'));const authUtils=require(a39_0xe374('0x6'));const responseUtils=require(a39_0xe374('0x7'));const LocaleStrings=require('../../resources/locale-strings');const format=require(a39_0xe374('0x8'));const formidable=require('formidable');const fsExtra=require('fs-extra');class AuthenticationController{constructor(_0x3a1a1e){this['model']=_0x3a1a1e;this[a39_0xe374('0x9')]=this[a39_0xe374('0x9')][a39_0xe374('0xa')](this);this[a39_0xe374('0xb')]=this[a39_0xe374('0xb')][a39_0xe374('0xa')](this);this[a39_0xe374('0xc')]=this[a39_0xe374('0xc')][a39_0xe374('0xa')](this);this[a39_0xe374('0xd')]=this['createAccount']['bind'](this);}[a39_0xe374('0x9')](_0x5b950c,_0x192d4d,_0x5458a4){this[a39_0xe374('0xe')]['findOne']({'where':{'username':_0x5b950c[a39_0xe374('0xf')]['username']},'attributes':['id',a39_0xe374('0x10'),a39_0xe374('0x11'),'email',a39_0xe374('0x12'),a39_0xe374('0x13')]})['then'](_0x55dd65=>{if(!_0x55dd65){return responseUtils[a39_0xe374('0x14')](_0x5b950c,_0x192d4d,format(LocaleStrings[a39_0xe374('0x15')],_0x5b950c[a39_0xe374('0xf')][a39_0xe374('0x12')]),0x193);}if(crypt_utils_1['default'][a39_0xe374('0x16')](_0x5b950c[a39_0xe374('0xf')][a39_0xe374('0x13')],_0x55dd65[a39_0xe374('0x13')]==null?'':_0x55dd65[a39_0xe374('0x13')])){_0x55dd65=_0x55dd65[a39_0xe374('0x17')]();const _0x434d25=authUtils[a39_0xe374('0x18')](_0x55dd65);const _0x2d7a8c={'token':_0x434d25,'id':sequelize_utils_1['default'][a39_0xe374('0x19')](_0x55dd65['id'])};return responseUtils[a39_0xe374('0x1a')](_0x5b950c,_0x192d4d,_0x2d7a8c,0xc8);}else{return responseUtils[a39_0xe374('0x14')](_0x5b950c,_0x192d4d,format(LocaleStrings[a39_0xe374('0x1b')]),0x193);}})['catch'](_0x35a5c1=>{return responseUtils[a39_0xe374('0x14')](_0x5b950c,_0x192d4d,_0x35a5c1,0x1f4);});}[a39_0xe374('0xb')](_0x13508d,_0x4919be,_0x199dbe){return responseUtils[a39_0xe374('0x1a')](_0x13508d,_0x4919be,!![],0xc8);}[a39_0xe374('0xc')](_0x280bf8,_0x3ff589,_0x5a30b3){this[a39_0xe374('0xe')][a39_0xe374('0x1c')]({'where':{'username':_0x280bf8[a39_0xe374('0xf')]['username']}})[a39_0xe374('0x1d')](_0x4b2aad=>{let _0x39538e=![];if(_0x4b2aad){_0x39538e=!![];}return responseUtils['successResponse'](_0x280bf8,_0x3ff589,{'exist':_0x39538e},0xc8);})[a39_0xe374('0x1e')](_0x3ac413=>{return responseUtils[a39_0xe374('0x14')](_0x280bf8,_0x3ff589,_0x3ac413['stack'],0x1f4);});}[a39_0xe374('0xd')](_0x465d13,_0x158f16,_0x2157cc){this[a39_0xe374('0xe')][a39_0xe374('0x1c')]({'where':{'username':_0x465d13[a39_0xe374('0xf')]['username']}})[a39_0xe374('0x1d')](_0x380a01=>{if(_0x380a01){return responseUtils[a39_0xe374('0x14')](_0x465d13,_0x158f16,format(LocaleStrings[a39_0xe374('0x1f')],_0x465d13[a39_0xe374('0xf')][a39_0xe374('0x12')]),0x193);}else{_0x465d13[a39_0xe374('0xf')][a39_0xe374('0x20')]=_0x465d13[a39_0xe374('0xf')]['username'];const _0x27474a={'first_name':_0x465d13[a39_0xe374('0xf')][a39_0xe374('0x10')],'last_name':_0x465d13[a39_0xe374('0xf')][a39_0xe374('0x11')],'email':_0x465d13['body']['email'],'username':_0x465d13[a39_0xe374('0xf')][a39_0xe374('0x12')],'password':crypt_utils_1['default'][a39_0xe374('0x21')](_0x465d13[a39_0xe374('0xf')][a39_0xe374('0x13')])};this['model']['create'](_0x27474a)[a39_0xe374('0x1d')](function(_0x21783e,_0x16419a){const _0x180963=authUtils['generateJWT'](_0x21783e);const _0x4cc903={'token':_0x180963,'id':sequelize_utils_1['default'][a39_0xe374('0x19')](_0x21783e['id'])};return responseUtils['successResponse'](_0x465d13,_0x158f16,_0x4cc903,0xc8);})[a39_0xe374('0x1e')](_0x2e524a=>{return responseUtils[a39_0xe374('0x14')](_0x465d13,_0x158f16,_0x2e524a[a39_0xe374('0x22')],0x1f4);});}})[a39_0xe374('0x1e')](_0x5ca962=>{return responseUtils[a39_0xe374('0x14')](_0x465d13,_0x158f16,_0x5ca962[a39_0xe374('0x22')],0x1f4);});}}exports['default']=AuthenticationController;