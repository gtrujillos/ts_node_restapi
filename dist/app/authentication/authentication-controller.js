var a30_0x4ef0=['body','username','first_name','last_name','email','password','errorResponse','default','toJSON','sign','secret','options','successResponse','passwordNotMatchError','catch','stack','hashPassword','create','then','dataValues','__esModule','defineProperty','jsonwebtoken','i18n','../../config/jwt.js','../../infrastructure/auth-utils','string-format','model','login','createAccount','findOne'];(function(_0x26b902,_0x373182){var _0x20edb9=function(_0x51b4eb){while(--_0x51b4eb){_0x26b902['push'](_0x26b902['shift']());}};_0x20edb9(++_0x373182);}(a30_0x4ef0,0x169));var a30_0x11d4=function(_0x4f4140,_0x6a71e6){_0x4f4140=_0x4f4140-0x0;var _0x5ba5ed=a30_0x4ef0[_0x4f4140];return _0x5ba5ed;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x394021){return _0x394021&&_0x394021[a30_0x11d4('0x0')]?_0x394021:{'default':_0x394021};};Object[a30_0x11d4('0x1')](exports,'__esModule',{'value':!![]});const crypt_utils_1=__importDefault(require('../../infrastructure/crypt-utils'));const jwt=require(a30_0x11d4('0x2'));const i18n=require(a30_0x11d4('0x3'));const configJwt=require(a30_0x11d4('0x4'));const authUtils=require(a30_0x11d4('0x5'));const responseUtils=require('../../infrastructure/response-utils');const LocaleStrings=require('../../resources/locale-strings');const format=require(a30_0x11d4('0x6'));class AuthenticationController{constructor(_0x2f3367){this[a30_0x11d4('0x7')]=_0x2f3367;this[a30_0x11d4('0x8')]=this[a30_0x11d4('0x8')]['bind'](this);this[a30_0x11d4('0x9')]=this['createAccount']['bind'](this);}[a30_0x11d4('0x8')](_0x51f2c3,_0x1f5a5e,_0x4f7cd6){this[a30_0x11d4('0x7')][a30_0x11d4('0xa')]({'where':{'username':_0x51f2c3[a30_0x11d4('0xb')][a30_0x11d4('0xc')]},'attributes':['id',a30_0x11d4('0xd'),a30_0x11d4('0xe'),a30_0x11d4('0xf'),a30_0x11d4('0xc'),a30_0x11d4('0x10')]})['then'](_0x3f3283=>{if(!_0x3f3283){return responseUtils[a30_0x11d4('0x11')](_0x1f5a5e,format(LocaleStrings['usernameNotFoundError'],_0x51f2c3[a30_0x11d4('0xb')][a30_0x11d4('0xc')]),0x193);}if(crypt_utils_1[a30_0x11d4('0x12')]['validPassword'](_0x51f2c3[a30_0x11d4('0xb')][a30_0x11d4('0x10')],_0x3f3283[a30_0x11d4('0x10')])){_0x3f3283=_0x3f3283[a30_0x11d4('0x13')]();const _0x37e62c={'id':_0x3f3283['id']};const _0x446be9=jwt[a30_0x11d4('0x14')](_0x37e62c,configJwt[a30_0x11d4('0x15')],configJwt[a30_0x11d4('0x16')]);const _0x2973fc={'token':_0x446be9};return responseUtils[a30_0x11d4('0x17')](_0x1f5a5e,_0x2973fc,0xc8);}else{return responseUtils[a30_0x11d4('0x11')](_0x1f5a5e,format(LocaleStrings[a30_0x11d4('0x18')]),0x193);}})[a30_0x11d4('0x19')](_0x15a72e=>{return responseUtils[a30_0x11d4('0x11')](_0x1f5a5e,_0x15a72e[a30_0x11d4('0x1a')],0x1f4);});}[a30_0x11d4('0x9')](_0x886a5,_0x456fa6,_0x22a03f){this[a30_0x11d4('0x7')][a30_0x11d4('0xa')]({'where':{'username':_0x886a5[a30_0x11d4('0xb')]['username']}})['then'](_0x5db16e=>{if(_0x5db16e){return responseUtils[a30_0x11d4('0x11')](_0x456fa6,format(LocaleStrings['usernameTakenError'],_0x886a5['body'][a30_0x11d4('0xc')]),0x193);}else{_0x886a5[a30_0x11d4('0xb')][a30_0x11d4('0xf')]=_0x886a5[a30_0x11d4('0xb')]['username'];const _0x3f1e3a={'first_name':_0x886a5[a30_0x11d4('0xb')][a30_0x11d4('0xd')],'last_name':_0x886a5[a30_0x11d4('0xb')][a30_0x11d4('0xe')],'email':_0x886a5[a30_0x11d4('0xb')][a30_0x11d4('0xf')],'username':_0x886a5[a30_0x11d4('0xb')][a30_0x11d4('0xc')],'password':crypt_utils_1[a30_0x11d4('0x12')][a30_0x11d4('0x1b')](_0x886a5[a30_0x11d4('0xb')]['password'])};this['model'][a30_0x11d4('0x1c')](_0x3f1e3a)[a30_0x11d4('0x1d')](function(_0x39bf0c,_0x28d77f){const _0x7995f7={'id':_0x39bf0c[a30_0x11d4('0x1e')]['id']};const _0x2b53ae=jwt['sign'](_0x7995f7,configJwt[a30_0x11d4('0x15')],configJwt['options']);const _0x3d5794={'token':_0x2b53ae};return responseUtils[a30_0x11d4('0x17')](_0x456fa6,_0x3d5794,0xc8);})[a30_0x11d4('0x19')](_0x1408d4=>{return responseUtils[a30_0x11d4('0x11')](_0x456fa6,_0x1408d4[a30_0x11d4('0x1a')],0x1f4);});}})['catch'](_0x35bc=>{return responseUtils['errorResponse'](_0x456fa6,_0x35bc['stack'],0x1f4);});}}exports[a30_0x11d4('0x12')]=AuthenticationController;