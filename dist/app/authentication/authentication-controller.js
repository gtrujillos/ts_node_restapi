var a30_0x16e1=['../../infrastructure/auth-utils','../../infrastructure/response-utils','string-format','login','bind','model','findOne','body','username','first_name','email','password','then','default','validPassword','toJSON','sign','secret','options','successResponse','passwordNotMatchError','errorResponse','usernameTakenError','last_name','hashPassword','create','dataValues','catch','stack','__importDefault','__esModule','defineProperty','i18n','../../config/jwt.js'];(function(_0x32a948,_0x35204f){var _0x5d9087=function(_0x2634f8){while(--_0x2634f8){_0x32a948['push'](_0x32a948['shift']());}};_0x5d9087(++_0x35204f);}(a30_0x16e1,0xa5));var a30_0x3e0e=function(_0x20256b,_0x290b04){_0x20256b=_0x20256b-0x0;var _0x38a48b=a30_0x16e1[_0x20256b];return _0x38a48b;};'use strict';var __importDefault=this&&this[a30_0x3e0e('0x0')]||function(_0x11a3f0){return _0x11a3f0&&_0x11a3f0[a30_0x3e0e('0x1')]?_0x11a3f0:{'default':_0x11a3f0};};Object[a30_0x3e0e('0x2')](exports,a30_0x3e0e('0x1'),{'value':!![]});const crypt_utils_1=__importDefault(require('../../infrastructure/crypt-utils'));const jwt=require('jsonwebtoken');const i18n=require(a30_0x3e0e('0x3'));const configJwt=require(a30_0x3e0e('0x4'));const authUtils=require(a30_0x3e0e('0x5'));const responseUtils=require(a30_0x3e0e('0x6'));const LocaleStrings=require('../../resources/locale-strings');const format=require(a30_0x3e0e('0x7'));class AuthenticationController{constructor(_0x1a076e){this['model']=_0x1a076e;this[a30_0x3e0e('0x8')]=this[a30_0x3e0e('0x8')][a30_0x3e0e('0x9')](this);this['createAccount']=this['createAccount']['bind'](this);}[a30_0x3e0e('0x8')](_0x1c1581,_0x3f5b8b,_0x110874){this[a30_0x3e0e('0xa')][a30_0x3e0e('0xb')]({'where':{'username':_0x1c1581[a30_0x3e0e('0xc')][a30_0x3e0e('0xd')]},'attributes':['id',a30_0x3e0e('0xe'),'last_name',a30_0x3e0e('0xf'),'username',a30_0x3e0e('0x10')]})[a30_0x3e0e('0x11')](_0x5f1d91=>{if(!_0x5f1d91){return responseUtils['errorResponse'](_0x3f5b8b,format(LocaleStrings['usernameNotFoundError'],_0x1c1581['body'][a30_0x3e0e('0xd')]),0x193);}if(crypt_utils_1[a30_0x3e0e('0x12')][a30_0x3e0e('0x13')](_0x1c1581['body'][a30_0x3e0e('0x10')],_0x5f1d91['password'])){_0x5f1d91=_0x5f1d91[a30_0x3e0e('0x14')]();const _0x3bd4d8={'id':_0x5f1d91['id']};const _0x126146=jwt[a30_0x3e0e('0x15')](_0x3bd4d8,configJwt[a30_0x3e0e('0x16')],configJwt[a30_0x3e0e('0x17')]);const _0x1405a5={'token':_0x126146};return responseUtils[a30_0x3e0e('0x18')](_0x3f5b8b,_0x1405a5,0xc8);}else{return responseUtils['errorResponse'](_0x3f5b8b,format(LocaleStrings[a30_0x3e0e('0x19')]),0x193);}})['catch'](_0x5a9627=>{return responseUtils['errorResponse'](_0x3f5b8b,_0x5a9627,0x1f4);});}['createAccount'](_0x58ea48,_0x1261ac,_0xcf7f01){this[a30_0x3e0e('0xa')]['findOne']({'where':{'username':_0x58ea48['body'][a30_0x3e0e('0xd')]}})[a30_0x3e0e('0x11')](_0x4f2574=>{if(_0x4f2574){return responseUtils[a30_0x3e0e('0x1a')](_0x1261ac,format(LocaleStrings[a30_0x3e0e('0x1b')],_0x58ea48[a30_0x3e0e('0xc')][a30_0x3e0e('0xd')]),0x193);}else{_0x58ea48[a30_0x3e0e('0xc')][a30_0x3e0e('0xf')]=_0x58ea48[a30_0x3e0e('0xc')][a30_0x3e0e('0xd')];const _0x4cf42b={'first_name':_0x58ea48[a30_0x3e0e('0xc')]['first_name'],'last_name':_0x58ea48['body'][a30_0x3e0e('0x1c')],'email':_0x58ea48[a30_0x3e0e('0xc')][a30_0x3e0e('0xf')],'username':_0x58ea48[a30_0x3e0e('0xc')][a30_0x3e0e('0xd')],'password':crypt_utils_1['default'][a30_0x3e0e('0x1d')](_0x58ea48['body']['password'])};this['model'][a30_0x3e0e('0x1e')](_0x4cf42b)['then'](function(_0x49c7e7,_0x34044c){const _0x39379b={'id':_0x49c7e7[a30_0x3e0e('0x1f')]['id']};const _0x2e2f85=jwt[a30_0x3e0e('0x15')](_0x39379b,configJwt[a30_0x3e0e('0x16')],configJwt['options']);const _0x5dc105={'token':_0x2e2f85};return responseUtils[a30_0x3e0e('0x18')](_0x1261ac,_0x5dc105,0xc8);})[a30_0x3e0e('0x20')](_0x3fce7b=>{return responseUtils['errorResponse'](_0x1261ac,_0x3fce7b['stack'],0x1f4);});}})[a30_0x3e0e('0x20')](_0x36200f=>{return responseUtils[a30_0x3e0e('0x1a')](_0x1261ac,_0x36200f[a30_0x3e0e('0x21')],0x1f4);});}}exports[a30_0x3e0e('0x12')]=AuthenticationController;