var a45_0x3124=['catch','hashPassword','create','encryptId','stack','__importDefault','defineProperty','__esModule','../../infrastructure/sequelize-utils','jsonwebtoken','../../infrastructure/response-utils','../../resources/locale-strings','formidable','model','login','bind','logout','usernameExist','createAccount','findOne','last_name','email','username','password','then','errorResponse','usernameNotFoundError','body','default','validPassword','generateJWT','successResponse','passwordNotMatchError'];(function(_0x16a372,_0x4da574){var _0x297823=function(_0x3bd74f){while(--_0x3bd74f){_0x16a372['push'](_0x16a372['shift']());}};_0x297823(++_0x4da574);}(a45_0x3124,0x89));var a45_0x56a6=function(_0x21503b,_0x4680ef){_0x21503b=_0x21503b-0x0;var _0x310d3f=a45_0x3124[_0x21503b];return _0x310d3f;};'use strict';var __importDefault=this&&this[a45_0x56a6('0x0')]||function(_0x1268fa){return _0x1268fa&&_0x1268fa['__esModule']?_0x1268fa:{'default':_0x1268fa};};Object[a45_0x56a6('0x1')](exports,a45_0x56a6('0x2'),{'value':!![]});const sequelize_utils_1=__importDefault(require(a45_0x56a6('0x3')));const crypt_utils_1=__importDefault(require('../../infrastructure/crypt-utils'));const jwt=require(a45_0x56a6('0x4'));const i18n=require('i18n');const authUtils=require('../../infrastructure/auth-utils');const responseUtils=require(a45_0x56a6('0x5'));const LocaleStrings=require(a45_0x56a6('0x6'));const format=require('string-format');const formidable=require(a45_0x56a6('0x7'));const fsExtra=require('fs-extra');class AuthenticationController{constructor(_0x488415){this[a45_0x56a6('0x8')]=_0x488415;this[a45_0x56a6('0x9')]=this[a45_0x56a6('0x9')][a45_0x56a6('0xa')](this);this[a45_0x56a6('0xb')]=this['logout']['bind'](this);this[a45_0x56a6('0xc')]=this['usernameExist'][a45_0x56a6('0xa')](this);this[a45_0x56a6('0xd')]=this[a45_0x56a6('0xd')][a45_0x56a6('0xa')](this);}[a45_0x56a6('0x9')](_0x173ad0,_0xacbe2d,_0x43f861){this['model'][a45_0x56a6('0xe')]({'where':{'username':_0x173ad0['body']['username']},'attributes':['id','first_name',a45_0x56a6('0xf'),a45_0x56a6('0x10'),a45_0x56a6('0x11'),a45_0x56a6('0x12')]})[a45_0x56a6('0x13')](_0x1b3752=>{if(!_0x1b3752){return responseUtils[a45_0x56a6('0x14')](_0x173ad0,_0xacbe2d,format(LocaleStrings[a45_0x56a6('0x15')],_0x173ad0[a45_0x56a6('0x16')][a45_0x56a6('0x11')]),0x193);}if(crypt_utils_1[a45_0x56a6('0x17')][a45_0x56a6('0x18')](_0x173ad0['body'][a45_0x56a6('0x12')],_0x1b3752['password']==null?'':_0x1b3752[a45_0x56a6('0x12')])){_0x1b3752=_0x1b3752['toJSON']();const _0x1321af=authUtils[a45_0x56a6('0x19')](_0x1b3752);const _0xabf316={'token':_0x1321af,'id':sequelize_utils_1[a45_0x56a6('0x17')]['encryptId'](_0x1b3752['id'])};return responseUtils[a45_0x56a6('0x1a')](_0x173ad0,_0xacbe2d,_0xabf316,0xc8);}else{return responseUtils[a45_0x56a6('0x14')](_0x173ad0,_0xacbe2d,format(LocaleStrings[a45_0x56a6('0x1b')]),0x193);}})[a45_0x56a6('0x1c')](_0x1efb1e=>{return responseUtils['errorResponse'](_0x173ad0,_0xacbe2d,_0x1efb1e,0x1f4);});}[a45_0x56a6('0xb')](_0x313da5,_0x3fc2e9,_0x2ff281){return responseUtils['successResponse'](_0x313da5,_0x3fc2e9,!![],0xc8);}[a45_0x56a6('0xc')](_0x216ff2,_0x3c7b0d,_0x1f31e3){this['model'][a45_0x56a6('0xe')]({'where':{'username':_0x216ff2[a45_0x56a6('0x16')][a45_0x56a6('0x11')]}})[a45_0x56a6('0x13')](_0x1334d2=>{let _0x586a4c=![];if(_0x1334d2){_0x586a4c=!![];}return responseUtils[a45_0x56a6('0x1a')](_0x216ff2,_0x3c7b0d,{'exist':_0x586a4c},0xc8);})[a45_0x56a6('0x1c')](_0x3cf5d4=>{return responseUtils[a45_0x56a6('0x14')](_0x216ff2,_0x3c7b0d,_0x3cf5d4['stack'],0x1f4);});}[a45_0x56a6('0xd')](_0x5d6bfa,_0x15317b,_0x2df3e1){this[a45_0x56a6('0x8')][a45_0x56a6('0xe')]({'where':{'username':_0x5d6bfa[a45_0x56a6('0x16')]['username']}})['then'](_0x5b0818=>{if(_0x5b0818){return responseUtils[a45_0x56a6('0x14')](_0x5d6bfa,_0x15317b,format(LocaleStrings['usernameTakenError'],_0x5d6bfa[a45_0x56a6('0x16')][a45_0x56a6('0x11')]),0x193);}else{_0x5d6bfa['body'][a45_0x56a6('0x10')]=_0x5d6bfa['body'][a45_0x56a6('0x11')];const _0x4d01e9={'first_name':_0x5d6bfa[a45_0x56a6('0x16')]['first_name'],'last_name':_0x5d6bfa[a45_0x56a6('0x16')][a45_0x56a6('0xf')],'email':_0x5d6bfa['body'][a45_0x56a6('0x10')],'username':_0x5d6bfa['body'][a45_0x56a6('0x11')],'password':crypt_utils_1[a45_0x56a6('0x17')][a45_0x56a6('0x1d')](_0x5d6bfa['body'][a45_0x56a6('0x12')])};this[a45_0x56a6('0x8')][a45_0x56a6('0x1e')](_0x4d01e9)[a45_0x56a6('0x13')](function(_0x244223,_0x34b5f6){const _0x23d5ae=authUtils[a45_0x56a6('0x19')](_0x244223);const _0x4f4c28={'token':_0x23d5ae,'id':sequelize_utils_1[a45_0x56a6('0x17')][a45_0x56a6('0x1f')](_0x244223['id'])};return responseUtils[a45_0x56a6('0x1a')](_0x5d6bfa,_0x15317b,_0x4f4c28,0xc8);})[a45_0x56a6('0x1c')](_0x175604=>{return responseUtils['errorResponse'](_0x5d6bfa,_0x15317b,_0x175604[a45_0x56a6('0x20')],0x1f4);});}})['catch'](_0x5c86a2=>{return responseUtils[a45_0x56a6('0x14')](_0x5d6bfa,_0x15317b,_0x5c86a2[a45_0x56a6('0x20')],0x1f4);});}}exports[a45_0x56a6('0x17')]=AuthenticationController;