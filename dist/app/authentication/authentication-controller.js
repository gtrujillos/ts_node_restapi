var a30_0x2fda=['last_name','email','then','errorResponse','usernameNotFoundError','default','validPassword','password','toJSON','sign','secret','passwordNotMatchError','catch','stack','findOne','usernameTakenError','hashPassword','create','dataValues','successResponse','__esModule','defineProperty','../../config/jwt.js','../../resources/locale-strings','model','login','bind','createAccount','body','username','first_name'];(function(_0x241627,_0x590021){var _0x36fc6d=function(_0x332456){while(--_0x332456){_0x241627['push'](_0x241627['shift']());}};_0x36fc6d(++_0x590021);}(a30_0x2fda,0x1a7));var a30_0x3b6a=function(_0x25ea3e,_0x4485ff){_0x25ea3e=_0x25ea3e-0x0;var _0x22b72a=a30_0x2fda[_0x25ea3e];return _0x22b72a;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x1bbbe6){return _0x1bbbe6&&_0x1bbbe6[a30_0x3b6a('0x0')]?_0x1bbbe6:{'default':_0x1bbbe6};};Object[a30_0x3b6a('0x1')](exports,a30_0x3b6a('0x0'),{'value':!![]});const crypt_utils_1=__importDefault(require('../../infrastructure/crypt-utils'));const jwt=require('jsonwebtoken');const i18n=require('i18n');const configJwt=require(a30_0x3b6a('0x2'));const authUtils=require('../../infrastructure/auth-utils');const responseUtils=require('../../infrastructure/response-utils');const LocaleStrings=require(a30_0x3b6a('0x3'));const format=require('string-format');class AuthenticationController{constructor(_0x465a7f){this[a30_0x3b6a('0x4')]=_0x465a7f;this[a30_0x3b6a('0x5')]=this['login'][a30_0x3b6a('0x6')](this);this[a30_0x3b6a('0x7')]=this[a30_0x3b6a('0x7')]['bind'](this);}[a30_0x3b6a('0x5')](_0x36d552,_0x9c60ae,_0x4841a7){this[a30_0x3b6a('0x4')]['findOne']({'where':{'username':_0x36d552[a30_0x3b6a('0x8')][a30_0x3b6a('0x9')]},'attributes':['id',a30_0x3b6a('0xa'),a30_0x3b6a('0xb'),a30_0x3b6a('0xc'),a30_0x3b6a('0x9'),'password']})[a30_0x3b6a('0xd')](_0x107bf0=>{if(!_0x107bf0){return responseUtils[a30_0x3b6a('0xe')](_0x9c60ae,format(LocaleStrings[a30_0x3b6a('0xf')],_0x36d552[a30_0x3b6a('0x8')][a30_0x3b6a('0x9')]),0x193);}if(crypt_utils_1[a30_0x3b6a('0x10')][a30_0x3b6a('0x11')](_0x36d552[a30_0x3b6a('0x8')][a30_0x3b6a('0x12')],_0x107bf0[a30_0x3b6a('0x12')])){_0x107bf0=_0x107bf0[a30_0x3b6a('0x13')]();const _0x1da474={'id':_0x107bf0['id']};const _0xc153e7=jwt[a30_0x3b6a('0x14')](_0x1da474,configJwt[a30_0x3b6a('0x15')],configJwt['options']);const _0x24f673={'token':_0xc153e7};return responseUtils['successResponse'](_0x9c60ae,_0x24f673,0xc8);}else{return responseUtils[a30_0x3b6a('0xe')](_0x9c60ae,format(LocaleStrings[a30_0x3b6a('0x16')]),0x193);}})[a30_0x3b6a('0x17')](_0x3bf096=>{return responseUtils[a30_0x3b6a('0xe')](_0x9c60ae,_0x3bf096[a30_0x3b6a('0x18')],0x1f4);});}[a30_0x3b6a('0x7')](_0x3078d3,_0x3bd215,_0x4a43fb){this[a30_0x3b6a('0x4')][a30_0x3b6a('0x19')]({'where':{'username':_0x3078d3[a30_0x3b6a('0x8')]['username']}})['then'](_0x429d29=>{if(_0x429d29){return responseUtils[a30_0x3b6a('0xe')](_0x3bd215,format(LocaleStrings[a30_0x3b6a('0x1a')],_0x3078d3[a30_0x3b6a('0x8')][a30_0x3b6a('0x9')]),0x193);}else{_0x3078d3[a30_0x3b6a('0x8')]['email']=_0x3078d3['body'][a30_0x3b6a('0x9')];const _0x4f58f8={'first_name':_0x3078d3[a30_0x3b6a('0x8')][a30_0x3b6a('0xa')],'last_name':_0x3078d3[a30_0x3b6a('0x8')]['last_name'],'email':_0x3078d3[a30_0x3b6a('0x8')][a30_0x3b6a('0xc')],'username':_0x3078d3['body']['username'],'password':crypt_utils_1[a30_0x3b6a('0x10')][a30_0x3b6a('0x1b')](_0x3078d3[a30_0x3b6a('0x8')][a30_0x3b6a('0x12')])};this[a30_0x3b6a('0x4')][a30_0x3b6a('0x1c')](_0x4f58f8)[a30_0x3b6a('0xd')](function(_0x106104,_0xbeb2ef){const _0x400e30={'id':_0x106104[a30_0x3b6a('0x1d')]['id']};const _0x45decd=jwt[a30_0x3b6a('0x14')](_0x400e30,configJwt['secret'],configJwt['options']);const _0x2ba452={'token':_0x45decd};return responseUtils[a30_0x3b6a('0x1e')](_0x3bd215,_0x2ba452,0xc8);})[a30_0x3b6a('0x17')](_0x18612f=>{return responseUtils['errorResponse'](_0x3bd215,_0x18612f[a30_0x3b6a('0x18')],0x1f4);});}})[a30_0x3b6a('0x17')](_0xb1d40c=>{return responseUtils['errorResponse'](_0x3bd215,_0xb1d40c['stack'],0x1f4);});}}exports[a30_0x3b6a('0x10')]=AuthenticationController;