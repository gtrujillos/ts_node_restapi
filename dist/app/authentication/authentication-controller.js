var a30_0x3b78=['toJSON','sign','options','successResponse','catch','stack','usernameTakenError','email','first_name','last_name','hashPassword','create','dataValues','__importDefault','__esModule','../../infrastructure/crypt-utils','../../config/jwt.js','../../infrastructure/response-utils','../../resources/locale-strings','string-format','login','bind','createAccount','model','body','username','password','then','errorResponse','usernameNotFoundError','default','validPassword'];(function(_0x326b86,_0x35fedd){var _0x4b1cd9=function(_0x5eb6d6){while(--_0x5eb6d6){_0x326b86['push'](_0x326b86['shift']());}};_0x4b1cd9(++_0x35fedd);}(a30_0x3b78,0x12d));var a30_0x2594=function(_0x1bc6d5,_0x1936e3){_0x1bc6d5=_0x1bc6d5-0x0;var _0x59ff4a=a30_0x3b78[_0x1bc6d5];return _0x59ff4a;};'use strict';var __importDefault=this&&this[a30_0x2594('0x0')]||function(_0x60094c){return _0x60094c&&_0x60094c[a30_0x2594('0x1')]?_0x60094c:{'default':_0x60094c};};Object['defineProperty'](exports,a30_0x2594('0x1'),{'value':!![]});const crypt_utils_1=__importDefault(require(a30_0x2594('0x2')));const jwt=require('jsonwebtoken');const i18n=require('i18n');const configJwt=require(a30_0x2594('0x3'));const authUtils=require('../../infrastructure/auth-utils');const responseUtils=require(a30_0x2594('0x4'));const LocaleStrings=require(a30_0x2594('0x5'));const format=require(a30_0x2594('0x6'));class AuthenticationController{constructor(_0x299912){this['model']=_0x299912;this[a30_0x2594('0x7')]=this[a30_0x2594('0x7')][a30_0x2594('0x8')](this);this[a30_0x2594('0x9')]=this[a30_0x2594('0x9')]['bind'](this);}['login'](_0x3c48b3,_0x39f399,_0x4670c6){this[a30_0x2594('0xa')]['findOne']({'where':{'username':_0x3c48b3[a30_0x2594('0xb')]['username']},'attributes':['id','first_name','last_name','email',a30_0x2594('0xc'),a30_0x2594('0xd')]})[a30_0x2594('0xe')](_0x20e5c0=>{if(!_0x20e5c0){return responseUtils[a30_0x2594('0xf')](_0x39f399,format(LocaleStrings[a30_0x2594('0x10')],_0x3c48b3[a30_0x2594('0xb')]['username']),0x193);}if(crypt_utils_1[a30_0x2594('0x11')][a30_0x2594('0x12')](_0x3c48b3[a30_0x2594('0xb')][a30_0x2594('0xd')],_0x20e5c0[a30_0x2594('0xd')])){_0x20e5c0=_0x20e5c0[a30_0x2594('0x13')]();const _0x1ee346={'id':_0x20e5c0['id']};const _0x508f3d=jwt[a30_0x2594('0x14')](_0x1ee346,configJwt['secret'],configJwt[a30_0x2594('0x15')]);const _0x10163d={'token':_0x508f3d};return responseUtils[a30_0x2594('0x16')](_0x39f399,_0x10163d,0xc8);}else{return responseUtils['errorResponse'](_0x39f399,format(LocaleStrings['passwordNotMatchError']),0x193);}})[a30_0x2594('0x17')](_0x1b1bf8=>{return responseUtils[a30_0x2594('0xf')](_0x39f399,_0x1b1bf8[a30_0x2594('0x18')],0x1f4);});}[a30_0x2594('0x9')](_0x492e2c,_0x4b3a67,_0x3a168d){this[a30_0x2594('0xa')]['findOne']({'where':{'username':_0x492e2c['body']['username']}})[a30_0x2594('0xe')](_0x3c6957=>{if(_0x3c6957){return responseUtils['errorResponse'](_0x4b3a67,format(LocaleStrings[a30_0x2594('0x19')],_0x492e2c[a30_0x2594('0xb')][a30_0x2594('0xc')]),0x193);}else{_0x492e2c[a30_0x2594('0xb')][a30_0x2594('0x1a')]=_0x492e2c[a30_0x2594('0xb')][a30_0x2594('0xc')];const _0x3dcb31={'first_name':_0x492e2c['body'][a30_0x2594('0x1b')],'last_name':_0x492e2c['body'][a30_0x2594('0x1c')],'email':_0x492e2c['body'][a30_0x2594('0x1a')],'username':_0x492e2c['body'][a30_0x2594('0xc')],'password':crypt_utils_1[a30_0x2594('0x11')][a30_0x2594('0x1d')](_0x492e2c[a30_0x2594('0xb')][a30_0x2594('0xd')])};this[a30_0x2594('0xa')][a30_0x2594('0x1e')](_0x3dcb31)[a30_0x2594('0xe')](function(_0x101977,_0x5e0a4f){const _0x3a6750={'id':_0x101977[a30_0x2594('0x1f')]['id']};const _0x17cb41=jwt[a30_0x2594('0x14')](_0x3a6750,configJwt['secret'],configJwt[a30_0x2594('0x15')]);const _0xfcb360={'token':_0x17cb41};return responseUtils['successResponse'](_0x4b3a67,_0xfcb360,0xc8);})[a30_0x2594('0x17')](_0x1fb60b=>{return responseUtils['errorResponse'](_0x4b3a67,_0x1fb60b['stack'],0x1f4);});}})[a30_0x2594('0x17')](_0x53c7a9=>{return responseUtils[a30_0x2594('0xf')](_0x4b3a67,_0x53c7a9['stack'],0x1f4);});}}exports['default']=AuthenticationController;