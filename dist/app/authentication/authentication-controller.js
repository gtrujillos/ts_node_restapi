var a39_0x4f5f=['../../infrastructure/response-utils','fs-extra','model','bind','createUserProfile','getUserProfile','login','findOne','first_name','last_name','password','errorResponse','usernameNotFoundError','username','default','validPassword','body','toJSON','generateJWT','successResponse','catch','logout','usernameExist','then','stack','usernameTakenError','email','hashPassword','create','authentication\x20failed','encryptId','assign','user','created_by_user_id','updated_by_user_id','status','deleted_at','updateUserProfile','parse','log','fields','files','params','code','__importDefault','__esModule','defineProperty','../../infrastructure/crypt-utils','jsonwebtoken','i18n'];(function(_0x21f13c,_0x309b70){var _0x560023=function(_0x7a5233){while(--_0x7a5233){_0x21f13c['push'](_0x21f13c['shift']());}};_0x560023(++_0x309b70);}(a39_0x4f5f,0x126));var a39_0xa9b7=function(_0x3aa924,_0x3f722b){_0x3aa924=_0x3aa924-0x0;var _0x514469=a39_0x4f5f[_0x3aa924];return _0x514469;};'use strict';var __importDefault=this&&this[a39_0xa9b7('0x0')]||function(_0xc5aad7){return _0xc5aad7&&_0xc5aad7[a39_0xa9b7('0x1')]?_0xc5aad7:{'default':_0xc5aad7};};Object[a39_0xa9b7('0x2')](exports,'__esModule',{'value':!![]});const sequelize_utils_1=__importDefault(require('../../infrastructure/sequelize-utils'));const crypt_utils_1=__importDefault(require(a39_0xa9b7('0x3')));const jwt=require(a39_0xa9b7('0x4'));const i18n=require(a39_0xa9b7('0x5'));const authUtils=require('../../infrastructure/auth-utils');const responseUtils=require(a39_0xa9b7('0x6'));const LocaleStrings=require('../../resources/locale-strings');const format=require('string-format');const formidable=require('formidable');const fsExtra=require(a39_0xa9b7('0x7'));class AuthenticationController{constructor(_0x487245){this[a39_0xa9b7('0x8')]=_0x487245;this['login']=this['login']['bind'](this);this['logout']=this['logout'][a39_0xa9b7('0x9')](this);this['usernameExist']=this['usernameExist']['bind'](this);this[a39_0xa9b7('0xa')]=this['createUserProfile'][a39_0xa9b7('0x9')](this);this[a39_0xa9b7('0xb')]=this['getUserProfile'][a39_0xa9b7('0x9')](this);this['updateUserProfile']=this['updateUserProfile'][a39_0xa9b7('0x9')](this);}[a39_0xa9b7('0xc')](_0x448a55,_0x6136b3,_0x3f0f7e){this['model'][a39_0xa9b7('0xd')]({'where':{'username':_0x448a55['body']['username']},'attributes':['id',a39_0xa9b7('0xe'),a39_0xa9b7('0xf'),'email','username',a39_0xa9b7('0x10')]})['then'](_0x3c6b1f=>{if(!_0x3c6b1f){return responseUtils[a39_0xa9b7('0x11')](_0x448a55,_0x6136b3,format(LocaleStrings[a39_0xa9b7('0x12')],_0x448a55['body'][a39_0xa9b7('0x13')]),0x193);}if(crypt_utils_1[a39_0xa9b7('0x14')][a39_0xa9b7('0x15')](_0x448a55[a39_0xa9b7('0x16')]['password'],_0x3c6b1f[a39_0xa9b7('0x10')]==null?'':_0x3c6b1f['password'])){_0x3c6b1f=_0x3c6b1f[a39_0xa9b7('0x17')]();const _0x2ea87f=authUtils[a39_0xa9b7('0x18')](_0x3c6b1f);const _0x58bd3a={'token':_0x2ea87f};return responseUtils[a39_0xa9b7('0x19')](_0x448a55,_0x6136b3,_0x58bd3a,0xc8);}else{return responseUtils[a39_0xa9b7('0x11')](_0x448a55,_0x6136b3,format(LocaleStrings['passwordNotMatchError']),0x193);}})[a39_0xa9b7('0x1a')](_0x4ba3f4=>{return responseUtils[a39_0xa9b7('0x11')](_0x448a55,_0x6136b3,_0x4ba3f4,0x1f4);});}[a39_0xa9b7('0x1b')](_0x122f6f,_0x547fc0,_0x77a502){}[a39_0xa9b7('0x1c')](_0x512260,_0x128422,_0x30f973){this['model']['findOne']({'where':{'username':_0x512260[a39_0xa9b7('0x16')][a39_0xa9b7('0x13')]}})[a39_0xa9b7('0x1d')](_0x425b61=>{let _0x1bd51b=![];if(_0x425b61){_0x1bd51b=!![];}return responseUtils[a39_0xa9b7('0x19')](_0x512260,_0x128422,{'exist':_0x1bd51b},0xc8);})[a39_0xa9b7('0x1a')](_0x5e2a59=>{return responseUtils[a39_0xa9b7('0x11')](_0x512260,_0x128422,_0x5e2a59[a39_0xa9b7('0x1e')],0x1f4);});}[a39_0xa9b7('0xa')](_0x33b647,_0x5a096b,_0x70b291){this[a39_0xa9b7('0x8')][a39_0xa9b7('0xd')]({'where':{'username':_0x33b647[a39_0xa9b7('0x16')]['username']}})[a39_0xa9b7('0x1d')](_0x3d993d=>{if(_0x3d993d){return responseUtils[a39_0xa9b7('0x11')](_0x33b647,_0x5a096b,format(LocaleStrings[a39_0xa9b7('0x1f')],_0x33b647[a39_0xa9b7('0x16')][a39_0xa9b7('0x13')]),0x193);}else{_0x33b647[a39_0xa9b7('0x16')]['email']=_0x33b647[a39_0xa9b7('0x16')]['username'];const _0x38ee2b={'first_name':_0x33b647['body'][a39_0xa9b7('0xe')],'last_name':_0x33b647[a39_0xa9b7('0x16')][a39_0xa9b7('0xf')],'email':_0x33b647[a39_0xa9b7('0x16')][a39_0xa9b7('0x20')],'username':_0x33b647[a39_0xa9b7('0x16')][a39_0xa9b7('0x13')],'password':crypt_utils_1[a39_0xa9b7('0x14')][a39_0xa9b7('0x21')](_0x33b647['body'][a39_0xa9b7('0x10')])};this['model'][a39_0xa9b7('0x22')](_0x38ee2b)[a39_0xa9b7('0x1d')](function(_0x29542b,_0x174138){const _0xfd9170=authUtils['generateJWT'](_0x29542b);const _0x11ec23={'token':_0xfd9170};return responseUtils[a39_0xa9b7('0x19')](_0x33b647,_0x5a096b,_0x11ec23,0xc8);})[a39_0xa9b7('0x1a')](_0x5e1cf0=>{return responseUtils[a39_0xa9b7('0x11')](_0x33b647,_0x5a096b,_0x5e1cf0['stack'],0x1f4);});}})[a39_0xa9b7('0x1a')](_0x51a5c7=>{return responseUtils[a39_0xa9b7('0x11')](_0x33b647,_0x5a096b,_0x51a5c7['stack'],0x1f4);});}[a39_0xa9b7('0xb')](_0x12510e,_0x451902,_0x3a5891){if(!_0x12510e['user']){return responseUtils['errorResponse'](_0x12510e,_0x451902,a39_0xa9b7('0x23'),0x191);}const _0x4d956c=sequelize_utils_1[a39_0xa9b7('0x14')][a39_0xa9b7('0x24')](Object[a39_0xa9b7('0x25')]({},_0x12510e[a39_0xa9b7('0x26')],{}));delete _0x4d956c[a39_0xa9b7('0x27')];delete _0x4d956c[a39_0xa9b7('0x28')];delete _0x4d956c['deleted_by_user_id'];delete _0x4d956c[a39_0xa9b7('0x10')];delete _0x4d956c[a39_0xa9b7('0x29')];delete _0x4d956c['created_at'];delete _0x4d956c['updated_at'];delete _0x4d956c[a39_0xa9b7('0x2a')];return responseUtils[a39_0xa9b7('0x19')](_0x12510e,_0x451902,_0x4d956c,0xc8);}[a39_0xa9b7('0x2b')](_0x3284e7,_0x298bb9,_0x13c201){}['updateUserProfileImage'](_0x316301,_0x31b16b,_0x36d792){const _0x39b282=formidable({'multiples':!![]});_0x39b282[a39_0xa9b7('0x2c')](_0x316301,(_0x1ae112,_0x2bfbae,_0x533bb5)=>{console[a39_0xa9b7('0x2d')](a39_0xa9b7('0x2e'),_0x2bfbae);console[a39_0xa9b7('0x2d')](a39_0xa9b7('0x2f'),_0x533bb5);if(_0x1ae112){return responseUtils[a39_0xa9b7('0x11')](_0x31b16b,_0x1ae112[a39_0xa9b7('0x1e')],0x1f4);}_0x316301[a39_0xa9b7('0x30')]={'code':_0x2bfbae[a39_0xa9b7('0x31')]};return responseUtils[a39_0xa9b7('0x19')](_0x316301,_0x31b16b,{},0xc8);});}}exports['default']=AuthenticationController;