var a11_0x3d40=['defineProperty','__esModule','../../config/jwt.js','../../infrastructure/auth-utils','../../resources/locale-strings','model','login','bind','createAccount','findOne','body','first_name','last_name','username','password','then','errorResponse','usernameNotFoundError','toJSON','uuid','sign','secret','options','token','stack','usernameTakenError','email','generateHash','create','dataValues','updated_at','created_at','successResponse','catch','default'];(function(_0x30ef24,_0x328003){var _0xca4c3f=function(_0x446816){while(--_0x446816){_0x30ef24['push'](_0x30ef24['shift']());}};_0xca4c3f(++_0x328003);}(a11_0x3d40,0x118));var a11_0x4c77=function(_0x266ef6,_0x27bfe4){_0x266ef6=_0x266ef6-0x0;var _0xa17c1d=a11_0x3d40[_0x266ef6];return _0xa17c1d;};'use strict';Object[a11_0x4c77('0x0')](exports,a11_0x4c77('0x1'),{'value':!![]});const jwt=require('jsonwebtoken');const i18n=require('i18n');const configJwt=require(a11_0x4c77('0x2'));const authUtils=require(a11_0x4c77('0x3'));const responseUtils=require('../../infrastructure/response-utils');const LocaleStrings=require(a11_0x4c77('0x4'));const format=require('string-format');class AuthenticationController{constructor(_0x4cb98b){this[a11_0x4c77('0x5')]=_0x4cb98b;this[a11_0x4c77('0x6')]=this['login'][a11_0x4c77('0x7')](this);this[a11_0x4c77('0x8')]=this['createAccount']['bind'](this);}[a11_0x4c77('0x6')](_0x4d09af,_0x40daf9,_0x16afa2){this[a11_0x4c77('0x5')][a11_0x4c77('0x9')]({'where':{'username':_0x4d09af[a11_0x4c77('0xa')]['username']},'attributes':['uuid',a11_0x4c77('0xb'),a11_0x4c77('0xc'),'email',a11_0x4c77('0xd'),a11_0x4c77('0xe')]})[a11_0x4c77('0xf')](_0x40b13f=>{if(!_0x40b13f){return responseUtils[a11_0x4c77('0x10')](_0x40daf9,format(LocaleStrings[a11_0x4c77('0x11')],_0x4d09af[a11_0x4c77('0xa')][a11_0x4c77('0xd')]),0x193);}if(authUtils['validPassword'](_0x4d09af['body']['password'],_0x40b13f[a11_0x4c77('0xe')])){_0x40b13f=_0x40b13f[a11_0x4c77('0x12')]();const _0x741de3={'uuid':_0x40b13f[a11_0x4c77('0x13')]};const _0x2c58a6=jwt[a11_0x4c77('0x14')](_0x741de3,configJwt[a11_0x4c77('0x15')],configJwt[a11_0x4c77('0x16')]);delete _0x40b13f['password'];_0x40b13f[a11_0x4c77('0x17')]=_0x2c58a6;return responseUtils['successResponse'](_0x40daf9,_0x40b13f,0xc8);}else{return responseUtils[a11_0x4c77('0x10')](_0x40daf9,format(LocaleStrings['passwordNotMatchError']),0x193);}})['catch'](_0x2000fa=>{return responseUtils[a11_0x4c77('0x10')](_0x40daf9,_0x2000fa[a11_0x4c77('0x18')],0x1f4);});}[a11_0x4c77('0x8')](_0x5910d8,_0x20fc37,_0x2ed2a1){this[a11_0x4c77('0x5')][a11_0x4c77('0x9')]({'where':{'username':_0x5910d8[a11_0x4c77('0xa')][a11_0x4c77('0xd')]}})[a11_0x4c77('0xf')](_0x1f2f27=>{if(_0x1f2f27){return responseUtils['errorResponse'](_0x20fc37,format(LocaleStrings[a11_0x4c77('0x19')],_0x5910d8[a11_0x4c77('0xa')][a11_0x4c77('0xd')]),0x193);}else{_0x5910d8[a11_0x4c77('0xa')][a11_0x4c77('0x1a')]=_0x5910d8[a11_0x4c77('0xa')][a11_0x4c77('0xd')];const _0x2ac31f={'first_name':_0x5910d8[a11_0x4c77('0xa')]['first_name'],'last_name':_0x5910d8[a11_0x4c77('0xa')][a11_0x4c77('0xc')],'email':_0x5910d8[a11_0x4c77('0xa')]['email'],'username':_0x5910d8[a11_0x4c77('0xa')][a11_0x4c77('0xd')],'password':authUtils[a11_0x4c77('0x1b')](_0x5910d8['body'][a11_0x4c77('0xe')])};this[a11_0x4c77('0x5')][a11_0x4c77('0x1c')](_0x2ac31f)[a11_0x4c77('0xf')](function(_0x384e7e,_0x3289f7){delete _0x384e7e[a11_0x4c77('0x1d')]['id'];delete _0x384e7e[a11_0x4c77('0x1d')]['status'];delete _0x384e7e['dataValues'][a11_0x4c77('0xe')];delete _0x384e7e[a11_0x4c77('0x1d')][a11_0x4c77('0x1e')];delete _0x384e7e['dataValues'][a11_0x4c77('0x1f')];const _0x58d6a4={'uuid':_0x384e7e[a11_0x4c77('0x13')]};const _0x3b22f2=jwt[a11_0x4c77('0x14')](_0x58d6a4,configJwt[a11_0x4c77('0x15')],configJwt[a11_0x4c77('0x16')]);_0x384e7e[a11_0x4c77('0x1d')]['token']=_0x3b22f2;return responseUtils[a11_0x4c77('0x20')](_0x20fc37,_0x384e7e,0xc8);})[a11_0x4c77('0x21')](_0x236a11=>{return responseUtils[a11_0x4c77('0x10')](_0x20fc37,_0x236a11[a11_0x4c77('0x18')],0x1f4);});}})[a11_0x4c77('0x21')](_0x531e57=>{return responseUtils[a11_0x4c77('0x10')](_0x20fc37,_0x531e57[a11_0x4c77('0x18')],0x1f4);});}}exports[a11_0x4c77('0x22')]=AuthenticationController;