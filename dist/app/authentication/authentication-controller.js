var a39_0x5d22=['__esModule','../../infrastructure/sequelize-utils','../../infrastructure/crypt-utils','i18n','../../infrastructure/auth-utils','../../infrastructure/response-utils','../../resources/locale-strings','string-format','model','login','logout','bind','usernameExist','createAccount','last_name','username','password','then','errorResponse','usernameNotFoundError','body','generateJWT','encryptId','passwordNotMatchError','successResponse','findOne','catch','stack','email','first_name','create','default','__importDefault'];(function(_0x1186d3,_0x1be8f4){var _0x21820a=function(_0xd266cc){while(--_0xd266cc){_0x1186d3['push'](_0x1186d3['shift']());}};_0x21820a(++_0x1be8f4);}(a39_0x5d22,0x149));var a39_0x328c=function(_0x189994,_0x17145d){_0x189994=_0x189994-0x0;var _0x2f0bfe=a39_0x5d22[_0x189994];return _0x2f0bfe;};'use strict';var __importDefault=this&&this[a39_0x328c('0x0')]||function(_0xc21f0d){return _0xc21f0d&&_0xc21f0d[a39_0x328c('0x1')]?_0xc21f0d:{'default':_0xc21f0d};};Object['defineProperty'](exports,a39_0x328c('0x1'),{'value':!![]});const sequelize_utils_1=__importDefault(require(a39_0x328c('0x2')));const crypt_utils_1=__importDefault(require(a39_0x328c('0x3')));const jwt=require('jsonwebtoken');const i18n=require(a39_0x328c('0x4'));const authUtils=require(a39_0x328c('0x5'));const responseUtils=require(a39_0x328c('0x6'));const LocaleStrings=require(a39_0x328c('0x7'));const format=require(a39_0x328c('0x8'));const formidable=require('formidable');const fsExtra=require('fs-extra');class AuthenticationController{constructor(_0x59cc44){this[a39_0x328c('0x9')]=_0x59cc44;this[a39_0x328c('0xa')]=this[a39_0x328c('0xa')]['bind'](this);this[a39_0x328c('0xb')]=this[a39_0x328c('0xb')][a39_0x328c('0xc')](this);this[a39_0x328c('0xd')]=this['usernameExist'][a39_0x328c('0xc')](this);this[a39_0x328c('0xe')]=this[a39_0x328c('0xe')][a39_0x328c('0xc')](this);}[a39_0x328c('0xa')](_0x40cd17,_0x353b78,_0x21bef9){this[a39_0x328c('0x9')]['findOne']({'where':{'username':_0x40cd17['body']['username']},'attributes':['id','first_name',a39_0x328c('0xf'),'email',a39_0x328c('0x10'),a39_0x328c('0x11')]})[a39_0x328c('0x12')](_0x2fcd35=>{if(!_0x2fcd35){return responseUtils[a39_0x328c('0x13')](_0x40cd17,_0x353b78,format(LocaleStrings[a39_0x328c('0x14')],_0x40cd17[a39_0x328c('0x15')][a39_0x328c('0x10')]),0x193);}if(crypt_utils_1['default']['validPassword'](_0x40cd17[a39_0x328c('0x15')][a39_0x328c('0x11')],_0x2fcd35['password']==null?'':_0x2fcd35[a39_0x328c('0x11')])){_0x2fcd35=_0x2fcd35['toJSON']();const _0x2fea19=authUtils[a39_0x328c('0x16')](_0x2fcd35);const _0x3cf382={'token':_0x2fea19,'id':sequelize_utils_1['default'][a39_0x328c('0x17')](_0x2fcd35['id'])};return responseUtils['successResponse'](_0x40cd17,_0x353b78,_0x3cf382,0xc8);}else{return responseUtils[a39_0x328c('0x13')](_0x40cd17,_0x353b78,format(LocaleStrings[a39_0x328c('0x18')]),0x193);}})['catch'](_0x51dd9a=>{return responseUtils[a39_0x328c('0x13')](_0x40cd17,_0x353b78,_0x51dd9a,0x1f4);});}[a39_0x328c('0xb')](_0x3975a5,_0x4738dd,_0x18bf73){return responseUtils[a39_0x328c('0x19')](_0x3975a5,_0x4738dd,!![],0xc8);}[a39_0x328c('0xd')](_0x1a438b,_0x4260f9,_0x183185){this[a39_0x328c('0x9')][a39_0x328c('0x1a')]({'where':{'username':_0x1a438b[a39_0x328c('0x15')][a39_0x328c('0x10')]}})[a39_0x328c('0x12')](_0x3b43da=>{let _0xc8d134=![];if(_0x3b43da){_0xc8d134=!![];}return responseUtils['successResponse'](_0x1a438b,_0x4260f9,{'exist':_0xc8d134},0xc8);})[a39_0x328c('0x1b')](_0x975f23=>{return responseUtils['errorResponse'](_0x1a438b,_0x4260f9,_0x975f23[a39_0x328c('0x1c')],0x1f4);});}[a39_0x328c('0xe')](_0x40bc1f,_0x6e8da0,_0x5cd138){this[a39_0x328c('0x9')][a39_0x328c('0x1a')]({'where':{'username':_0x40bc1f[a39_0x328c('0x15')]['username']}})[a39_0x328c('0x12')](_0x507db2=>{if(_0x507db2){return responseUtils[a39_0x328c('0x13')](_0x40bc1f,_0x6e8da0,format(LocaleStrings['usernameTakenError'],_0x40bc1f[a39_0x328c('0x15')][a39_0x328c('0x10')]),0x193);}else{_0x40bc1f[a39_0x328c('0x15')][a39_0x328c('0x1d')]=_0x40bc1f[a39_0x328c('0x15')]['username'];const _0x32fca5={'first_name':_0x40bc1f[a39_0x328c('0x15')][a39_0x328c('0x1e')],'last_name':_0x40bc1f[a39_0x328c('0x15')][a39_0x328c('0xf')],'email':_0x40bc1f[a39_0x328c('0x15')]['email'],'username':_0x40bc1f[a39_0x328c('0x15')][a39_0x328c('0x10')],'password':crypt_utils_1['default']['hashPassword'](_0x40bc1f[a39_0x328c('0x15')][a39_0x328c('0x11')])};this[a39_0x328c('0x9')][a39_0x328c('0x1f')](_0x32fca5)[a39_0x328c('0x12')](function(_0x18d896,_0x15d283){const _0x30098f=authUtils['generateJWT'](_0x18d896);const _0x4bfc8e={'token':_0x30098f,'id':sequelize_utils_1[a39_0x328c('0x20')][a39_0x328c('0x17')](_0x18d896['id'])};return responseUtils[a39_0x328c('0x19')](_0x40bc1f,_0x6e8da0,_0x4bfc8e,0xc8);})[a39_0x328c('0x1b')](_0x5afd29=>{return responseUtils['errorResponse'](_0x40bc1f,_0x6e8da0,_0x5afd29['stack'],0x1f4);});}})[a39_0x328c('0x1b')](_0x2e67e3=>{return responseUtils[a39_0x328c('0x13')](_0x40bc1f,_0x6e8da0,_0x2e67e3['stack'],0x1f4);});}}exports[a39_0x328c('0x20')]=AuthenticationController;