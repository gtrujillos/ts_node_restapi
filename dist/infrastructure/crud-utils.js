var a207_0x347f=['writeFile','err:','__importDefault','__esModule','defineProperty','./sequelize-utils','../infrastructure/auth-utils','../infrastructure/response-utils','i18n','count','errorResponse','then','json','catch','status','stack','find','query','offset','limit','params','findAll','deleted_by_user_id','updated_at','default','headers','lang','toJSON','encryptId','authentication\x20failed','decryptId','model','findByPk','toJSONLocalizedOnly','dataValues','env','images/','.jpg','existsSync','IMAGE_FILES_FOLDER','name','.png','base64Sync','parse','created_at','deleted_at','password','send','user','findOne','created_by_user_id','updated_by_user_id','uuid','stringify','image_data','body','findOneAndUpdate','create','hashPassword','saveImageFile','bind','length','update','updateOrCreate','findOrCreate','remove','destroy','match','jpg','log','fileName'];(function(_0x4aaf92,_0x323aea){var _0xdebf76=function(_0x3a8d1f){while(--_0x3a8d1f){_0x4aaf92['push'](_0x4aaf92['shift']());}};_0xdebf76(++_0x323aea);}(a207_0x347f,0x90));var a207_0x108a=function(_0x2b4245,_0x1c21fa){_0x2b4245=_0x2b4245-0x0;var _0x6aa494=a207_0x347f[_0x2b4245];return _0x6aa494;};'use strict';var __importDefault=this&&this[a207_0x108a('0x0')]||function(_0x1619d9){return _0x1619d9&&_0x1619d9[a207_0x108a('0x1')]?_0x1619d9:{'default':_0x1619d9};};Object[a207_0x108a('0x2')](exports,a207_0x108a('0x1'),{'value':!![]});const sequelize_utils_1=__importDefault(require(a207_0x108a('0x3')));const crypt_utils_1=__importDefault(require('./crypt-utils'));const authUtils=require(a207_0x108a('0x4'));const fsExtra=require('fs-extra');const base64Img=require('base64-img');const responseUtils=require(a207_0x108a('0x5'));class CrudUtils{constructor(_0x1e6b64,_0x161482){this['model']=_0x1e6b64;this[a207_0x108a('0x6')]=_0x161482;}[a207_0x108a('0x7')](_0x2bf77c,_0x37aaa6,_0x34d348){if(!_0x2bf77c['user']){return responseUtils[a207_0x108a('0x8')](_0x37aaa6,'authentication\x20failed',0x191);}return this['model'][a207_0x108a('0x7')]({'where':_0x2bf77c['params']})[a207_0x108a('0x9')](_0x1a4124=>{const _0x391ac3=_0x1a4124;if(_0x37aaa6){return _0x37aaa6[a207_0x108a('0xa')]({'success':!![],'data':{'total':_0x1a4124}});}else{return _0x391ac3;}})[a207_0x108a('0xb')](_0x2d7a68=>{if(_0x37aaa6){return _0x37aaa6[a207_0x108a('0xc')](0x1f4)['send']({'success':![],'data':_0x2d7a68[a207_0x108a('0xd')]});}else{return _0x2d7a68[a207_0x108a('0xd')];}});}[a207_0x108a('0xe')](_0x3b1f40,_0x4abb17,_0x2d7342,_0x2dc932=![],_0x5cbe46=[],_0x19ccc5=null,_0x228824=![]){const _0x44c082=_0x3b1f40[a207_0x108a('0xf')]['offset']?Number(_0x3b1f40['query'][a207_0x108a('0x10')]):null;const _0x276588=_0x3b1f40[a207_0x108a('0xf')][a207_0x108a('0x11')]?Number(_0x3b1f40[a207_0x108a('0xf')][a207_0x108a('0x11')]):null;if(!_0x3b1f40['user']){return responseUtils[a207_0x108a('0x8')](_0x4abb17,'authentication\x20failed',0x191);}if(!_0x228824){_0x3b1f40[a207_0x108a('0x12')]['created_by_user_id']=_0x3b1f40['user']['id'];}return this['model'][a207_0x108a('0x13')]({'attributes':{'exclude':_0x2dc932?[]:['created_by_user_id','updated_by_user_id',a207_0x108a('0x14'),'created_at',a207_0x108a('0x15'),'deleted_at']},'where':_0x3b1f40[a207_0x108a('0x12')],'offset':_0x44c082,'limit':_0x276588,'include':_0x5cbe46,'order':_0x19ccc5})[a207_0x108a('0x9')](_0x54fc9e=>{let _0x55fb7b=this['i18n']?sequelize_utils_1[a207_0x108a('0x16')]['toJSONLocalizedOnly'](_0x54fc9e,_0x3b1f40[a207_0x108a('0x17')][a207_0x108a('0x18')]):sequelize_utils_1[a207_0x108a('0x16')][a207_0x108a('0x19')](_0x54fc9e);_0x55fb7b=sequelize_utils_1[a207_0x108a('0x16')][a207_0x108a('0x1a')](_0x55fb7b);if(_0x4abb17){return responseUtils['successResponse'](_0x4abb17,_0x55fb7b,0xc8);}else{return _0x55fb7b;}})[a207_0x108a('0xb')](_0x7b9b20=>{if(_0x4abb17){return responseUtils[a207_0x108a('0x8')](_0x4abb17,_0x7b9b20[a207_0x108a('0xd')],0x1f4);}else{return _0x7b9b20[a207_0x108a('0xd')];}});}['findById'](_0x59a536,_0x4f5413,_0x14bfa7){if(!_0x59a536['user']){return responseUtils['errorResponse'](_0x4f5413,a207_0x108a('0x1b'),0x191);}_0x59a536[a207_0x108a('0x12')]['id']=sequelize_utils_1['default'][a207_0x108a('0x1c')](_0x59a536[a207_0x108a('0x12')]['id']);this[a207_0x108a('0x1d')][a207_0x108a('0x1e')](_0x59a536[a207_0x108a('0x12')]['id'])[a207_0x108a('0x9')](_0x4d62ad=>{let _0x1cbcb9=this[a207_0x108a('0x6')]?sequelize_utils_1['default'][a207_0x108a('0x1f')](_0x4d62ad,_0x59a536[a207_0x108a('0x17')][a207_0x108a('0x18')]):_0x4d62ad;if(_0x1cbcb9){_0x1cbcb9=_0x1cbcb9[a207_0x108a('0x20')];_0x1cbcb9=sequelize_utils_1[a207_0x108a('0x16')][a207_0x108a('0x1a')](_0x1cbcb9);let _0x2d7c1d=process[a207_0x108a('0x21')]['IMAGE_FILES_FOLDER']+a207_0x108a('0x22')+this[a207_0x108a('0x1d')]['name']+'_'+_0x1cbcb9['id']+a207_0x108a('0x23');if(!fsExtra[a207_0x108a('0x24')](_0x2d7c1d)){_0x2d7c1d=process[a207_0x108a('0x21')][a207_0x108a('0x25')]+a207_0x108a('0x22')+this[a207_0x108a('0x1d')][a207_0x108a('0x26')]+'_'+_0x1cbcb9['id']+a207_0x108a('0x27');}let _0x1269b1=null;if(fsExtra[a207_0x108a('0x24')](_0x2d7c1d)){_0x1269b1=base64Img[a207_0x108a('0x28')](_0x2d7c1d);_0x1cbcb9=JSON[a207_0x108a('0x29')](JSON['stringify'](_0x1cbcb9));_0x1cbcb9['image_data']=_0x1269b1;}delete _0x1cbcb9['created_by_user_id'];delete _0x1cbcb9['updated_by_user_id'];delete _0x1cbcb9['deleted_by_user_id'];delete _0x1cbcb9[a207_0x108a('0x2a')];delete _0x1cbcb9['updated_at'];delete _0x1cbcb9[a207_0x108a('0x2b')];delete _0x1cbcb9[a207_0x108a('0x2c')];}return _0x4f5413[a207_0x108a('0xa')]({'success':!![],'data':_0x1cbcb9});})[a207_0x108a('0xb')](_0x3f9a24=>{return _0x4f5413[a207_0x108a('0xc')](0x1f4)[a207_0x108a('0x2d')]({'success':![],'data':_0x3f9a24[a207_0x108a('0xd')]});});}['findByUuid'](_0x42452b,_0xdb4cf6,_0x374248){if(!_0x42452b[a207_0x108a('0x2e')]){}this[a207_0x108a('0x1d')][a207_0x108a('0x2f')]({'attributes':{'exclude':[a207_0x108a('0x30'),a207_0x108a('0x31'),a207_0x108a('0x14'),a207_0x108a('0x2a'),a207_0x108a('0x15'),a207_0x108a('0x2b')]},'where':{'uuid':_0x42452b['params'][a207_0x108a('0x32')]}})[a207_0x108a('0x9')](_0x7bb6c1=>{let _0x298320=this[a207_0x108a('0x6')]?sequelize_utils_1[a207_0x108a('0x16')]['toJSONLocalizedOnly'](_0x7bb6c1,_0x42452b[a207_0x108a('0x17')]['lang']):_0x7bb6c1;if(_0x298320){const _0x41d8a0=process[a207_0x108a('0x21')][a207_0x108a('0x25')]+'images/'+_0x298320['uuid']+a207_0x108a('0x23');let _0x105528=null;if(fsExtra[a207_0x108a('0x24')](_0x41d8a0)){_0x105528=base64Img[a207_0x108a('0x28')](_0x41d8a0);_0x298320=JSON[a207_0x108a('0x29')](JSON[a207_0x108a('0x33')](_0x298320));_0x298320[a207_0x108a('0x34')]=_0x105528;}}return _0xdb4cf6[a207_0x108a('0xa')]({'success':!![],'data':_0x298320});})['catch'](_0x3c1f00=>{return _0xdb4cf6['status'](0x1f4)[a207_0x108a('0x2d')]({'success':![],'data':_0x3c1f00['stack']});});}['save'](_0x373539,_0x45c0e6,_0x443522){if(!_0x373539[a207_0x108a('0x2e')]){return responseUtils[a207_0x108a('0x8')](_0x45c0e6,a207_0x108a('0x1b'),0x191);}if(_0x373539[a207_0x108a('0x35')]['id']&&_0x373539[a207_0x108a('0x35')]['id']!=''){return this[a207_0x108a('0x36')](_0x373539,_0x45c0e6,_0x443522);}else{return this['create'](_0x373539,_0x45c0e6);}}[a207_0x108a('0x37')](_0x1a150c,_0xf2330d){if(!_0x1a150c[a207_0x108a('0x2e')]){return responseUtils[a207_0x108a('0x8')](_0xf2330d,a207_0x108a('0x1b'),0x191);}_0x1a150c[a207_0x108a('0x35')]=sequelize_utils_1[a207_0x108a('0x16')][a207_0x108a('0x1c')](_0x1a150c[a207_0x108a('0x35')]);_0x1a150c['body'][a207_0x108a('0x30')]=_0x1a150c['user']['id'];if(_0x1a150c['body']['password']&&_0x1a150c[a207_0x108a('0x35')][a207_0x108a('0x2c')]!=''){_0x1a150c[a207_0x108a('0x35')][a207_0x108a('0x2c')]=crypt_utils_1[a207_0x108a('0x16')][a207_0x108a('0x38')](_0x1a150c[a207_0x108a('0x35')][a207_0x108a('0x2c')]);}return this[a207_0x108a('0x1d')][a207_0x108a('0x37')](_0x1a150c['body'],this[a207_0x108a('0x6')]?{'language_id':_0x1a150c['headers'][a207_0x108a('0x18')]}:{})[a207_0x108a('0x9')](_0x925fac=>{const _0x3bb773=this[a207_0x108a('0x6')]?sequelize_utils_1['default'][a207_0x108a('0x1f')](_0x925fac,_0x1a150c[a207_0x108a('0x17')][a207_0x108a('0x18')]):_0x925fac;this[a207_0x108a('0x39')](_0x1a150c,_0x3bb773);delete _0x3bb773['dataValues']['id'];delete _0x3bb773['dataValues'][a207_0x108a('0x30')];delete _0x3bb773[a207_0x108a('0x20')][a207_0x108a('0x31')];delete _0x3bb773[a207_0x108a('0x20')][a207_0x108a('0x14')];delete _0x3bb773['dataValues'][a207_0x108a('0x2a')];delete _0x3bb773[a207_0x108a('0x20')]['updated_at'];delete _0x3bb773[a207_0x108a('0x20')]['deleted_at'];delete _0x3bb773[a207_0x108a('0x20')][a207_0x108a('0x2c')];if(_0xf2330d){return _0xf2330d[a207_0x108a('0xa')]({'success':!![],'data':_0x3bb773});}else{return _0x3bb773;}})[a207_0x108a('0xb')](_0x1a53c1=>{if(_0xf2330d){return _0xf2330d[a207_0x108a('0xc')](0x1f4)[a207_0x108a('0x2d')]({'success':![],'data':_0x1a53c1[a207_0x108a('0xd')]});}else{return _0x1a53c1['stack'];}});}[a207_0x108a('0x36')](_0x157bc9,_0x406a37,_0x5cb94b){if(!_0x157bc9[a207_0x108a('0x2e')]){return responseUtils[a207_0x108a('0x8')](_0x406a37,a207_0x108a('0x1b'),0x191);}_0x157bc9[a207_0x108a('0x35')]=sequelize_utils_1[a207_0x108a('0x16')][a207_0x108a('0x1c')](_0x157bc9[a207_0x108a('0x35')]);_0x157bc9[a207_0x108a('0x35')][a207_0x108a('0x31')]=_0x157bc9[a207_0x108a('0x2e')]['id'];if(_0x157bc9[a207_0x108a('0x35')][a207_0x108a('0x2c')]&&_0x157bc9[a207_0x108a('0x35')][a207_0x108a('0x2c')]!=''){_0x157bc9[a207_0x108a('0x35')][a207_0x108a('0x2c')]=crypt_utils_1[a207_0x108a('0x16')]['hashPassword'](_0x157bc9[a207_0x108a('0x35')][a207_0x108a('0x2c')]);}this[a207_0x108a('0x1d')][a207_0x108a('0x1e')](_0x157bc9[a207_0x108a('0x35')]['id'])['then'](_0x148151=>{if(_0x148151==null)return _0x406a37['json']({'success':!![],'data':_0x148151});_0x148151['update'](_0x157bc9[a207_0x108a('0x35')],{'language_id':_0x157bc9[a207_0x108a('0x17')][a207_0x108a('0x18')]})[a207_0x108a('0x9')](function(_0x321f8e){const _0x2304fc=this[a207_0x108a('0x6')]?sequelize_utils_1[a207_0x108a('0x16')]['toJSONLocalizedOnly'](_0x148151,_0x157bc9[a207_0x108a('0x17')][a207_0x108a('0x18')]):_0x148151;this[a207_0x108a('0x39')](_0x157bc9,_0x2304fc);delete _0x2304fc[a207_0x108a('0x20')]['id'];delete _0x2304fc[a207_0x108a('0x20')]['created_by_user_id'];delete _0x2304fc[a207_0x108a('0x20')]['updated_by_user_id'];delete _0x2304fc['dataValues'][a207_0x108a('0x14')];delete _0x2304fc[a207_0x108a('0x20')][a207_0x108a('0x2a')];delete _0x2304fc[a207_0x108a('0x20')][a207_0x108a('0x15')];delete _0x2304fc['dataValues'][a207_0x108a('0x2b')];delete _0x2304fc[a207_0x108a('0x20')][a207_0x108a('0x2c')];return _0x406a37[a207_0x108a('0xa')]({'success':!![],'data':_0x2304fc});}[a207_0x108a('0x3a')](this))[a207_0x108a('0xb')](_0x33f77f=>{return _0x406a37[a207_0x108a('0xc')](0x1f4)[a207_0x108a('0x2d')]({'success':![],'data':_0x33f77f['stack']});});})[a207_0x108a('0xb')](_0xbf0e34=>{return _0x406a37[a207_0x108a('0xc')](0x1f4)[a207_0x108a('0x2d')]({'success':![],'data':_0xbf0e34['stack']});});}['findUuidAndUpdate'](_0x225605,_0x4d16ed,_0x1d4f5e){if(!_0x225605[a207_0x108a('0x2e')]){return _0x4d16ed[a207_0x108a('0xc')](0x191)[a207_0x108a('0x2d')]({'success':![],'data':a207_0x108a('0x1b')});}if(_0x225605[a207_0x108a('0x2e')]&&_0x225605[a207_0x108a('0x2e')][a207_0x108a('0x3b')]>0x0){}console['log'](_0x225605[a207_0x108a('0x12')]);const _0x1a39ac=_0x225605[a207_0x108a('0x35')][a207_0x108a('0x32')]&&_0x225605[a207_0x108a('0x35')][a207_0x108a('0x32')]!=''?_0x225605[a207_0x108a('0x35')][a207_0x108a('0x32')]:_0x225605['params'][a207_0x108a('0x32')];this['model'][a207_0x108a('0x2f')]({'where':{'uuid':_0x1a39ac}})[a207_0x108a('0x9')](_0x4baf12=>{if(_0x4baf12==null)return _0x4d16ed[a207_0x108a('0xa')]({'success':!![],'data':_0x4baf12});_0x4baf12[a207_0x108a('0x3c')](_0x225605[a207_0x108a('0x35')],{'language_id':_0x225605['headers'][a207_0x108a('0x18')]})['then'](function(_0xc76913){const _0x416a7c=this[a207_0x108a('0x6')]?sequelize_utils_1['default'][a207_0x108a('0x1f')](_0x4baf12,_0x225605['headers'][a207_0x108a('0x18')]):_0x4baf12;this[a207_0x108a('0x39')](_0x225605,_0x416a7c);return _0x4d16ed['json']({'success':!![],'data':_0x416a7c});}[a207_0x108a('0x3a')](this))[a207_0x108a('0xb')](_0x556f35=>{return _0x4d16ed[a207_0x108a('0xc')](0x1f4)['send']({'success':![],'data':_0x556f35[a207_0x108a('0xd')]});});})[a207_0x108a('0xb')](_0x4ec61f=>{return _0x4d16ed['status'](0x1f4)[a207_0x108a('0x2d')]({'success':![],'data':_0x4ec61f[a207_0x108a('0xd')]});});}[a207_0x108a('0x3d')](_0x2cd24e,_0x5811c8,_0x220ceb,_0x47301a=![]){if(!_0x2cd24e[a207_0x108a('0x2e')]){return _0x5811c8[a207_0x108a('0xc')](0x191)[a207_0x108a('0x2d')]({'success':![],'data':'authentication\x20failed'});}if(_0x2cd24e[a207_0x108a('0x2e')]&&_0x2cd24e[a207_0x108a('0x2e')]['length']>0x0){}return this['model'][a207_0x108a('0x2f')]({'where':_0x2cd24e[a207_0x108a('0x12')]})['then'](function(_0x1f80ed){if(_0x1f80ed){return _0x1f80ed[a207_0x108a('0x3c')](_0x2cd24e[a207_0x108a('0x35')])[a207_0x108a('0x9')](function(_0x3cfb69){const _0x57fbe8=_0x3cfb69[a207_0x108a('0x20')];if(_0x47301a){delete _0x57fbe8['id'];}if(_0x5811c8){return _0x5811c8['json']({'success':!![],'data':_0x57fbe8});}else{return _0x57fbe8;}}[a207_0x108a('0x3a')](this));}else{return this[a207_0x108a('0x1d')][a207_0x108a('0x37')](_0x2cd24e[a207_0x108a('0x35')])[a207_0x108a('0x9')](function(_0x16b3b0){if(_0x5811c8){return _0x5811c8[a207_0x108a('0xa')]({'success':!![],'data':_0x16b3b0[a207_0x108a('0x19')]()});}else{return _0x16b3b0;}});}}[a207_0x108a('0x3a')](this))[a207_0x108a('0xb')](_0x4a9bbb=>{if(_0x5811c8){return _0x5811c8[a207_0x108a('0xc')](0x1f4)[a207_0x108a('0x2d')]({'success':![],'data':_0x4a9bbb[a207_0x108a('0xd')]});}else{return _0x4a9bbb['stack'];}});}[a207_0x108a('0x3e')](_0x3d0b6a,_0x3b7d94,_0x3b20c1){if(!_0x3d0b6a[a207_0x108a('0x2e')]){return _0x3b7d94[a207_0x108a('0xc')](0x191)[a207_0x108a('0x2d')]({'success':![],'data':a207_0x108a('0x1b')});}_0x3d0b6a[a207_0x108a('0x35')]['created_by_user_id']=_0x3d0b6a[a207_0x108a('0x2e')]['id'];return this[a207_0x108a('0x1d')]['findOrCreate']({'where':{'uuid':_0x3d0b6a[a207_0x108a('0x35')][a207_0x108a('0x32')]},'defaults':_0x3d0b6a[a207_0x108a('0x35')]})[a207_0x108a('0x9')]((_0x2e848f,_0x10830c)=>{if(_0x10830c){}else{}return _0x3b7d94[a207_0x108a('0xa')]({'success':!![],'data':_0x2e848f});})[a207_0x108a('0xb')](_0x38109a=>{return _0x3b7d94['status'](0x1f4)[a207_0x108a('0x2d')]({'success':![],'data':_0x38109a[a207_0x108a('0xd')]});});}[a207_0x108a('0x3f')](_0x43ab78,_0x7dc9f,_0xf88510){if(!_0x43ab78['user']||_0x43ab78[a207_0x108a('0x2e')][a207_0x108a('0x3b')]==0x0){return _0x7dc9f[a207_0x108a('0xc')](0x191)[a207_0x108a('0x2d')]({'success':![],'data':'authentication\x20failed'});}_0x43ab78[a207_0x108a('0x12')]['id']=sequelize_utils_1[a207_0x108a('0x16')]['decryptId'](_0x43ab78[a207_0x108a('0x12')]['id']);this['model'][a207_0x108a('0x1e')](_0x43ab78[a207_0x108a('0x12')]['id'])[a207_0x108a('0x9')](_0x5850ea=>{if(_0x5850ea==null)return _0x7dc9f[a207_0x108a('0xa')]({'success':!![],'data':_0x5850ea});_0x5850ea[a207_0x108a('0x3c')]({'deleted_by_user_id':_0x43ab78[a207_0x108a('0x2e')]['id']},{'language_id':_0x43ab78[a207_0x108a('0x17')][a207_0x108a('0x18')]})[a207_0x108a('0x9')](function(_0x4d0a34){_0x5850ea[a207_0x108a('0x40')]()[a207_0x108a('0x9')](function(_0x5850ea){return _0x7dc9f[a207_0x108a('0xa')]({'success':!![],'data':_0x5850ea});})[a207_0x108a('0xb')](_0x3fca7c=>{return _0x7dc9f[a207_0x108a('0xc')](0x1f4)[a207_0x108a('0x2d')]({'success':![],'data':_0x3fca7c[a207_0x108a('0xd')]});});}['bind'](this))['catch'](_0x474dc6=>{return _0x7dc9f[a207_0x108a('0xc')](0x1f4)[a207_0x108a('0x2d')]({'success':![],'data':_0x474dc6[a207_0x108a('0xd')]});});})[a207_0x108a('0xb')](_0x475e62=>{return _0x7dc9f[a207_0x108a('0xc')](0x1f4)[a207_0x108a('0x2d')]({'success':![],'data':_0x475e62[a207_0x108a('0xd')]});});}[a207_0x108a('0x39')](_0x8df91e,_0x7afed4){if(_0x8df91e[a207_0x108a('0x35')][a207_0x108a('0x34')]&&_0x8df91e[a207_0x108a('0x35')]['image_data']!=''){const _0x549378=process['env'][a207_0x108a('0x25')]+a207_0x108a('0x22');const _0x715580=_0x8df91e[a207_0x108a('0x35')][a207_0x108a('0x34')];let _0x6823e1='';const _0x217976=_0x715580['replace'](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x715580[a207_0x108a('0x41')](/^data:image\/png;base64,/,'')){_0x6823e1='png';}else if(_0x715580[a207_0x108a('0x41')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x6823e1=a207_0x108a('0x42');}const _0x147373=sequelize_utils_1[a207_0x108a('0x16')]['encryptId'](_0x7afed4['dataValues']['id']);fsExtra['ensureDirSync'](_0x549378);const _0x32e40c=''+_0x549378+this[a207_0x108a('0x1d')]['name']+'_'+_0x147373+'.'+_0x6823e1;console[a207_0x108a('0x43')](a207_0x108a('0x44'),_0x32e40c);fsExtra[a207_0x108a('0x45')](_0x32e40c,_0x217976,'base64',function(_0x2dacaf){console[a207_0x108a('0x43')](a207_0x108a('0x46'),_0x2dacaf);});}}}exports[a207_0x108a('0x16')]=CrudUtils;