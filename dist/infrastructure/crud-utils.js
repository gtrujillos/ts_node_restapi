var a207_0xbee7=['env','IMAGE_FILES_FOLDER','name','.jpg','existsSync','images/','base64Sync','stringify','password','json','send','findByUuid','findOne','uuid','parse','image_data','save','body','findOneAndUpdate','create','hashPassword','saveImageFile','findUuidAndUpdate','length','update','bind','updateOrCreate','remove','destroy','match','jpg','ensureDirSync','log','fileName','writeFile','base64','err:','__esModule','defineProperty','./sequelize-utils','../infrastructure/auth-utils','fs-extra','base64-img','../infrastructure/response-utils','model','i18n','user','errorResponse','count','params','catch','status','stack','find','query','offset','limit','created_by_user_id','findAll','updated_by_user_id','deleted_by_user_id','created_at','updated_at','deleted_at','then','default','toJSONLocalizedOnly','headers','lang','toJSON','encryptId','successResponse','findById','authentication\x20failed','decryptId','findByPk','dataValues'];(function(_0x1f06ff,_0x595098){var _0x5d36f5=function(_0x1504be){while(--_0x1504be){_0x1f06ff['push'](_0x1f06ff['shift']());}};_0x5d36f5(++_0x595098);}(a207_0xbee7,0x1a6));var a207_0x6941=function(_0x3a349f,_0x2ff410){_0x3a349f=_0x3a349f-0x0;var _0x41386a=a207_0xbee7[_0x3a349f];return _0x41386a;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x223496){return _0x223496&&_0x223496[a207_0x6941('0x0')]?_0x223496:{'default':_0x223496};};Object[a207_0x6941('0x1')](exports,a207_0x6941('0x0'),{'value':!![]});const sequelize_utils_1=__importDefault(require(a207_0x6941('0x2')));const crypt_utils_1=__importDefault(require('./crypt-utils'));const authUtils=require(a207_0x6941('0x3'));const fsExtra=require(a207_0x6941('0x4'));const base64Img=require(a207_0x6941('0x5'));const responseUtils=require(a207_0x6941('0x6'));class CrudUtils{constructor(_0x317d04,_0x5c17b3){this[a207_0x6941('0x7')]=_0x317d04;this[a207_0x6941('0x8')]=_0x5c17b3;}['count'](_0x559b1e,_0x570688,_0x2002ea){if(!_0x559b1e[a207_0x6941('0x9')]){return responseUtils[a207_0x6941('0xa')](_0x570688,'authentication\x20failed',0x191);}return this[a207_0x6941('0x7')][a207_0x6941('0xb')]({'where':_0x559b1e[a207_0x6941('0xc')]})['then'](_0x22aef7=>{const _0x21d55e=_0x22aef7;if(_0x570688){return _0x570688['json']({'success':!![],'data':{'total':_0x22aef7}});}else{return _0x21d55e;}})[a207_0x6941('0xd')](_0x4ff812=>{if(_0x570688){return _0x570688[a207_0x6941('0xe')](0x1f4)['send']({'success':![],'data':_0x4ff812[a207_0x6941('0xf')]});}else{return _0x4ff812['stack'];}});}[a207_0x6941('0x10')](_0x5f2cd8,_0x3a005d,_0x22c810,_0x252d80=![],_0x1840de=[],_0x34e912=null,_0x147d7c=![]){const _0x210383=_0x5f2cd8[a207_0x6941('0x11')][a207_0x6941('0x12')]?Number(_0x5f2cd8[a207_0x6941('0x11')][a207_0x6941('0x12')]):null;const _0x56cdc5=_0x5f2cd8[a207_0x6941('0x11')][a207_0x6941('0x13')]?Number(_0x5f2cd8[a207_0x6941('0x11')][a207_0x6941('0x13')]):null;if(!_0x5f2cd8['user']){return responseUtils[a207_0x6941('0xa')](_0x3a005d,'authentication\x20failed',0x191);}if(!_0x147d7c){_0x5f2cd8[a207_0x6941('0xc')][a207_0x6941('0x14')]=_0x5f2cd8['user']['id'];}return this[a207_0x6941('0x7')][a207_0x6941('0x15')]({'attributes':{'exclude':_0x252d80?[]:[a207_0x6941('0x14'),a207_0x6941('0x16'),a207_0x6941('0x17'),a207_0x6941('0x18'),a207_0x6941('0x19'),a207_0x6941('0x1a')]},'where':_0x5f2cd8[a207_0x6941('0xc')],'offset':_0x210383,'limit':_0x56cdc5,'include':_0x1840de,'order':_0x34e912})[a207_0x6941('0x1b')](_0x2aed41=>{let _0x1e38a8=this[a207_0x6941('0x8')]?sequelize_utils_1[a207_0x6941('0x1c')][a207_0x6941('0x1d')](_0x2aed41,_0x5f2cd8[a207_0x6941('0x1e')][a207_0x6941('0x1f')]):sequelize_utils_1[a207_0x6941('0x1c')][a207_0x6941('0x20')](_0x2aed41);_0x1e38a8=sequelize_utils_1[a207_0x6941('0x1c')][a207_0x6941('0x21')](_0x1e38a8);if(_0x3a005d){return responseUtils[a207_0x6941('0x22')](_0x3a005d,_0x1e38a8,0xc8);}else{return _0x1e38a8;}})[a207_0x6941('0xd')](_0x441da1=>{if(_0x3a005d){return responseUtils['errorResponse'](_0x3a005d,_0x441da1[a207_0x6941('0xf')],0x1f4);}else{return _0x441da1[a207_0x6941('0xf')];}});}[a207_0x6941('0x23')](_0x27a173,_0x261b33,_0x118b1b){if(!_0x27a173['user']){return responseUtils[a207_0x6941('0xa')](_0x261b33,a207_0x6941('0x24'),0x191);}_0x27a173[a207_0x6941('0xc')]['id']=sequelize_utils_1[a207_0x6941('0x1c')][a207_0x6941('0x25')](_0x27a173[a207_0x6941('0xc')]['id']);this['model'][a207_0x6941('0x26')](_0x27a173[a207_0x6941('0xc')]['id'])[a207_0x6941('0x1b')](_0x287b7d=>{let _0x338a3e=this[a207_0x6941('0x8')]?sequelize_utils_1[a207_0x6941('0x1c')][a207_0x6941('0x1d')](_0x287b7d,_0x27a173['headers'][a207_0x6941('0x1f')]):_0x287b7d;if(_0x338a3e){_0x338a3e=_0x338a3e[a207_0x6941('0x27')];_0x338a3e=sequelize_utils_1['default'][a207_0x6941('0x21')](_0x338a3e);let _0x2cc639=process[a207_0x6941('0x28')][a207_0x6941('0x29')]+'images/'+this['model'][a207_0x6941('0x2a')]+'_'+_0x338a3e['id']+a207_0x6941('0x2b');if(!fsExtra[a207_0x6941('0x2c')](_0x2cc639)){_0x2cc639=process['env']['IMAGE_FILES_FOLDER']+a207_0x6941('0x2d')+this['model']['name']+'_'+_0x338a3e['id']+'.png';}let _0x35fa2f=null;if(fsExtra[a207_0x6941('0x2c')](_0x2cc639)){_0x35fa2f=base64Img[a207_0x6941('0x2e')](_0x2cc639);_0x338a3e=JSON['parse'](JSON[a207_0x6941('0x2f')](_0x338a3e));_0x338a3e['image_data']=_0x35fa2f;}delete _0x338a3e[a207_0x6941('0x14')];delete _0x338a3e['updated_by_user_id'];delete _0x338a3e[a207_0x6941('0x17')];delete _0x338a3e[a207_0x6941('0x18')];delete _0x338a3e['updated_at'];delete _0x338a3e['deleted_at'];delete _0x338a3e[a207_0x6941('0x30')];}return _0x261b33[a207_0x6941('0x31')]({'success':!![],'data':_0x338a3e});})[a207_0x6941('0xd')](_0x2a20ee=>{return _0x261b33[a207_0x6941('0xe')](0x1f4)[a207_0x6941('0x32')]({'success':![],'data':_0x2a20ee[a207_0x6941('0xf')]});});}[a207_0x6941('0x33')](_0x2792fb,_0x486680,_0x5c73a0){if(!_0x2792fb[a207_0x6941('0x9')]){}this[a207_0x6941('0x7')][a207_0x6941('0x34')]({'attributes':{'exclude':[a207_0x6941('0x14'),a207_0x6941('0x16'),'deleted_by_user_id',a207_0x6941('0x18'),'updated_at','deleted_at']},'where':{'uuid':_0x2792fb[a207_0x6941('0xc')]['uuid']}})[a207_0x6941('0x1b')](_0x192574=>{let _0x4e7d29=this[a207_0x6941('0x8')]?sequelize_utils_1[a207_0x6941('0x1c')][a207_0x6941('0x1d')](_0x192574,_0x2792fb[a207_0x6941('0x1e')]['lang']):_0x192574;if(_0x4e7d29){const _0x49680f=process['env']['IMAGE_FILES_FOLDER']+a207_0x6941('0x2d')+_0x4e7d29[a207_0x6941('0x35')]+a207_0x6941('0x2b');let _0x3aaf8c=null;if(fsExtra['existsSync'](_0x49680f)){_0x3aaf8c=base64Img['base64Sync'](_0x49680f);_0x4e7d29=JSON[a207_0x6941('0x36')](JSON['stringify'](_0x4e7d29));_0x4e7d29[a207_0x6941('0x37')]=_0x3aaf8c;}}return _0x486680[a207_0x6941('0x31')]({'success':!![],'data':_0x4e7d29});})[a207_0x6941('0xd')](_0x401623=>{return _0x486680[a207_0x6941('0xe')](0x1f4)[a207_0x6941('0x32')]({'success':![],'data':_0x401623[a207_0x6941('0xf')]});});}[a207_0x6941('0x38')](_0x37dad4,_0x3b0319,_0x106530){if(!_0x37dad4[a207_0x6941('0x9')]){return responseUtils[a207_0x6941('0xa')](_0x3b0319,'authentication\x20failed',0x191);}if(_0x37dad4['body']['id']&&_0x37dad4[a207_0x6941('0x39')]['id']!=''){return this[a207_0x6941('0x3a')](_0x37dad4,_0x3b0319,_0x106530);}else{return this[a207_0x6941('0x3b')](_0x37dad4,_0x3b0319);}}[a207_0x6941('0x3b')](_0x5e3e1f,_0x1fed4a){if(!_0x5e3e1f[a207_0x6941('0x9')]){return responseUtils[a207_0x6941('0xa')](_0x1fed4a,'authentication\x20failed',0x191);}_0x5e3e1f['body']=sequelize_utils_1[a207_0x6941('0x1c')][a207_0x6941('0x25')](_0x5e3e1f['body']);_0x5e3e1f[a207_0x6941('0x39')][a207_0x6941('0x14')]=_0x5e3e1f['user']['id'];if(_0x5e3e1f[a207_0x6941('0x39')][a207_0x6941('0x30')]&&_0x5e3e1f[a207_0x6941('0x39')][a207_0x6941('0x30')]!=''){_0x5e3e1f[a207_0x6941('0x39')][a207_0x6941('0x30')]=crypt_utils_1['default'][a207_0x6941('0x3c')](_0x5e3e1f[a207_0x6941('0x39')][a207_0x6941('0x30')]);}return this[a207_0x6941('0x7')][a207_0x6941('0x3b')](_0x5e3e1f[a207_0x6941('0x39')],this['i18n']?{'language_id':_0x5e3e1f[a207_0x6941('0x1e')][a207_0x6941('0x1f')]}:{})[a207_0x6941('0x1b')](_0x172931=>{const _0x1338d9=this[a207_0x6941('0x8')]?sequelize_utils_1['default']['toJSONLocalizedOnly'](_0x172931,_0x5e3e1f[a207_0x6941('0x1e')][a207_0x6941('0x1f')]):_0x172931;this[a207_0x6941('0x3d')](_0x5e3e1f,_0x1338d9);delete _0x1338d9[a207_0x6941('0x27')]['id'];delete _0x1338d9['dataValues'][a207_0x6941('0x14')];delete _0x1338d9[a207_0x6941('0x27')][a207_0x6941('0x16')];delete _0x1338d9[a207_0x6941('0x27')][a207_0x6941('0x17')];delete _0x1338d9[a207_0x6941('0x27')][a207_0x6941('0x18')];delete _0x1338d9[a207_0x6941('0x27')][a207_0x6941('0x19')];delete _0x1338d9['dataValues'][a207_0x6941('0x1a')];delete _0x1338d9[a207_0x6941('0x27')][a207_0x6941('0x30')];if(_0x1fed4a){return _0x1fed4a['json']({'success':!![],'data':_0x1338d9});}else{return _0x1338d9;}})[a207_0x6941('0xd')](_0x1af836=>{if(_0x1fed4a){return _0x1fed4a[a207_0x6941('0xe')](0x1f4)[a207_0x6941('0x32')]({'success':![],'data':_0x1af836[a207_0x6941('0xf')]});}else{return _0x1af836[a207_0x6941('0xf')];}});}['findOneAndUpdate'](_0x24cd3b,_0x5b15b7,_0x4a4334){if(!_0x24cd3b[a207_0x6941('0x9')]){return responseUtils[a207_0x6941('0xa')](_0x5b15b7,a207_0x6941('0x24'),0x191);}_0x24cd3b[a207_0x6941('0x39')]=sequelize_utils_1[a207_0x6941('0x1c')]['decryptId'](_0x24cd3b[a207_0x6941('0x39')]);_0x24cd3b[a207_0x6941('0x39')][a207_0x6941('0x16')]=_0x24cd3b[a207_0x6941('0x9')]['id'];if(_0x24cd3b[a207_0x6941('0x39')][a207_0x6941('0x30')]&&_0x24cd3b['body'][a207_0x6941('0x30')]!=''){_0x24cd3b[a207_0x6941('0x39')]['password']=crypt_utils_1[a207_0x6941('0x1c')][a207_0x6941('0x3c')](_0x24cd3b[a207_0x6941('0x39')]['password']);}this[a207_0x6941('0x7')]['findByPk'](_0x24cd3b['body']['id'])['then'](_0xa1183e=>{if(_0xa1183e==null)return _0x5b15b7['json']({'success':!![],'data':_0xa1183e});_0xa1183e['update'](_0x24cd3b[a207_0x6941('0x39')],{'language_id':_0x24cd3b[a207_0x6941('0x1e')][a207_0x6941('0x1f')]})['then'](function(_0x81f315){const _0x314ebe=this[a207_0x6941('0x8')]?sequelize_utils_1[a207_0x6941('0x1c')][a207_0x6941('0x1d')](_0xa1183e,_0x24cd3b[a207_0x6941('0x1e')][a207_0x6941('0x1f')]):_0xa1183e;this[a207_0x6941('0x3d')](_0x24cd3b,_0x314ebe);delete _0x314ebe[a207_0x6941('0x27')]['id'];delete _0x314ebe[a207_0x6941('0x27')][a207_0x6941('0x14')];delete _0x314ebe[a207_0x6941('0x27')][a207_0x6941('0x16')];delete _0x314ebe[a207_0x6941('0x27')][a207_0x6941('0x17')];delete _0x314ebe[a207_0x6941('0x27')]['created_at'];delete _0x314ebe[a207_0x6941('0x27')][a207_0x6941('0x19')];delete _0x314ebe[a207_0x6941('0x27')][a207_0x6941('0x1a')];delete _0x314ebe[a207_0x6941('0x27')][a207_0x6941('0x30')];return _0x5b15b7['json']({'success':!![],'data':_0x314ebe});}['bind'](this))[a207_0x6941('0xd')](_0x202fda=>{return _0x5b15b7['status'](0x1f4)[a207_0x6941('0x32')]({'success':![],'data':_0x202fda[a207_0x6941('0xf')]});});})['catch'](_0x576eb9=>{return _0x5b15b7[a207_0x6941('0xe')](0x1f4)['send']({'success':![],'data':_0x576eb9[a207_0x6941('0xf')]});});}[a207_0x6941('0x3e')](_0x4c9b29,_0x1724c9,_0x37e25c){if(!_0x4c9b29[a207_0x6941('0x9')]){return _0x1724c9[a207_0x6941('0xe')](0x191)['send']({'success':![],'data':a207_0x6941('0x24')});}if(_0x4c9b29[a207_0x6941('0x9')]&&_0x4c9b29[a207_0x6941('0x9')][a207_0x6941('0x3f')]>0x0){}console['log'](_0x4c9b29['params']);const _0x164654=_0x4c9b29[a207_0x6941('0x39')]['uuid']&&_0x4c9b29[a207_0x6941('0x39')][a207_0x6941('0x35')]!=''?_0x4c9b29[a207_0x6941('0x39')]['uuid']:_0x4c9b29[a207_0x6941('0xc')]['uuid'];this[a207_0x6941('0x7')][a207_0x6941('0x34')]({'where':{'uuid':_0x164654}})[a207_0x6941('0x1b')](_0x54403c=>{if(_0x54403c==null)return _0x1724c9[a207_0x6941('0x31')]({'success':!![],'data':_0x54403c});_0x54403c[a207_0x6941('0x40')](_0x4c9b29[a207_0x6941('0x39')],{'language_id':_0x4c9b29['headers'][a207_0x6941('0x1f')]})[a207_0x6941('0x1b')](function(_0x15860c){const _0x269379=this[a207_0x6941('0x8')]?sequelize_utils_1['default'][a207_0x6941('0x1d')](_0x54403c,_0x4c9b29['headers'][a207_0x6941('0x1f')]):_0x54403c;this[a207_0x6941('0x3d')](_0x4c9b29,_0x269379);return _0x1724c9[a207_0x6941('0x31')]({'success':!![],'data':_0x269379});}[a207_0x6941('0x41')](this))[a207_0x6941('0xd')](_0x13fc3f=>{return _0x1724c9['status'](0x1f4)[a207_0x6941('0x32')]({'success':![],'data':_0x13fc3f['stack']});});})[a207_0x6941('0xd')](_0x30de82=>{return _0x1724c9[a207_0x6941('0xe')](0x1f4)[a207_0x6941('0x32')]({'success':![],'data':_0x30de82[a207_0x6941('0xf')]});});}[a207_0x6941('0x42')](_0x82d150,_0x2086ac,_0x294560,_0x58b1fc=![]){if(!_0x82d150['user']){return _0x2086ac[a207_0x6941('0xe')](0x191)[a207_0x6941('0x32')]({'success':![],'data':a207_0x6941('0x24')});}if(_0x82d150[a207_0x6941('0x9')]&&_0x82d150[a207_0x6941('0x9')][a207_0x6941('0x3f')]>0x0){}return this[a207_0x6941('0x7')][a207_0x6941('0x34')]({'where':_0x82d150[a207_0x6941('0xc')]})[a207_0x6941('0x1b')](function(_0x53ec14){if(_0x53ec14){return _0x53ec14['update'](_0x82d150[a207_0x6941('0x39')])[a207_0x6941('0x1b')](function(_0x4f8f0f){const _0x1c1505=_0x4f8f0f[a207_0x6941('0x27')];if(_0x58b1fc){delete _0x1c1505['id'];}if(_0x2086ac){return _0x2086ac['json']({'success':!![],'data':_0x1c1505});}else{return _0x1c1505;}}[a207_0x6941('0x41')](this));}else{return this[a207_0x6941('0x7')][a207_0x6941('0x3b')](_0x82d150[a207_0x6941('0x39')])[a207_0x6941('0x1b')](function(_0xffb490){if(_0x2086ac){return _0x2086ac[a207_0x6941('0x31')]({'success':!![],'data':_0xffb490[a207_0x6941('0x20')]()});}else{return _0xffb490;}});}}[a207_0x6941('0x41')](this))[a207_0x6941('0xd')](_0x1ec763=>{if(_0x2086ac){return _0x2086ac[a207_0x6941('0xe')](0x1f4)['send']({'success':![],'data':_0x1ec763['stack']});}else{return _0x1ec763[a207_0x6941('0xf')];}});}['findOrCreate'](_0x17a8ee,_0x1165e8,_0x527f18){if(!_0x17a8ee[a207_0x6941('0x9')]){return _0x1165e8[a207_0x6941('0xe')](0x191)[a207_0x6941('0x32')]({'success':![],'data':a207_0x6941('0x24')});}_0x17a8ee[a207_0x6941('0x39')][a207_0x6941('0x14')]=_0x17a8ee[a207_0x6941('0x9')]['id'];return this[a207_0x6941('0x7')]['findOrCreate']({'where':{'uuid':_0x17a8ee['body'][a207_0x6941('0x35')]},'defaults':_0x17a8ee[a207_0x6941('0x39')]})[a207_0x6941('0x1b')]((_0x427883,_0x1dba53)=>{if(_0x1dba53){}else{}return _0x1165e8[a207_0x6941('0x31')]({'success':!![],'data':_0x427883});})['catch'](_0x2f0f5a=>{return _0x1165e8[a207_0x6941('0xe')](0x1f4)[a207_0x6941('0x32')]({'success':![],'data':_0x2f0f5a[a207_0x6941('0xf')]});});}[a207_0x6941('0x43')](_0x3b53c3,_0x5635d2,_0x53a078){if(!_0x3b53c3[a207_0x6941('0x9')]||_0x3b53c3[a207_0x6941('0x9')][a207_0x6941('0x3f')]==0x0){return _0x5635d2[a207_0x6941('0xe')](0x191)[a207_0x6941('0x32')]({'success':![],'data':a207_0x6941('0x24')});}_0x3b53c3['params']['id']=sequelize_utils_1[a207_0x6941('0x1c')]['decryptId'](_0x3b53c3[a207_0x6941('0xc')]['id']);this[a207_0x6941('0x7')]['findByPk'](_0x3b53c3[a207_0x6941('0xc')]['id'])['then'](_0x57e38e=>{if(_0x57e38e==null)return _0x5635d2[a207_0x6941('0x31')]({'success':!![],'data':_0x57e38e});_0x57e38e[a207_0x6941('0x40')]({'deleted_by_user_id':_0x3b53c3[a207_0x6941('0x9')]['id']},{'language_id':_0x3b53c3[a207_0x6941('0x1e')]['lang']})['then'](function(_0x1c8631){_0x57e38e[a207_0x6941('0x44')]()[a207_0x6941('0x1b')](function(_0x57e38e){return _0x5635d2['json']({'success':!![],'data':_0x57e38e});})[a207_0x6941('0xd')](_0x585c84=>{return _0x5635d2[a207_0x6941('0xe')](0x1f4)['send']({'success':![],'data':_0x585c84[a207_0x6941('0xf')]});});}['bind'](this))[a207_0x6941('0xd')](_0xbcf2fd=>{return _0x5635d2[a207_0x6941('0xe')](0x1f4)[a207_0x6941('0x32')]({'success':![],'data':_0xbcf2fd[a207_0x6941('0xf')]});});})[a207_0x6941('0xd')](_0x2f50fb=>{return _0x5635d2[a207_0x6941('0xe')](0x1f4)[a207_0x6941('0x32')]({'success':![],'data':_0x2f50fb[a207_0x6941('0xf')]});});}[a207_0x6941('0x3d')](_0x11d856,_0x49375f){if(_0x11d856[a207_0x6941('0x39')][a207_0x6941('0x37')]&&_0x11d856[a207_0x6941('0x39')][a207_0x6941('0x37')]!=''){const _0x4cc662=process[a207_0x6941('0x28')][a207_0x6941('0x29')]+a207_0x6941('0x2d');const _0x518943=_0x11d856[a207_0x6941('0x39')][a207_0x6941('0x37')];let _0x26afba='';const _0x78b8e0=_0x518943['replace'](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x518943[a207_0x6941('0x45')](/^data:image\/png;base64,/,'')){_0x26afba='png';}else if(_0x518943[a207_0x6941('0x45')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x26afba=a207_0x6941('0x46');}const _0x48776a=sequelize_utils_1[a207_0x6941('0x1c')][a207_0x6941('0x21')](_0x49375f[a207_0x6941('0x27')]['id']);fsExtra[a207_0x6941('0x47')](_0x4cc662);const _0x7749d0=''+_0x4cc662+this['model'][a207_0x6941('0x2a')]+'_'+_0x48776a+'.'+_0x26afba;console[a207_0x6941('0x48')](a207_0x6941('0x49'),_0x7749d0);fsExtra[a207_0x6941('0x4a')](_0x7749d0,_0x78b8e0,a207_0x6941('0x4b'),function(_0x373d0e){console[a207_0x6941('0x48')](a207_0x6941('0x4c'),_0x373d0e);});}}}exports[a207_0x6941('0x1c')]=CrudUtils;