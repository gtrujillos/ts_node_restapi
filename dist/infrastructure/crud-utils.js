var a207_0x40a3=['then','json','catch','status','send','stack','find','query','offset','limit','errorResponse','created_by_user_id','log','shared','req.params','findAll','updated_by_user_id','deleted_at','i18n','toJSONLocalizedOnly','lang','default','encryptId','successResponse','findById','decryptId','findByPk','env','IMAGE_FILES_FOLDER','images/','name','existsSync','.png','base64Sync','parse','stringify','image_data','deleted_by_user_id','created_at','updated_at','password','findByUuid','uuid','headers','.jpg','body','findOneAndUpdate','create','hashPassword','saveImageFile','dataValues','bind','findUuidAndUpdate','length','findOne','update','updateOrCreate','findOrCreate','match','png','jpg','ensureDirSync','fileName','base64','err:','__importDefault','defineProperty','__esModule','./crypt-utils','../infrastructure/auth-utils','fs-extra','../infrastructure/response-utils','model','user','authentication\x20failed','count','params'];(function(_0x3562b5,_0x22dabc){var _0x54d52d=function(_0x27bd3d){while(--_0x27bd3d){_0x3562b5['push'](_0x3562b5['shift']());}};_0x54d52d(++_0x22dabc);}(a207_0x40a3,0xdb));var a207_0x364e=function(_0x304f8c,_0x41345f){_0x304f8c=_0x304f8c-0x0;var _0x2448ee=a207_0x40a3[_0x304f8c];return _0x2448ee;};'use strict';var __importDefault=this&&this[a207_0x364e('0x0')]||function(_0x3757ba){return _0x3757ba&&_0x3757ba['__esModule']?_0x3757ba:{'default':_0x3757ba};};Object[a207_0x364e('0x1')](exports,a207_0x364e('0x2'),{'value':!![]});const sequelize_utils_1=__importDefault(require('./sequelize-utils'));const crypt_utils_1=__importDefault(require(a207_0x364e('0x3')));const authUtils=require(a207_0x364e('0x4'));const fsExtra=require(a207_0x364e('0x5'));const base64Img=require('base64-img');const responseUtils=require(a207_0x364e('0x6'));class CrudUtils{constructor(_0x27835b,_0x25b4ca){this[a207_0x364e('0x7')]=_0x27835b;this['i18n']=_0x25b4ca;}['count'](_0x217441,_0x1d5280,_0x22d5f8){if(!_0x217441[a207_0x364e('0x8')]){return responseUtils['errorResponse'](_0x1d5280,a207_0x364e('0x9'),0x191);}return this[a207_0x364e('0x7')][a207_0x364e('0xa')]({'where':_0x217441[a207_0x364e('0xb')]})[a207_0x364e('0xc')](_0x475b23=>{const _0x479c7c=_0x475b23;if(_0x1d5280){return _0x1d5280[a207_0x364e('0xd')]({'success':!![],'data':{'total':_0x475b23}});}else{return _0x479c7c;}})[a207_0x364e('0xe')](_0x2e96ec=>{if(_0x1d5280){return _0x1d5280[a207_0x364e('0xf')](0x1f4)[a207_0x364e('0x10')]({'success':![],'data':_0x2e96ec[a207_0x364e('0x11')]});}else{return _0x2e96ec[a207_0x364e('0x11')];}});}[a207_0x364e('0x12')](_0x5e58d8,_0x4cd5b7,_0x955c4,_0x1845cb=![],_0x900bfb=[],_0x1490e0=null,_0x1372e3=![]){const _0x2a8132=_0x5e58d8[a207_0x364e('0x13')][a207_0x364e('0x14')]?Number(_0x5e58d8[a207_0x364e('0x13')]['offset']):null;const _0x224028=_0x5e58d8[a207_0x364e('0x13')][a207_0x364e('0x15')]?Number(_0x5e58d8[a207_0x364e('0x13')][a207_0x364e('0x15')]):null;if(!_0x5e58d8['user']){return responseUtils[a207_0x364e('0x16')](_0x4cd5b7,a207_0x364e('0x9'),0x191);}if(!_0x1372e3){_0x5e58d8[a207_0x364e('0xb')][a207_0x364e('0x17')]=_0x5e58d8['user']['id'];}console[a207_0x364e('0x18')](a207_0x364e('0x19'),_0x1372e3);console[a207_0x364e('0x18')](a207_0x364e('0x1a'),_0x5e58d8[a207_0x364e('0xb')]);return this[a207_0x364e('0x7')][a207_0x364e('0x1b')]({'attributes':{'exclude':_0x1845cb?[]:[a207_0x364e('0x17'),a207_0x364e('0x1c'),'deleted_by_user_id','created_at','updated_at',a207_0x364e('0x1d')]},'where':_0x5e58d8[a207_0x364e('0xb')],'offset':_0x2a8132,'limit':_0x224028,'include':_0x900bfb,'order':_0x1490e0})[a207_0x364e('0xc')](_0xd7ad51=>{let _0x81b7a3=this[a207_0x364e('0x1e')]?sequelize_utils_1['default'][a207_0x364e('0x1f')](_0xd7ad51,_0x5e58d8['headers'][a207_0x364e('0x20')]):sequelize_utils_1[a207_0x364e('0x21')]['toJSON'](_0xd7ad51);_0x81b7a3=sequelize_utils_1['default'][a207_0x364e('0x22')](_0x81b7a3);if(_0x4cd5b7){return responseUtils[a207_0x364e('0x23')](_0x4cd5b7,_0x81b7a3,0xc8);}else{return _0x81b7a3;}})[a207_0x364e('0xe')](_0x36b744=>{if(_0x4cd5b7){return responseUtils[a207_0x364e('0x16')](_0x4cd5b7,_0x36b744[a207_0x364e('0x11')],0x1f4);}else{return _0x36b744['stack'];}});}[a207_0x364e('0x24')](_0x1414f6,_0x25b6bd,_0x50b24c){if(!_0x1414f6[a207_0x364e('0x8')]){return responseUtils[a207_0x364e('0x16')](_0x25b6bd,a207_0x364e('0x9'),0x191);}_0x1414f6[a207_0x364e('0xb')]['id']=sequelize_utils_1[a207_0x364e('0x21')][a207_0x364e('0x25')](_0x1414f6[a207_0x364e('0xb')]['id']);this[a207_0x364e('0x7')][a207_0x364e('0x26')](_0x1414f6[a207_0x364e('0xb')]['id'])[a207_0x364e('0xc')](_0x191615=>{let _0x5abc9a=this['i18n']?sequelize_utils_1['default'][a207_0x364e('0x1f')](_0x191615,_0x1414f6['headers'][a207_0x364e('0x20')]):_0x191615;if(_0x5abc9a){_0x5abc9a=_0x5abc9a['dataValues'];_0x5abc9a=sequelize_utils_1[a207_0x364e('0x21')][a207_0x364e('0x22')](_0x5abc9a);let _0x29d956=process[a207_0x364e('0x27')][a207_0x364e('0x28')]+a207_0x364e('0x29')+this[a207_0x364e('0x7')][a207_0x364e('0x2a')]+'_'+_0x5abc9a['id']+'.jpg';if(!fsExtra[a207_0x364e('0x2b')](_0x29d956)){_0x29d956=process['env'][a207_0x364e('0x28')]+'images/'+this[a207_0x364e('0x7')][a207_0x364e('0x2a')]+'_'+_0x5abc9a['id']+a207_0x364e('0x2c');}let _0x1cf69d=null;if(fsExtra[a207_0x364e('0x2b')](_0x29d956)){_0x1cf69d=base64Img[a207_0x364e('0x2d')](_0x29d956);_0x5abc9a=JSON[a207_0x364e('0x2e')](JSON[a207_0x364e('0x2f')](_0x5abc9a));_0x5abc9a[a207_0x364e('0x30')]=_0x1cf69d;}delete _0x5abc9a['created_by_user_id'];delete _0x5abc9a[a207_0x364e('0x1c')];delete _0x5abc9a[a207_0x364e('0x31')];delete _0x5abc9a[a207_0x364e('0x32')];delete _0x5abc9a[a207_0x364e('0x33')];delete _0x5abc9a[a207_0x364e('0x1d')];delete _0x5abc9a[a207_0x364e('0x34')];}return _0x25b6bd['json']({'success':!![],'data':_0x5abc9a});})[a207_0x364e('0xe')](_0x4b99c7=>{return _0x25b6bd[a207_0x364e('0xf')](0x1f4)[a207_0x364e('0x10')]({'success':![],'data':_0x4b99c7[a207_0x364e('0x11')]});});}[a207_0x364e('0x35')](_0x305098,_0x2a8c8d,_0x550278){if(!_0x305098[a207_0x364e('0x8')]){}this[a207_0x364e('0x7')]['findOne']({'attributes':{'exclude':[a207_0x364e('0x17'),a207_0x364e('0x1c'),a207_0x364e('0x31'),a207_0x364e('0x32'),a207_0x364e('0x33'),a207_0x364e('0x1d')]},'where':{'uuid':_0x305098[a207_0x364e('0xb')][a207_0x364e('0x36')]}})[a207_0x364e('0xc')](_0x54bde2=>{let _0x3e5a77=this['i18n']?sequelize_utils_1['default']['toJSONLocalizedOnly'](_0x54bde2,_0x305098[a207_0x364e('0x37')]['lang']):_0x54bde2;if(_0x3e5a77){const _0x46e861=process['env'][a207_0x364e('0x28')]+'images/'+_0x3e5a77[a207_0x364e('0x36')]+a207_0x364e('0x38');let _0x4b4676=null;if(fsExtra[a207_0x364e('0x2b')](_0x46e861)){_0x4b4676=base64Img['base64Sync'](_0x46e861);_0x3e5a77=JSON[a207_0x364e('0x2e')](JSON['stringify'](_0x3e5a77));_0x3e5a77['image_data']=_0x4b4676;}}return _0x2a8c8d['json']({'success':!![],'data':_0x3e5a77});})[a207_0x364e('0xe')](_0x38e2fa=>{return _0x2a8c8d[a207_0x364e('0xf')](0x1f4)[a207_0x364e('0x10')]({'success':![],'data':_0x38e2fa[a207_0x364e('0x11')]});});}['save'](_0x4f6073,_0xde8bc1,_0xbc0aae){if(!_0x4f6073[a207_0x364e('0x8')]){return responseUtils[a207_0x364e('0x16')](_0xde8bc1,a207_0x364e('0x9'),0x191);}if(_0x4f6073[a207_0x364e('0x39')]['id']&&_0x4f6073[a207_0x364e('0x39')]['id']!=''){return this[a207_0x364e('0x3a')](_0x4f6073,_0xde8bc1,_0xbc0aae);}else{return this[a207_0x364e('0x3b')](_0x4f6073,_0xde8bc1);}}[a207_0x364e('0x3b')](_0x44914a,_0x10a107){if(!_0x44914a['user']){return responseUtils[a207_0x364e('0x16')](_0x10a107,'authentication\x20failed',0x191);}_0x44914a[a207_0x364e('0x39')]=sequelize_utils_1[a207_0x364e('0x21')][a207_0x364e('0x25')](_0x44914a[a207_0x364e('0x39')]);_0x44914a[a207_0x364e('0x39')][a207_0x364e('0x17')]=_0x44914a[a207_0x364e('0x8')]['id'];if(_0x44914a[a207_0x364e('0x39')][a207_0x364e('0x34')]&&_0x44914a['body'][a207_0x364e('0x34')]!=''){_0x44914a[a207_0x364e('0x39')][a207_0x364e('0x34')]=crypt_utils_1[a207_0x364e('0x21')][a207_0x364e('0x3c')](_0x44914a[a207_0x364e('0x39')][a207_0x364e('0x34')]);}return this['model'][a207_0x364e('0x3b')](_0x44914a[a207_0x364e('0x39')],this['i18n']?{'language_id':_0x44914a[a207_0x364e('0x37')][a207_0x364e('0x20')]}:{})[a207_0x364e('0xc')](_0x2d6954=>{const _0xd8b8bc=this['i18n']?sequelize_utils_1[a207_0x364e('0x21')]['toJSONLocalizedOnly'](_0x2d6954,_0x44914a['headers'][a207_0x364e('0x20')]):_0x2d6954;this[a207_0x364e('0x3d')](_0x44914a,_0xd8b8bc);delete _0xd8b8bc[a207_0x364e('0x3e')]['id'];delete _0xd8b8bc[a207_0x364e('0x3e')][a207_0x364e('0x17')];delete _0xd8b8bc['dataValues']['updated_by_user_id'];delete _0xd8b8bc['dataValues'][a207_0x364e('0x31')];delete _0xd8b8bc[a207_0x364e('0x3e')][a207_0x364e('0x32')];delete _0xd8b8bc[a207_0x364e('0x3e')][a207_0x364e('0x33')];delete _0xd8b8bc[a207_0x364e('0x3e')][a207_0x364e('0x1d')];delete _0xd8b8bc['dataValues']['password'];if(_0x10a107){return _0x10a107[a207_0x364e('0xd')]({'success':!![],'data':_0xd8b8bc});}else{return _0xd8b8bc;}})['catch'](_0x3c84ff=>{if(_0x10a107){return _0x10a107[a207_0x364e('0xf')](0x1f4)[a207_0x364e('0x10')]({'success':![],'data':_0x3c84ff['stack']});}else{return _0x3c84ff[a207_0x364e('0x11')];}});}['findOneAndUpdate'](_0x1373ad,_0x19b461,_0x3654bf){if(!_0x1373ad[a207_0x364e('0x8')]){return responseUtils[a207_0x364e('0x16')](_0x19b461,'authentication\x20failed',0x191);}_0x1373ad[a207_0x364e('0x39')]=sequelize_utils_1[a207_0x364e('0x21')][a207_0x364e('0x25')](_0x1373ad['body']);_0x1373ad[a207_0x364e('0x39')][a207_0x364e('0x1c')]=_0x1373ad['user']['id'];if(_0x1373ad[a207_0x364e('0x39')][a207_0x364e('0x34')]&&_0x1373ad[a207_0x364e('0x39')]['password']!=''){_0x1373ad[a207_0x364e('0x39')]['password']=crypt_utils_1[a207_0x364e('0x21')]['hashPassword'](_0x1373ad['body'][a207_0x364e('0x34')]);}this[a207_0x364e('0x7')][a207_0x364e('0x26')](_0x1373ad[a207_0x364e('0x39')]['id'])[a207_0x364e('0xc')](_0x373844=>{if(_0x373844==null)return _0x19b461[a207_0x364e('0xd')]({'success':!![],'data':_0x373844});_0x373844['update'](_0x1373ad[a207_0x364e('0x39')],{'language_id':_0x1373ad[a207_0x364e('0x37')][a207_0x364e('0x20')]})[a207_0x364e('0xc')](function(_0x2f0db9){const _0x29cc86=this[a207_0x364e('0x1e')]?sequelize_utils_1['default'][a207_0x364e('0x1f')](_0x373844,_0x1373ad['headers'][a207_0x364e('0x20')]):_0x373844;this[a207_0x364e('0x3d')](_0x1373ad,_0x29cc86);delete _0x29cc86[a207_0x364e('0x3e')]['id'];delete _0x29cc86[a207_0x364e('0x3e')][a207_0x364e('0x17')];delete _0x29cc86[a207_0x364e('0x3e')]['updated_by_user_id'];delete _0x29cc86[a207_0x364e('0x3e')]['deleted_by_user_id'];delete _0x29cc86['dataValues'][a207_0x364e('0x32')];delete _0x29cc86[a207_0x364e('0x3e')]['updated_at'];delete _0x29cc86['dataValues'][a207_0x364e('0x1d')];delete _0x29cc86['dataValues'][a207_0x364e('0x34')];return _0x19b461['json']({'success':!![],'data':_0x29cc86});}[a207_0x364e('0x3f')](this))[a207_0x364e('0xe')](_0x21adc5=>{return _0x19b461['status'](0x1f4)['send']({'success':![],'data':_0x21adc5[a207_0x364e('0x11')]});});})['catch'](_0x35298e=>{return _0x19b461[a207_0x364e('0xf')](0x1f4)[a207_0x364e('0x10')]({'success':![],'data':_0x35298e['stack']});});}[a207_0x364e('0x40')](_0x318f7f,_0xee66fe,_0x5e751c){if(!_0x318f7f['user']){return _0xee66fe[a207_0x364e('0xf')](0x191)[a207_0x364e('0x10')]({'success':![],'data':a207_0x364e('0x9')});}if(_0x318f7f[a207_0x364e('0x8')]&&_0x318f7f['user'][a207_0x364e('0x41')]>0x0){}console[a207_0x364e('0x18')](_0x318f7f['params']);const _0x365cdc=_0x318f7f[a207_0x364e('0x39')][a207_0x364e('0x36')]&&_0x318f7f[a207_0x364e('0x39')][a207_0x364e('0x36')]!=''?_0x318f7f[a207_0x364e('0x39')][a207_0x364e('0x36')]:_0x318f7f[a207_0x364e('0xb')][a207_0x364e('0x36')];this['model'][a207_0x364e('0x42')]({'where':{'uuid':_0x365cdc}})[a207_0x364e('0xc')](_0x478d4e=>{if(_0x478d4e==null)return _0xee66fe[a207_0x364e('0xd')]({'success':!![],'data':_0x478d4e});_0x478d4e[a207_0x364e('0x43')](_0x318f7f[a207_0x364e('0x39')],{'language_id':_0x318f7f[a207_0x364e('0x37')][a207_0x364e('0x20')]})[a207_0x364e('0xc')](function(_0x2d5ca7){const _0x1e9495=this[a207_0x364e('0x1e')]?sequelize_utils_1['default'][a207_0x364e('0x1f')](_0x478d4e,_0x318f7f[a207_0x364e('0x37')][a207_0x364e('0x20')]):_0x478d4e;this['saveImageFile'](_0x318f7f,_0x1e9495);return _0xee66fe[a207_0x364e('0xd')]({'success':!![],'data':_0x1e9495});}[a207_0x364e('0x3f')](this))[a207_0x364e('0xe')](_0x4af09c=>{return _0xee66fe['status'](0x1f4)[a207_0x364e('0x10')]({'success':![],'data':_0x4af09c['stack']});});})[a207_0x364e('0xe')](_0x1f6289=>{return _0xee66fe[a207_0x364e('0xf')](0x1f4)[a207_0x364e('0x10')]({'success':![],'data':_0x1f6289['stack']});});}[a207_0x364e('0x44')](_0x18676e,_0x3a6b49,_0x58fdc0,_0x5e221a=![],_0xab6a46=![]){if(!_0x18676e['user']&&!_0xab6a46){return responseUtils[a207_0x364e('0x16')](_0x3a6b49,a207_0x364e('0x9'),0x191);}if(_0x18676e[a207_0x364e('0x8')]&&_0x18676e[a207_0x364e('0x8')][a207_0x364e('0x41')]>0x0){}return this['model'][a207_0x364e('0x42')]({'where':_0x18676e[a207_0x364e('0xb')]})[a207_0x364e('0xc')](function(_0x4064da){if(_0x4064da){return _0x4064da[a207_0x364e('0x43')](_0x18676e[a207_0x364e('0x39')])['then'](function(_0x54c392){const _0x3b749c=_0x54c392[a207_0x364e('0x3e')];if(!_0x5e221a){delete _0x3b749c['id'];}if(_0x3a6b49){return _0x3a6b49[a207_0x364e('0xd')]({'success':!![],'data':_0x3b749c});}else{return _0x3b749c;}}[a207_0x364e('0x3f')](this));}else{return this['model'][a207_0x364e('0x3b')](_0x18676e[a207_0x364e('0x39')])[a207_0x364e('0xc')](function(_0xb9d27){if(_0x3a6b49){return _0x3a6b49['json']({'success':!![],'data':_0xb9d27['toJSON']()});}else{return _0xb9d27;}});}}[a207_0x364e('0x3f')](this))[a207_0x364e('0xe')](_0x41e22c=>{if(_0x3a6b49){return _0x3a6b49[a207_0x364e('0xf')](0x1f4)['send']({'success':![],'data':_0x41e22c['stack']});}else{return _0x41e22c[a207_0x364e('0x11')];}});}[a207_0x364e('0x45')](_0x530952,_0x596f44,_0xf93e88){if(!_0x530952['user']){return _0x596f44[a207_0x364e('0xf')](0x191)[a207_0x364e('0x10')]({'success':![],'data':'authentication\x20failed'});}_0x530952[a207_0x364e('0x39')]['created_by_user_id']=_0x530952[a207_0x364e('0x8')]['id'];return this['model'][a207_0x364e('0x45')]({'where':{'uuid':_0x530952['body'][a207_0x364e('0x36')]},'defaults':_0x530952[a207_0x364e('0x39')]})[a207_0x364e('0xc')]((_0x523957,_0x428269)=>{if(_0x428269){}else{}return _0x596f44['json']({'success':!![],'data':_0x523957});})['catch'](_0x324ec0=>{return _0x596f44['status'](0x1f4)['send']({'success':![],'data':_0x324ec0[a207_0x364e('0x11')]});});}['remove'](_0x24002d,_0xa15883,_0x1b99b3){if(!_0x24002d[a207_0x364e('0x8')]||_0x24002d['user'][a207_0x364e('0x41')]==0x0){return _0xa15883[a207_0x364e('0xf')](0x191)['send']({'success':![],'data':a207_0x364e('0x9')});}_0x24002d[a207_0x364e('0xb')]['id']=sequelize_utils_1[a207_0x364e('0x21')]['decryptId'](_0x24002d['params']['id']);this[a207_0x364e('0x7')]['findByPk'](_0x24002d[a207_0x364e('0xb')]['id'])[a207_0x364e('0xc')](_0x1df381=>{if(_0x1df381==null)return _0xa15883[a207_0x364e('0xd')]({'success':!![],'data':_0x1df381});_0x1df381[a207_0x364e('0x43')]({'deleted_by_user_id':_0x24002d['user']['id']},{'language_id':_0x24002d[a207_0x364e('0x37')][a207_0x364e('0x20')]})[a207_0x364e('0xc')](function(_0x50f4de){_0x1df381['destroy']()[a207_0x364e('0xc')](function(_0x1df381){return _0xa15883[a207_0x364e('0xd')]({'success':!![],'data':_0x1df381});})[a207_0x364e('0xe')](_0x10bd8b=>{return _0xa15883[a207_0x364e('0xf')](0x1f4)[a207_0x364e('0x10')]({'success':![],'data':_0x10bd8b['stack']});});}['bind'](this))[a207_0x364e('0xe')](_0x1dd3a7=>{return _0xa15883['status'](0x1f4)['send']({'success':![],'data':_0x1dd3a7[a207_0x364e('0x11')]});});})[a207_0x364e('0xe')](_0x1de528=>{return _0xa15883[a207_0x364e('0xf')](0x1f4)[a207_0x364e('0x10')]({'success':![],'data':_0x1de528[a207_0x364e('0x11')]});});}['saveImageFile'](_0x3c711b,_0x72761b){if(_0x3c711b[a207_0x364e('0x39')][a207_0x364e('0x30')]&&_0x3c711b['body'][a207_0x364e('0x30')]!=''){const _0x815d26=process[a207_0x364e('0x27')][a207_0x364e('0x28')]+a207_0x364e('0x29');const _0x43ec02=_0x3c711b[a207_0x364e('0x39')][a207_0x364e('0x30')];let _0x4bab64='';const _0x4ba2db=_0x43ec02['replace'](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x43ec02[a207_0x364e('0x46')](/^data:image\/png;base64,/,'')){_0x4bab64=a207_0x364e('0x47');}else if(_0x43ec02[a207_0x364e('0x46')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x4bab64=a207_0x364e('0x48');}const _0x5463e9=sequelize_utils_1['default'][a207_0x364e('0x22')](_0x72761b[a207_0x364e('0x3e')]['id']);fsExtra[a207_0x364e('0x49')](_0x815d26);const _0x129e9a=''+_0x815d26+this[a207_0x364e('0x7')][a207_0x364e('0x2a')]+'_'+_0x5463e9+'.'+_0x4bab64;console[a207_0x364e('0x18')](a207_0x364e('0x4a'),_0x129e9a);fsExtra['writeFile'](_0x129e9a,_0x4ba2db,a207_0x364e('0x4b'),function(_0x127a99){console[a207_0x364e('0x18')](a207_0x364e('0x4c'),_0x127a99);});}}}exports['default']=CrudUtils;