var a146_0x544b=['password','generateHash','user_uuid','user_id','findUuidAndUpdate','create','dataValues','saveImageFile','findByPk','bind','log','update','updateOrCreate','findOrCreate','remove','authentication\x20failed','destroy','replace','jpg','writeFile','base64','defineProperty','__esModule','./sequelize-utils','../infrastructure/auth-utils','fs-extra','base64-img','model','i18n','count','params','then','json','catch','send','stack','offset','query','user','length','findAll','updated_by_user_id','deleted_by_user_id','deleted_at','toJSONLocalizedOnly','lang','default','toJSON','status','findById','headers','env','IMAGE_FILES_FOLDER','images/','uuid','.jpg','existsSync','parse','stringify','image_data','findByUuid','findOne','created_by_user_id','created_at','updated_at','save','body'];(function(_0x3f9a28,_0x47dd6f){var _0x4556cd=function(_0x429f35){while(--_0x429f35){_0x3f9a28['push'](_0x3f9a28['shift']());}};_0x4556cd(++_0x47dd6f);}(a146_0x544b,0x164));var a146_0xceee=function(_0x5601f3,_0x171f93){_0x5601f3=_0x5601f3-0x0;var _0x3f9a09=a146_0x544b[_0x5601f3];return _0x3f9a09;};'use strict';var __importDefault=this&&this['__importDefault']||function(_0x1f9e32){return _0x1f9e32&&_0x1f9e32['__esModule']?_0x1f9e32:{'default':_0x1f9e32};};Object[a146_0xceee('0x0')](exports,a146_0xceee('0x1'),{'value':!![]});const sequelize_utils_1=__importDefault(require(a146_0xceee('0x2')));const authUtils=require(a146_0xceee('0x3'));const fsExtra=require(a146_0xceee('0x4'));const base64Img=require(a146_0xceee('0x5'));class CrudUtils{constructor(_0x127c61,_0x4dd188){this[a146_0xceee('0x6')]=_0x127c61;this[a146_0xceee('0x7')]=_0x4dd188;}[a146_0xceee('0x8')](_0xa678d1,_0x425013,_0xfb16c5){if(!_0xa678d1['user']||_0xa678d1['user']['length']==0x0){}return this['model'][a146_0xceee('0x8')]({'where':_0xa678d1[a146_0xceee('0x9')]})[a146_0xceee('0xa')](_0x488697=>{const _0x26778c=_0x488697;if(_0x425013){return _0x425013[a146_0xceee('0xb')]({'success':!![],'data':{'total':_0x488697}});}else{return _0x26778c;}})[a146_0xceee('0xc')](_0x38fa57=>{if(_0x425013){return _0x425013['status'](0x1f4)[a146_0xceee('0xd')]({'success':![],'data':_0x38fa57[a146_0xceee('0xe')]});}else{return _0x38fa57['stack'];}});}['find'](_0x345f7c,_0x3b7b98,_0x10aa39,_0x2cb115=![],_0xe42357=[],_0x5af422=null){const _0x4cf493=_0x345f7c['query'][a146_0xceee('0xf')]?Number(_0x345f7c[a146_0xceee('0x10')]['offset']):null;const _0x1dc339=_0x345f7c[a146_0xceee('0x10')]['limit']?Number(_0x345f7c[a146_0xceee('0x10')]['limit']):null;if(!_0x345f7c[a146_0xceee('0x11')]||_0x345f7c['user'][a146_0xceee('0x12')]==0x0){}return this[a146_0xceee('0x6')][a146_0xceee('0x13')]({'attributes':{'exclude':_0x2cb115?[]:['created_by_user_id',a146_0xceee('0x14'),a146_0xceee('0x15'),'created_at','updated_at',a146_0xceee('0x16')]},'where':_0x345f7c[a146_0xceee('0x9')],'offset':_0x4cf493,'limit':_0x1dc339,'include':_0xe42357,'order':_0x5af422})[a146_0xceee('0xa')](_0x50531e=>{const _0x1c5b6e=this[a146_0xceee('0x7')]?sequelize_utils_1['default'][a146_0xceee('0x17')](_0x50531e,_0x345f7c['headers'][a146_0xceee('0x18')]):sequelize_utils_1[a146_0xceee('0x19')][a146_0xceee('0x1a')](_0x50531e);if(_0x3b7b98){return _0x3b7b98[a146_0xceee('0xb')]({'success':!![],'data':_0x1c5b6e});}else{return _0x1c5b6e;}})[a146_0xceee('0xc')](_0x53ba70=>{if(_0x3b7b98){return _0x3b7b98[a146_0xceee('0x1b')](0x1f4)[a146_0xceee('0xd')]({'success':![],'data':_0x53ba70[a146_0xceee('0xe')]});}else{return _0x53ba70[a146_0xceee('0xe')];}});}['findById'](_0x5a9e19,_0x458d14,_0x31f9e4){if(!_0x5a9e19[a146_0xceee('0x11')]||_0x5a9e19[a146_0xceee('0x11')][a146_0xceee('0x12')]==0x0){}this[a146_0xceee('0x6')][a146_0xceee('0x1c')](_0x5a9e19[a146_0xceee('0x9')]['id'])[a146_0xceee('0xa')](_0xb94e89=>{let _0x1a49f4=this[a146_0xceee('0x7')]?sequelize_utils_1[a146_0xceee('0x19')][a146_0xceee('0x17')](_0xb94e89,_0x5a9e19[a146_0xceee('0x1d')]['lang']):_0xb94e89;if(_0x1a49f4){const _0x57b390=process[a146_0xceee('0x1e')][a146_0xceee('0x1f')]+a146_0xceee('0x20')+_0x1a49f4[a146_0xceee('0x21')]+a146_0xceee('0x22');let _0x48d31a=null;if(fsExtra[a146_0xceee('0x23')](_0x57b390)){_0x48d31a=base64Img['base64Sync'](_0x57b390);_0x1a49f4=JSON[a146_0xceee('0x24')](JSON[a146_0xceee('0x25')](_0x1a49f4));_0x1a49f4[a146_0xceee('0x26')]=_0x48d31a;}}return _0x458d14['json']({'success':!![],'data':_0x1a49f4});})[a146_0xceee('0xc')](_0x5ce143=>{return _0x458d14[a146_0xceee('0x1b')](0x1f4)[a146_0xceee('0xd')]({'success':![],'data':_0x5ce143[a146_0xceee('0xe')]});});}[a146_0xceee('0x27')](_0x405632,_0x29cecd,_0x58d9d1){if(!_0x405632[a146_0xceee('0x11')]||_0x405632[a146_0xceee('0x11')][a146_0xceee('0x12')]==0x0){}this[a146_0xceee('0x6')][a146_0xceee('0x28')]({'attributes':{'exclude':['id',a146_0xceee('0x29'),a146_0xceee('0x14'),a146_0xceee('0x15'),a146_0xceee('0x2a'),a146_0xceee('0x2b'),a146_0xceee('0x16')]},'where':{'uuid':_0x405632[a146_0xceee('0x9')]['uuid']}})[a146_0xceee('0xa')](_0x9c2f31=>{let _0x37b4e1=this['i18n']?sequelize_utils_1[a146_0xceee('0x19')][a146_0xceee('0x17')](_0x9c2f31,_0x405632[a146_0xceee('0x1d')]['lang']):_0x9c2f31;if(_0x37b4e1){const _0x3f7839=process['env'][a146_0xceee('0x1f')]+a146_0xceee('0x20')+_0x37b4e1[a146_0xceee('0x21')]+a146_0xceee('0x22');let _0x248d18=null;if(fsExtra[a146_0xceee('0x23')](_0x3f7839)){_0x248d18=base64Img['base64Sync'](_0x3f7839);_0x37b4e1=JSON[a146_0xceee('0x24')](JSON[a146_0xceee('0x25')](_0x37b4e1));_0x37b4e1[a146_0xceee('0x26')]=_0x248d18;}}return _0x29cecd['json']({'success':!![],'data':_0x37b4e1});})[a146_0xceee('0xc')](_0x32e21f=>{return _0x29cecd[a146_0xceee('0x1b')](0x1f4)['send']({'success':![],'data':_0x32e21f[a146_0xceee('0xe')]});});}[a146_0xceee('0x2c')](_0x174290,_0x4f2a8f,_0x8e95ad){if(!_0x174290[a146_0xceee('0x11')]||_0x174290['user']['length']==0x0){}if(_0x174290[a146_0xceee('0x11')]&&_0x174290[a146_0xceee('0x11')]['length']>0x0){_0x174290[a146_0xceee('0x2d')]['created_by_user_id']=_0x174290[a146_0xceee('0x11')][0x0]['id'];}if(_0x174290['body']['password']&&_0x174290[a146_0xceee('0x2d')][a146_0xceee('0x2e')]!=''){_0x174290[a146_0xceee('0x2d')][a146_0xceee('0x2e')]=authUtils[a146_0xceee('0x2f')](_0x174290[a146_0xceee('0x2d')][a146_0xceee('0x2e')]);}if(_0x174290[a146_0xceee('0x2d')]['user_uuid']&&_0x174290[a146_0xceee('0x2d')][a146_0xceee('0x30')]!=''){_0x174290[a146_0xceee('0x2d')][a146_0xceee('0x31')]='1';}if(_0x174290[a146_0xceee('0x2d')][a146_0xceee('0x21')]&&_0x174290[a146_0xceee('0x2d')][a146_0xceee('0x21')]!=''){return this[a146_0xceee('0x32')](_0x174290,_0x4f2a8f,_0x8e95ad);}else{return this[a146_0xceee('0x6')][a146_0xceee('0x33')](_0x174290[a146_0xceee('0x2d')],this['i18n']?{'language_id':_0x174290[a146_0xceee('0x1d')][a146_0xceee('0x18')]}:{})[a146_0xceee('0xa')](_0x42037f=>{const _0x42aa2d=this[a146_0xceee('0x7')]?sequelize_utils_1[a146_0xceee('0x19')][a146_0xceee('0x17')](_0x42037f,_0x174290[a146_0xceee('0x1d')]['lang']):_0x42037f;delete _0x42aa2d[a146_0xceee('0x34')]['id'];delete _0x42aa2d[a146_0xceee('0x34')][a146_0xceee('0x29')];delete _0x42aa2d[a146_0xceee('0x34')]['updated_by_user_id'];delete _0x42aa2d[a146_0xceee('0x34')]['deleted_by_user_id'];delete _0x42aa2d[a146_0xceee('0x34')]['created_at'];delete _0x42aa2d[a146_0xceee('0x34')][a146_0xceee('0x2b')];delete _0x42aa2d[a146_0xceee('0x34')][a146_0xceee('0x16')];delete _0x42aa2d[a146_0xceee('0x34')][a146_0xceee('0x2e')];this[a146_0xceee('0x35')](_0x174290,_0x42aa2d);if(_0x4f2a8f){return _0x4f2a8f['json']({'success':!![],'data':_0x42aa2d});}else{return _0x42aa2d;}})[a146_0xceee('0xc')](_0x139c25=>{if(_0x4f2a8f){return _0x4f2a8f['status'](0x1f4)[a146_0xceee('0xd')]({'success':![],'data':_0x139c25[a146_0xceee('0xe')]});}else{return _0x139c25[a146_0xceee('0xe')];}});}}['findOneAndUpdate'](_0x3b8a06,_0x115f79,_0x2a793c){if(!_0x3b8a06[a146_0xceee('0x11')]||_0x3b8a06[a146_0xceee('0x11')]['length']==0x0){}if(_0x3b8a06[a146_0xceee('0x11')]&&_0x3b8a06[a146_0xceee('0x11')][a146_0xceee('0x12')]>0x0){}this[a146_0xceee('0x6')][a146_0xceee('0x36')](_0x3b8a06[a146_0xceee('0x2d')]['id'])[a146_0xceee('0xa')](_0x54c66e=>{if(_0x54c66e==null)return _0x115f79[a146_0xceee('0xb')]({'success':!![],'data':_0x54c66e});_0x54c66e['update'](_0x3b8a06[a146_0xceee('0x2d')],{'language_id':_0x3b8a06[a146_0xceee('0x1d')][a146_0xceee('0x18')]})[a146_0xceee('0xa')](function(_0x8342c8){const _0x35aa0c=this['i18n']?sequelize_utils_1[a146_0xceee('0x19')][a146_0xceee('0x17')](_0x54c66e,_0x3b8a06[a146_0xceee('0x1d')][a146_0xceee('0x18')]):_0x54c66e;return _0x115f79['json']({'success':!![],'data':_0x35aa0c});}[a146_0xceee('0x37')](this))[a146_0xceee('0xc')](_0x2250d2=>{return _0x115f79['status'](0x1f4)[a146_0xceee('0xd')]({'success':![],'data':_0x2250d2['stack']});});})[a146_0xceee('0xc')](_0x48857f=>{return _0x115f79[a146_0xceee('0x1b')](0x1f4)[a146_0xceee('0xd')]({'success':![],'data':_0x48857f[a146_0xceee('0xe')]});});}[a146_0xceee('0x32')](_0x5d55dd,_0x5c7304,_0x45131f){if(!_0x5d55dd[a146_0xceee('0x11')]||_0x5d55dd['user'][a146_0xceee('0x12')]==0x0){}if(_0x5d55dd[a146_0xceee('0x11')]&&_0x5d55dd[a146_0xceee('0x11')][a146_0xceee('0x12')]>0x0){}console[a146_0xceee('0x38')](_0x5d55dd[a146_0xceee('0x9')]);const _0x2cd7dd=_0x5d55dd[a146_0xceee('0x2d')]['uuid']&&_0x5d55dd[a146_0xceee('0x2d')][a146_0xceee('0x21')]!=''?_0x5d55dd[a146_0xceee('0x2d')][a146_0xceee('0x21')]:_0x5d55dd[a146_0xceee('0x9')][a146_0xceee('0x21')];this[a146_0xceee('0x6')]['findOne']({'where':{'uuid':_0x2cd7dd}})[a146_0xceee('0xa')](_0x3864dc=>{if(_0x3864dc==null)return _0x5c7304[a146_0xceee('0xb')]({'success':!![],'data':_0x3864dc});_0x3864dc[a146_0xceee('0x39')](_0x5d55dd[a146_0xceee('0x2d')],{'language_id':_0x5d55dd[a146_0xceee('0x1d')]['lang']})[a146_0xceee('0xa')](function(_0x3ec419){const _0x5e8b83=this['i18n']?sequelize_utils_1[a146_0xceee('0x19')][a146_0xceee('0x17')](_0x3864dc,_0x5d55dd[a146_0xceee('0x1d')][a146_0xceee('0x18')]):_0x3864dc;this['saveImageFile'](_0x5d55dd,_0x5e8b83);return _0x5c7304[a146_0xceee('0xb')]({'success':!![],'data':_0x5e8b83});}[a146_0xceee('0x37')](this))['catch'](_0xd161b7=>{return _0x5c7304[a146_0xceee('0x1b')](0x1f4)[a146_0xceee('0xd')]({'success':![],'data':_0xd161b7[a146_0xceee('0xe')]});});})[a146_0xceee('0xc')](_0x147a97=>{return _0x5c7304['status'](0x1f4)['send']({'success':![],'data':_0x147a97['stack']});});}[a146_0xceee('0x3a')](_0xdc379f,_0x9844a7,_0xd2f84c,_0xaa8bd5=![]){if(!_0xdc379f[a146_0xceee('0x11')]||_0xdc379f[a146_0xceee('0x11')][a146_0xceee('0x12')]==0x0){}if(_0xdc379f['user']&&_0xdc379f[a146_0xceee('0x11')][a146_0xceee('0x12')]>0x0){}return this[a146_0xceee('0x6')][a146_0xceee('0x28')]({'where':_0xdc379f[a146_0xceee('0x9')]})[a146_0xceee('0xa')](function(_0x57f060){if(_0x57f060){return _0x57f060[a146_0xceee('0x39')](_0xdc379f['body'])[a146_0xceee('0xa')](function(_0x235424){const _0x2d0bac=_0x235424[a146_0xceee('0x34')];if(_0xaa8bd5){delete _0x2d0bac['id'];}if(_0x9844a7){return _0x9844a7['json']({'success':!![],'data':_0x2d0bac});}else{return _0x2d0bac;}}[a146_0xceee('0x37')](this));}else{return this[a146_0xceee('0x6')]['create'](_0xdc379f[a146_0xceee('0x2d')])[a146_0xceee('0xa')](function(_0x2d2237){if(_0x9844a7){return _0x9844a7[a146_0xceee('0xb')]({'success':!![],'data':_0x2d2237['toJSON']()});}else{return _0x2d2237;}});}}[a146_0xceee('0x37')](this))[a146_0xceee('0xc')](_0x1f1239=>{if(_0x9844a7){return _0x9844a7[a146_0xceee('0x1b')](0x1f4)['send']({'success':![],'data':_0x1f1239['stack']});}else{return _0x1f1239['stack'];}});}[a146_0xceee('0x3b')](_0x4a04fe,_0x3e77c6,_0x3c7368){if(!_0x4a04fe[a146_0xceee('0x11')]||_0x4a04fe[a146_0xceee('0x11')][a146_0xceee('0x12')]==0x0){}if(_0x4a04fe['user']&&_0x4a04fe[a146_0xceee('0x11')][a146_0xceee('0x12')]>0x0){}return this['model'][a146_0xceee('0x3b')]({'where':{'uuid':_0x4a04fe[a146_0xceee('0x2d')][a146_0xceee('0x21')]},'defaults':_0x4a04fe[a146_0xceee('0x2d')]})['then']((_0x29e03b,_0x231b22)=>{if(_0x231b22){}else{}return _0x3e77c6[a146_0xceee('0xb')]({'success':!![],'data':_0x29e03b});})[a146_0xceee('0xc')](_0x16bb51=>{return _0x3e77c6[a146_0xceee('0x1b')](0x1f4)[a146_0xceee('0xd')]({'success':![],'data':_0x16bb51[a146_0xceee('0xe')]});});}[a146_0xceee('0x3c')](_0x3a5703,_0x1cb2da,_0x51ae3b){if(!_0x3a5703[a146_0xceee('0x11')]||_0x3a5703[a146_0xceee('0x11')]['length']==0x0){return _0x1cb2da[a146_0xceee('0x1b')](0x191)[a146_0xceee('0xd')]({'success':![],'data':a146_0xceee('0x3d')});}if(_0x3a5703[a146_0xceee('0x11')]&&_0x3a5703['user'][a146_0xceee('0x12')]>0x0){_0x3a5703['body'][a146_0xceee('0x29')]=_0x3a5703[a146_0xceee('0x11')][0x0]['id'];}this[a146_0xceee('0x6')][a146_0xceee('0x1c')](_0x3a5703[a146_0xceee('0x9')]['id'])[a146_0xceee('0xa')](_0x4239ab=>{if(_0x4239ab==null)return _0x1cb2da[a146_0xceee('0xb')]({'success':!![],'data':_0x4239ab});_0x4239ab[a146_0xceee('0x3e')]()['then'](function(_0x25d83f){const _0x469256=this['i18n']?sequelize_utils_1[a146_0xceee('0x19')][a146_0xceee('0x17')](_0x4239ab,_0x3a5703[a146_0xceee('0x1d')][a146_0xceee('0x18')]):_0x4239ab;return _0x1cb2da['json']({'success':!![],'data':_0x469256});})[a146_0xceee('0xc')](_0x4cb911=>{return _0x1cb2da[a146_0xceee('0x1b')](0x1f4)[a146_0xceee('0xd')]({'success':![],'data':_0x4cb911[a146_0xceee('0xe')]});});})[a146_0xceee('0xc')](_0x1e2e7b=>{return _0x1cb2da['status'](0x1f4)[a146_0xceee('0xd')]({'success':![],'data':_0x1e2e7b[a146_0xceee('0xe')]});});}[a146_0xceee('0x35')](_0x196cb6,_0x28d696){if(_0x196cb6[a146_0xceee('0x2d')]['image_data']&&_0x196cb6[a146_0xceee('0x2d')]['image_data']!=''){const _0x34b4ff=process[a146_0xceee('0x1e')][a146_0xceee('0x1f')]+a146_0xceee('0x20');const _0x480ee5=_0x196cb6[a146_0xceee('0x2d')]['image_data'];let _0x465ada='';const _0x2151b8=_0x480ee5[a146_0xceee('0x3f')](/^data:image\/(png|jpeg);base64,/,'');if(_0x480ee5['match'](/^data:image\/png;base64,/,'')){_0x465ada='png';}else if(_0x480ee5['match'](/^data:image\/(jpg|jpeg);base64,/,'')){_0x465ada=a146_0xceee('0x40');}fsExtra['ensureDirSync'](_0x34b4ff);const _0xfb0cb9=''+_0x34b4ff+_0x28d696[a146_0xceee('0x34')]['uuid']+'.'+_0x465ada;fsExtra[a146_0xceee('0x41')](_0xfb0cb9,_0x2151b8,a146_0xceee('0x42'),function(_0x14fdd1){console[a146_0xceee('0x38')](_0x14fdd1);});}}}exports[a146_0xceee('0x19')]=CrudUtils;