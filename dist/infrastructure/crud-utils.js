var a207_0x1991=['catch','status','send','stack','find','offset','query','limit','errorResponse','created_by_user_id','findAll','deleted_by_user_id','created_at','updated_at','deleted_at','then','default','toJSONLocalizedOnly','headers','lang','encryptId','successResponse','findById','dataValues','env','images/','name','.jpg','existsSync','IMAGE_FILES_FOLDER','base64Sync','parse','image_data','findByUuid','findOne','updated_by_user_id','uuid','stringify','save','create','body','decryptId','password','hashPassword','saveImageFile','findOneAndUpdate','findByPk','bind','findUuidAndUpdate','length','log','update','updateOrCreate','toJSON','findOrCreate','remove','destroy','replace','png','match','jpg','fileName','base64','err:','__importDefault','__esModule','defineProperty','./sequelize-utils','./crypt-utils','fs-extra','base64-img','model','i18n','count','user','authentication\x20failed','params','json'];(function(_0x477d71,_0x327f13){var _0x9c58a2=function(_0x20c1aa){while(--_0x20c1aa){_0x477d71['push'](_0x477d71['shift']());}};_0x9c58a2(++_0x327f13);}(a207_0x1991,0x1c6));var a207_0x1279=function(_0x286c0b,_0x2e81b8){_0x286c0b=_0x286c0b-0x0;var _0x25f89d=a207_0x1991[_0x286c0b];return _0x25f89d;};'use strict';var __importDefault=this&&this[a207_0x1279('0x0')]||function(_0x3ab1b1){return _0x3ab1b1&&_0x3ab1b1[a207_0x1279('0x1')]?_0x3ab1b1:{'default':_0x3ab1b1};};Object[a207_0x1279('0x2')](exports,a207_0x1279('0x1'),{'value':!![]});const sequelize_utils_1=__importDefault(require(a207_0x1279('0x3')));const crypt_utils_1=__importDefault(require(a207_0x1279('0x4')));const authUtils=require('../infrastructure/auth-utils');const fsExtra=require(a207_0x1279('0x5'));const base64Img=require(a207_0x1279('0x6'));const responseUtils=require('../infrastructure/response-utils');class CrudUtils{constructor(_0x47c895,_0x3c7766){this[a207_0x1279('0x7')]=_0x47c895;this[a207_0x1279('0x8')]=_0x3c7766;}[a207_0x1279('0x9')](_0x39cfac,_0x43672a,_0x52be5a){if(!_0x39cfac[a207_0x1279('0xa')]){return responseUtils['errorResponse'](_0x43672a,a207_0x1279('0xb'),0x191);}return this[a207_0x1279('0x7')][a207_0x1279('0x9')]({'where':_0x39cfac[a207_0x1279('0xc')]})['then'](_0x40f93f=>{const _0x389c23=_0x40f93f;if(_0x43672a){return _0x43672a[a207_0x1279('0xd')]({'success':!![],'data':{'total':_0x40f93f}});}else{return _0x389c23;}})[a207_0x1279('0xe')](_0x276041=>{if(_0x43672a){return _0x43672a[a207_0x1279('0xf')](0x1f4)[a207_0x1279('0x10')]({'success':![],'data':_0x276041[a207_0x1279('0x11')]});}else{return _0x276041[a207_0x1279('0x11')];}});}[a207_0x1279('0x12')](_0x1c9b92,_0x29f877,_0x48e1b7,_0x52295b=![],_0x4c9749=[],_0x364a2e=null,_0x4952c9=![]){const _0x3f562e=_0x1c9b92['query'][a207_0x1279('0x13')]?Number(_0x1c9b92[a207_0x1279('0x14')]['offset']):null;const _0x1f3056=_0x1c9b92[a207_0x1279('0x14')][a207_0x1279('0x15')]?Number(_0x1c9b92[a207_0x1279('0x14')]['limit']):null;if(!_0x1c9b92[a207_0x1279('0xa')]){return responseUtils[a207_0x1279('0x16')](_0x29f877,'authentication\x20failed',0x191);}if(!_0x4952c9){_0x1c9b92[a207_0x1279('0xc')][a207_0x1279('0x17')]=_0x1c9b92['user']['id'];}return this[a207_0x1279('0x7')][a207_0x1279('0x18')]({'attributes':{'exclude':_0x52295b?[]:[a207_0x1279('0x17'),'updated_by_user_id',a207_0x1279('0x19'),a207_0x1279('0x1a'),a207_0x1279('0x1b'),a207_0x1279('0x1c')]},'where':_0x1c9b92[a207_0x1279('0xc')],'offset':_0x3f562e,'limit':_0x1f3056,'include':_0x4c9749,'order':_0x364a2e})[a207_0x1279('0x1d')](_0x26aae4=>{let _0x27b43c=this['i18n']?sequelize_utils_1[a207_0x1279('0x1e')][a207_0x1279('0x1f')](_0x26aae4,_0x1c9b92[a207_0x1279('0x20')][a207_0x1279('0x21')]):sequelize_utils_1[a207_0x1279('0x1e')]['toJSON'](_0x26aae4);_0x27b43c=sequelize_utils_1[a207_0x1279('0x1e')][a207_0x1279('0x22')](_0x27b43c);if(_0x29f877){return responseUtils[a207_0x1279('0x23')](_0x29f877,_0x27b43c,0xc8);}else{return _0x27b43c;}})[a207_0x1279('0xe')](_0x2831b5=>{if(_0x29f877){return responseUtils[a207_0x1279('0x16')](_0x29f877,_0x2831b5[a207_0x1279('0x11')],0x1f4);}else{return _0x2831b5[a207_0x1279('0x11')];}});}[a207_0x1279('0x24')](_0x34e05b,_0xccff57,_0x293ea0){if(!_0x34e05b[a207_0x1279('0xa')]){return responseUtils[a207_0x1279('0x16')](_0xccff57,'authentication\x20failed',0x191);}_0x34e05b[a207_0x1279('0xc')]['id']=sequelize_utils_1['default']['decryptId'](_0x34e05b['params']['id']);this[a207_0x1279('0x7')]['findByPk'](_0x34e05b[a207_0x1279('0xc')]['id'])['then'](_0x33608d=>{let _0x34dd79=this[a207_0x1279('0x8')]?sequelize_utils_1[a207_0x1279('0x1e')][a207_0x1279('0x1f')](_0x33608d,_0x34e05b[a207_0x1279('0x20')][a207_0x1279('0x21')]):_0x33608d;if(_0x34dd79){_0x34dd79=_0x34dd79[a207_0x1279('0x25')];_0x34dd79=sequelize_utils_1['default'][a207_0x1279('0x22')](_0x34dd79);let _0x2571b4=process[a207_0x1279('0x26')]['IMAGE_FILES_FOLDER']+a207_0x1279('0x27')+this[a207_0x1279('0x7')][a207_0x1279('0x28')]+'_'+_0x34dd79['id']+a207_0x1279('0x29');if(!fsExtra[a207_0x1279('0x2a')](_0x2571b4)){_0x2571b4=process[a207_0x1279('0x26')][a207_0x1279('0x2b')]+a207_0x1279('0x27')+this[a207_0x1279('0x7')][a207_0x1279('0x28')]+'_'+_0x34dd79['id']+'.png';}let _0x5ef0ab=null;if(fsExtra[a207_0x1279('0x2a')](_0x2571b4)){_0x5ef0ab=base64Img[a207_0x1279('0x2c')](_0x2571b4);_0x34dd79=JSON[a207_0x1279('0x2d')](JSON['stringify'](_0x34dd79));_0x34dd79[a207_0x1279('0x2e')]=_0x5ef0ab;}delete _0x34dd79['created_by_user_id'];delete _0x34dd79['updated_by_user_id'];delete _0x34dd79[a207_0x1279('0x19')];delete _0x34dd79[a207_0x1279('0x1a')];delete _0x34dd79[a207_0x1279('0x1b')];delete _0x34dd79['deleted_at'];delete _0x34dd79['password'];}return _0xccff57[a207_0x1279('0xd')]({'success':!![],'data':_0x34dd79});})[a207_0x1279('0xe')](_0x3cfd6e=>{return _0xccff57[a207_0x1279('0xf')](0x1f4)['send']({'success':![],'data':_0x3cfd6e[a207_0x1279('0x11')]});});}[a207_0x1279('0x2f')](_0x292248,_0x74229f,_0x5ca842){if(!_0x292248[a207_0x1279('0xa')]){}this[a207_0x1279('0x7')][a207_0x1279('0x30')]({'attributes':{'exclude':[a207_0x1279('0x17'),a207_0x1279('0x31'),a207_0x1279('0x19'),'created_at',a207_0x1279('0x1b'),'deleted_at']},'where':{'uuid':_0x292248[a207_0x1279('0xc')][a207_0x1279('0x32')]}})[a207_0x1279('0x1d')](_0x14a9aa=>{let _0xc8ac0d=this['i18n']?sequelize_utils_1[a207_0x1279('0x1e')][a207_0x1279('0x1f')](_0x14a9aa,_0x292248[a207_0x1279('0x20')][a207_0x1279('0x21')]):_0x14a9aa;if(_0xc8ac0d){const _0x23ade5=process['env'][a207_0x1279('0x2b')]+a207_0x1279('0x27')+_0xc8ac0d['uuid']+'.jpg';let _0x3e435a=null;if(fsExtra[a207_0x1279('0x2a')](_0x23ade5)){_0x3e435a=base64Img[a207_0x1279('0x2c')](_0x23ade5);_0xc8ac0d=JSON[a207_0x1279('0x2d')](JSON[a207_0x1279('0x33')](_0xc8ac0d));_0xc8ac0d[a207_0x1279('0x2e')]=_0x3e435a;}}return _0x74229f[a207_0x1279('0xd')]({'success':!![],'data':_0xc8ac0d});})[a207_0x1279('0xe')](_0x14641d=>{return _0x74229f[a207_0x1279('0xf')](0x1f4)[a207_0x1279('0x10')]({'success':![],'data':_0x14641d['stack']});});}[a207_0x1279('0x34')](_0x4fce6e,_0x333c41,_0x5bf8da){if(!_0x4fce6e['user']){return responseUtils['errorResponse'](_0x333c41,'authentication\x20failed',0x191);}if(_0x4fce6e['body']['id']&&_0x4fce6e['body']['id']!=''){return this['findOneAndUpdate'](_0x4fce6e,_0x333c41,_0x5bf8da);}else{return this[a207_0x1279('0x35')](_0x4fce6e,_0x333c41);}}[a207_0x1279('0x35')](_0x948d72,_0x1187fe){if(!_0x948d72['user']){return responseUtils[a207_0x1279('0x16')](_0x1187fe,a207_0x1279('0xb'),0x191);}_0x948d72[a207_0x1279('0x36')]=sequelize_utils_1[a207_0x1279('0x1e')][a207_0x1279('0x37')](_0x948d72[a207_0x1279('0x36')]);_0x948d72[a207_0x1279('0x36')][a207_0x1279('0x17')]=_0x948d72[a207_0x1279('0xa')]['id'];if(_0x948d72[a207_0x1279('0x36')][a207_0x1279('0x38')]&&_0x948d72[a207_0x1279('0x36')][a207_0x1279('0x38')]!=''){_0x948d72[a207_0x1279('0x36')][a207_0x1279('0x38')]=crypt_utils_1[a207_0x1279('0x1e')][a207_0x1279('0x39')](_0x948d72[a207_0x1279('0x36')][a207_0x1279('0x38')]);}return this[a207_0x1279('0x7')][a207_0x1279('0x35')](_0x948d72[a207_0x1279('0x36')],this[a207_0x1279('0x8')]?{'language_id':_0x948d72['headers'][a207_0x1279('0x21')]}:{})[a207_0x1279('0x1d')](_0x2ef5aa=>{const _0x2df3aa=this[a207_0x1279('0x8')]?sequelize_utils_1['default'][a207_0x1279('0x1f')](_0x2ef5aa,_0x948d72[a207_0x1279('0x20')][a207_0x1279('0x21')]):_0x2ef5aa;this[a207_0x1279('0x3a')](_0x948d72,_0x2df3aa);delete _0x2df3aa['dataValues']['id'];delete _0x2df3aa[a207_0x1279('0x25')][a207_0x1279('0x17')];delete _0x2df3aa[a207_0x1279('0x25')]['updated_by_user_id'];delete _0x2df3aa[a207_0x1279('0x25')][a207_0x1279('0x19')];delete _0x2df3aa[a207_0x1279('0x25')][a207_0x1279('0x1a')];delete _0x2df3aa['dataValues'][a207_0x1279('0x1b')];delete _0x2df3aa[a207_0x1279('0x25')]['deleted_at'];delete _0x2df3aa['dataValues']['password'];if(_0x1187fe){return _0x1187fe['json']({'success':!![],'data':_0x2df3aa});}else{return _0x2df3aa;}})['catch'](_0x3d41d0=>{if(_0x1187fe){return _0x1187fe['status'](0x1f4)['send']({'success':![],'data':_0x3d41d0[a207_0x1279('0x11')]});}else{return _0x3d41d0[a207_0x1279('0x11')];}});}[a207_0x1279('0x3b')](_0x96f469,_0x1551f5,_0x315e89){if(!_0x96f469[a207_0x1279('0xa')]){return responseUtils[a207_0x1279('0x16')](_0x1551f5,a207_0x1279('0xb'),0x191);}_0x96f469[a207_0x1279('0x36')]=sequelize_utils_1[a207_0x1279('0x1e')][a207_0x1279('0x37')](_0x96f469[a207_0x1279('0x36')]);_0x96f469[a207_0x1279('0x36')][a207_0x1279('0x31')]=_0x96f469['user']['id'];if(_0x96f469[a207_0x1279('0x36')][a207_0x1279('0x38')]&&_0x96f469[a207_0x1279('0x36')][a207_0x1279('0x38')]!=''){_0x96f469[a207_0x1279('0x36')]['password']=crypt_utils_1[a207_0x1279('0x1e')][a207_0x1279('0x39')](_0x96f469['body'][a207_0x1279('0x38')]);}this['model'][a207_0x1279('0x3c')](_0x96f469[a207_0x1279('0x36')]['id'])['then'](_0xe1a9c0=>{if(_0xe1a9c0==null)return _0x1551f5[a207_0x1279('0xd')]({'success':!![],'data':_0xe1a9c0});_0xe1a9c0['update'](_0x96f469['body'],{'language_id':_0x96f469[a207_0x1279('0x20')]['lang']})[a207_0x1279('0x1d')](function(_0x410c51){const _0x4c650f=this[a207_0x1279('0x8')]?sequelize_utils_1['default'][a207_0x1279('0x1f')](_0xe1a9c0,_0x96f469['headers']['lang']):_0xe1a9c0;this[a207_0x1279('0x3a')](_0x96f469,_0x4c650f);delete _0x4c650f[a207_0x1279('0x25')]['id'];delete _0x4c650f[a207_0x1279('0x25')]['created_by_user_id'];delete _0x4c650f['dataValues'][a207_0x1279('0x31')];delete _0x4c650f['dataValues'][a207_0x1279('0x19')];delete _0x4c650f[a207_0x1279('0x25')][a207_0x1279('0x1a')];delete _0x4c650f[a207_0x1279('0x25')][a207_0x1279('0x1b')];delete _0x4c650f[a207_0x1279('0x25')][a207_0x1279('0x1c')];delete _0x4c650f[a207_0x1279('0x25')][a207_0x1279('0x38')];return _0x1551f5[a207_0x1279('0xd')]({'success':!![],'data':_0x4c650f});}[a207_0x1279('0x3d')](this))[a207_0x1279('0xe')](_0x482a01=>{return _0x1551f5[a207_0x1279('0xf')](0x1f4)[a207_0x1279('0x10')]({'success':![],'data':_0x482a01[a207_0x1279('0x11')]});});})[a207_0x1279('0xe')](_0x4cc2da=>{return _0x1551f5['status'](0x1f4)[a207_0x1279('0x10')]({'success':![],'data':_0x4cc2da['stack']});});}[a207_0x1279('0x3e')](_0x2a847b,_0x1e2e6d,_0x3b5710){if(!_0x2a847b[a207_0x1279('0xa')]){return _0x1e2e6d[a207_0x1279('0xf')](0x191)[a207_0x1279('0x10')]({'success':![],'data':a207_0x1279('0xb')});}if(_0x2a847b[a207_0x1279('0xa')]&&_0x2a847b[a207_0x1279('0xa')][a207_0x1279('0x3f')]>0x0){}console[a207_0x1279('0x40')](_0x2a847b[a207_0x1279('0xc')]);const _0x223c10=_0x2a847b[a207_0x1279('0x36')][a207_0x1279('0x32')]&&_0x2a847b[a207_0x1279('0x36')][a207_0x1279('0x32')]!=''?_0x2a847b['body'][a207_0x1279('0x32')]:_0x2a847b[a207_0x1279('0xc')][a207_0x1279('0x32')];this[a207_0x1279('0x7')][a207_0x1279('0x30')]({'where':{'uuid':_0x223c10}})[a207_0x1279('0x1d')](_0x1cd9a8=>{if(_0x1cd9a8==null)return _0x1e2e6d[a207_0x1279('0xd')]({'success':!![],'data':_0x1cd9a8});_0x1cd9a8[a207_0x1279('0x41')](_0x2a847b[a207_0x1279('0x36')],{'language_id':_0x2a847b['headers'][a207_0x1279('0x21')]})[a207_0x1279('0x1d')](function(_0x2cb2e1){const _0x5aec3e=this['i18n']?sequelize_utils_1[a207_0x1279('0x1e')]['toJSONLocalizedOnly'](_0x1cd9a8,_0x2a847b['headers'][a207_0x1279('0x21')]):_0x1cd9a8;this['saveImageFile'](_0x2a847b,_0x5aec3e);return _0x1e2e6d[a207_0x1279('0xd')]({'success':!![],'data':_0x5aec3e});}[a207_0x1279('0x3d')](this))[a207_0x1279('0xe')](_0xb6a4ed=>{return _0x1e2e6d[a207_0x1279('0xf')](0x1f4)[a207_0x1279('0x10')]({'success':![],'data':_0xb6a4ed[a207_0x1279('0x11')]});});})[a207_0x1279('0xe')](_0x5056ce=>{return _0x1e2e6d['status'](0x1f4)[a207_0x1279('0x10')]({'success':![],'data':_0x5056ce[a207_0x1279('0x11')]});});}[a207_0x1279('0x42')](_0x53995d,_0x264330,_0x3718c7,_0x146b47=![]){if(!_0x53995d[a207_0x1279('0xa')]){return _0x264330[a207_0x1279('0xf')](0x191)['send']({'success':![],'data':'authentication\x20failed'});}if(_0x53995d[a207_0x1279('0xa')]&&_0x53995d[a207_0x1279('0xa')][a207_0x1279('0x3f')]>0x0){}return this[a207_0x1279('0x7')][a207_0x1279('0x30')]({'where':_0x53995d['params']})[a207_0x1279('0x1d')](function(_0x3f60c8){if(_0x3f60c8){return _0x3f60c8[a207_0x1279('0x41')](_0x53995d[a207_0x1279('0x36')])[a207_0x1279('0x1d')](function(_0x265933){const _0x4645fa=_0x265933[a207_0x1279('0x25')];if(_0x146b47){delete _0x4645fa['id'];}if(_0x264330){return _0x264330[a207_0x1279('0xd')]({'success':!![],'data':_0x4645fa});}else{return _0x4645fa;}}['bind'](this));}else{return this['model'][a207_0x1279('0x35')](_0x53995d[a207_0x1279('0x36')])['then'](function(_0x205cc3){if(_0x264330){return _0x264330['json']({'success':!![],'data':_0x205cc3[a207_0x1279('0x43')]()});}else{return _0x205cc3;}});}}[a207_0x1279('0x3d')](this))[a207_0x1279('0xe')](_0x47e650=>{if(_0x264330){return _0x264330[a207_0x1279('0xf')](0x1f4)[a207_0x1279('0x10')]({'success':![],'data':_0x47e650['stack']});}else{return _0x47e650[a207_0x1279('0x11')];}});}[a207_0x1279('0x44')](_0x341581,_0x2ff2df,_0x4b8031){if(!_0x341581[a207_0x1279('0xa')]){return _0x2ff2df[a207_0x1279('0xf')](0x191)['send']({'success':![],'data':a207_0x1279('0xb')});}_0x341581[a207_0x1279('0x36')][a207_0x1279('0x17')]=_0x341581['user']['id'];return this[a207_0x1279('0x7')][a207_0x1279('0x44')]({'where':{'uuid':_0x341581[a207_0x1279('0x36')][a207_0x1279('0x32')]},'defaults':_0x341581['body']})['then']((_0x21c6e0,_0x3172b5)=>{if(_0x3172b5){}else{}return _0x2ff2df[a207_0x1279('0xd')]({'success':!![],'data':_0x21c6e0});})[a207_0x1279('0xe')](_0x38bc84=>{return _0x2ff2df[a207_0x1279('0xf')](0x1f4)['send']({'success':![],'data':_0x38bc84[a207_0x1279('0x11')]});});}[a207_0x1279('0x45')](_0x52b7d3,_0x5727f3,_0x2584c3){if(!_0x52b7d3[a207_0x1279('0xa')]||_0x52b7d3[a207_0x1279('0xa')][a207_0x1279('0x3f')]==0x0){return _0x5727f3[a207_0x1279('0xf')](0x191)[a207_0x1279('0x10')]({'success':![],'data':'authentication\x20failed'});}_0x52b7d3['params']['id']=sequelize_utils_1['default'][a207_0x1279('0x37')](_0x52b7d3[a207_0x1279('0xc')]['id']);this[a207_0x1279('0x7')][a207_0x1279('0x3c')](_0x52b7d3['params']['id'])[a207_0x1279('0x1d')](_0x5a4702=>{if(_0x5a4702==null)return _0x5727f3[a207_0x1279('0xd')]({'success':!![],'data':_0x5a4702});_0x5a4702[a207_0x1279('0x41')]({'deleted_by_user_id':_0x52b7d3[a207_0x1279('0xa')]['id']},{'language_id':_0x52b7d3[a207_0x1279('0x20')][a207_0x1279('0x21')]})[a207_0x1279('0x1d')](function(_0x1da231){_0x5a4702[a207_0x1279('0x46')]()[a207_0x1279('0x1d')](function(_0x5a4702){return _0x5727f3['json']({'success':!![],'data':_0x5a4702});})['catch'](_0x142165=>{return _0x5727f3[a207_0x1279('0xf')](0x1f4)['send']({'success':![],'data':_0x142165[a207_0x1279('0x11')]});});}['bind'](this))[a207_0x1279('0xe')](_0x2d696a=>{return _0x5727f3['status'](0x1f4)[a207_0x1279('0x10')]({'success':![],'data':_0x2d696a[a207_0x1279('0x11')]});});})[a207_0x1279('0xe')](_0x529740=>{return _0x5727f3[a207_0x1279('0xf')](0x1f4)['send']({'success':![],'data':_0x529740[a207_0x1279('0x11')]});});}[a207_0x1279('0x3a')](_0x48cf63,_0x4a9e8b){if(_0x48cf63[a207_0x1279('0x36')][a207_0x1279('0x2e')]&&_0x48cf63[a207_0x1279('0x36')][a207_0x1279('0x2e')]!=''){const _0x300739=process[a207_0x1279('0x26')][a207_0x1279('0x2b')]+a207_0x1279('0x27');const _0x4e641e=_0x48cf63[a207_0x1279('0x36')][a207_0x1279('0x2e')];let _0x4492c2='';const _0x2c7e7e=_0x4e641e[a207_0x1279('0x47')](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x4e641e['match'](/^data:image\/png;base64,/,'')){_0x4492c2=a207_0x1279('0x48');}else if(_0x4e641e[a207_0x1279('0x49')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x4492c2=a207_0x1279('0x4a');}const _0x5bb3a0=sequelize_utils_1['default'][a207_0x1279('0x22')](_0x4a9e8b[a207_0x1279('0x25')]['id']);fsExtra['ensureDirSync'](_0x300739);const _0xaabf78=''+_0x300739+this[a207_0x1279('0x7')][a207_0x1279('0x28')]+'_'+_0x5bb3a0+'.'+_0x4492c2;console[a207_0x1279('0x40')](a207_0x1279('0x4b'),_0xaabf78);fsExtra['writeFile'](_0xaabf78,_0x2c7e7e,a207_0x1279('0x4c'),function(_0x4442d9){console[a207_0x1279('0x40')](a207_0x1279('0x4d'),_0x4442d9);});}}}exports[a207_0x1279('0x1e')]=CrudUtils;