var a207_0x4041=['__esModule','./crypt-utils','fs-extra','../infrastructure/response-utils','count','user','errorResponse','authentication\x20failed','json','status','send','stack','find','offset','query','limit','params','created_by_user_id','findAll','updated_by_user_id','deleted_by_user_id','created_at','updated_at','i18n','toJSONLocalizedOnly','headers','lang','toJSON','encryptId','successResponse','catch','default','decryptId','model','findByPk','then','dataValues','env','IMAGE_FILES_FOLDER','name','.jpg','existsSync','images/','.png','base64Sync','parse','stringify','image_data','deleted_at','password','findByUuid','findOne','uuid','save','body','findOneAndUpdate','create','hashPassword','saveImageFile','update','bind','findUuidAndUpdate','updateOrCreate','length','findOrCreate','remove','replace','match','png','jpg','ensureDirSync','log','writeFile','base64','__importDefault'];(function(_0x4b1093,_0x8bcbcb){var _0x314ffc=function(_0x3babdc){while(--_0x3babdc){_0x4b1093['push'](_0x4b1093['shift']());}};_0x314ffc(++_0x8bcbcb);}(a207_0x4041,0x95));var a207_0x7534=function(_0x599703,_0xcf3a0f){_0x599703=_0x599703-0x0;var _0x371f41=a207_0x4041[_0x599703];return _0x371f41;};'use strict';var __importDefault=this&&this[a207_0x7534('0x0')]||function(_0x359526){return _0x359526&&_0x359526[a207_0x7534('0x1')]?_0x359526:{'default':_0x359526};};Object['defineProperty'](exports,a207_0x7534('0x1'),{'value':!![]});const sequelize_utils_1=__importDefault(require('./sequelize-utils'));const crypt_utils_1=__importDefault(require(a207_0x7534('0x2')));const authUtils=require('../infrastructure/auth-utils');const fsExtra=require(a207_0x7534('0x3'));const base64Img=require('base64-img');const responseUtils=require(a207_0x7534('0x4'));class CrudUtils{constructor(_0x53cff7,_0xe80326){this['model']=_0x53cff7;this['i18n']=_0xe80326;}[a207_0x7534('0x5')](_0x53e257,_0x4b77aa,_0x5357f4){if(!_0x53e257[a207_0x7534('0x6')]){return responseUtils[a207_0x7534('0x7')](_0x4b77aa,a207_0x7534('0x8'),0x191);}return this['model']['count']({'where':_0x53e257['params']})['then'](_0x58ef96=>{const _0x33a0b6=_0x58ef96;if(_0x4b77aa){return _0x4b77aa[a207_0x7534('0x9')]({'success':!![],'data':{'total':_0x58ef96}});}else{return _0x33a0b6;}})['catch'](_0x1d5aae=>{if(_0x4b77aa){return _0x4b77aa[a207_0x7534('0xa')](0x1f4)[a207_0x7534('0xb')]({'success':![],'data':_0x1d5aae[a207_0x7534('0xc')]});}else{return _0x1d5aae[a207_0x7534('0xc')];}});}[a207_0x7534('0xd')](_0x372234,_0x4463ff,_0x2156e4,_0x1c5dbf=![],_0x6eafd4=[],_0x1fc18a=null,_0x1038d9=![]){const _0x2c6afc=_0x372234['query'][a207_0x7534('0xe')]?Number(_0x372234[a207_0x7534('0xf')][a207_0x7534('0xe')]):null;const _0x10e5a7=_0x372234[a207_0x7534('0xf')][a207_0x7534('0x10')]?Number(_0x372234['query'][a207_0x7534('0x10')]):null;if(!_0x372234[a207_0x7534('0x6')]){return responseUtils[a207_0x7534('0x7')](_0x4463ff,'authentication\x20failed',0x191);}if(!_0x1038d9){_0x372234[a207_0x7534('0x11')][a207_0x7534('0x12')]=_0x372234[a207_0x7534('0x6')]['id'];}return this['model'][a207_0x7534('0x13')]({'attributes':{'exclude':_0x1c5dbf?[]:['created_by_user_id',a207_0x7534('0x14'),a207_0x7534('0x15'),a207_0x7534('0x16'),a207_0x7534('0x17'),'deleted_at']},'where':_0x372234[a207_0x7534('0x11')],'offset':_0x2c6afc,'limit':_0x10e5a7,'include':_0x6eafd4,'order':_0x1fc18a})['then'](_0x1a7e48=>{let _0x1b0bbd=this[a207_0x7534('0x18')]?sequelize_utils_1['default'][a207_0x7534('0x19')](_0x1a7e48,_0x372234[a207_0x7534('0x1a')][a207_0x7534('0x1b')]):sequelize_utils_1['default'][a207_0x7534('0x1c')](_0x1a7e48);_0x1b0bbd=sequelize_utils_1['default'][a207_0x7534('0x1d')](_0x1b0bbd);if(_0x4463ff){return responseUtils[a207_0x7534('0x1e')](_0x4463ff,_0x1b0bbd,0xc8);}else{return _0x1b0bbd;}})[a207_0x7534('0x1f')](_0x413f56=>{if(_0x4463ff){return responseUtils['errorResponse'](_0x4463ff,_0x413f56[a207_0x7534('0xc')],0x1f4);}else{return _0x413f56[a207_0x7534('0xc')];}});}['findById'](_0x43a1f8,_0x4f446e,_0x3e15fc){if(!_0x43a1f8[a207_0x7534('0x6')]){return responseUtils[a207_0x7534('0x7')](_0x4f446e,a207_0x7534('0x8'),0x191);}_0x43a1f8['params']['id']=sequelize_utils_1[a207_0x7534('0x20')][a207_0x7534('0x21')](_0x43a1f8[a207_0x7534('0x11')]['id']);this[a207_0x7534('0x22')][a207_0x7534('0x23')](_0x43a1f8['params']['id'])[a207_0x7534('0x24')](_0x180943=>{let _0x1a890c=this['i18n']?sequelize_utils_1[a207_0x7534('0x20')][a207_0x7534('0x19')](_0x180943,_0x43a1f8[a207_0x7534('0x1a')][a207_0x7534('0x1b')]):_0x180943;if(_0x1a890c){_0x1a890c=_0x1a890c[a207_0x7534('0x25')];_0x1a890c=sequelize_utils_1['default'][a207_0x7534('0x1d')](_0x1a890c);let _0x19bfd5=process[a207_0x7534('0x26')][a207_0x7534('0x27')]+'images/'+this[a207_0x7534('0x22')][a207_0x7534('0x28')]+'_'+_0x1a890c['id']+a207_0x7534('0x29');if(!fsExtra[a207_0x7534('0x2a')](_0x19bfd5)){_0x19bfd5=process[a207_0x7534('0x26')][a207_0x7534('0x27')]+a207_0x7534('0x2b')+this['model'][a207_0x7534('0x28')]+'_'+_0x1a890c['id']+a207_0x7534('0x2c');}let _0x58691b=null;if(fsExtra[a207_0x7534('0x2a')](_0x19bfd5)){_0x58691b=base64Img[a207_0x7534('0x2d')](_0x19bfd5);_0x1a890c=JSON[a207_0x7534('0x2e')](JSON[a207_0x7534('0x2f')](_0x1a890c));_0x1a890c[a207_0x7534('0x30')]=_0x58691b;}delete _0x1a890c[a207_0x7534('0x12')];delete _0x1a890c[a207_0x7534('0x14')];delete _0x1a890c['deleted_by_user_id'];delete _0x1a890c[a207_0x7534('0x16')];delete _0x1a890c['updated_at'];delete _0x1a890c[a207_0x7534('0x31')];delete _0x1a890c[a207_0x7534('0x32')];}return _0x4f446e[a207_0x7534('0x9')]({'success':!![],'data':_0x1a890c});})[a207_0x7534('0x1f')](_0x5c737e=>{return _0x4f446e[a207_0x7534('0xa')](0x1f4)['send']({'success':![],'data':_0x5c737e['stack']});});}[a207_0x7534('0x33')](_0x45513f,_0x51464c,_0x1e4513){if(!_0x45513f[a207_0x7534('0x6')]){}this['model'][a207_0x7534('0x34')]({'attributes':{'exclude':[a207_0x7534('0x12'),a207_0x7534('0x14'),a207_0x7534('0x15'),'created_at',a207_0x7534('0x17'),'deleted_at']},'where':{'uuid':_0x45513f[a207_0x7534('0x11')][a207_0x7534('0x35')]}})[a207_0x7534('0x24')](_0x549878=>{let _0x2d7fa2=this[a207_0x7534('0x18')]?sequelize_utils_1[a207_0x7534('0x20')]['toJSONLocalizedOnly'](_0x549878,_0x45513f['headers'][a207_0x7534('0x1b')]):_0x549878;if(_0x2d7fa2){const _0x42c8f4=process['env'][a207_0x7534('0x27')]+a207_0x7534('0x2b')+_0x2d7fa2[a207_0x7534('0x35')]+a207_0x7534('0x29');let _0x42e4bb=null;if(fsExtra[a207_0x7534('0x2a')](_0x42c8f4)){_0x42e4bb=base64Img['base64Sync'](_0x42c8f4);_0x2d7fa2=JSON['parse'](JSON['stringify'](_0x2d7fa2));_0x2d7fa2[a207_0x7534('0x30')]=_0x42e4bb;}}return _0x51464c[a207_0x7534('0x9')]({'success':!![],'data':_0x2d7fa2});})['catch'](_0xb74a00=>{return _0x51464c[a207_0x7534('0xa')](0x1f4)['send']({'success':![],'data':_0xb74a00[a207_0x7534('0xc')]});});}[a207_0x7534('0x36')](_0x4d9300,_0x38ca8c,_0x472d91){if(!_0x4d9300[a207_0x7534('0x6')]){return responseUtils[a207_0x7534('0x7')](_0x38ca8c,'authentication\x20failed',0x191);}if(_0x4d9300[a207_0x7534('0x37')]['id']&&_0x4d9300['body']['id']!=''){return this[a207_0x7534('0x38')](_0x4d9300,_0x38ca8c,_0x472d91);}else{return this['create'](_0x4d9300,_0x38ca8c);}}[a207_0x7534('0x39')](_0x22d1b0,_0x3df2a0){if(!_0x22d1b0['user']){return responseUtils[a207_0x7534('0x7')](_0x3df2a0,a207_0x7534('0x8'),0x191);}_0x22d1b0[a207_0x7534('0x37')]=sequelize_utils_1[a207_0x7534('0x20')]['decryptId'](_0x22d1b0['body']);_0x22d1b0[a207_0x7534('0x37')][a207_0x7534('0x12')]=_0x22d1b0[a207_0x7534('0x6')]['id'];if(_0x22d1b0[a207_0x7534('0x37')][a207_0x7534('0x32')]&&_0x22d1b0['body']['password']!=''){_0x22d1b0['body'][a207_0x7534('0x32')]=crypt_utils_1['default'][a207_0x7534('0x3a')](_0x22d1b0[a207_0x7534('0x37')][a207_0x7534('0x32')]);}return this[a207_0x7534('0x22')][a207_0x7534('0x39')](_0x22d1b0[a207_0x7534('0x37')],this[a207_0x7534('0x18')]?{'language_id':_0x22d1b0[a207_0x7534('0x1a')]['lang']}:{})[a207_0x7534('0x24')](_0x2ed931=>{const _0x376ff8=this['i18n']?sequelize_utils_1[a207_0x7534('0x20')][a207_0x7534('0x19')](_0x2ed931,_0x22d1b0[a207_0x7534('0x1a')][a207_0x7534('0x1b')]):_0x2ed931;this[a207_0x7534('0x3b')](_0x22d1b0,_0x376ff8);delete _0x376ff8[a207_0x7534('0x25')]['id'];delete _0x376ff8['dataValues'][a207_0x7534('0x12')];delete _0x376ff8[a207_0x7534('0x25')][a207_0x7534('0x14')];delete _0x376ff8[a207_0x7534('0x25')]['deleted_by_user_id'];delete _0x376ff8[a207_0x7534('0x25')][a207_0x7534('0x16')];delete _0x376ff8[a207_0x7534('0x25')][a207_0x7534('0x17')];delete _0x376ff8[a207_0x7534('0x25')][a207_0x7534('0x31')];delete _0x376ff8[a207_0x7534('0x25')][a207_0x7534('0x32')];if(_0x3df2a0){return _0x3df2a0[a207_0x7534('0x9')]({'success':!![],'data':_0x376ff8});}else{return _0x376ff8;}})[a207_0x7534('0x1f')](_0x4689eb=>{if(_0x3df2a0){return _0x3df2a0[a207_0x7534('0xa')](0x1f4)['send']({'success':![],'data':_0x4689eb[a207_0x7534('0xc')]});}else{return _0x4689eb['stack'];}});}[a207_0x7534('0x38')](_0xc11e9f,_0x365b9f,_0x4b14f3){if(!_0xc11e9f[a207_0x7534('0x6')]){return responseUtils[a207_0x7534('0x7')](_0x365b9f,a207_0x7534('0x8'),0x191);}_0xc11e9f['body']=sequelize_utils_1['default'][a207_0x7534('0x21')](_0xc11e9f['body']);_0xc11e9f[a207_0x7534('0x37')][a207_0x7534('0x14')]=_0xc11e9f['user']['id'];if(_0xc11e9f[a207_0x7534('0x37')][a207_0x7534('0x32')]&&_0xc11e9f[a207_0x7534('0x37')][a207_0x7534('0x32')]!=''){_0xc11e9f[a207_0x7534('0x37')][a207_0x7534('0x32')]=crypt_utils_1[a207_0x7534('0x20')]['hashPassword'](_0xc11e9f[a207_0x7534('0x37')][a207_0x7534('0x32')]);}this['model'][a207_0x7534('0x23')](_0xc11e9f['body']['id'])[a207_0x7534('0x24')](_0xb39ea5=>{if(_0xb39ea5==null)return _0x365b9f[a207_0x7534('0x9')]({'success':!![],'data':_0xb39ea5});_0xb39ea5[a207_0x7534('0x3c')](_0xc11e9f[a207_0x7534('0x37')],{'language_id':_0xc11e9f[a207_0x7534('0x1a')][a207_0x7534('0x1b')]})['then'](function(_0xc83b23){const _0x28f9be=this['i18n']?sequelize_utils_1[a207_0x7534('0x20')]['toJSONLocalizedOnly'](_0xb39ea5,_0xc11e9f[a207_0x7534('0x1a')]['lang']):_0xb39ea5;this[a207_0x7534('0x3b')](_0xc11e9f,_0x28f9be);delete _0x28f9be[a207_0x7534('0x25')]['id'];delete _0x28f9be[a207_0x7534('0x25')]['created_by_user_id'];delete _0x28f9be[a207_0x7534('0x25')][a207_0x7534('0x14')];delete _0x28f9be[a207_0x7534('0x25')][a207_0x7534('0x15')];delete _0x28f9be['dataValues'][a207_0x7534('0x16')];delete _0x28f9be[a207_0x7534('0x25')]['updated_at'];delete _0x28f9be[a207_0x7534('0x25')][a207_0x7534('0x31')];delete _0x28f9be[a207_0x7534('0x25')]['password'];return _0x365b9f['json']({'success':!![],'data':_0x28f9be});}[a207_0x7534('0x3d')](this))[a207_0x7534('0x1f')](_0x337f6b=>{return _0x365b9f['status'](0x1f4)['send']({'success':![],'data':_0x337f6b[a207_0x7534('0xc')]});});})[a207_0x7534('0x1f')](_0x19a7a8=>{return _0x365b9f['status'](0x1f4)[a207_0x7534('0xb')]({'success':![],'data':_0x19a7a8[a207_0x7534('0xc')]});});}[a207_0x7534('0x3e')](_0x5e27eb,_0x3c3edb,_0x5d0186){if(!_0x5e27eb[a207_0x7534('0x6')]){return _0x3c3edb[a207_0x7534('0xa')](0x191)[a207_0x7534('0xb')]({'success':![],'data':a207_0x7534('0x8')});}if(_0x5e27eb[a207_0x7534('0x6')]&&_0x5e27eb['user']['length']>0x0){}console['log'](_0x5e27eb['params']);const _0x3fa249=_0x5e27eb[a207_0x7534('0x37')][a207_0x7534('0x35')]&&_0x5e27eb[a207_0x7534('0x37')][a207_0x7534('0x35')]!=''?_0x5e27eb[a207_0x7534('0x37')][a207_0x7534('0x35')]:_0x5e27eb[a207_0x7534('0x11')][a207_0x7534('0x35')];this[a207_0x7534('0x22')]['findOne']({'where':{'uuid':_0x3fa249}})[a207_0x7534('0x24')](_0x29cac9=>{if(_0x29cac9==null)return _0x3c3edb[a207_0x7534('0x9')]({'success':!![],'data':_0x29cac9});_0x29cac9[a207_0x7534('0x3c')](_0x5e27eb[a207_0x7534('0x37')],{'language_id':_0x5e27eb[a207_0x7534('0x1a')][a207_0x7534('0x1b')]})[a207_0x7534('0x24')](function(_0x19bdf7){const _0x32d932=this[a207_0x7534('0x18')]?sequelize_utils_1[a207_0x7534('0x20')][a207_0x7534('0x19')](_0x29cac9,_0x5e27eb[a207_0x7534('0x1a')]['lang']):_0x29cac9;this['saveImageFile'](_0x5e27eb,_0x32d932);return _0x3c3edb['json']({'success':!![],'data':_0x32d932});}['bind'](this))[a207_0x7534('0x1f')](_0x31cafe=>{return _0x3c3edb[a207_0x7534('0xa')](0x1f4)['send']({'success':![],'data':_0x31cafe[a207_0x7534('0xc')]});});})['catch'](_0xe131ac=>{return _0x3c3edb['status'](0x1f4)[a207_0x7534('0xb')]({'success':![],'data':_0xe131ac['stack']});});}[a207_0x7534('0x3f')](_0x4ae164,_0x10a3e8,_0xe567f3,_0x2b47c3=![]){if(!_0x4ae164[a207_0x7534('0x6')]){return _0x10a3e8[a207_0x7534('0xa')](0x191)[a207_0x7534('0xb')]({'success':![],'data':'authentication\x20failed'});}if(_0x4ae164[a207_0x7534('0x6')]&&_0x4ae164['user'][a207_0x7534('0x40')]>0x0){}return this[a207_0x7534('0x22')][a207_0x7534('0x34')]({'where':_0x4ae164['params']})[a207_0x7534('0x24')](function(_0x107aca){if(_0x107aca){return _0x107aca[a207_0x7534('0x3c')](_0x4ae164[a207_0x7534('0x37')])[a207_0x7534('0x24')](function(_0x15868e){const _0x5de2ec=_0x15868e[a207_0x7534('0x25')];if(_0x2b47c3){delete _0x5de2ec['id'];}if(_0x10a3e8){return _0x10a3e8[a207_0x7534('0x9')]({'success':!![],'data':_0x5de2ec});}else{return _0x5de2ec;}}['bind'](this));}else{return this[a207_0x7534('0x22')][a207_0x7534('0x39')](_0x4ae164[a207_0x7534('0x37')])[a207_0x7534('0x24')](function(_0x284dd9){if(_0x10a3e8){return _0x10a3e8['json']({'success':!![],'data':_0x284dd9[a207_0x7534('0x1c')]()});}else{return _0x284dd9;}});}}[a207_0x7534('0x3d')](this))[a207_0x7534('0x1f')](_0x3cf2be=>{if(_0x10a3e8){return _0x10a3e8[a207_0x7534('0xa')](0x1f4)[a207_0x7534('0xb')]({'success':![],'data':_0x3cf2be[a207_0x7534('0xc')]});}else{return _0x3cf2be['stack'];}});}[a207_0x7534('0x41')](_0x2c9e70,_0x55f902,_0x2d04bb){if(!_0x2c9e70[a207_0x7534('0x6')]){return _0x55f902[a207_0x7534('0xa')](0x191)[a207_0x7534('0xb')]({'success':![],'data':a207_0x7534('0x8')});}_0x2c9e70['body'][a207_0x7534('0x12')]=_0x2c9e70[a207_0x7534('0x6')]['id'];return this[a207_0x7534('0x22')][a207_0x7534('0x41')]({'where':{'uuid':_0x2c9e70[a207_0x7534('0x37')][a207_0x7534('0x35')]},'defaults':_0x2c9e70[a207_0x7534('0x37')]})[a207_0x7534('0x24')]((_0xa3c3e,_0x4def8f)=>{if(_0x4def8f){}else{}return _0x55f902[a207_0x7534('0x9')]({'success':!![],'data':_0xa3c3e});})[a207_0x7534('0x1f')](_0x2525fd=>{return _0x55f902[a207_0x7534('0xa')](0x1f4)[a207_0x7534('0xb')]({'success':![],'data':_0x2525fd['stack']});});}[a207_0x7534('0x42')](_0x9570ec,_0x1bad99,_0x3f3519){if(!_0x9570ec[a207_0x7534('0x6')]||_0x9570ec[a207_0x7534('0x6')][a207_0x7534('0x40')]==0x0){return _0x1bad99[a207_0x7534('0xa')](0x191)['send']({'success':![],'data':a207_0x7534('0x8')});}_0x9570ec[a207_0x7534('0x11')]['id']=sequelize_utils_1[a207_0x7534('0x20')][a207_0x7534('0x21')](_0x9570ec[a207_0x7534('0x11')]['id']);this['model'][a207_0x7534('0x23')](_0x9570ec[a207_0x7534('0x11')]['id'])[a207_0x7534('0x24')](_0x4b470f=>{if(_0x4b470f==null)return _0x1bad99['json']({'success':!![],'data':_0x4b470f});_0x4b470f[a207_0x7534('0x3c')]({'deleted_by_user_id':_0x9570ec[a207_0x7534('0x6')]['id']},{'language_id':_0x9570ec[a207_0x7534('0x1a')][a207_0x7534('0x1b')]})[a207_0x7534('0x24')](function(_0x27cd6c){_0x4b470f['destroy']()[a207_0x7534('0x24')](function(_0x4b470f){return _0x1bad99[a207_0x7534('0x9')]({'success':!![],'data':_0x4b470f});})[a207_0x7534('0x1f')](_0x3f76bb=>{return _0x1bad99[a207_0x7534('0xa')](0x1f4)[a207_0x7534('0xb')]({'success':![],'data':_0x3f76bb[a207_0x7534('0xc')]});});}[a207_0x7534('0x3d')](this))['catch'](_0x233298=>{return _0x1bad99[a207_0x7534('0xa')](0x1f4)[a207_0x7534('0xb')]({'success':![],'data':_0x233298[a207_0x7534('0xc')]});});})[a207_0x7534('0x1f')](_0x32faed=>{return _0x1bad99[a207_0x7534('0xa')](0x1f4)['send']({'success':![],'data':_0x32faed[a207_0x7534('0xc')]});});}['saveImageFile'](_0x23b209,_0x28e129){if(_0x23b209[a207_0x7534('0x37')]['image_data']&&_0x23b209['body'][a207_0x7534('0x30')]!=''){const _0x37b3b0=process[a207_0x7534('0x26')][a207_0x7534('0x27')]+'images/';const _0x518b7f=_0x23b209[a207_0x7534('0x37')][a207_0x7534('0x30')];let _0x455036='';const _0x1ec78e=_0x518b7f[a207_0x7534('0x43')](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x518b7f[a207_0x7534('0x44')](/^data:image\/png;base64,/,'')){_0x455036=a207_0x7534('0x45');}else if(_0x518b7f[a207_0x7534('0x44')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x455036=a207_0x7534('0x46');}const _0x571a40=sequelize_utils_1[a207_0x7534('0x20')]['encryptId'](_0x28e129[a207_0x7534('0x25')]['id']);fsExtra[a207_0x7534('0x47')](_0x37b3b0);const _0x244221=''+_0x37b3b0+this[a207_0x7534('0x22')][a207_0x7534('0x28')]+'_'+_0x571a40+'.'+_0x455036;console[a207_0x7534('0x48')]('fileName',_0x244221);fsExtra[a207_0x7534('0x49')](_0x244221,_0x1ec78e,a207_0x7534('0x4a'),function(_0x81612c){console[a207_0x7534('0x48')]('err:',_0x81612c);});}}}exports[a207_0x7534('0x20')]=CrudUtils;