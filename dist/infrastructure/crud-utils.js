var a207_0x5f57=['dataValues','hashPassword','findByPk','update','saveImageFile','bind','findUuidAndUpdate','length','updateOrCreate','findOrCreate','remove','destroy','replace','match','png','jpg','encryptId','fileName','writeFile','__importDefault','__esModule','defineProperty','./crypt-utils','fs-extra','../infrastructure/response-utils','i18n','count','errorResponse','authentication\x20failed','params','then','json','catch','status','send','stack','offset','query','limit','user','created_by_user_id','log','model','findAll','updated_by_user_id','deleted_by_user_id','created_at','deleted_at','default','toJSONLocalizedOnly','lang','toJSON','successResponse','findById','decryptId','env','IMAGE_FILES_FOLDER','images/','name','existsSync','.png','base64Sync','parse','stringify','password','findByUuid','findOne','updated_at','uuid','headers','.jpg','image_data','body','findOneAndUpdate','create'];(function(_0x25e520,_0x51003c){var _0x1a7c87=function(_0x54c867){while(--_0x54c867){_0x25e520['push'](_0x25e520['shift']());}};_0x1a7c87(++_0x51003c);}(a207_0x5f57,0xa9));var a207_0x2052=function(_0x438a48,_0x4f2a5b){_0x438a48=_0x438a48-0x0;var _0x425aa7=a207_0x5f57[_0x438a48];return _0x425aa7;};'use strict';var __importDefault=this&&this[a207_0x2052('0x0')]||function(_0x3d133e){return _0x3d133e&&_0x3d133e[a207_0x2052('0x1')]?_0x3d133e:{'default':_0x3d133e};};Object[a207_0x2052('0x2')](exports,a207_0x2052('0x1'),{'value':!![]});const sequelize_utils_1=__importDefault(require('./sequelize-utils'));const crypt_utils_1=__importDefault(require(a207_0x2052('0x3')));const authUtils=require('../infrastructure/auth-utils');const fsExtra=require(a207_0x2052('0x4'));const base64Img=require('base64-img');const responseUtils=require(a207_0x2052('0x5'));class CrudUtils{constructor(_0x2cf39e,_0x17920b){this['model']=_0x2cf39e;this[a207_0x2052('0x6')]=_0x17920b;}[a207_0x2052('0x7')](_0x371704,_0x47c7b2,_0x5b65c6){if(!_0x371704['user']){return responseUtils[a207_0x2052('0x8')](_0x47c7b2,a207_0x2052('0x9'),0x191);}return this['model'][a207_0x2052('0x7')]({'where':_0x371704[a207_0x2052('0xa')]})[a207_0x2052('0xb')](_0xcbcc70=>{const _0x53f274=_0xcbcc70;if(_0x47c7b2){return _0x47c7b2[a207_0x2052('0xc')]({'success':!![],'data':{'total':_0xcbcc70}});}else{return _0x53f274;}})[a207_0x2052('0xd')](_0x293f0a=>{if(_0x47c7b2){return _0x47c7b2[a207_0x2052('0xe')](0x1f4)[a207_0x2052('0xf')]({'success':![],'data':_0x293f0a[a207_0x2052('0x10')]});}else{return _0x293f0a['stack'];}});}['find'](_0x12dfcb,_0x3dfc52,_0x1766f1,_0x289eb9=![],_0x56df3f=[],_0x5e20e9=null,_0x24daf8=![]){const _0x375683=_0x12dfcb['query'][a207_0x2052('0x11')]?Number(_0x12dfcb[a207_0x2052('0x12')]['offset']):null;const _0x33b759=_0x12dfcb[a207_0x2052('0x12')][a207_0x2052('0x13')]?Number(_0x12dfcb[a207_0x2052('0x12')][a207_0x2052('0x13')]):null;if(!_0x12dfcb[a207_0x2052('0x14')]){return responseUtils['errorResponse'](_0x3dfc52,a207_0x2052('0x9'),0x191);}if(!_0x24daf8){_0x12dfcb[a207_0x2052('0xa')][a207_0x2052('0x15')]=_0x12dfcb[a207_0x2052('0x14')]['id'];}console[a207_0x2052('0x16')]('shared',_0x24daf8);console[a207_0x2052('0x16')]('req.params',_0x12dfcb[a207_0x2052('0xa')]);return this[a207_0x2052('0x17')][a207_0x2052('0x18')]({'attributes':{'exclude':_0x289eb9?[]:[a207_0x2052('0x15'),a207_0x2052('0x19'),a207_0x2052('0x1a'),a207_0x2052('0x1b'),'updated_at',a207_0x2052('0x1c')]},'where':_0x12dfcb['params'],'offset':_0x375683,'limit':_0x33b759,'include':_0x56df3f,'order':_0x5e20e9})[a207_0x2052('0xb')](_0x20ddd1=>{let _0x3218cd=this['i18n']?sequelize_utils_1[a207_0x2052('0x1d')][a207_0x2052('0x1e')](_0x20ddd1,_0x12dfcb['headers'][a207_0x2052('0x1f')]):sequelize_utils_1[a207_0x2052('0x1d')][a207_0x2052('0x20')](_0x20ddd1);_0x3218cd=sequelize_utils_1[a207_0x2052('0x1d')]['encryptId'](_0x3218cd);if(_0x3dfc52){return responseUtils[a207_0x2052('0x21')](_0x3dfc52,_0x3218cd,0xc8);}else{return _0x3218cd;}})['catch'](_0x549d30=>{if(_0x3dfc52){return responseUtils[a207_0x2052('0x8')](_0x3dfc52,_0x549d30[a207_0x2052('0x10')],0x1f4);}else{return _0x549d30[a207_0x2052('0x10')];}});}[a207_0x2052('0x22')](_0x246818,_0x360773,_0x538f3d){if(!_0x246818[a207_0x2052('0x14')]){return responseUtils[a207_0x2052('0x8')](_0x360773,'authentication\x20failed',0x191);}_0x246818[a207_0x2052('0xa')]['id']=sequelize_utils_1[a207_0x2052('0x1d')][a207_0x2052('0x23')](_0x246818[a207_0x2052('0xa')]['id']);this[a207_0x2052('0x17')]['findByPk'](_0x246818['params']['id'])['then'](_0x4ff49c=>{let _0x4a5cac=this[a207_0x2052('0x6')]?sequelize_utils_1[a207_0x2052('0x1d')][a207_0x2052('0x1e')](_0x4ff49c,_0x246818['headers'][a207_0x2052('0x1f')]):_0x4ff49c;if(_0x4a5cac){_0x4a5cac=_0x4a5cac['dataValues'];_0x4a5cac=sequelize_utils_1[a207_0x2052('0x1d')]['encryptId'](_0x4a5cac);let _0x32deb1=process[a207_0x2052('0x24')][a207_0x2052('0x25')]+a207_0x2052('0x26')+this[a207_0x2052('0x17')][a207_0x2052('0x27')]+'_'+_0x4a5cac['id']+'.jpg';if(!fsExtra[a207_0x2052('0x28')](_0x32deb1)){_0x32deb1=process[a207_0x2052('0x24')]['IMAGE_FILES_FOLDER']+a207_0x2052('0x26')+this[a207_0x2052('0x17')][a207_0x2052('0x27')]+'_'+_0x4a5cac['id']+a207_0x2052('0x29');}let _0x46872b=null;if(fsExtra[a207_0x2052('0x28')](_0x32deb1)){_0x46872b=base64Img[a207_0x2052('0x2a')](_0x32deb1);_0x4a5cac=JSON[a207_0x2052('0x2b')](JSON[a207_0x2052('0x2c')](_0x4a5cac));_0x4a5cac['image_data']=_0x46872b;}delete _0x4a5cac['created_by_user_id'];delete _0x4a5cac[a207_0x2052('0x19')];delete _0x4a5cac[a207_0x2052('0x1a')];delete _0x4a5cac[a207_0x2052('0x1b')];delete _0x4a5cac['updated_at'];delete _0x4a5cac[a207_0x2052('0x1c')];delete _0x4a5cac[a207_0x2052('0x2d')];}return _0x360773[a207_0x2052('0xc')]({'success':!![],'data':_0x4a5cac});})[a207_0x2052('0xd')](_0x606248=>{return _0x360773[a207_0x2052('0xe')](0x1f4)[a207_0x2052('0xf')]({'success':![],'data':_0x606248['stack']});});}[a207_0x2052('0x2e')](_0x4fe9ec,_0x55c217,_0x3989f3){if(!_0x4fe9ec[a207_0x2052('0x14')]){}this[a207_0x2052('0x17')][a207_0x2052('0x2f')]({'attributes':{'exclude':[a207_0x2052('0x15'),'updated_by_user_id',a207_0x2052('0x1a'),'created_at',a207_0x2052('0x30'),a207_0x2052('0x1c')]},'where':{'uuid':_0x4fe9ec['params'][a207_0x2052('0x31')]}})['then'](_0x6d38ac=>{let _0x151029=this[a207_0x2052('0x6')]?sequelize_utils_1[a207_0x2052('0x1d')][a207_0x2052('0x1e')](_0x6d38ac,_0x4fe9ec[a207_0x2052('0x32')][a207_0x2052('0x1f')]):_0x6d38ac;if(_0x151029){const _0x435550=process[a207_0x2052('0x24')][a207_0x2052('0x25')]+'images/'+_0x151029[a207_0x2052('0x31')]+a207_0x2052('0x33');let _0x7293d7=null;if(fsExtra[a207_0x2052('0x28')](_0x435550)){_0x7293d7=base64Img[a207_0x2052('0x2a')](_0x435550);_0x151029=JSON['parse'](JSON[a207_0x2052('0x2c')](_0x151029));_0x151029[a207_0x2052('0x34')]=_0x7293d7;}}return _0x55c217[a207_0x2052('0xc')]({'success':!![],'data':_0x151029});})[a207_0x2052('0xd')](_0x31bbc7=>{return _0x55c217[a207_0x2052('0xe')](0x1f4)['send']({'success':![],'data':_0x31bbc7['stack']});});}['save'](_0x2ef519,_0x1fe29a,_0x5a5a81){if(!_0x2ef519[a207_0x2052('0x14')]){return responseUtils['errorResponse'](_0x1fe29a,a207_0x2052('0x9'),0x191);}if(_0x2ef519['body']['id']&&_0x2ef519[a207_0x2052('0x35')]['id']!=''){return this[a207_0x2052('0x36')](_0x2ef519,_0x1fe29a,_0x5a5a81);}else{return this[a207_0x2052('0x37')](_0x2ef519,_0x1fe29a);}}[a207_0x2052('0x37')](_0x1b0ce4,_0x487c32){if(!_0x1b0ce4[a207_0x2052('0x14')]){return responseUtils['errorResponse'](_0x487c32,a207_0x2052('0x9'),0x191);}_0x1b0ce4['body']=sequelize_utils_1['default'][a207_0x2052('0x23')](_0x1b0ce4[a207_0x2052('0x35')]);_0x1b0ce4[a207_0x2052('0x35')]['created_by_user_id']=_0x1b0ce4[a207_0x2052('0x14')]['id'];if(_0x1b0ce4[a207_0x2052('0x35')][a207_0x2052('0x2d')]&&_0x1b0ce4[a207_0x2052('0x35')][a207_0x2052('0x2d')]!=''){_0x1b0ce4[a207_0x2052('0x35')][a207_0x2052('0x2d')]=crypt_utils_1['default']['hashPassword'](_0x1b0ce4['body']['password']);}return this['model']['create'](_0x1b0ce4[a207_0x2052('0x35')],this['i18n']?{'language_id':_0x1b0ce4[a207_0x2052('0x32')]['lang']}:{})['then'](_0x337408=>{const _0x195e77=this[a207_0x2052('0x6')]?sequelize_utils_1[a207_0x2052('0x1d')][a207_0x2052('0x1e')](_0x337408,_0x1b0ce4['headers'][a207_0x2052('0x1f')]):_0x337408;this['saveImageFile'](_0x1b0ce4,_0x195e77);delete _0x195e77[a207_0x2052('0x38')]['id'];delete _0x195e77[a207_0x2052('0x38')]['created_by_user_id'];delete _0x195e77[a207_0x2052('0x38')][a207_0x2052('0x19')];delete _0x195e77['dataValues']['deleted_by_user_id'];delete _0x195e77['dataValues']['created_at'];delete _0x195e77['dataValues']['updated_at'];delete _0x195e77['dataValues'][a207_0x2052('0x1c')];delete _0x195e77[a207_0x2052('0x38')]['password'];if(_0x487c32){return _0x487c32[a207_0x2052('0xc')]({'success':!![],'data':_0x195e77});}else{return _0x195e77;}})[a207_0x2052('0xd')](_0x44ff12=>{if(_0x487c32){return _0x487c32[a207_0x2052('0xe')](0x1f4)[a207_0x2052('0xf')]({'success':![],'data':_0x44ff12[a207_0x2052('0x10')]});}else{return _0x44ff12['stack'];}});}[a207_0x2052('0x36')](_0x1cc40f,_0x1db131,_0x5c813a){if(!_0x1cc40f[a207_0x2052('0x14')]){return responseUtils['errorResponse'](_0x1db131,'authentication\x20failed',0x191);}_0x1cc40f[a207_0x2052('0x35')]=sequelize_utils_1[a207_0x2052('0x1d')][a207_0x2052('0x23')](_0x1cc40f[a207_0x2052('0x35')]);_0x1cc40f['body'][a207_0x2052('0x19')]=_0x1cc40f[a207_0x2052('0x14')]['id'];if(_0x1cc40f[a207_0x2052('0x35')]['password']&&_0x1cc40f[a207_0x2052('0x35')][a207_0x2052('0x2d')]!=''){_0x1cc40f['body'][a207_0x2052('0x2d')]=crypt_utils_1[a207_0x2052('0x1d')][a207_0x2052('0x39')](_0x1cc40f[a207_0x2052('0x35')][a207_0x2052('0x2d')]);}this[a207_0x2052('0x17')][a207_0x2052('0x3a')](_0x1cc40f['body']['id'])[a207_0x2052('0xb')](_0x285915=>{if(_0x285915==null)return _0x1db131['json']({'success':!![],'data':_0x285915});_0x285915[a207_0x2052('0x3b')](_0x1cc40f['body'],{'language_id':_0x1cc40f[a207_0x2052('0x32')][a207_0x2052('0x1f')]})[a207_0x2052('0xb')](function(_0xc011d2){const _0x44f4c1=this[a207_0x2052('0x6')]?sequelize_utils_1[a207_0x2052('0x1d')][a207_0x2052('0x1e')](_0x285915,_0x1cc40f[a207_0x2052('0x32')][a207_0x2052('0x1f')]):_0x285915;this[a207_0x2052('0x3c')](_0x1cc40f,_0x44f4c1);delete _0x44f4c1[a207_0x2052('0x38')]['id'];delete _0x44f4c1[a207_0x2052('0x38')][a207_0x2052('0x15')];delete _0x44f4c1['dataValues'][a207_0x2052('0x19')];delete _0x44f4c1['dataValues'][a207_0x2052('0x1a')];delete _0x44f4c1[a207_0x2052('0x38')][a207_0x2052('0x1b')];delete _0x44f4c1[a207_0x2052('0x38')][a207_0x2052('0x30')];delete _0x44f4c1[a207_0x2052('0x38')]['deleted_at'];delete _0x44f4c1[a207_0x2052('0x38')][a207_0x2052('0x2d')];return _0x1db131[a207_0x2052('0xc')]({'success':!![],'data':_0x44f4c1});}[a207_0x2052('0x3d')](this))['catch'](_0x3e39e7=>{return _0x1db131['status'](0x1f4)[a207_0x2052('0xf')]({'success':![],'data':_0x3e39e7[a207_0x2052('0x10')]});});})[a207_0x2052('0xd')](_0x282401=>{return _0x1db131[a207_0x2052('0xe')](0x1f4)[a207_0x2052('0xf')]({'success':![],'data':_0x282401[a207_0x2052('0x10')]});});}[a207_0x2052('0x3e')](_0x57ceb5,_0x15cb92,_0x1a49aa){if(!_0x57ceb5[a207_0x2052('0x14')]){return _0x15cb92[a207_0x2052('0xe')](0x191)[a207_0x2052('0xf')]({'success':![],'data':a207_0x2052('0x9')});}if(_0x57ceb5['user']&&_0x57ceb5['user'][a207_0x2052('0x3f')]>0x0){}console['log'](_0x57ceb5[a207_0x2052('0xa')]);const _0x379db5=_0x57ceb5[a207_0x2052('0x35')][a207_0x2052('0x31')]&&_0x57ceb5[a207_0x2052('0x35')][a207_0x2052('0x31')]!=''?_0x57ceb5[a207_0x2052('0x35')]['uuid']:_0x57ceb5[a207_0x2052('0xa')][a207_0x2052('0x31')];this[a207_0x2052('0x17')][a207_0x2052('0x2f')]({'where':{'uuid':_0x379db5}})[a207_0x2052('0xb')](_0xe82e15=>{if(_0xe82e15==null)return _0x15cb92[a207_0x2052('0xc')]({'success':!![],'data':_0xe82e15});_0xe82e15['update'](_0x57ceb5[a207_0x2052('0x35')],{'language_id':_0x57ceb5[a207_0x2052('0x32')][a207_0x2052('0x1f')]})[a207_0x2052('0xb')](function(_0x4cefa7){const _0x486d7e=this[a207_0x2052('0x6')]?sequelize_utils_1[a207_0x2052('0x1d')][a207_0x2052('0x1e')](_0xe82e15,_0x57ceb5[a207_0x2052('0x32')]['lang']):_0xe82e15;this[a207_0x2052('0x3c')](_0x57ceb5,_0x486d7e);return _0x15cb92[a207_0x2052('0xc')]({'success':!![],'data':_0x486d7e});}[a207_0x2052('0x3d')](this))[a207_0x2052('0xd')](_0x43b131=>{return _0x15cb92[a207_0x2052('0xe')](0x1f4)[a207_0x2052('0xf')]({'success':![],'data':_0x43b131['stack']});});})[a207_0x2052('0xd')](_0xac04e=>{return _0x15cb92[a207_0x2052('0xe')](0x1f4)['send']({'success':![],'data':_0xac04e[a207_0x2052('0x10')]});});}[a207_0x2052('0x40')](_0x1810ac,_0x19afef,_0x4865a5,_0x4f1787=![],_0x5491fd=![]){if(!_0x1810ac[a207_0x2052('0x14')]&&!_0x5491fd){return responseUtils[a207_0x2052('0x8')](_0x19afef,a207_0x2052('0x9'),0x191);}if(_0x1810ac[a207_0x2052('0x14')]&&_0x1810ac['user'][a207_0x2052('0x3f')]>0x0){}return this[a207_0x2052('0x17')][a207_0x2052('0x2f')]({'where':_0x1810ac[a207_0x2052('0xa')]})[a207_0x2052('0xb')](function(_0x41b678){if(_0x41b678){return _0x41b678[a207_0x2052('0x3b')](_0x1810ac[a207_0x2052('0x35')])[a207_0x2052('0xb')](function(_0x1c715f){const _0x41a727=_0x1c715f[a207_0x2052('0x38')];if(!_0x4f1787){delete _0x41a727['id'];}if(_0x19afef){return _0x19afef[a207_0x2052('0xc')]({'success':!![],'data':_0x41a727});}else{return _0x41a727;}}[a207_0x2052('0x3d')](this));}else{return this[a207_0x2052('0x17')]['create'](_0x1810ac[a207_0x2052('0x35')])['then'](function(_0x28bb94){if(_0x19afef){return _0x19afef[a207_0x2052('0xc')]({'success':!![],'data':_0x28bb94[a207_0x2052('0x20')]()});}else{return _0x28bb94;}});}}[a207_0x2052('0x3d')](this))['catch'](_0x3c9f4a=>{if(_0x19afef){return _0x19afef[a207_0x2052('0xe')](0x1f4)['send']({'success':![],'data':_0x3c9f4a['stack']});}else{return _0x3c9f4a[a207_0x2052('0x10')];}});}['findOrCreate'](_0x4e2428,_0x4277b1,_0x24ea84){if(!_0x4e2428[a207_0x2052('0x14')]){return _0x4277b1[a207_0x2052('0xe')](0x191)[a207_0x2052('0xf')]({'success':![],'data':a207_0x2052('0x9')});}_0x4e2428[a207_0x2052('0x35')][a207_0x2052('0x15')]=_0x4e2428[a207_0x2052('0x14')]['id'];return this[a207_0x2052('0x17')][a207_0x2052('0x41')]({'where':{'uuid':_0x4e2428[a207_0x2052('0x35')][a207_0x2052('0x31')]},'defaults':_0x4e2428[a207_0x2052('0x35')]})[a207_0x2052('0xb')]((_0x336740,_0x4d66ac)=>{if(_0x4d66ac){}else{}return _0x4277b1['json']({'success':!![],'data':_0x336740});})['catch'](_0x5e17d4=>{return _0x4277b1[a207_0x2052('0xe')](0x1f4)[a207_0x2052('0xf')]({'success':![],'data':_0x5e17d4[a207_0x2052('0x10')]});});}[a207_0x2052('0x42')](_0x568cd4,_0x665578,_0x4d471d){if(!_0x568cd4[a207_0x2052('0x14')]||_0x568cd4[a207_0x2052('0x14')][a207_0x2052('0x3f')]==0x0){return _0x665578[a207_0x2052('0xe')](0x191)[a207_0x2052('0xf')]({'success':![],'data':a207_0x2052('0x9')});}_0x568cd4[a207_0x2052('0xa')]['id']=sequelize_utils_1[a207_0x2052('0x1d')]['decryptId'](_0x568cd4['params']['id']);this[a207_0x2052('0x17')]['findByPk'](_0x568cd4[a207_0x2052('0xa')]['id'])[a207_0x2052('0xb')](_0x399826=>{if(_0x399826==null)return _0x665578['json']({'success':!![],'data':_0x399826});_0x399826[a207_0x2052('0x3b')]({'deleted_by_user_id':_0x568cd4[a207_0x2052('0x14')]['id']},{'language_id':_0x568cd4['headers'][a207_0x2052('0x1f')]})[a207_0x2052('0xb')](function(_0x573331){_0x399826[a207_0x2052('0x43')]()[a207_0x2052('0xb')](function(_0x399826){return _0x665578['json']({'success':!![],'data':_0x399826});})[a207_0x2052('0xd')](_0x39803c=>{return _0x665578['status'](0x1f4)['send']({'success':![],'data':_0x39803c[a207_0x2052('0x10')]});});}[a207_0x2052('0x3d')](this))[a207_0x2052('0xd')](_0x452810=>{return _0x665578[a207_0x2052('0xe')](0x1f4)[a207_0x2052('0xf')]({'success':![],'data':_0x452810[a207_0x2052('0x10')]});});})['catch'](_0x320c13=>{return _0x665578[a207_0x2052('0xe')](0x1f4)[a207_0x2052('0xf')]({'success':![],'data':_0x320c13['stack']});});}[a207_0x2052('0x3c')](_0x650763,_0x22bcf1){if(_0x650763[a207_0x2052('0x35')][a207_0x2052('0x34')]&&_0x650763['body'][a207_0x2052('0x34')]!=''){const _0x5dc57c=process[a207_0x2052('0x24')][a207_0x2052('0x25')]+a207_0x2052('0x26');const _0x5706ce=_0x650763[a207_0x2052('0x35')][a207_0x2052('0x34')];let _0x428b0a='';const _0x7ce59c=_0x5706ce[a207_0x2052('0x44')](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x5706ce[a207_0x2052('0x45')](/^data:image\/png;base64,/,'')){_0x428b0a=a207_0x2052('0x46');}else if(_0x5706ce[a207_0x2052('0x45')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x428b0a=a207_0x2052('0x47');}const _0x4fafc2=sequelize_utils_1['default'][a207_0x2052('0x48')](_0x22bcf1[a207_0x2052('0x38')]['id']);fsExtra['ensureDirSync'](_0x5dc57c);const _0x50d547=''+_0x5dc57c+this[a207_0x2052('0x17')][a207_0x2052('0x27')]+'_'+_0x4fafc2+'.'+_0x428b0a;console[a207_0x2052('0x16')](a207_0x2052('0x49'),_0x50d547);fsExtra[a207_0x2052('0x4a')](_0x50d547,_0x7ce59c,'base64',function(_0x4c4ad0){console['log']('err:',_0x4c4ad0);});}}}exports['default']=CrudUtils;