var a207_0x11a6=['toJSONLocalizedOnly','lang','toJSON','encryptId','successResponse','stack','headers','env','IMAGE_FILES_FOLDER','images/','name','.jpg','existsSync','.png','base64Sync','parse','stringify','image_data','created_by_user_id','deleted_by_user_id','created_at','password','findByUuid','findOne','uuid','body','findOneAndUpdate','create','decryptId','hashPassword','saveImageFile','dataValues','update','findUuidAndUpdate','length','bind','findOrCreate','remove','replace','png','match','ensureDirSync','log','fileName','base64','__importDefault','__esModule','defineProperty','./sequelize-utils','./crypt-utils','../infrastructure/auth-utils','base64-img','../infrastructure/response-utils','model','i18n','count','errorResponse','authentication\x20failed','params','then','json','catch','status','send','find','offset','query','limit','user','findAll','updated_by_user_id','updated_at','deleted_at','default'];(function(_0x367128,_0x2debf3){var _0x4ac1a6=function(_0x19b3c2){while(--_0x19b3c2){_0x367128['push'](_0x367128['shift']());}};_0x4ac1a6(++_0x2debf3);}(a207_0x11a6,0x10b));var a207_0x411e=function(_0x3ea8f8,_0xcb2478){_0x3ea8f8=_0x3ea8f8-0x0;var _0x2a30f0=a207_0x11a6[_0x3ea8f8];return _0x2a30f0;};'use strict';var __importDefault=this&&this[a207_0x411e('0x0')]||function(_0x34accd){return _0x34accd&&_0x34accd[a207_0x411e('0x1')]?_0x34accd:{'default':_0x34accd};};Object[a207_0x411e('0x2')](exports,a207_0x411e('0x1'),{'value':!![]});const sequelize_utils_1=__importDefault(require(a207_0x411e('0x3')));const crypt_utils_1=__importDefault(require(a207_0x411e('0x4')));const authUtils=require(a207_0x411e('0x5'));const fsExtra=require('fs-extra');const base64Img=require(a207_0x411e('0x6'));const responseUtils=require(a207_0x411e('0x7'));class CrudUtils{constructor(_0x5079de,_0x2e1fa7){this[a207_0x411e('0x8')]=_0x5079de;this[a207_0x411e('0x9')]=_0x2e1fa7;}[a207_0x411e('0xa')](_0x35f559,_0x27e7da,_0x50e7db){if(!_0x35f559['user']){return responseUtils[a207_0x411e('0xb')](_0x27e7da,a207_0x411e('0xc'),0x191);}return this[a207_0x411e('0x8')]['count']({'where':_0x35f559[a207_0x411e('0xd')]})[a207_0x411e('0xe')](_0x3859f1=>{const _0x484bf0=_0x3859f1;if(_0x27e7da){return _0x27e7da[a207_0x411e('0xf')]({'success':!![],'data':{'total':_0x3859f1}});}else{return _0x484bf0;}})[a207_0x411e('0x10')](_0x4a216b=>{if(_0x27e7da){return _0x27e7da[a207_0x411e('0x11')](0x1f4)[a207_0x411e('0x12')]({'success':![],'data':_0x4a216b['stack']});}else{return _0x4a216b['stack'];}});}[a207_0x411e('0x13')](_0x1527e6,_0x30ad86,_0x2bd39f,_0x1dfd7a=![],_0x2e4d41=[],_0x5985e3=null,_0x53919b=![]){const _0x4502c4=_0x1527e6['query'][a207_0x411e('0x14')]?Number(_0x1527e6[a207_0x411e('0x15')]['offset']):null;const _0x1ea93b=_0x1527e6['query'][a207_0x411e('0x16')]?Number(_0x1527e6[a207_0x411e('0x15')][a207_0x411e('0x16')]):null;if(!_0x1527e6[a207_0x411e('0x17')]){return responseUtils[a207_0x411e('0xb')](_0x30ad86,'authentication\x20failed',0x191);}if(!_0x53919b){_0x1527e6['params']['created_by_user_id']=_0x1527e6[a207_0x411e('0x17')]['id'];}return this['model'][a207_0x411e('0x18')]({'attributes':{'exclude':_0x1dfd7a?[]:['created_by_user_id',a207_0x411e('0x19'),'deleted_by_user_id','created_at',a207_0x411e('0x1a'),a207_0x411e('0x1b')]},'where':_0x1527e6[a207_0x411e('0xd')],'offset':_0x4502c4,'limit':_0x1ea93b,'include':_0x2e4d41,'order':_0x5985e3})[a207_0x411e('0xe')](_0x26ed9a=>{let _0xa9c0a1=this[a207_0x411e('0x9')]?sequelize_utils_1[a207_0x411e('0x1c')][a207_0x411e('0x1d')](_0x26ed9a,_0x1527e6['headers'][a207_0x411e('0x1e')]):sequelize_utils_1[a207_0x411e('0x1c')][a207_0x411e('0x1f')](_0x26ed9a);_0xa9c0a1=sequelize_utils_1[a207_0x411e('0x1c')][a207_0x411e('0x20')](_0xa9c0a1);if(_0x30ad86){return responseUtils[a207_0x411e('0x21')](_0x30ad86,_0xa9c0a1,0xc8);}else{return _0xa9c0a1;}})[a207_0x411e('0x10')](_0x5abb86=>{if(_0x30ad86){return responseUtils['errorResponse'](_0x30ad86,_0x5abb86[a207_0x411e('0x22')],0x1f4);}else{return _0x5abb86[a207_0x411e('0x22')];}});}['findById'](_0x2ccb63,_0x13e3f0,_0x16d771){if(!_0x2ccb63['user']){return responseUtils[a207_0x411e('0xb')](_0x13e3f0,a207_0x411e('0xc'),0x191);}_0x2ccb63[a207_0x411e('0xd')]['id']=sequelize_utils_1[a207_0x411e('0x1c')]['decryptId'](_0x2ccb63[a207_0x411e('0xd')]['id']);this[a207_0x411e('0x8')]['findByPk'](_0x2ccb63[a207_0x411e('0xd')]['id'])[a207_0x411e('0xe')](_0x3b1148=>{let _0x1cec86=this[a207_0x411e('0x9')]?sequelize_utils_1[a207_0x411e('0x1c')][a207_0x411e('0x1d')](_0x3b1148,_0x2ccb63[a207_0x411e('0x23')][a207_0x411e('0x1e')]):_0x3b1148;if(_0x1cec86){_0x1cec86=_0x1cec86['dataValues'];_0x1cec86=sequelize_utils_1[a207_0x411e('0x1c')][a207_0x411e('0x20')](_0x1cec86);let _0x5cb32d=process[a207_0x411e('0x24')][a207_0x411e('0x25')]+a207_0x411e('0x26')+this[a207_0x411e('0x8')][a207_0x411e('0x27')]+'_'+_0x1cec86['id']+a207_0x411e('0x28');if(!fsExtra[a207_0x411e('0x29')](_0x5cb32d)){_0x5cb32d=process[a207_0x411e('0x24')][a207_0x411e('0x25')]+a207_0x411e('0x26')+this[a207_0x411e('0x8')][a207_0x411e('0x27')]+'_'+_0x1cec86['id']+a207_0x411e('0x2a');}let _0x3ec5e4=null;if(fsExtra['existsSync'](_0x5cb32d)){_0x3ec5e4=base64Img[a207_0x411e('0x2b')](_0x5cb32d);_0x1cec86=JSON[a207_0x411e('0x2c')](JSON[a207_0x411e('0x2d')](_0x1cec86));_0x1cec86[a207_0x411e('0x2e')]=_0x3ec5e4;}delete _0x1cec86[a207_0x411e('0x2f')];delete _0x1cec86[a207_0x411e('0x19')];delete _0x1cec86[a207_0x411e('0x30')];delete _0x1cec86[a207_0x411e('0x31')];delete _0x1cec86[a207_0x411e('0x1a')];delete _0x1cec86[a207_0x411e('0x1b')];delete _0x1cec86[a207_0x411e('0x32')];}return _0x13e3f0[a207_0x411e('0xf')]({'success':!![],'data':_0x1cec86});})['catch'](_0x4b174f=>{return _0x13e3f0['status'](0x1f4)[a207_0x411e('0x12')]({'success':![],'data':_0x4b174f[a207_0x411e('0x22')]});});}[a207_0x411e('0x33')](_0x447a1a,_0x3a92a9,_0x184e32){if(!_0x447a1a['user']){}this['model'][a207_0x411e('0x34')]({'attributes':{'exclude':[a207_0x411e('0x2f'),a207_0x411e('0x19'),'deleted_by_user_id',a207_0x411e('0x31'),a207_0x411e('0x1a'),a207_0x411e('0x1b')]},'where':{'uuid':_0x447a1a[a207_0x411e('0xd')][a207_0x411e('0x35')]}})[a207_0x411e('0xe')](_0x2064f6=>{let _0x67161e=this[a207_0x411e('0x9')]?sequelize_utils_1[a207_0x411e('0x1c')][a207_0x411e('0x1d')](_0x2064f6,_0x447a1a[a207_0x411e('0x23')][a207_0x411e('0x1e')]):_0x2064f6;if(_0x67161e){const _0x28e74d=process[a207_0x411e('0x24')][a207_0x411e('0x25')]+a207_0x411e('0x26')+_0x67161e[a207_0x411e('0x35')]+a207_0x411e('0x28');let _0x33f340=null;if(fsExtra[a207_0x411e('0x29')](_0x28e74d)){_0x33f340=base64Img[a207_0x411e('0x2b')](_0x28e74d);_0x67161e=JSON[a207_0x411e('0x2c')](JSON[a207_0x411e('0x2d')](_0x67161e));_0x67161e[a207_0x411e('0x2e')]=_0x33f340;}}return _0x3a92a9[a207_0x411e('0xf')]({'success':!![],'data':_0x67161e});})['catch'](_0xb65d06=>{return _0x3a92a9['status'](0x1f4)[a207_0x411e('0x12')]({'success':![],'data':_0xb65d06[a207_0x411e('0x22')]});});}['save'](_0x4d026f,_0x41df42,_0x25c01c){if(!_0x4d026f['user']){return responseUtils[a207_0x411e('0xb')](_0x41df42,a207_0x411e('0xc'),0x191);}if(_0x4d026f[a207_0x411e('0x36')]['id']&&_0x4d026f[a207_0x411e('0x36')]['id']!=''){return this[a207_0x411e('0x37')](_0x4d026f,_0x41df42,_0x25c01c);}else{return this[a207_0x411e('0x38')](_0x4d026f,_0x41df42);}}[a207_0x411e('0x38')](_0x174a40,_0x5ee79a){if(!_0x174a40['user']){return responseUtils[a207_0x411e('0xb')](_0x5ee79a,'authentication\x20failed',0x191);}_0x174a40[a207_0x411e('0x36')]=sequelize_utils_1[a207_0x411e('0x1c')][a207_0x411e('0x39')](_0x174a40['body']);_0x174a40[a207_0x411e('0x36')][a207_0x411e('0x2f')]=_0x174a40['user']['id'];if(_0x174a40[a207_0x411e('0x36')][a207_0x411e('0x32')]&&_0x174a40[a207_0x411e('0x36')][a207_0x411e('0x32')]!=''){_0x174a40['body']['password']=crypt_utils_1[a207_0x411e('0x1c')][a207_0x411e('0x3a')](_0x174a40[a207_0x411e('0x36')][a207_0x411e('0x32')]);}return this[a207_0x411e('0x8')][a207_0x411e('0x38')](_0x174a40[a207_0x411e('0x36')],this[a207_0x411e('0x9')]?{'language_id':_0x174a40[a207_0x411e('0x23')][a207_0x411e('0x1e')]}:{})[a207_0x411e('0xe')](_0x46f30f=>{const _0x3d7b0d=this[a207_0x411e('0x9')]?sequelize_utils_1[a207_0x411e('0x1c')]['toJSONLocalizedOnly'](_0x46f30f,_0x174a40[a207_0x411e('0x23')][a207_0x411e('0x1e')]):_0x46f30f;this[a207_0x411e('0x3b')](_0x174a40,_0x3d7b0d);delete _0x3d7b0d[a207_0x411e('0x3c')]['id'];delete _0x3d7b0d[a207_0x411e('0x3c')]['created_by_user_id'];delete _0x3d7b0d[a207_0x411e('0x3c')][a207_0x411e('0x19')];delete _0x3d7b0d['dataValues']['deleted_by_user_id'];delete _0x3d7b0d[a207_0x411e('0x3c')][a207_0x411e('0x31')];delete _0x3d7b0d[a207_0x411e('0x3c')][a207_0x411e('0x1a')];delete _0x3d7b0d['dataValues'][a207_0x411e('0x1b')];delete _0x3d7b0d[a207_0x411e('0x3c')][a207_0x411e('0x32')];if(_0x5ee79a){return _0x5ee79a[a207_0x411e('0xf')]({'success':!![],'data':_0x3d7b0d});}else{return _0x3d7b0d;}})['catch'](_0x32e5eb=>{if(_0x5ee79a){return _0x5ee79a[a207_0x411e('0x11')](0x1f4)[a207_0x411e('0x12')]({'success':![],'data':_0x32e5eb[a207_0x411e('0x22')]});}else{return _0x32e5eb['stack'];}});}[a207_0x411e('0x37')](_0x41f272,_0x4c618e,_0x16b14e){if(!_0x41f272['user']){return responseUtils[a207_0x411e('0xb')](_0x4c618e,a207_0x411e('0xc'),0x191);}_0x41f272['body']=sequelize_utils_1[a207_0x411e('0x1c')][a207_0x411e('0x39')](_0x41f272[a207_0x411e('0x36')]);_0x41f272[a207_0x411e('0x36')][a207_0x411e('0x19')]=_0x41f272[a207_0x411e('0x17')]['id'];if(_0x41f272[a207_0x411e('0x36')]['password']&&_0x41f272[a207_0x411e('0x36')]['password']!=''){_0x41f272['body'][a207_0x411e('0x32')]=crypt_utils_1[a207_0x411e('0x1c')][a207_0x411e('0x3a')](_0x41f272['body']['password']);}this['model']['findByPk'](_0x41f272['body']['id'])[a207_0x411e('0xe')](_0x404f03=>{if(_0x404f03==null)return _0x4c618e[a207_0x411e('0xf')]({'success':!![],'data':_0x404f03});_0x404f03[a207_0x411e('0x3d')](_0x41f272[a207_0x411e('0x36')],{'language_id':_0x41f272[a207_0x411e('0x23')][a207_0x411e('0x1e')]})[a207_0x411e('0xe')](function(_0x5b84a1){const _0x9764f7=this['i18n']?sequelize_utils_1[a207_0x411e('0x1c')][a207_0x411e('0x1d')](_0x404f03,_0x41f272['headers'][a207_0x411e('0x1e')]):_0x404f03;this[a207_0x411e('0x3b')](_0x41f272,_0x9764f7);delete _0x9764f7[a207_0x411e('0x3c')]['id'];delete _0x9764f7[a207_0x411e('0x3c')][a207_0x411e('0x2f')];delete _0x9764f7['dataValues'][a207_0x411e('0x19')];delete _0x9764f7[a207_0x411e('0x3c')][a207_0x411e('0x30')];delete _0x9764f7[a207_0x411e('0x3c')][a207_0x411e('0x31')];delete _0x9764f7[a207_0x411e('0x3c')][a207_0x411e('0x1a')];delete _0x9764f7['dataValues'][a207_0x411e('0x1b')];delete _0x9764f7[a207_0x411e('0x3c')]['password'];return _0x4c618e['json']({'success':!![],'data':_0x9764f7});}['bind'](this))[a207_0x411e('0x10')](_0x469c34=>{return _0x4c618e[a207_0x411e('0x11')](0x1f4)[a207_0x411e('0x12')]({'success':![],'data':_0x469c34[a207_0x411e('0x22')]});});})['catch'](_0x412314=>{return _0x4c618e[a207_0x411e('0x11')](0x1f4)[a207_0x411e('0x12')]({'success':![],'data':_0x412314[a207_0x411e('0x22')]});});}[a207_0x411e('0x3e')](_0x1e9297,_0x3d5f7b,_0x3f7866){if(!_0x1e9297['user']){return _0x3d5f7b[a207_0x411e('0x11')](0x191)[a207_0x411e('0x12')]({'success':![],'data':a207_0x411e('0xc')});}if(_0x1e9297[a207_0x411e('0x17')]&&_0x1e9297[a207_0x411e('0x17')][a207_0x411e('0x3f')]>0x0){}console['log'](_0x1e9297[a207_0x411e('0xd')]);const _0x1e93b6=_0x1e9297[a207_0x411e('0x36')][a207_0x411e('0x35')]&&_0x1e9297['body'][a207_0x411e('0x35')]!=''?_0x1e9297[a207_0x411e('0x36')][a207_0x411e('0x35')]:_0x1e9297[a207_0x411e('0xd')]['uuid'];this[a207_0x411e('0x8')][a207_0x411e('0x34')]({'where':{'uuid':_0x1e93b6}})['then'](_0xb96c17=>{if(_0xb96c17==null)return _0x3d5f7b[a207_0x411e('0xf')]({'success':!![],'data':_0xb96c17});_0xb96c17[a207_0x411e('0x3d')](_0x1e9297[a207_0x411e('0x36')],{'language_id':_0x1e9297[a207_0x411e('0x23')][a207_0x411e('0x1e')]})[a207_0x411e('0xe')](function(_0x11281c){const _0x1ec12a=this[a207_0x411e('0x9')]?sequelize_utils_1[a207_0x411e('0x1c')][a207_0x411e('0x1d')](_0xb96c17,_0x1e9297['headers'][a207_0x411e('0x1e')]):_0xb96c17;this['saveImageFile'](_0x1e9297,_0x1ec12a);return _0x3d5f7b[a207_0x411e('0xf')]({'success':!![],'data':_0x1ec12a});}['bind'](this))[a207_0x411e('0x10')](_0x202c64=>{return _0x3d5f7b['status'](0x1f4)[a207_0x411e('0x12')]({'success':![],'data':_0x202c64[a207_0x411e('0x22')]});});})[a207_0x411e('0x10')](_0x119a4e=>{return _0x3d5f7b['status'](0x1f4)['send']({'success':![],'data':_0x119a4e[a207_0x411e('0x22')]});});}['updateOrCreate'](_0x9da260,_0x131c44,_0x491a8e,_0x4fedaa=![]){if(!_0x9da260[a207_0x411e('0x17')]){return _0x131c44['status'](0x191)['send']({'success':![],'data':a207_0x411e('0xc')});}if(_0x9da260[a207_0x411e('0x17')]&&_0x9da260[a207_0x411e('0x17')]['length']>0x0){}return this[a207_0x411e('0x8')][a207_0x411e('0x34')]({'where':_0x9da260[a207_0x411e('0xd')]})[a207_0x411e('0xe')](function(_0x4fee81){if(_0x4fee81){return _0x4fee81[a207_0x411e('0x3d')](_0x9da260[a207_0x411e('0x36')])['then'](function(_0x54f0f5){const _0x235693=_0x54f0f5[a207_0x411e('0x3c')];if(_0x4fedaa){delete _0x235693['id'];}if(_0x131c44){return _0x131c44[a207_0x411e('0xf')]({'success':!![],'data':_0x235693});}else{return _0x235693;}}[a207_0x411e('0x40')](this));}else{return this[a207_0x411e('0x8')][a207_0x411e('0x38')](_0x9da260[a207_0x411e('0x36')])[a207_0x411e('0xe')](function(_0x361584){if(_0x131c44){return _0x131c44['json']({'success':!![],'data':_0x361584['toJSON']()});}else{return _0x361584;}});}}['bind'](this))['catch'](_0x345698=>{if(_0x131c44){return _0x131c44[a207_0x411e('0x11')](0x1f4)[a207_0x411e('0x12')]({'success':![],'data':_0x345698['stack']});}else{return _0x345698[a207_0x411e('0x22')];}});}['findOrCreate'](_0x2bf457,_0x596ce9,_0x5e108d){if(!_0x2bf457[a207_0x411e('0x17')]){return _0x596ce9[a207_0x411e('0x11')](0x191)[a207_0x411e('0x12')]({'success':![],'data':a207_0x411e('0xc')});}_0x2bf457['body'][a207_0x411e('0x2f')]=_0x2bf457['user']['id'];return this[a207_0x411e('0x8')][a207_0x411e('0x41')]({'where':{'uuid':_0x2bf457[a207_0x411e('0x36')][a207_0x411e('0x35')]},'defaults':_0x2bf457['body']})['then']((_0x4da26e,_0x515865)=>{if(_0x515865){}else{}return _0x596ce9[a207_0x411e('0xf')]({'success':!![],'data':_0x4da26e});})[a207_0x411e('0x10')](_0x1dc946=>{return _0x596ce9[a207_0x411e('0x11')](0x1f4)[a207_0x411e('0x12')]({'success':![],'data':_0x1dc946[a207_0x411e('0x22')]});});}[a207_0x411e('0x42')](_0x457e79,_0x3e6539,_0x2b74e7){if(!_0x457e79[a207_0x411e('0x17')]||_0x457e79['user'][a207_0x411e('0x3f')]==0x0){return _0x3e6539[a207_0x411e('0x11')](0x191)[a207_0x411e('0x12')]({'success':![],'data':a207_0x411e('0xc')});}_0x457e79['params']['id']=sequelize_utils_1['default'][a207_0x411e('0x39')](_0x457e79[a207_0x411e('0xd')]['id']);this['model']['findByPk'](_0x457e79[a207_0x411e('0xd')]['id'])['then'](_0x43ffb9=>{if(_0x43ffb9==null)return _0x3e6539['json']({'success':!![],'data':_0x43ffb9});_0x43ffb9['update']({'deleted_by_user_id':_0x457e79[a207_0x411e('0x17')]['id']},{'language_id':_0x457e79[a207_0x411e('0x23')]['lang']})[a207_0x411e('0xe')](function(_0x3b5782){_0x43ffb9['destroy']()[a207_0x411e('0xe')](function(_0x43ffb9){return _0x3e6539['json']({'success':!![],'data':_0x43ffb9});})['catch'](_0x55c3e3=>{return _0x3e6539[a207_0x411e('0x11')](0x1f4)[a207_0x411e('0x12')]({'success':![],'data':_0x55c3e3[a207_0x411e('0x22')]});});}['bind'](this))['catch'](_0x33235f=>{return _0x3e6539['status'](0x1f4)['send']({'success':![],'data':_0x33235f[a207_0x411e('0x22')]});});})[a207_0x411e('0x10')](_0x163716=>{return _0x3e6539[a207_0x411e('0x11')](0x1f4)[a207_0x411e('0x12')]({'success':![],'data':_0x163716[a207_0x411e('0x22')]});});}[a207_0x411e('0x3b')](_0x12967e,_0x4a53a4){if(_0x12967e[a207_0x411e('0x36')]['image_data']&&_0x12967e[a207_0x411e('0x36')]['image_data']!=''){const _0x5ac459=process[a207_0x411e('0x24')][a207_0x411e('0x25')]+a207_0x411e('0x26');const _0x43982f=_0x12967e['body']['image_data'];let _0x5ee6eb='';const _0x5470bd=_0x43982f[a207_0x411e('0x43')](/^data:image\/(png|jpeg|jpg);base64,/,'');if(_0x43982f['match'](/^data:image\/png;base64,/,'')){_0x5ee6eb=a207_0x411e('0x44');}else if(_0x43982f[a207_0x411e('0x45')](/^data:image\/(jpg|jpeg);base64,/,'')){_0x5ee6eb='jpg';}const _0x50d289=sequelize_utils_1[a207_0x411e('0x1c')][a207_0x411e('0x20')](_0x4a53a4['dataValues']['id']);fsExtra[a207_0x411e('0x46')](_0x5ac459);const _0x24d9f8=''+_0x5ac459+this[a207_0x411e('0x8')][a207_0x411e('0x27')]+'_'+_0x50d289+'.'+_0x5ee6eb;console[a207_0x411e('0x47')](a207_0x411e('0x48'),_0x24d9f8);fsExtra['writeFile'](_0x24d9f8,_0x5470bd,a207_0x411e('0x49'),function(_0x2bc5b8){console[a207_0x411e('0x47')]('err:',_0x2bc5b8);});}}}exports['default']=CrudUtils;